###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         17/Dec/2014  18:09:18 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\sta #
#                          ck\zdo\ZDApp.c                                     #
#    Command line       =  -f "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\z #
#                          stack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wEndev.cfg" (-DCPU32MHZ                   #
#                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3         #
#                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC253 #
#                          0DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=1         #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=60            #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=30           #
#                          -DNWK_MAX_BINDING_ENTRIES=1                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 -DASSERT_RESET         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=8000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=1000)  #
#                          -DREJOIN_POLL_RATE=440 "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Components\stack\zdo\ZDApp.c" -D         #
#                          NV_INIT -D NV_RESTORE -D HOLD_AUTO_START -D        #
#                          MT_TASK -D xMT_APP_FUNC -D MT_SYS_FUNC -D          #
#                          MT_ZDO_FUNC -D xMT_ZDO_MGMT -D ISR_KEYINTERRUPT    #
#                          -D POWER_SAVING -D LONG_POLL_TIMES -D xSR_PIR -D   #
#                          CR2_DATA_NODETECT -D xHAVE_TEST_FUN -D             #
#                          RESUME_TIME_TEST -D FLOOD_SENSOR_device -lC        #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\FLOOD_SENSOR_ED_devi #
#                          ce\List\" -lA "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8 #
#                          \Projects\zstack\Samples\SampleApp\CC2530DB\FLOOD_ #
#                          SENSOR_ED_device\List\" --diag_suppress            #
#                          Pe001,Pa010 -o "D:\RE_1_2_0_FORMAL_APP(251)-14-12- #
#                          8\Projects\zstack\Samples\SampleApp\CC2530DB\FLOOD #
#                          _SENSOR_ED_device\Obj\" -e --no_cse --no_unroll    #
#                          --no_inline --no_code_motion --no_tbaa --debug     #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\RE_1_2_0_FORMAL_APP(25 #
#                          1)-14-12-8\Projects\zstack\Samples\SampleApp\CC253 #
#                          0DB\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\Source\" #
#                           -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\..\Source\FLOOD_ #
#                          SENSOR_device\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14 #
#                          -12-8\Projects\zstack\Samples\SampleApp\CC2530DB\. #
#                          .\..\..\ZMain\TI2530DB\" -I                        #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\include\" -I "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\Components\hal\target\CC2530EB\" #
#                           -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\C #
#                          omponents\mac\include\" -I                         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\high_level\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\" -I                     #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\single_chip\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mt\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8 #
#                          \Projects\zstack\Samples\SampleApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\osal\include\" -I              #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\saddr\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\sdata\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\af\" -I "D:\RE_1_2_0_FORMAL_APP(251)-1 #
#                          4-12-8\Projects\zstack\Samples\SampleApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\nwk\" -I           #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sapi\" -I "D:\RE_1_2_0_FORMAL_APP(251) #
#                          -14-12-8\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\Components\stack\sec\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sys\" -I "D:\RE_1_2_0_FORMAL_APP(251)- #
#                          14-12-8\Projects\zstack\Samples\SampleApp\CC2530DB #
#                          \..\..\..\..\..\Components\stack\zdo\" -I          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\zmac\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12 #
#                          -8\Projects\zstack\Samples\SampleApp\CC2530DB\..\. #
#                          .\..\..\..\Components\zmac\f8w\" -On               #
#                          --require_prototypes                               #
#    List file          =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\FLOOD_SENSOR_ED_devic #
#                          e\List\ZDApp.lst                                   #
#    Object file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\FLOOD_SENSOR_ED_devic #
#                          e\Obj\ZDApp.r51                                    #
#                                                                             #
#                                                                             #
###############################################################################

D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2012-02-16 16:04:32 -0800 (Thu, 16 Feb 2012) $
      4            Revision:       $Revision: 29348 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the user can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "ZMac.h"
     47          #include "OSAL.h"
     48          #include "OSAL_Tasks.h"
     49          #include "OSAL_PwrMgr.h"
     50          #include "OSAL_Nv.h"
     51          #include "AF.h"
     52          #include "APSMEDE.h"
     53          #include "NLMEDE.h"
     54          #include "AddrMgr.h"
     55          #include "ZDProfile.h"
     56          #include "ZDObject.h"
     57          #include "ZDConfig.h"
     58          #include "ZDSecMgr.h"
     59          #include "ZDApp.h"
     60          #include "DebugTrace.h"
     61          #include "nwk_util.h"
     62          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1
     63          #include "ZGlobals.h"
     64          #include "ZDNwkMgr.h"
     65          #include "rtg.h"
     66          
     67          #include "ssp.h"
     68          
     69          /* HAL */
     70          #include "hal_led.h"
     71          #include "hal_lcd.h"
     72          #include "hal_key.h"
     73          //#include "my_time.h"
     74          #include "MT_UART.h"
     75          #include "ZDO_LIB.h"
     76          #include "common_device.h"
     77          
     78          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     79            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     80          #endif
     81          
     82          /*********************************************************************
     83           * CONSTANTS
     84           */
     85          
     86          #if !defined( NWK_START_DELAY )
     87            #define NWK_START_DELAY             100   // in milliseconds
     88          #endif
     89          
     90          #if !defined( LEAVE_RESET_DELAY )
     91            #define LEAVE_RESET_DELAY           5000  // in milliseconds
     92          #endif
     93          
     94          // Init ZDO, but hold and wait for application to start the joining or
     95          // forming network
     96          #define ZDO_INIT_HOLD_NWK_START       0xFFFF
     97          
     98          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     99            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
    100          #endif
    101          
    102          #if !defined( BEACON_REQUEST_DELAY )
    103            #define BEACON_REQUEST_DELAY        100   // in milliseconds
    104          #endif
    105          
    106          #if !defined( BEACON_REQ_DELAY_MASK )
    107            #define BEACON_REQ_DELAY_MASK       0x007F
    108          #endif
    109          
    110          #define MAX_RESUME_RETRY            3
    111          
    112          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    113          
    114          // Beacon Order Settings (see NLMEDE.h)
    115          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    116          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    117          
    118          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    119            // The number of times the frame counter can change before
    120            // saving to NV
    121            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    122          #endif
    123          
    124          // Leave control bits
    125          #define ZDAPP_LEAVE_CTRL_INIT 0
    126          #define ZDAPP_LEAVE_CTRL_SET  1
    127          #define ZDAPP_LEAVE_CTRL_RA   2
    128          
    129          // Address Manager Stub Implementation
    130          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    131          
    132          
    133          #if !defined ZDO_NV_SAVE_RFDs
    134          #define ZDO_NV_SAVE_RFDs  TRUE
    135          #endif
    136          
    137          // Delay time before updating NWK NV data to force fewer writes during high activity.
    138          #if ZDO_NV_SAVE_RFDs
    139          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    140          #else
    141          #define ZDAPP_UPDATE_NWK_NV_TIME 65000
    142          #endif
    143          
    144          /*********************************************************************
    145           * GLOBAL VARIABLES
    146           */
    147          
    148          #if defined( LCD_SUPPORTED )
    149            uint8 MatchRsps = 0;
    150          #endif
    151          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    152          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    155          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    161          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    162          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    163          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    164          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    165          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    166          
    167          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    168          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    169          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 14
   \   00000E                REQUIRE __INIT_XDATA_Z
    171          
    172          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    173             uint8 ZDO_FIRST_join_flag = 0; //¼ûNOTE
   \                     ZDO_FIRST_join_flag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    174                
    175                extern uint8  SampleApp_TaskID;
    176          
    177          
    178            
    179            
    180              void ZDO_DEVICE_DISC(void);
    181            
    182          /*********************************************************************
    183           * EXTERNAL VARIABLES
    184           */
    185          
    186          /*********************************************************************
    187           * EXTERNAL FUNCTIONS
    188           */
    189          
    190          /*********************************************************************
    191           * LOCAL FUNCTIONS
    192           */
    193          
    194          void ZDApp_NetworkStartEvt( void );
    195          void ZDApp_DeviceAuthEvt( void );
    196          void ZDApp_SaveNetworkStateEvt( void );
    197          
    198          uint8 ZDApp_ReadNetworkRestoreState( void );
    199          uint8 ZDApp_RestoreNetworkState( void );
    200          void ZDAppDetermineDeviceType( void );
    201          void ZDApp_InitUserDesc( void );
    202          void ZDAppCheckForHoldKey( void );
    203          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    204          void ZDApp_ProcessNetworkJoin( void );
    205          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    206          uint8 ZDApp_RestoreNwkKey( void );
    207          networkDesc_t* ZDApp_NwkDescListProcessing(void);
    208          
    209          void ZDApp_SecInit( uint8 state );
    210          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    211          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    212          
    213          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    214          
    215          void ZDApp_ResetTimerStart( uint16 delay );
    216          void ZDApp_ResetTimerCancel( void );
    217          void ZDApp_LeaveCtrlInit( void );
    218          void ZDApp_LeaveCtrlSet( uint8 ra );
    219          uint8 ZDApp_LeaveCtrlBypass( void );
    220          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    221          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    222                                  uint8 removeChildren );
    223          void ZDApp_NodeProfileSync( uint8 stackProfile );
    224          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    225          void ZDApp_RegisterCBs( void );
    226          void ZDApp_InitZdoCBFunc(void);
    227          
    228          /*********************************************************************
    229           * LOCAL VARIABLES
    230           */
    231          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    232          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    233          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    234          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    235          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    236          
    237          #if defined( HOLD_AUTO_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    238            devStates_t devState = DEV_HOLD;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    239          #else
    240            devStates_t devState = DEV_INIT;
    241          #endif
    242          
    243          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    244            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    245            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    246                                  // to parent. Set to make the device do an Orphan scan.
    247          #else
    248            // Set the default to coodinator
    249            devStartModes_t devStartMode = MODE_HARD;
    250          #endif
    251          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    252          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    253          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    254          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    255          {
    256            ZDO_EP,
    257            &ZDAppTaskID,
    258            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    259            (afNetworkLatencyReq_t)0            // No Network Latency req
    260          };
    261          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    262          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    263          
    264          /*********************************************************************
    265           * @fn      ZDApp_Init
    266           *
    267           * @brief   ZDApp Initialization function.
    268           *
    269           * @param   task_id - ZDApp Task ID
    270           *
    271           * @return  None
    272           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    273          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    274          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    275            // Save the task ID
    276            ZDAppTaskID = task_id;
   \   000007   90....       MOV     DPTR,#ZDAppTaskID
   \   00000A   F0           MOVX    @DPTR,A
    277          
    278            // Initialize the ZDO global device short address storage
    279            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000B   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000E   7402         MOV     A,#0x2
   \   000010   F0           MOVX    @DPTR,A
    280            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000011   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000014   74FE         MOV     A,#-0x2
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   74FF         MOV     A,#-0x1
   \   00001A   F0           MOVX    @DPTR,A
    281            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001B                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001B   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00001E   8A..         MOV     ?V0 + 2,R2
   \   000020   8B..         MOV     ?V0 + 3,R3
   \   000022   85....       MOV     ?V0 + 0,?V0 + 2
   \   000025   85....       MOV     ?V0 + 1,?V0 + 3
    282          
    283            // Check for manual "Hold Auto Start"
    284            ZDAppCheckForHoldKey();
   \   000028                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   000028   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    285          
    286            // Initialize ZDO items and setup the device - type of device to create.
    287            ZDO_Init();
   \   00002B                ; Setup parameters for call to function ZDO_Init
   \   00002B   12....       LCALL   ??ZDO_Init?relay
    288          
    289            // Register the endpoint description with the AF
    290            // This task doesn't have a Simple description, but we still need
    291            // to register the endpoint.
    292            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   00002E                ; Setup parameters for call to function afRegister
   \   00002E   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000030   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000032   12....       LCALL   ??afRegister?relay
   \   000035   E9           MOV     A,R1
    293          
    294          #if defined( ZDO_USERDESC_RESPONSE )
    295            ZDApp_InitUserDesc();
   \   000036                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000036   12....       LCALL   ??ZDApp_InitUserDesc?relay
    296          #endif // ZDO_USERDESC_RESPONSE
    297          
    298            // Start the device?
    299            if ( devState != DEV_HOLD )
   \   000039   90....       MOV     DPTR,#devState
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   600A         JZ      ??ZDApp_Init_0
    300            {
    301              ZDOInitDevice( 0 );
   \   00003F                ; Setup parameters for call to function ZDOInitDevice
   \   00003F   7A00         MOV     R2,#0x0
   \   000041   7B00         MOV     R3,#0x0
   \   000043   12....       LCALL   ??ZDOInitDevice?relay
   \   000046   E9           MOV     A,R1
   \   000047   8011         SJMP    ??ZDApp_Init_1
    302            }
    303            else
    304            {
    305              ZDOInitDevice( ZDO_INIT_HOLD_NWK_START );
   \                     ??ZDApp_Init_0:
   \   000049                ; Setup parameters for call to function ZDOInitDevice
   \   000049   7AFF         MOV     R2,#-0x1
   \   00004B   7BFF         MOV     R3,#-0x1
   \   00004D   12....       LCALL   ??ZDOInitDevice?relay
   \   000050   E9           MOV     A,R1
    306              // Blink LED to indicate HOLD_START
    307             // HalLedBlink ( HAL_LED_4, 0, 50, 500 );
    308              HAL_TURN_OFF_LED1();
   \   000051   D290         SETB    0x90.0
    309              HAL_TURN_OFF_LED2();
   \   000053   D286         SETB    0x80.6
    310              #if defined ( POWER_SAVING )
    311               osal_pwrmgr_device( PWRMGR_BATTERY );
   \   000055                ; Setup parameters for call to function osal_pwrmgr_device
   \   000055   7901         MOV     R1,#0x1
   \   000057   12....       LCALL   ??osal_pwrmgr_device?relay
    312              #endif
    313               
    314            }
    315          
    316            // Initialize the ZDO callback function pointers zdoCBFunc[]
    317            ZDApp_InitZdoCBFunc();
   \                     ??ZDApp_Init_1:
   \   00005A                ; Setup parameters for call to function ZDApp_InitZdoCBFunc
   \   00005A   12....       LCALL   ??ZDApp_InitZdoCBFunc?relay
    318          
    319            ZDApp_RegisterCBs();
   \   00005D                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   00005D   12....       LCALL   ??ZDApp_RegisterCBs?relay
    320          } /* ZDApp_Init() */
   \   000060   7F04         MOV     R7,#0x4
   \   000062   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000065                REQUIRE _A_P1
   \   000065                REQUIRE _A_P0
    321          
    322          /*********************************************************************
    323           * @fn          ZDApp_SecInit
    324           *
    325           * @brief       ZDApp initialize security.
    326           *
    327           * @param       state - device initialization state
    328           *
    329           * @return      none
    330           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    331          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    332          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    333            uint8 zgPreConfigKey[SEC_KEY_LEN];
    334          
    335            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    336            {
    337              // Set the Trust Center bit
    338              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    339            }
    340          
    341            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    342            {
    343              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    344            }
    345          
    346            // Initialize ZigBee Device Security Manager
    347            ZDSecMgrInit(state);
   \   00000C                ; Setup parameters for call to function ZDSecMgrInit
   \   00000C   EE           MOV     A,R6
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??ZDSecMgrInit?relay
    348          
    349            if ( ZG_SECURE_ENABLED )
    350            {
    351              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
   \   000011   EE           MOV     A,R6
   \   000012   6059         JZ      ??ZDApp_SecInit_0
    352              {
    353                nwkFrameCounter = 0;
   \   000014   90....       MOV     DPTR,#__Constant_0
   \   000017   12....       LCALL   ?XLOAD_R2345
   \   00001A   90....       MOV     DPTR,#nwkFrameCounter
   \   00001D   12....       LCALL   ?XSTORE_R2345
    354          
    355                if( _NIB.nwkKeyLoaded == FALSE )
   \   000020   90....       MOV     DPTR,#_NIB + 61
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7047         JNZ     ??ZDApp_SecInit_0
    356                {
    357                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    358                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
   \   000026   90....       MOV     DPTR,#zgSecurityMode
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   6401         XRL     A,#0x1
   \   00002C   703F         JNZ     ??ZDApp_SecInit_0
   \   00002E   90....       MOV     DPTR,#zgPreConfigKeys
   \   000031   E0           MOVX    A,@DPTR
   \   000032   6039         JZ      ??ZDApp_SecInit_0
    359                  {
    360                      ZDSecMgrReadKeyFromNv(ZCD_NV_PRECFGKEY, zgPreConfigKey);
   \   000034                ; Setup parameters for call to function ZDSecMgrReadKeyFromNv
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A62         MOV     R2,#0x62
   \   000040   7B00         MOV     R3,#0x0
   \   000042   12....       LCALL   ??ZDSecMgrReadKeyFromNv?relay
   \   000045   E9           MOV     A,R1
    361                      SSP_UpdateNwkKey( zgPreConfigKey, 0);
   \   000046                ; Setup parameters for call to function SSP_UpdateNwkKey
   \   000046   7900         MOV     R1,#0x0
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   AA82         MOV     R2,DPL
   \   000050   AB83         MOV     R3,DPH
   \   000052   12....       LCALL   ??SSP_UpdateNwkKey?relay
    362                      SSP_SwitchNwkKey( 0 );
   \   000055                ; Setup parameters for call to function SSP_SwitchNwkKey
   \   000055   7900         MOV     R1,#0x0
   \   000057   12....       LCALL   ??SSP_SwitchNwkKey?relay
    363          
    364                      // clear local copy of key
    365                      osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
   \   00005A                ; Setup parameters for call to function osal_memset
   \   00005A   7C10         MOV     R4,#0x10
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   7900         MOV     R1,#0x0
   \   000060   85..82       MOV     DPL,?XSP + 0
   \   000063   85..83       MOV     DPH,?XSP + 1
   \   000066   AA82         MOV     R2,DPL
   \   000068   AB83         MOV     R3,DPH
   \   00006A   12....       LCALL   ??osal_memset?relay
    366                  }
    367                }
    368              }
    369            }
    370          }
   \                     ??ZDApp_SecInit_0:
   \   00006D   7410         MOV     A,#0x10
   \   00006F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000072   7F01         MOV     R7,#0x1
   \   000074   02....       LJMP    ?BANKED_LEAVE_XDATA
    371          
    372          /*********************************************************************
    373           * @fn      ZDApp_event_loop()
    374           *
    375           * @brief   Main event loop for Zigbee device objects task. This function
    376           *          should be called at periodic intervals.
    377           *
    378           * @param   task_id - Task ID
    379           * @param   events  - Bitmap of events
    380           *
    381           * @return  none
    382           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    383          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    384          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    385            uint8 *msg_ptr;
    386          
    387            if ( events & SYS_EVENT_MSG )
   \   00000B   EE           MOV     A,R6
   \   00000C   5400         ANL     A,#0x0
   \   00000E   F8           MOV     R0,A
   \   00000F   EF           MOV     A,R7
   \   000010   5480         ANL     A,#0x80
   \   000012   F9           MOV     R1,A
   \   000013   E8           MOV     A,R0
   \   000014   49           ORL     A,R1
   \   000015   6034         JZ      ??ZDApp_event_loop_0
    388            {
    389              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
   \                     ??ZDApp_event_loop_1:
   \   000017                ; Setup parameters for call to function osal_msg_receive
   \   000017   90....       MOV     DPTR,#ZDAppTaskID
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??osal_msg_receive?relay
   \   00001F   8A..         MOV     ?V0 + 4,R2
   \   000021   8B..         MOV     ?V0 + 5,R3
   \   000023   A8..         MOV     R0,?V0 + 4
   \   000025   A9..         MOV     R1,?V0 + 5
   \   000027   88..         MOV     ?V0 + 2,R0
   \   000029   89..         MOV     ?V0 + 3,R1
   \   00002B   E8           MOV     A,R0
   \   00002C   49           ORL     A,R1
   \   00002D   6011         JZ      ??ZDApp_event_loop_2
    390              {
    391                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
   \   00002F                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00002F   AA..         MOV     R2,?V0 + 2
   \   000031   AB..         MOV     R3,?V0 + 3
   \   000033   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
    392          
    393                // Release the memory
    394                osal_msg_deallocate( msg_ptr );
   \   000036                ; Setup parameters for call to function osal_msg_deallocate
   \   000036   AA..         MOV     R2,?V0 + 2
   \   000038   AB..         MOV     R3,?V0 + 3
   \   00003A   12....       LCALL   ??osal_msg_deallocate?relay
   \   00003D   E9           MOV     A,R1
   \   00003E   80D7         SJMP    ??ZDApp_event_loop_1
    395              }
    396          
    397              // Return unprocessed events
    398              return (events ^ SYS_EVENT_MSG);
   \                     ??ZDApp_event_loop_2:
   \   000040   EE           MOV     A,R6
   \   000041   6400         XRL     A,#0x0
   \   000043   FA           MOV     R2,A
   \   000044   EF           MOV     A,R7
   \   000045   6480         XRL     A,#0x80
   \   000047   FB           MOV     R3,A
   \   000048   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    399            }
    400          
    401            if ( events & ZDO_NETWORK_INIT )
   \                     ??ZDApp_event_loop_0:
   \   00004B   EE           MOV     A,R6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   5051         JNC     ??ZDApp_event_loop_4
    402            {
    403              // Initialize apps and start the network
    404              
    405            if(zdoDiscCounter<10)
   \   000050   90....       MOV     DPTR,#zdoDiscCounter
   \   000053   E0           MOVX    A,@DPTR
   \   000054   C3           CLR     C
   \   000055   940A         SUBB    A,#0xa
   \   000057   5003         JNC     ??ZDApp_event_loop_5
    406            {  
    407              // HalLedBlink ( HAL_LED_1, 1, 30, 1000 );
    408                  USER_ZDO_JOINING_MSG();
   \   000059                ; Setup parameters for call to function USER_ZDO_JOINING_MSG
   \   000059   12....       LCALL   ??USER_ZDO_JOINING_MSG?relay
    409            } 
    410            
    411              devState = DEV_INIT;
   \                     ??ZDApp_event_loop_5:
   \   00005C   90....       MOV     DPTR,#devState
   \   00005F   7401         MOV     A,#0x1
   \   000061   F0           MOVX    @DPTR,A
    412              
    413              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000062                ; Setup parameters for call to function osal_set_event
   \   000062   7A10         MOV     R2,#0x10
   \   000064   7B00         MOV     R3,#0x0
   \   000066   90....       MOV     DPTR,#ZDAppTaskID
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F9           MOV     R1,A
   \   00006B   12....       LCALL   ??osal_set_event?relay
   \   00006E   E9           MOV     A,R1
    414          
    415              
    416               if( (devStartMode == MODE_HARD) || (devStartMode == MODE_JOIN))
   \   00006F   90....       MOV     DPTR,#devStartMode
   \   000072   E0           MOVX    A,@DPTR
   \   000073   6402         XRL     A,#0x2
   \   000075   6006         JZ      ??ZDApp_event_loop_6
   \   000077   90....       MOV     DPTR,#devStartMode
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   7006         JNZ     ??ZDApp_event_loop_7
    417             {
    418               ZDO_FIRST_join_flag = 1;
   \                     ??ZDApp_event_loop_6:
   \   00007D   90....       MOV     DPTR,#ZDO_FIRST_join_flag
   \   000080   7401         MOV     A,#0x1
   \   000082   F0           MOVX    @DPTR,A
    419             }
    420              
    421              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    422                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \                     ??ZDApp_event_loop_7:
   \   000083                ; Setup parameters for call to function ZDO_StartDevice
   \   000083   7C0F         MOV     R4,#0xf
   \   000085   7B0F         MOV     R3,#0xf
   \   000087   90....       MOV     DPTR,#devStartMode
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   FA           MOV     R2,A
   \   00008C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   5407         ANL     A,#0x7
   \   000092   F9           MOV     R1,A
   \   000093   12....       LCALL   ??ZDO_StartDevice?relay
    423          
    424              // Return unprocessed events
    425              return (events ^ ZDO_NETWORK_INIT);
   \   000096   EE           MOV     A,R6
   \   000097   6401         XRL     A,#0x1
   \   000099   FA           MOV     R2,A
   \   00009A   EF           MOV     A,R7
   \   00009B   6400         XRL     A,#0x0
   \   00009D   FB           MOV     R3,A
   \   00009E   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    426            }
    427            
    428          
    429             if ( events & ZDO_ENDDIVCE_DISC )
   \                     ??ZDApp_event_loop_4:
   \   0000A1   EE           MOV     A,R6
   \   0000A2   5400         ANL     A,#0x0
   \   0000A4   F8           MOV     R0,A
   \   0000A5   EF           MOV     A,R7
   \   0000A6   5420         ANL     A,#0x20
   \   0000A8   F9           MOV     R1,A
   \   0000A9   E8           MOV     A,R0
   \   0000AA   49           ORL     A,R1
   \   0000AB   600E         JZ      ??ZDApp_event_loop_8
    430            
    431             { 
    432              ZDO_DEVICE_DISC();     
   \   0000AD                ; Setup parameters for call to function ZDO_DEVICE_DISC
   \   0000AD   12....       LCALL   ??ZDO_DEVICE_DISC?relay
    433              return (events ^ ZDO_ENDDIVCE_DISC);
   \   0000B0   EE           MOV     A,R6
   \   0000B1   6400         XRL     A,#0x0
   \   0000B3   FA           MOV     R2,A
   \   0000B4   EF           MOV     A,R7
   \   0000B5   6420         XRL     A,#0x20
   \   0000B7   FB           MOV     R3,A
   \   0000B8   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    434            }
    435            
    436             if ( events & ZDO_ENDDIVCE_REJOIN )
   \                     ??ZDApp_event_loop_8:
   \   0000BB   EE           MOV     A,R6
   \   0000BC   5400         ANL     A,#0x0
   \   0000BE   F8           MOV     R0,A
   \   0000BF   EF           MOV     A,R7
   \   0000C0   5440         ANL     A,#0x40
   \   0000C2   F9           MOV     R1,A
   \   0000C3   E8           MOV     A,R0
   \   0000C4   49           ORL     A,R1
   \   0000C5   601D         JZ      ??ZDApp_event_loop_9
    437            {
    438              if((devState ==DEV_NWK_REJOIN)|| (devState ==DEV_NWK_DISC))
   \   0000C7   90....       MOV     DPTR,#devState
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   6404         XRL     A,#0x4
   \   0000CD   6008         JZ      ??ZDApp_event_loop_10
   \   0000CF   90....       MOV     DPTR,#devState
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   6402         XRL     A,#0x2
   \   0000D5   7003         JNZ     ??ZDApp_event_loop_11
    439              {
    440                ZDO_ACK_DEAL_WITH();
   \                     ??ZDApp_event_loop_10:
   \   0000D7                ; Setup parameters for call to function ZDO_ACK_DEAL_WITH
   \   0000D7   12....       LCALL   ??ZDO_ACK_DEAL_WITH?relay
    441              }
    442              
    443             return (events ^ ZDO_ENDDIVCE_REJOIN);
   \                     ??ZDApp_event_loop_11:
   \   0000DA   EE           MOV     A,R6
   \   0000DB   6400         XRL     A,#0x0
   \   0000DD   FA           MOV     R2,A
   \   0000DE   EF           MOV     A,R7
   \   0000DF   6440         XRL     A,#0x40
   \   0000E1   FB           MOV     R3,A
   \   0000E2   8071         SJMP    ??ZDApp_event_loop_3
    444            }
    445            
    446          
    447          
    448            
    449          
    450            if ( ZSTACK_ROUTER_BUILD )
    451            {
    452              if ( events & ZDO_NETWORK_START )
    453              {
    454                ZDApp_NetworkStartEvt();
    455          
    456                // Return unprocessed events
    457                return (events ^ ZDO_NETWORK_START);
    458              }
    459          
    460              if ( events & ZDO_ROUTER_START )
    461              {
    462                if ( nwkStatus == ZSuccess )
    463                {
    464                  if ( devState == DEV_END_DEVICE )
    465                    devState = DEV_ROUTER;
    466          
    467                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    468                }
    469                else
    470                {
    471                  // remain as end device!!
    472                }
    473                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    474          
    475                // Return unprocessed events
    476                return (events ^ ZDO_ROUTER_START);
    477              }
    478            }
    479          
    480            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_9:
   \   0000E4   EE           MOV     A,R6
   \   0000E5   5410         ANL     A,#0x10
   \   0000E7   602B         JZ      ??ZDApp_event_loop_12
    481            {
    482              ZDO_UpdateNwkStatus( devState );
   \   0000E9                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   0000E9   90....       MOV     DPTR,#devState
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   F9           MOV     R1,A
   \   0000EE   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    483          
    484              // At start up, do one MTO route discovery if the device is a concentrator
    485              if ( zgConcentratorEnable == TRUE )
   \   0000F1   90....       MOV     DPTR,#zgConcentratorEnable
   \   0000F4   E0           MOVX    A,@DPTR
   \   0000F5   6401         XRL     A,#0x1
   \   0000F7   7011         JNZ     ??ZDApp_event_loop_13
    486              {
    487                // Start next event
    488                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   0000F9                ; Setup parameters for call to function osal_start_timerEx
   \   0000F9   7C64         MOV     R4,#0x64
   \   0000FB   7D00         MOV     R5,#0x0
   \   0000FD   7A00         MOV     R2,#0x0
   \   0000FF   7B08         MOV     R3,#0x8
   \   000101   90....       MOV     DPTR,#NWK_TaskID
   \   000104   E0           MOVX    A,@DPTR
   \   000105   F9           MOV     R1,A
   \   000106   12....       LCALL   ??osal_start_timerEx?relay
   \   000109   E9           MOV     A,R1
    489              }
    490          
    491              // Return unprocessed events
    492              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??ZDApp_event_loop_13:
   \   00010A   EE           MOV     A,R6
   \   00010B   6410         XRL     A,#0x10
   \   00010D   FA           MOV     R2,A
   \   00010E   EF           MOV     A,R7
   \   00010F   6400         XRL     A,#0x0
   \   000111   FB           MOV     R3,A
   \   000112   8041         SJMP    ??ZDApp_event_loop_3
    493            }
    494          
    495            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_12:
   \   000114   EE           MOV     A,R6
   \   000115   5408         ANL     A,#0x8
   \   000117   600A         JZ      ??ZDApp_event_loop_14
    496            {
    497              // User defined logic
    498          
    499              // Return unprocessed events
    500              return (events ^ ZDO_COMMAND_CNF);
   \   000119   EE           MOV     A,R6
   \   00011A   6408         XRL     A,#0x8
   \   00011C   FA           MOV     R2,A
   \   00011D   EF           MOV     A,R7
   \   00011E   6400         XRL     A,#0x0
   \   000120   FB           MOV     R3,A
   \   000121   8032         SJMP    ??ZDApp_event_loop_3
    501            }
    502          
    503            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_14:
   \   000123   EE           MOV     A,R6
   \   000124   5400         ANL     A,#0x0
   \   000126   F8           MOV     R0,A
   \   000127   EF           MOV     A,R7
   \   000128   5402         ANL     A,#0x2
   \   00012A   F9           MOV     R1,A
   \   00012B   E8           MOV     A,R0
   \   00012C   49           ORL     A,R1
   \   00012D   600D         JZ      ??ZDApp_event_loop_15
    504            {
    505              ZDApp_SaveNetworkStateEvt();
   \   00012F                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   00012F   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    506          
    507              // Return unprocessed events
    508              return (events ^ ZDO_NWK_UPDATE_NV);
   \   000132   EE           MOV     A,R6
   \   000133   6400         XRL     A,#0x0
   \   000135   FA           MOV     R2,A
   \   000136   EF           MOV     A,R7
   \   000137   6402         XRL     A,#0x2
   \   000139   FB           MOV     R3,A
   \   00013A   8019         SJMP    ??ZDApp_event_loop_3
    509            }
    510          
    511            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_15:
   \   00013C   EE           MOV     A,R6
   \   00013D   5404         ANL     A,#0x4
   \   00013F   600B         JZ      ??ZDApp_event_loop_16
    512            {
    513          #ifdef ZBA_FALLBACK_NWKKEY
    514              if ( devState == DEV_END_DEVICE_UNAUTH )
    515              {
    516                ZDSecMgrFallbackNwkKey();
    517              }
    518              else
    519          #endif
    520              {
    521                // Set the NV startup option to force a "new" join.
    522                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000141                ; Setup parameters for call to function zgWriteStartupOptions
   \   000141   7A02         MOV     R2,#0x2
   \   000143   79FF         MOV     R1,#-0x1
   \   000145   12....       LCALL   ??zgWriteStartupOptions?relay
   \   000148   E9           MOV     A,R1
    523          
    524                // The device has been in the UNAUTH state, so reset
    525                // Note: there will be no return from this call
    526                SystemResetSoft();
   \   000149                ; Setup parameters for call to function Onboard_soft_reset
   \   000149   12....       LCALL   Onboard_soft_reset & 0xFFFF
    527              }
    528            }
    529          
    530            if ( ZG_SECURE_ENABLED )
    531            {
    532              return ( ZDApp_ProcessSecEvent( task_id, events ) );
   \                     ??ZDApp_event_loop_16:
   \   00014C                ; Setup parameters for call to function ZDApp_ProcessSecEvent
   \   00014C   EE           MOV     A,R6
   \   00014D   FA           MOV     R2,A
   \   00014E   EF           MOV     A,R7
   \   00014F   FB           MOV     R3,A
   \   000150   A9..         MOV     R1,?V0 + 0
   \   000152   12....       LCALL   ??ZDApp_ProcessSecEvent?relay
   \                     ??ZDApp_event_loop_3:
   \   000155   7F06         MOV     R7,#0x6
   \   000157   02....       LJMP    ?BANKED_LEAVE_XDATA
    533            }
    534            else
    535            {
    536              // Discard or make more handlers
    537              return 0;
    538            }
    539          }
    540          
    541          /*********************************************************************
    542           * @fn      ZDApp_ProcessSecEvent()
    543           *
    544           * @brief   Process incoming security events.
    545           *
    546           * @param   task_id - Task ID
    547           * @param   events  - Bitmap of events
    548           *
    549           * @return  none
    550           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    551          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    552          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    553            (void)task_id;  // Intentionally unreferenced parameter
    554          
    555            if ( ZSTACK_ROUTER_BUILD )
    556            {
    557              if ( events & ZDO_NEW_DEVICE )
    558              {
    559                // process the new device event
    560                if ( ZDSecMgrNewDeviceEvent() == TRUE )
    561                {
    562                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    563                }
    564          
    565                // Return unprocessed events
    566                return (events ^ ZDO_NEW_DEVICE);
    567              }
    568            }
    569          
    570            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    571                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    572            {
    573              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    574              {
    575                if ( events & ZDO_SECMGR_EVENT )
    576                {
    577                  ZDSecMgrEvent();
    578          
    579                  // Return unprocessed events
    580                  return (events ^ ZDO_SECMGR_EVENT);
    581                }
    582              }
    583            }
    584          
    585            if ( events & ZDO_DEVICE_AUTH )
   \   00000B   EE           MOV     A,R6
   \   00000C   5480         ANL     A,#0x80
   \   00000E   600D         JZ      ??ZDApp_ProcessSecEvent_0
    586            {
    587              ZDApp_DeviceAuthEvt();
   \   000010                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   000010   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    588          
    589              // Return unprocessed events
    590              return (events ^ ZDO_DEVICE_AUTH);
   \   000013   EE           MOV     A,R6
   \   000014   6480         XRL     A,#0x80
   \   000016   FA           MOV     R2,A
   \   000017   EF           MOV     A,R7
   \   000018   6400         XRL     A,#0x0
   \   00001A   FB           MOV     R3,A
   \   00001B   8070         SJMP    ??ZDApp_ProcessSecEvent_1
    591            }
    592          
    593            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   00001D   EE           MOV     A,R6
   \   00001E   5400         ANL     A,#0x0
   \   000020   F8           MOV     R0,A
   \   000021   EF           MOV     A,R7
   \   000022   5404         ANL     A,#0x4
   \   000024   F9           MOV     R1,A
   \   000025   E8           MOV     A,R0
   \   000026   49           ORL     A,R1
   \   000027   602E         JZ      ??ZDApp_ProcessSecEvent_2
    594            {
    595              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000029   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   E8           MOV     A,R0
   \   000032   2401         ADD     A,#0x1
   \   000034   FA           MOV     R2,A
   \   000035   E9           MOV     A,R1
   \   000036   3400         ADDC    A,#0x0
   \   000038   FB           MOV     R3,A
   \   000039   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00003C   EA           MOV     A,R2
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E   A3           INC     DPTR
   \   00003F   EB           MOV     A,R3
   \   000040   F0           MOVX    @DPTR,A
   \   000041   C3           CLR     C
   \   000042   E8           MOV     A,R0
   \   000043   94E9         SUBB    A,#-0x17
   \   000045   E9           MOV     A,R1
   \   000046   9403         SUBB    A,#0x3
   \   000048   4003         JC      ??ZDApp_ProcessSecEvent_3
    596              {
    597                ZDApp_SaveNwkKey();
   \   00004A                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00004A   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    598              }
    599          
    600              // Return unprocessed events
    601              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_3:
   \   00004D   EE           MOV     A,R6
   \   00004E   6400         XRL     A,#0x0
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   6404         XRL     A,#0x4
   \   000054   FB           MOV     R3,A
   \   000055   8036         SJMP    ??ZDApp_ProcessSecEvent_1
    602            }
    603          
    604            if ( events & ZDO_APS_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000057   EE           MOV     A,R6
   \   000058   5400         ANL     A,#0x0
   \   00005A   F8           MOV     R0,A
   \   00005B   EF           MOV     A,R7
   \   00005C   5410         ANL     A,#0x10
   \   00005E   F9           MOV     R1,A
   \   00005F   E8           MOV     A,R0
   \   000060   49           ORL     A,R1
   \   000061   600D         JZ      ??ZDApp_ProcessSecEvent_4
    605            {
    606          #if defined (NV_RESTORE)
    607              ZDSecMgrSaveApsLinkKey();
   \   000063                ; Setup parameters for call to function ZDSecMgrSaveApsLinkKey
   \   000063   12....       LCALL   ??ZDSecMgrSaveApsLinkKey?relay
    608          #endif // (NV_RESTORE)
    609          
    610              // Return unprocessed events
    611              return (events ^ ZDO_APS_FRAMECOUNTER_CHANGE);
   \   000066   EE           MOV     A,R6
   \   000067   6400         XRL     A,#0x0
   \   000069   FA           MOV     R2,A
   \   00006A   EF           MOV     A,R7
   \   00006B   6410         XRL     A,#0x10
   \   00006D   FB           MOV     R3,A
   \   00006E   801D         SJMP    ??ZDApp_ProcessSecEvent_1
    612            }
    613          
    614            if ( events & ZDO_TCLK_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   000070   EE           MOV     A,R6
   \   000071   5400         ANL     A,#0x0
   \   000073   F8           MOV     R0,A
   \   000074   EF           MOV     A,R7
   \   000075   5408         ANL     A,#0x8
   \   000077   F9           MOV     R1,A
   \   000078   E8           MOV     A,R0
   \   000079   49           ORL     A,R1
   \   00007A   600D         JZ      ??ZDApp_ProcessSecEvent_5
    615            {
    616              ZDSecMgrSaveTCLinkKey();
   \   00007C                ; Setup parameters for call to function ZDSecMgrSaveTCLinkKey
   \   00007C   12....       LCALL   ??ZDSecMgrSaveTCLinkKey?relay
    617          
    618              // Return unprocessed events
    619              return (events ^ ZDO_TCLK_FRAMECOUNTER_CHANGE);
   \   00007F   EE           MOV     A,R6
   \   000080   6400         XRL     A,#0x0
   \   000082   FA           MOV     R2,A
   \   000083   EF           MOV     A,R7
   \   000084   6408         XRL     A,#0x8
   \   000086   FB           MOV     R3,A
   \   000087   8004         SJMP    ??ZDApp_ProcessSecEvent_1
    620            }
    621          
    622            // Discard or make more handlers
    623            return 0;
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000089   7A00         MOV     R2,#0x0
   \   00008B   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_1:
   \   00008D   7F01         MOV     R7,#0x1
   \   00008F   02....       LJMP    ?BANKED_LEAVE_XDATA
    624          }
    625          
    626          /*********************************************************************
    627           * Application Functions
    628           */
    629          
    630          /*********************************************************************
    631           * @fn      ZDOInitDevice
    632           *
    633           * @brief   Start the device in the network.  This function will read
    634           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    635           *   restore the network state of the device.
    636           *
    637           * @param   startDelay - timeDelay to start device (in milliseconds).
    638           *                       There is a jitter added to this delay:
    639           *                       ((NWK_START_DELAY + startDelay)
    640           *                       + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    641           *                       When startDelay is set to ZDO_INIT_HOLD_NWK_START
    642           *                       this function will hold the network init. Application
    643           *                       can start the device.
    644           *
    645           * NOTE:    If the application would like to force a "new" join, the
    646           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    647           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    648           *          this function. "new" join means to not restore the network
    649           *          state of the device. Use zgWriteStartupOptions() to set these
    650           *          options.
    651           *
    652           * @return
    653           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    654           *          restored.
    655           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    656           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    657           *          it could mean that there was no network state to restore.
    658           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    659           *          with the rejoin option set to TRUE.  So, the device was not
    660           *          started in the network (one time only).  The next time this
    661           *          function is called it will start.
    662           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    663          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    664          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    665            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000009   75..01       MOV     ?V0 + 2,#0x1
    666            uint16 extendedDelay = 0;
   \   00000C   7E00         MOV     R6,#0x0
   \   00000E   7F00         MOV     R7,#0x0
    667          
    668            if ( devState == DEV_HOLD )
   \   000010   90....       MOV     DPTR,#devState
   \   000013   E0           MOVX    A,@DPTR
   \   000014   7005         JNZ     ??ZDOInitDevice_0
    669            {
    670              // Initialize the RAM items table, in case an NV item has been updated.
    671              zgInitItems( FALSE );
   \   000016                ; Setup parameters for call to function zgInitItems
   \   000016   7900         MOV     R1,#0x0
   \   000018   12....       LCALL   ??zgInitItems?relay
    672            }
    673          
    674            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   00001B                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   00001B   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    675            //devtag.071807.todo - fix this temporary solution
    676            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000021   E0           MOVX    A,@DPTR
   \   000022   90....       MOV     DPTR,#_NIB + 14
   \   000025   F0           MOVX    @DPTR,A
    677          
    678          #if defined ( NV_RESTORE )
    679            // Get Keypad directly to see if a reset nv is needed.
    680            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    681            // while booting to skip past NV Restore.
    682            if ( HalKeyRead() == SW_BYPASS_NV )
   \   000026                ; Setup parameters for call to function HalKeyRead
   \   000026   12....       LCALL   ??HalKeyRead?relay
   \   000029   E9           MOV     A,R1
   \   00002A   6404         XRL     A,#0x4
   \   00002C   7005         JNZ     ??ZDOInitDevice_1
    683              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00002E   75..01       MOV     ?V0 + 2,#0x1
   \   000031   8006         SJMP    ??ZDOInitDevice_2
    684            else
    685            {
    686              // Determine if NV should be restored
    687              networkStateNV = ZDApp_ReadNetworkRestoreState();
   \                     ??ZDOInitDevice_1:
   \   000033                ; Setup parameters for call to function ZDApp_ReadNetworkRestoreState
   \   000033   12....       LCALL   ??ZDApp_ReadNetworkRestoreState?relay
   \   000036   E9           MOV     A,R1
   \   000037   F5..         MOV     ?V0 + 2,A
    688            }
    689          
    690            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
   \                     ??ZDOInitDevice_2:
   \   000039   E5..         MOV     A,?V0 + 2
   \   00003B   7008         JNZ     ??ZDOInitDevice_3
    691            {
    692              networkStateNV = ZDApp_RestoreNetworkState();
   \   00003D                ; Setup parameters for call to function ZDApp_RestoreNetworkState
   \   00003D   12....       LCALL   ??ZDApp_RestoreNetworkState?relay
   \   000040   E9           MOV     A,R1
   \   000041   F5..         MOV     ?V0 + 2,A
   \   000043   800A         SJMP    ??ZDOInitDevice_4
    693            }
    694            else
    695            {
    696              // Wipe out the network state in NV
    697              NLME_InitNV();
   \                     ??ZDOInitDevice_3:
   \   000045                ; Setup parameters for call to function NLME_InitNV
   \   000045   12....       LCALL   ??NLME_InitNV?relay
   \   000048   E9           MOV     A,R1
    698              NLME_SetDefaultNV();
   \   000049                ; Setup parameters for call to function NLME_SetDefaultNV
   \   000049   12....       LCALL   ??NLME_SetDefaultNV?relay
    699              // clear NWK key values
    700              ZDSecMgrClearNVKeyValues();
   \   00004C                ; Setup parameters for call to function ZDSecMgrClearNVKeyValues
   \   00004C   12....       LCALL   ??ZDSecMgrClearNVKeyValues?relay
    701            }
    702          #endif
    703          
    704            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
   \                     ??ZDOInitDevice_4:
   \   00004F   7401         MOV     A,#0x1
   \   000051   65..         XRL     A,?V0 + 2
   \   000053   7028         JNZ     ??ZDOInitDevice_5
    705            {
    706              ZDAppDetermineDeviceType();
   \   000055                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000055   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    707          
    708              // Only delay if joining network - not restoring network state
    709              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    710                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000058                ; Setup parameters for call to function osal_rand
   \   000058   12....       LCALL   ??osal_rand?relay
   \   00005B   8A..         MOV     ?V0 + 4,R2
   \   00005D   8B..         MOV     ?V0 + 5,R3
   \   00005F   E5..         MOV     A,?V0 + 4
   \   000061   547F         ANL     A,#0x7f
   \   000063   F8           MOV     R0,A
   \   000064   E5..         MOV     A,?V0 + 5
   \   000066   5400         ANL     A,#0x0
   \   000068   F9           MOV     R1,A
   \   000069   E5..         MOV     A,?V0 + 0
   \   00006B   28           ADD     A,R0
   \   00006C   F8           MOV     R0,A
   \   00006D   E5..         MOV     A,?V0 + 1
   \   00006F   39           ADDC    A,R1
   \   000070   F9           MOV     R1,A
   \   000071   E8           MOV     A,R0
   \   000072   2464         ADD     A,#0x64
   \   000074   F8           MOV     R0,A
   \   000075   E9           MOV     A,R1
   \   000076   3400         ADDC    A,#0x0
   \   000078   F9           MOV     R1,A
   \   000079   E8           MOV     A,R0
   \   00007A   FE           MOV     R6,A
   \   00007B   E9           MOV     A,R1
   \   00007C   FF           MOV     R7,A
    711            }
    712          
    713            // Initialize the security for type of device
    714            ZDApp_SecInit( networkStateNV );
   \                     ??ZDOInitDevice_5:
   \   00007D                ; Setup parameters for call to function ZDApp_SecInit
   \   00007D   A9..         MOV     R1,?V0 + 2
   \   00007F   12....       LCALL   ??ZDApp_SecInit?relay
    715          
    716            if( ZDO_INIT_HOLD_NWK_START != startDelay )
   \   000082   74FF         MOV     A,#-0x1
   \   000084   65..         XRL     A,?V0 + 0
   \   000086   7004         JNZ     ??ZDOInitDevice_6
   \   000088   74FF         MOV     A,#-0x1
   \   00008A   65..         XRL     A,?V0 + 1
   \                     ??ZDOInitDevice_6:
   \   00008C   602F         JZ      ??ZDOInitDevice_7
    717            {
    718              devState = DEV_INIT;    // Remove the Hold state
   \   00008E   90....       MOV     DPTR,#devState
   \   000091   7401         MOV     A,#0x1
   \   000093   F0           MOVX    @DPTR,A
    719          
    720              // Initialize leave control logic
    721              ZDApp_LeaveCtrlInit();
   \   000094                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000094   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    722          
    723              // Check leave control reset settings
    724             // ZDApp_LeaveCtrlStartup( &devState, &startDelay );
    725          
    726              // Leave may make the hold state come back
    727              if ( devState == DEV_HOLD )
   \   000097   90....       MOV     DPTR,#devState
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   7019         JNZ     ??ZDOInitDevice_8
    728              {
    729                // Set the NV startup option to force a "new" join.
    730                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   00009D                ; Setup parameters for call to function zgWriteStartupOptions
   \   00009D   7A02         MOV     R2,#0x2
   \   00009F   79FF         MOV     R1,#-0x1
   \   0000A1   12....       LCALL   ??zgWriteStartupOptions?relay
   \   0000A4   E9           MOV     A,R1
    731          
    732                // Notify the applications
    733                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   0000A5                ; Setup parameters for call to function osal_set_event
   \   0000A5   7A10         MOV     R2,#0x10
   \   0000A7   7B00         MOV     R3,#0x0
   \   0000A9   90....       MOV     DPTR,#ZDAppTaskID
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   F9           MOV     R1,A
   \   0000AE   12....       LCALL   ??osal_set_event?relay
   \   0000B1   E9           MOV     A,R1
    734          
    735                return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   0000B2   7902         MOV     R1,#0x2
   \   0000B4   8011         SJMP    ??ZDOInitDevice_9
    736              }
    737          
    738              // Trigger the network start
    739              ZDApp_NetworkInit( extendedDelay );
   \                     ??ZDOInitDevice_8:
   \   0000B6                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000B6   EE           MOV     A,R6
   \   0000B7   FA           MOV     R2,A
   \   0000B8   EF           MOV     A,R7
   \   0000B9   FB           MOV     R3,A
   \   0000BA   12....       LCALL   ??ZDApp_NetworkInit?relay
    740            }
    741          
    742            // set broadcast address mask to support broadcast filtering
    743            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \                     ??ZDOInitDevice_7:
   \   0000BD                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   0000BD   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F9           MOV     R1,A
   \   0000C2   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    744          
    745            return ( networkStateNV );
   \   0000C5   A9..         MOV     R1,?V0 + 2
   \                     ??ZDOInitDevice_9:
   \   0000C7   7F06         MOV     R7,#0x6
   \   0000C9   02....       LJMP    ?BANKED_LEAVE_XDATA
    746          }
    747          
    748          /*********************************************************************
    749           * @fn      ZDApp_ReadNetworkRestoreState
    750           *
    751           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    752           *          or not to restore the network state.
    753           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    754           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    755           *
    756           * @param   none
    757           *
    758           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    759           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    760           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    761           *          ZCD_NV_STARTUP_OPTION
    762           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    763          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    764          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    765            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    766          
    767            // Look for the New Network State option.
    768            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   F8           MOV     R0,A
   \   00000C   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000E   5002         JNC     ??ZDApp_ReadNetworkRestoreState_0
    769            {
    770              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000010   7E01         MOV     R6,#0x1
    771            }
    772          
    773            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000012   EE           MOV     A,R6
   \   000013   F9           MOV     R1,A
   \   000014   7F01         MOV     R7,#0x1
   \   000016   02....       LJMP    ?BANKED_LEAVE_XDATA
    774          }
    775          
    776          /*********************************************************************
    777           * @fn      ZDAppDetermineDeviceType()
    778           *
    779           * @brief   Determines the type of device to start.
    780           *
    781           *          Looks at zgDeviceLogicalType and determines what type of
    782           *          device to start.  The types are:
    783           *            ZG_DEVICETYPE_COORDINATOR
    784           *            ZG_DEVICETYPE_ROUTER
    785           *            ZG_DEVICETYPE_ENDDEVICE
    786           *
    787           * @param   none
    788           *
    789           * @return  none
    790           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    791          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    792          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    793            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700F         JNZ     ??ZDAppDetermineDeviceType_0
    794            {
    795              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    796              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   F0           MOVX    @DPTR,A
   \   000017   8042         SJMP    ??ZDAppDetermineDeviceType_1
    797            }
    798            else
    799            {
    800              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000019   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   700E         JNZ     ??ZDAppDetermineDeviceType_2
    801                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   54F8         ANL     A,#0xf8
   \   000027   4401         ORL     A,#0x1
   \   000029   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   8014         SJMP    ??ZDAppDetermineDeviceType_3
    802              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   00002F   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6402         XRL     A,#0x2
   \   000035   700C         JNZ     ??ZDAppDetermineDeviceType_3
    803                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000037   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   54F8         ANL     A,#0xf8
   \   00003D   4402         ORL     A,#0x2
   \   00003F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000042   F0           MOVX    @DPTR,A
    804          
    805              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    806              // The device shall do rejoin the network. Otherwise, do normal join
    807              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_3:
   \   000043                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000043   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000045   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000047   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00004A   E9           MOV     A,R1
   \   00004B   7008         JNZ     ??ZDAppDetermineDeviceType_4
    808              {
    809                devStartMode = MODE_JOIN;     // Assume joining
   \   00004D   90....       MOV     DPTR,#devStartMode
   \   000050   7400         MOV     A,#0x0
   \   000052   F0           MOVX    @DPTR,A
   \   000053   8006         SJMP    ??ZDAppDetermineDeviceType_1
    810              }
    811              else
    812              {
    813                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_4:
   \   000055   90....       MOV     DPTR,#devStartMode
   \   000058   7403         MOV     A,#0x3
   \   00005A   F0           MOVX    @DPTR,A
    814              }
    815            }
    816          }
   \                     ??ZDAppDetermineDeviceType_1:
   \   00005B   D083         POP     DPH
   \   00005D   D082         POP     DPL
   \   00005F   02....       LJMP    ?BRET
    817          
    818          /*********************************************************************
    819           * @fn      ZDApp_NetworkStartEvt()
    820           *
    821           * @brief   Process the Network Start Event
    822           *
    823           * @param   none
    824           *
    825           * @return  none
    826           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    827          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    828          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    829            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7022         JNZ     ??ZDApp_NetworkStartEvt_0
    830            {
    831              // Successfully started a ZigBee network
    832              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7006         JNZ     ??ZDApp_NetworkStartEvt_1
    833              {
    834                devState = DEV_ZB_COORD;
   \   000012   90....       MOV     DPTR,#devState
   \   000015   7409         MOV     A,#0x9
   \   000017   F0           MOVX    @DPTR,A
    835              }
    836          
    837              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000018                ; Setup parameters for call to function osal_pwrmgr_device
   \   000018   7900         MOV     R1,#0x0
   \   00001A   12....       LCALL   ??osal_pwrmgr_device?relay
    838              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A10         MOV     R2,#0x10
   \   00001F   7B00         MOV     R3,#0x0
   \   000021   90....       MOV     DPTR,#ZDAppTaskID
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??osal_set_event?relay
   \   000029   E9           MOV     A,R1
   \   00002A   8048         SJMP    ??ZDApp_NetworkStartEvt_2
    839            }
    840            else
    841            {
    842              // Try again with a higher energy threshold !!
    843              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00002C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00002C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00002F   E9           MOV     A,R1
   \   000030   F8           MOV     R0,A
   \   000031   7900         MOV     R1,#0x0
   \   000033   2410         ADD     A,#0x10
   \   000035   F8           MOV     R0,A
   \   000036   E9           MOV     A,R1
   \   000037   3400         ADDC    A,#0x0
   \   000039   F9           MOV     R1,A
   \   00003A   C3           CLR     C
   \   00003B   E8           MOV     A,R0
   \   00003C   94FF         SUBB    A,#-0x1
   \   00003E   E9           MOV     A,R1
   \   00003F   9400         SUBB    A,#0x0
   \   000041   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000043   65D0         XRL     A,PSW
   \   000045   33           RLC     A
   \   000046   5019         JNC     ??ZDApp_NetworkStartEvt_3
    844              {
    845                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000048                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000048                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000048   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   2410         ADD     A,#0x10
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    846                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7B00         MOV     R3,#0x0
   \   000056   90....       MOV     DPTR,#ZDAppTaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??osal_set_event?relay
   \   00005E   E9           MOV     A,R1
   \   00005F   8013         SJMP    ??ZDApp_NetworkStartEvt_2
    847              }
    848              else
    849              {
    850                // Failed to start network. Enter a dormant state (until user intervenes)
    851                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000061   90....       MOV     DPTR,#devState
   \   000064   7401         MOV     A,#0x1
   \   000066   F0           MOVX    @DPTR,A
    852                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000067                ; Setup parameters for call to function osal_set_event
   \   000067   7A10         MOV     R2,#0x10
   \   000069   7B00         MOV     R3,#0x0
   \   00006B   90....       MOV     DPTR,#ZDAppTaskID
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F9           MOV     R1,A
   \   000070   12....       LCALL   ??osal_set_event?relay
   \   000073   E9           MOV     A,R1
    853              }
    854            }
    855          }
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000074   D083         POP     DPH
   \   000076   D082         POP     DPL
   \   000078   02....       LJMP    ?BRET
    856          
    857          /*********************************************************************
    858           * @fn      ZDApp_DeviceAuthEvt()
    859           *
    860           * @brief   Process the Device Authentic Event
    861           *
    862           * @param   none
    863           *
    864           * @return  none
    865           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    866          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    867          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    868            // received authentication from trust center
    869            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   7039         JNZ     ??ZDApp_DeviceAuthEvt_0
    870            {
    871              // Stop the reset timer so it doesn't reset
    872              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    873          
    874              devState = DEV_END_DEVICE;
   \   00000F   90....       MOV     DPTR,#devState
   \   000012   7406         MOV     A,#0x6
   \   000014   F0           MOVX    @DPTR,A
    875              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A10         MOV     R2,#0x10
   \   000017   7B00         MOV     R3,#0x0
   \   000019   90....       MOV     DPTR,#ZDAppTaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??osal_set_event?relay
   \   000021   E9           MOV     A,R1
    876          
    877              // Set the Power Manager Device
    878          #if defined ( POWER_SAVING )
    879              osal_pwrmgr_device( PWRMGR_BATTERY );
   \   000022                ; Setup parameters for call to function osal_pwrmgr_device
   \   000022   7901         MOV     R1,#0x1
   \   000024   12....       LCALL   ??osal_pwrmgr_device?relay
    880          #endif
    881          
    882              if ( ZSTACK_ROUTER_BUILD )
    883              {
    884                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    885                {
    886                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    887                  NLME_StartRouterRequest( 0, 0, false );
    888                }
    889              }
    890          
    891              // Notify to save info into NV
    892              ZDApp_NVUpdate();
   \   000027                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000027   12....       LCALL   ??ZDApp_NVUpdate?relay
    893          
    894              // Save off the security
    895              ZDApp_SaveNwkKey();
   \   00002A                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00002A   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    896          
    897              ZDApp_AnnounceNewAddress();
   \   00002D                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00002D   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    898          
    899              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000030   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000033   E0           MOVX    A,@DPTR
   \   000034   A2E3         MOV     C,0xE0 /* A   */.3
   \   000036   4010         JC      ??ZDApp_DeviceAuthEvt_1
    900              {
    901                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000038                ; Setup parameters for call to function NLME_SetPollRate
   \   000038   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   FA           MOV     R2,A
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??NLME_SetPollRate?relay
   \   000043   8003         SJMP    ??ZDApp_DeviceAuthEvt_1
    902              }
    903            }
    904            else
    905            {
    906              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000045                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000045   12....       LCALL   ??ZDApp_NVUpdate?relay
    907            }
    908          }
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000048   D083         POP     DPH
   \   00004A   D082         POP     DPL
   \   00004C   02....       LJMP    ?BRET
    909          
    910          /*********************************************************************
    911           * @fn      ZDApp_SaveNetworkStateEvt()
    912           *
    913           * @brief   Process the Save the Network State Event
    914           *
    915           * @param   none
    916           *
    917           * @return  none
    918           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    919          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    920          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    921          #if defined ( NV_RESTORE )
    922           #if defined ( NV_TURN_OFF_RADIO )
    923            // Turn off the radio's receiver during an NV update
    924            uint8 RxOnIdle;
    925            uint8 x = false;
    926            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    927            ZMacSetReq( ZMacRxOnIdle, &x );
    928           #endif
    929          
    930            // Update the Network State in NV
    931            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    932                           NWK_NV_DEVICELIST_ENABLE |
    933                           NWK_NV_BINDING_ENABLE    |
    934                           NWK_NV_ADDRMGR_ENABLE );
   \   000004                ; Setup parameters for call to function NLME_UpdateNV
   \   000004   790F         MOV     R1,#0xf
   \   000006   12....       LCALL   ??NLME_UpdateNV?relay
    935          
    936            // Reset the NV startup option to resume from NV by
    937            // clearing the "New" join option.
    938            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000009                ; Setup parameters for call to function zgWriteStartupOptions
   \   000009   7A02         MOV     R2,#0x2
   \   00000B   7900         MOV     R1,#0x0
   \   00000D   12....       LCALL   ??zgWriteStartupOptions?relay
   \   000010   E9           MOV     A,R1
    939          
    940           #if defined ( NV_TURN_OFF_RADIO )
    941            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    942           #endif
    943          #endif  // NV_RESTORE
    944          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
    945          
    946          /*********************************************************************
    947           * @fn      ZDApp_RestoreNetworkState()
    948           *
    949           * @brief   This function will restore the network state of the
    950           *          device if the network state is stored in NV.
    951           *
    952           * @param   none
    953           *
    954           * @return
    955           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    956           *          restored.
    957           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    958           *          This could mean that zgStartupOption said to not restore, or
    959           *          it could mean that there was no network state to restore.
    960           *
    961           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    962          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    963          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    964            uint8 nvStat;
    965          
    966            // Initialize NWK NV items
    967            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    968          
    969            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   6043         JZ      ??ZDApp_RestoreNetworkState_0
    970            {
    971              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6031         JZ      ??ZDApp_RestoreNetworkState_1
    972              {
    973                // Are we a coordinator
    974                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    975                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    976                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   54F8         ANL     A,#0xf8
   \   000032   F0           MOVX    @DPTR,A
    977                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   7401         MOV     A,#0x1
   \   000038   F0           MOVX    @DPTR,A
    978                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000039                ; Setup parameters for call to function sAddrExtCpy
   \   000039   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   00003B   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   00003D   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00003F   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000041   12....       LCALL   ??sAddrExtCpy?relay
   \   000044   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    979              }
    980              else
    981                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000046   7E09         MOV     R6,#0x9
    982          
    983              if ( ZG_SECURE_ENABLED )
    984              {
    985                nwkFrameCounterChanges = 0;
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000048   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004B   7400         MOV     A,#0x0
   \   00004D   F0           MOVX    @DPTR,A
   \   00004E   A3           INC     DPTR
   \   00004F   7400         MOV     A,#0x0
   \   000051   F0           MOVX    @DPTR,A
    986          
    987                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    988                {
    989                  ZDApp_RestoreNwkKey();
    990                }
    991              }
    992          
    993              // The default for RxOnWhenIdle is true for Routers and false for end devices
    994              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    995              // other than default.
    996            }
    997          
    998            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000052   EE           MOV     A,R6
   \   000053   7004         JNZ     ??ZDApp_RestoreNetworkState_4
    999              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_RestoreNetworkState_5
   1000            else
   1001              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_5:
   \   00005B   7F01         MOV     R7,#0x1
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1002          }
   1003          
   1004          /*********************************************************************
   1005           * @fn      ZDApp_InitUserDesc()
   1006           *
   1007           * @brief   Initialize the User Descriptor, the descriptor is read from NV
   1008           *          when needed.  If you want to initialize the User descriptor to
   1009           *          something other than all zero, do it here.
   1010           *
   1011           * @param   none
   1012           *
   1013           * @return  none
   1014           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1015          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
   1016          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1017            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
   1018          
   1019            // Initialize the User Descriptor, the descriptor is read from NV
   1020            // when needed.  If you want to initialize the User descriptor to something
   1021            // other than all zero, do it here.
   1022            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1023            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
   1024                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   703F         JNZ     ??ZDApp_InitUserDesc_0
   1025            {
   1026              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
   1027                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   8582..       MOV     ?V0 + 0,DPL
   \   00004A   8583..       MOV     ?V0 + 1,DPH
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000052   75..11       MOV     ?V0 + 0,#0x11
   \   000055   75..00       MOV     ?V0 + 1,#0x0
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   7C00         MOV     R4,#0x0
   \   00005F   7D00         MOV     R5,#0x0
   \   000061   7A81         MOV     R2,#-0x7f
   \   000063   7B00         MOV     R3,#0x0
   \   000065   12....       LCALL   ??osal_nv_read?relay
   \   000068   7404         MOV     A,#0x4
   \   00006A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006D   E9           MOV     A,R1
   \   00006E   7010         JNZ     ??ZDApp_InitUserDesc_0
   1028              {
   1029                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6007         JZ      ??ZDApp_InitUserDesc_0
   1030                {
   1031                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000079   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   D2E4         SETB    0xE0 /* A   */.4
   \   00007F   F0           MOVX    @DPTR,A
   1032                }
   1033              }
   1034            }
   1035          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000080   7411         MOV     A,#0x11
   \   000082   12....       LCALL   ?DEALLOC_XSTACK8
   \   000085   7F02         MOV     R7,#0x2
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
   1036          
   1037          /*********************************************************************
   1038           * @fn      ZDAppCheckForHoldKey()
   1039           *
   1040           * @brief   Check for key to set the device into Hold Auto Start
   1041           *
   1042           * @param   none
   1043           *
   1044           * @return  none
   1045           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1046          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
   1047          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1048          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
   1049            // Get Keypad directly to see if a HOLD_START is needed.
   1050            // Hold down the SW_BYPASS_START key (see OnBoard.h)
   1051            // while booting to avoid starting up the device.
   1052            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7006         JNZ     ??ZDAppCheckForHoldKey_0
   1053            {
   1054              // Change the device state to HOLD on start up
   1055              devState = DEV_HOLD;
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   7400         MOV     A,#0x0
   \   000011   F0           MOVX    @DPTR,A
   1056            }
   1057          #endif // HAL_KEY
   1058          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1059          
   1060          /*********************************************************************
   1061           * @fn      ZDApp_ProcessOSALMsg()
   1062           *
   1063           * @brief   Process the incoming task message.
   1064           *
   1065           * @param   msgPtr - message to process
   1066           *
   1067           * @return  none
   1068           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1069          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
   1070          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   1071            // Data Confirmation message fields
   1072            uint8 sentEP;       // This should always be 0
   1073            uint8 sentStatus;
   1074            afDataConfirm_t *afDataConfirm;
   1075            uint8 tmp;
   1076          
   1077            switch ( msgPtr->event )
   \   00000E   85..82       MOV     DPL,?V0 + 0
   \   000011   85..83       MOV     DPH,?V0 + 1
   \   000014   E0           MOVX    A,@DPTR
   \   000015   14           DEC     A
   \   000016   604D         JZ      ??ZDApp_ProcessOSALMsg_0
   \   000018   14           DEC     A
   \   000019   7003         JNZ     $+5
   \   00001B   02....       LJMP    ??ZDApp_ProcessOSALMsg_1 & 0xFFFF
   \   00001E   14           DEC     A
   \   00001F   7003         JNZ     $+5
   \   000021   02....       LJMP    ??ZDApp_ProcessOSALMsg_2 & 0xFFFF
   \   000024   24E9         ADD     A,#-0x17
   \   000026   600B         JZ      ??ZDApp_ProcessOSALMsg_3
   \   000028   2447         ADD     A,#0x47
   \   00002A   6011         JZ      ??ZDApp_ProcessOSALMsg_4
   \   00002C   24D6         ADD     A,#-0x2a
   \   00002E   6017         JZ      ??ZDApp_ProcessOSALMsg_5
   \   000030   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1078            {
   1079              // Incoming ZDO Message
   1080              case AF_INCOMING_MSG_CMD:
   1081                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000033                ; Setup parameters for call to function ZDP_IncomingData
   \   000033   AA..         MOV     R2,?V0 + 0
   \   000035   AB..         MOV     R3,?V0 + 1
   \   000037   12....       LCALL   ??ZDP_IncomingData?relay
   1082                break;
   \   00003A   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1083          
   1084              case ZDO_CB_MSG:
   1085                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00003D                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   1086                break;
   \   000044   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1087          
   1088              case AF_DATA_CONFIRM_CMD:
   1089                // This message is received as a confirmation of a data packet sent.
   1090                // The status is of ZStatus_t type [defined in NLMEDE.h]
   1091                // The message fields are defined in AF.h
   1092                afDataConfirm = (afDataConfirm_t *)msgPtr;
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000047   85....       MOV     ?V0 + 2,?V0 + 0
   \   00004A   85....       MOV     ?V0 + 3,?V0 + 1
   1093                sentEP = afDataConfirm->endpoint;
   \   00004D   85..82       MOV     DPL,?V0 + 2
   \   000050   85..83       MOV     DPH,?V0 + 3
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F5..         MOV     ?V0 + 5,A
   1094                sentStatus = afDataConfirm->hdr.status;
   \   000058   85..82       MOV     DPL,?V0 + 2
   \   00005B   85..83       MOV     DPH,?V0 + 3
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F5..         MOV     ?V0 + 4,A
   1095          
   1096                // Action taken when confirmation is received.
   1097          #if defined ( ZIGBEE_FREQ_AGILITY )
   1098                if ( pZDNwkMgr_ProcessDataConfirm )
   1099                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   1100          #endif
   1101                (void)sentEP;
   1102                (void)sentStatus;
   1103                break;
   \   000062   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1104          
   1105              case ZDO_NWK_DISC_CNF:
   1106                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000065   90....       MOV     DPTR,#devState
   \   000068   E0           MOVX    A,@DPTR
   \   000069   6402         XRL     A,#0x2
   \   00006B   6003         JZ      $+5
   \   00006D   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1107                  break;
   1108          
   1109                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   000070   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000073   E0           MOVX    A,@DPTR
   \   000074   6401         XRL     A,#0x1
   \   000076   600B         JZ      ??ZDApp_ProcessOSALMsg_8
   \   000078   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   6402         XRL     A,#0x2
   \   00007E   6003         JZ      $+5
   \   000080   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1110                {
   1111                  // Process the network discovery scan results and choose a parent
   1112                  // device to join/rejoin itself
   1113                  networkDesc_t *pChosenNwk;
   1114                  if ( ( (pChosenNwk = ZDApp_NwkDescListProcessing()) != NULL ) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   000083                ; Setup parameters for call to function ZDApp_NwkDescListProcessing
   \   000083   12....       LCALL   ??ZDApp_NwkDescListProcessing?relay
   \   000086   8A..         MOV     ?V0 + 6,R2
   \   000088   8B..         MOV     ?V0 + 7,R3
   \   00008A   A8..         MOV     R0,?V0 + 6
   \   00008C   A9..         MOV     R1,?V0 + 7
   \   00008E   E8           MOV     A,R0
   \   00008F   FE           MOV     R6,A
   \   000090   E9           MOV     A,R1
   \   000091   FF           MOV     R7,A
   \   000092   E8           MOV     A,R0
   \   000093   49           ORL     A,R1
   \   000094   7003         JNZ     $+5
   \   000096   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   \   000099   90....       MOV     DPTR,#zdoDiscCounter
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   C3           CLR     C
   \   00009E   9403         SUBB    A,#0x3
   \   0000A0   5003         JNC     $+5
   \   0000A2   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   1115                  {
   1116                    if ( devStartMode == MODE_JOIN )
   \   0000A5   90....       MOV     DPTR,#devStartMode
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   6003         JZ      $+5
   \   0000AB   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   1117                    {
   1118                      devState = DEV_NWK_JOINING;
   \   0000AE   90....       MOV     DPTR,#devState
   \   0000B1   7403         MOV     A,#0x3
   \   0000B3   F0           MOVX    @DPTR,A
   1119          
   1120                      ZDApp_NodeProfileSync( pChosenNwk->stackProfile);
   \   0000B4                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   0000B4   8E82         MOV     DPL,R6
   \   0000B6   8F83         MOV     DPH,R7
   \   0000B8   A3           INC     DPTR
   \   0000B9   A3           INC     DPTR
   \   0000BA   A3           INC     DPTR
   \   0000BB   A3           INC     DPTR
   \   0000BC   A3           INC     DPTR
   \   0000BD   A3           INC     DPTR
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   F9           MOV     R1,A
   \   0000C0   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1121          
   1122                      if ( NLME_JoinRequest( pChosenNwk->extendedPANID, pChosenNwk->panId,
   1123                                            pChosenNwk->logicalChannel,
   1124                                            ZDO_Config_Node_Descriptor.CapabilityFlags,
   1125                                            pChosenNwk->chosenRouter, pChosenNwk->chosenRouterDepth ) != ZSuccess )
   \   0000C3                ; Setup parameters for call to function NLME_JoinRequest
   \   0000C3   8E82         MOV     DPL,R6
   \   0000C5   8F83         MOV     DPH,R7
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   A3           INC     DPTR
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   F5..         MOV     ?V0 + 6,A
   \   0000D4   78..         MOV     R0,#?V0 + 6
   \   0000D6   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000D9   8E82         MOV     DPL,R6
   \   0000DB   8F83         MOV     DPH,R7
   \   0000DD   A3           INC     DPTR
   \   0000DE   A3           INC     DPTR
   \   0000DF   A3           INC     DPTR
   \   0000E0   A3           INC     DPTR
   \   0000E1   A3           INC     DPTR
   \   0000E2   A3           INC     DPTR
   \   0000E3   A3           INC     DPTR
   \   0000E4   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0000E7   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   F5..         MOV     ?V0 + 6,A
   \   0000ED   78..         MOV     R0,#?V0 + 6
   \   0000EF   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000F2   8E82         MOV     DPL,R6
   \   0000F4   8F83         MOV     DPH,R7
   \   0000F6   A3           INC     DPTR
   \   0000F7   A3           INC     DPTR
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   F9           MOV     R1,A
   \   0000FA   8E82         MOV     DPL,R6
   \   0000FC   8F83         MOV     DPH,R7
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   FC           MOV     R4,A
   \   000100   A3           INC     DPTR
   \   000101   E0           MOVX    A,@DPTR
   \   000102   FD           MOV     R5,A
   \   000103   EE           MOV     A,R6
   \   000104   240B         ADD     A,#0xb
   \   000106   FA           MOV     R2,A
   \   000107   EF           MOV     A,R7
   \   000108   3400         ADDC    A,#0x0
   \   00010A   FB           MOV     R3,A
   \   00010B   12....       LCALL   ??NLME_JoinRequest?relay
   \   00010E   7404         MOV     A,#0x4
   \   000110   12....       LCALL   ?DEALLOC_XSTACK8
   \   000113   E9           MOV     A,R1
   \   000114   7003         JNZ     $+5
   \   000116   02....       LJMP    ??ZDApp_ProcessOSALMsg_11 & 0xFFFF
   1126                      {
   1127                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1128                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000119                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000119                ; Setup parameters for call to function osal_rand
   \   000119   12....       LCALL   ??osal_rand?relay
   \   00011C   8A..         MOV     ?V0 + 6,R2
   \   00011E   8B..         MOV     ?V0 + 7,R3
   \   000120   E5..         MOV     A,?V0 + 6
   \   000122   547F         ANL     A,#0x7f
   \   000124   F8           MOV     R0,A
   \   000125   E5..         MOV     A,?V0 + 7
   \   000127   5400         ANL     A,#0x0
   \   000129   F9           MOV     R1,A
   \   00012A   E8           MOV     A,R0
   \   00012B   2464         ADD     A,#0x64
   \   00012D   FA           MOV     R2,A
   \   00012E   E9           MOV     A,R1
   \   00012F   3400         ADDC    A,#0x0
   \   000131   FB           MOV     R3,A
   \   000132   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000135   02....       LJMP    ??ZDApp_ProcessOSALMsg_11 & 0xFFFF
   1129                      }
   1130                    } // if ( devStartMode == MODE_JOIN )
   1131                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   000138   90....       MOV     DPTR,#devStartMode
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   6403         XRL     A,#0x3
   \   00013E   6003         JZ      $+5
   \   000140   02....       LJMP    ??ZDApp_ProcessOSALMsg_11 & 0xFFFF
   1132                    {
   1133                      devState = DEV_NWK_REJOIN;
   \   000143   90....       MOV     DPTR,#devState
   \   000146   7404         MOV     A,#0x4
   \   000148   F0           MOVX    @DPTR,A
   1134          
   1135                      
   1136                     osal_start_timerEx( ZDAppTaskID,ZDO_ENDDIVCE_REJOIN, 30000 );//°ë·ÖÖÓºó·¢ÏÖREJOINÊ§°ÜÔò¸´Î»Ò»ÏÂ
   \   000149                ; Setup parameters for call to function osal_start_timerEx
   \   000149   7C30         MOV     R4,#0x30
   \   00014B   7D75         MOV     R5,#0x75
   \   00014D   7A00         MOV     R2,#0x0
   \   00014F   7B40         MOV     R3,#0x40
   \   000151   90....       MOV     DPTR,#ZDAppTaskID
   \   000154   E0           MOVX    A,@DPTR
   \   000155   F9           MOV     R1,A
   \   000156   12....       LCALL   ??osal_start_timerEx?relay
   \   000159   E9           MOV     A,R1
   1137          
   1138          
   1139                                  
   1140                      // Before trying to do rejoin, check if the device has a valid short address
   1141                      // If not, generate a random short address for itself
   1142                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   00015A   90....       MOV     DPTR,#_NIB + 20
   \   00015D   E0           MOVX    A,@DPTR
   \   00015E   64FE         XRL     A,#0xfe
   \   000160   7004         JNZ     ??ZDApp_ProcessOSALMsg_12
   \   000162   A3           INC     DPTR
   \   000163   E0           MOVX    A,@DPTR
   \   000164   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   000166   7015         JNZ     ??ZDApp_ProcessOSALMsg_13
   1143                      {
   1144                        _NIB.nwkDevAddress = osal_rand();
   \   000168                ; Setup parameters for call to function osal_rand
   \   000168   12....       LCALL   ??osal_rand?relay
   \   00016B   90....       MOV     DPTR,#_NIB + 20
   \   00016E   EA           MOV     A,R2
   \   00016F   F0           MOVX    @DPTR,A
   \   000170   A3           INC     DPTR
   \   000171   EB           MOV     A,R3
   \   000172   F0           MOVX    @DPTR,A
   1145                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \   000173                ; Setup parameters for call to function ZMacSetReq
   \   000173   7A..         MOV     R2,#(_NIB + 20) & 0xff
   \   000175   7B..         MOV     R3,#((_NIB + 20) >> 8) & 0xff
   \   000177   7953         MOV     R1,#0x53
   \   000179   12....       LCALL   ??ZMacSetReq?relay
   \   00017C   E9           MOV     A,R1
   1146                      }
   1147          
   1148                      if ( ZG_SECURE_ENABLED )
   1149                      {
   1150                        ZDApp_RestoreNwkKey();
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   00017D                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   00017D   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   000180   E9           MOV     A,R1
   1151                      }
   1152          
   1153                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1154                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \   000181   90....       MOV     DPTR,#_NIB + 33
   \   000184   E0           MOVX    A,@DPTR
   \   000185   64FE         XRL     A,#0xfe
   \   000187   7004         JNZ     ??ZDApp_ProcessOSALMsg_14
   \   000189   A3           INC     DPTR
   \   00018A   E0           MOVX    A,@DPTR
   \   00018B   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   00018D   701B         JNZ     ??ZDApp_ProcessOSALMsg_15
   1155                      {
   1156                        _NIB.nwkPanId = pChosenNwk->panId;
   \   00018F   8E82         MOV     DPL,R6
   \   000191   8F83         MOV     DPH,R7
   \   000193   E0           MOVX    A,@DPTR
   \   000194   F8           MOV     R0,A
   \   000195   A3           INC     DPTR
   \   000196   E0           MOVX    A,@DPTR
   \   000197   F9           MOV     R1,A
   \   000198   90....       MOV     DPTR,#_NIB + 33
   \   00019B   E8           MOV     A,R0
   \   00019C   F0           MOVX    @DPTR,A
   \   00019D   A3           INC     DPTR
   \   00019E   E9           MOV     A,R1
   \   00019F   F0           MOVX    @DPTR,A
   1157                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   0001A0                ; Setup parameters for call to function ZMacSetReq
   \   0001A0   7A..         MOV     R2,#(_NIB + 33) & 0xff
   \   0001A2   7B..         MOV     R3,#((_NIB + 33) >> 8) & 0xff
   \   0001A4   7950         MOV     R1,#0x50
   \   0001A6   12....       LCALL   ??ZMacSetReq?relay
   \   0001A9   E9           MOV     A,R1
   1158                      }
   1159          
   1160                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   0001AA   85..82       MOV     DPL,?XSP + 0
   \   0001AD   85..83       MOV     DPH,?XSP + 1
   \   0001B0   7401         MOV     A,#0x1
   \   0001B2   F0           MOVX    @DPTR,A
   1161                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   0001B3                ; Setup parameters for call to function ZMacSetReq
   \   0001B3   85..82       MOV     DPL,?XSP + 0
   \   0001B6   85..83       MOV     DPH,?XSP + 1
   \   0001B9   AA82         MOV     R2,DPL
   \   0001BB   AB83         MOV     R3,DPH
   \   0001BD   7952         MOV     R1,#0x52
   \   0001BF   12....       LCALL   ??ZMacSetReq?relay
   \   0001C2   E9           MOV     A,R1
   1162                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, pChosenNwk->logicalChannel) != ZSuccess )
   \   0001C3                ; Setup parameters for call to function NLME_ReJoinRequest
   \   0001C3   8E82         MOV     DPL,R6
   \   0001C5   8F83         MOV     DPH,R7
   \   0001C7   A3           INC     DPTR
   \   0001C8   A3           INC     DPTR
   \   0001C9   E0           MOVX    A,@DPTR
   \   0001CA   F9           MOV     R1,A
   \   0001CB   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   0001CD   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   0001CF   12....       LCALL   ??NLME_ReJoinRequest?relay
   \   0001D2   E9           MOV     A,R1
   \   0001D3   601C         JZ      ??ZDApp_ProcessOSALMsg_11
   1163                      {
   1164                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1165                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0001D5                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001D5                ; Setup parameters for call to function osal_rand
   \   0001D5   12....       LCALL   ??osal_rand?relay
   \   0001D8   8A..         MOV     ?V0 + 6,R2
   \   0001DA   8B..         MOV     ?V0 + 7,R3
   \   0001DC   E5..         MOV     A,?V0 + 6
   \   0001DE   547F         ANL     A,#0x7f
   \   0001E0   F8           MOV     R0,A
   \   0001E1   E5..         MOV     A,?V0 + 7
   \   0001E3   5400         ANL     A,#0x0
   \   0001E5   F9           MOV     R1,A
   \   0001E6   E8           MOV     A,R0
   \   0001E7   2464         ADD     A,#0x64
   \   0001E9   FA           MOV     R2,A
   \   0001EA   E9           MOV     A,R1
   \   0001EB   3400         ADDC    A,#0x0
   \   0001ED   FB           MOV     R3,A
   \   0001EE   12....       LCALL   ??ZDApp_NetworkInit?relay
   1166                      }
   1167                    } 
   1168          
   1169                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   0001F1   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0001F4   E0           MOVX    A,@DPTR
   \   0001F5   A2E3         MOV     C,0xE0 /* A   */.3
   \   0001F7   5017         JNC     ??ZDApp_ProcessOSALMsg_16
   1170                    {
   1171                      // The receiver is on, turn network layer polling off.
   1172                      NLME_SetPollRate( 0 );
   \   0001F9                ; Setup parameters for call to function NLME_SetPollRate
   \   0001F9   7A00         MOV     R2,#0x0
   \   0001FB   7B00         MOV     R3,#0x0
   \   0001FD   12....       LCALL   ??NLME_SetPollRate?relay
   1173                      NLME_SetQueuedPollRate( 0 );
   \   000200                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000200   7A00         MOV     R2,#0x0
   \   000202   7B00         MOV     R3,#0x0
   \   000204   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1174                      NLME_SetResponseRate( 0 );
   \   000207                ; Setup parameters for call to function NLME_SetResponseRate
   \   000207   7A00         MOV     R2,#0x0
   \   000209   7B00         MOV     R3,#0x0
   \   00020B   12....       LCALL   ??NLME_SetResponseRate?relay
   \   00020E   8036         SJMP    ??ZDApp_ProcessOSALMsg_17
   1175                    }
   1176                    else
   1177                    {
   1178                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   000210   90....       MOV     DPTR,#devStartMode
   \   000213   E0           MOVX    A,@DPTR
   \   000214   7030         JNZ     ??ZDApp_ProcessOSALMsg_17
   1179                      {
   1180                        ZDApp_SavedPollRate = zgPollRate;
   \   000216   90....       MOV     DPTR,#zgPollRate
   \   000219   E0           MOVX    A,@DPTR
   \   00021A   F8           MOV     R0,A
   \   00021B   A3           INC     DPTR
   \   00021C   E0           MOVX    A,@DPTR
   \   00021D   F9           MOV     R1,A
   \   00021E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000221   E8           MOV     A,R0
   \   000222   F0           MOVX    @DPTR,A
   \   000223   A3           INC     DPTR
   \   000224   E9           MOV     A,R1
   \   000225   F0           MOVX    @DPTR,A
   1181                        NLME_SetPollRate( zgRejoinPollRate );
   \   000226                ; Setup parameters for call to function NLME_SetPollRate
   \   000226   90....       MOV     DPTR,#zgRejoinPollRate
   \   000229   E0           MOVX    A,@DPTR
   \   00022A   FA           MOV     R2,A
   \   00022B   A3           INC     DPTR
   \   00022C   E0           MOVX    A,@DPTR
   \   00022D   FB           MOV     R3,A
   \   00022E   12....       LCALL   ??NLME_SetPollRate?relay
   \   000231   806D         SJMP    ??ZDApp_ProcessOSALMsg_7
   1182                      }
   1183                    }
   1184                  }
   1185                  else
   1186                  {
   1187                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000233   90....       MOV     DPTR,#continueJoining
   \   000236   E0           MOVX    A,@DPTR
   \   000237   6067         JZ      ??ZDApp_ProcessOSALMsg_7
   1188                    {
   1189              #if defined ( MANAGED_SCAN )
   1190                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1191              #else
   1192                      
   1193                  osal_set_event( ZDAppTaskID, ZDO_ENDDIVCE_DISC );
   \   000239                ; Setup parameters for call to function osal_set_event
   \   000239   7A00         MOV     R2,#0x0
   \   00023B   7B20         MOV     R3,#0x20
   \   00023D   90....       MOV     DPTR,#ZDAppTaskID
   \   000240   E0           MOVX    A,@DPTR
   \   000241   F9           MOV     R1,A
   \   000242   12....       LCALL   ??osal_set_event?relay
   \   000245   E9           MOV     A,R1
   1194                      
   1195              #endif
   1196                    }
   1197                  }
   1198                }
   1199                break;
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   000246   8058         SJMP    ??ZDApp_ProcessOSALMsg_7
   1200          
   1201              case ZDO_NWK_JOIN_IND:
   1202                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000248   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00024B   E0           MOVX    A,@DPTR
   \   00024C   6401         XRL     A,#0x1
   \   00024E   6008         JZ      ??ZDApp_ProcessOSALMsg_18
   \   000250   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000253   E0           MOVX    A,@DPTR
   \   000254   6402         XRL     A,#0x2
   \   000256   7048         JNZ     ??ZDApp_ProcessOSALMsg_7
   1203                {
   1204                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_18:
   \   000258                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   000258   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   1205                }
   1206                break;
   \   00025B   8043         SJMP    ??ZDApp_ProcessOSALMsg_7
   1207          
   1208              case ZDO_NWK_JOIN_REQ:
   1209                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   00025D   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000260   E0           MOVX    A,@DPTR
   \   000261   6401         XRL     A,#0x1
   \   000263   6008         JZ      ??ZDApp_ProcessOSALMsg_19
   \   000265   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000268   E0           MOVX    A,@DPTR
   \   000269   6402         XRL     A,#0x2
   \   00026B   7033         JNZ     ??ZDApp_ProcessOSALMsg_7
   1210                {
   1211                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_19:
   \   00026D   90....       MOV     DPTR,#retryCnt
   \   000270   7400         MOV     A,#0x0
   \   000272   F0           MOVX    @DPTR,A
   1212                  devStartMode = MODE_RESUME;
   \   000273   90....       MOV     DPTR,#devStartMode
   \   000276   7401         MOV     A,#0x1
   \   000278   F0           MOVX    @DPTR,A
   1213                  _tmpRejoinState = true;
   \   000279   90....       MOV     DPTR,#_tmpRejoinState
   \   00027C   7401         MOV     A,#0x1
   \   00027E   F0           MOVX    @DPTR,A
   1214                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   00027F                ; Setup parameters for call to function sAddrExtCpy
   \   00027F   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   000281   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   000283   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   000285   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000287   12....       LCALL   ??sAddrExtCpy?relay
   1215                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   00028A   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   00028D   7402         MOV     A,#0x2
   \   00028F   F0           MOVX    @DPTR,A
   1216                  ZDApp_NetworkInit( 0 );
   \   000290                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000290   7A00         MOV     R2,#0x0
   \   000292   7B00         MOV     R3,#0x0
   \   000294   12....       LCALL   ??ZDApp_NetworkInit?relay
   1217                }
   1218                break;
   \   000297   8007         SJMP    ??ZDApp_ProcessOSALMsg_7
   1219          
   1220              default:
   1221                if ( ZG_SECURE_ENABLED )
   1222                  ZDApp_ProcessSecMsg( msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   000299                ; Setup parameters for call to function ZDApp_ProcessSecMsg
   \   000299   AA..         MOV     R2,?V0 + 0
   \   00029B   AB..         MOV     R3,?V0 + 1
   \   00029D   12....       LCALL   ??ZDApp_ProcessSecMsg?relay
   1223                break;
   1224            }
   1225          
   1226          }
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   0002A0   7401         MOV     A,#0x1
   \   0002A2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002A5   7F08         MOV     R7,#0x8
   \   0002A7   02....       LJMP    ?BANKED_LEAVE_XDATA
   1227          
   1228          /*********************************************************************
   1229           * @fn      ZDApp_ProcessMsgCBs()
   1230           *
   1231           * @brief   Process response messages
   1232           *
   1233           * @param   none
   1234           *
   1235           * @return  none
   1236           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1237          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1238          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1239            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 0,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 1,A
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000024   0200         DW        2
   \   000026   2100         DW        33
   \   000028   2200         DW        34
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002C   0080         DW        32768
   \   00002E   0180         DW        32769
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000032   0000         DW        0
   \   000034   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1240            {
   1241          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1242              case NWK_addr_rsp:
   1243              case IEEE_addr_rsp:
   1244                {
   1245                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1246                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000036                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000036   EE           MOV     A,R6
   \   000037   FA           MOV     R2,A
   \   000038   EF           MOV     A,R7
   \   000039   FB           MOV     R3,A
   \   00003A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003D   8A..         MOV     ?V0 + 2,R2
   \   00003F   8B..         MOV     ?V0 + 3,R3
   \   000041   85....       MOV     ?V0 + 0,?V0 + 2
   \   000044   85....       MOV     ?V0 + 1,?V0 + 3
   1247                  if ( pAddrRsp )
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   45..         ORL     A,?V0 + 1
   \   00004B   604D         JZ      ??ZDApp_ProcessMsgCBs_2
   1248                  {
   1249                    if ( pAddrRsp->status == ZSuccess )
   \   00004D   85..82       MOV     DPL,?V0 + 0
   \   000050   85..83       MOV     DPH,?V0 + 1
   \   000053   E0           MOVX    A,@DPTR
   \   000054   7019         JNZ     ??ZDApp_ProcessMsgCBs_3
   1250                    {
   1251                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000056                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000056   E5..         MOV     A,?V0 + 0
   \   000058   2403         ADD     A,#0x3
   \   00005A   FC           MOV     R4,A
   \   00005B   E5..         MOV     A,?V0 + 1
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FD           MOV     R5,A
   \   000060   85..82       MOV     DPL,?V0 + 0
   \   000063   85..83       MOV     DPH,?V0 + 1
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   FA           MOV     R2,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FB           MOV     R3,A
   \   00006C   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1252                    }
   1253                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   00006F                ; Setup parameters for call to function osal_mem_free
   \   00006F   AA..         MOV     R2,?V0 + 0
   \   000071   AB..         MOV     R3,?V0 + 1
   \   000073   12....       LCALL   ??osal_mem_free?relay
   1254                  }
   1255                }
   1256                break;
   \   000076   8022         SJMP    ??ZDApp_ProcessMsgCBs_2
   1257          #endif
   1258          
   1259          #if defined ( REFLECTOR )
   1260              case Bind_req:
   1261              case Unbind_req:
   1262                {
   1263                  ZDO_BindUnbindReq_t bindReq;
   1264                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000078                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000078   85..82       MOV     DPL,?XSP + 0
   \   00007B   85..83       MOV     DPH,?XSP + 1
   \   00007E   AC82         MOV     R4,DPL
   \   000080   AD83         MOV     R5,DPH
   \   000082   EE           MOV     A,R6
   \   000083   FA           MOV     R2,A
   \   000084   EF           MOV     A,R7
   \   000085   FB           MOV     R3,A
   \   000086   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1265                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000089                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000089   85..82       MOV     DPL,?XSP + 0
   \   00008C   85..83       MOV     DPH,?XSP + 1
   \   00008F   AC82         MOV     R4,DPL
   \   000091   AD83         MOV     R5,DPH
   \   000093   EE           MOV     A,R6
   \   000094   FA           MOV     R2,A
   \   000095   EF           MOV     A,R7
   \   000096   FB           MOV     R3,A
   \   000097   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1266                }
   1267                break;
   1268          #endif
   1269          
   1270          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1271              case Bind_rsp:
   1272              case Unbind_rsp:
   1273                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1274                {
   1275                  ZDMatchSendState(
   1276                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1277                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1278                }
   1279                break;
   1280          
   1281              case End_Device_Bind_req:
   1282                if (ZG_DEVICE_COORDINATOR_TYPE)
   1283                {
   1284                  ZDEndDeviceBind_t bindReq;
   1285                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1286                  ZDO_MatchEndDeviceBind( &bindReq );
   1287          
   1288                  // Freeing the cluster lists - if allocated.
   1289                  if ( bindReq.numInClusters )
   1290                    osal_mem_free( bindReq.inClusters );
   1291                  if ( bindReq.numOutClusters )
   1292                    osal_mem_free( bindReq.outClusters );
   1293                }
   1294                break;
   1295          #endif
   1296            }
   1297          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00009A   7415         MOV     A,#0x15
   \   00009C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009F   7F04         MOV     R7,#0x4
   \   0000A1   02....       LJMP    ?BANKED_LEAVE_XDATA
   1298          
   1299          /*********************************************************************
   1300           * @fn      ZDApp_RegisterCBs()
   1301           *
   1302           * @brief   Process response messages
   1303           *
   1304           * @param   none
   1305           *
   1306           * @return  none
   1307           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1308          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1309          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1310          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1311            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B80         MOV     R3,#-0x80
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000010   E9           MOV     A,R1
   1312          #endif
   1313          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1314            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \   000011                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000011   7A00         MOV     R2,#0x0
   \   000013   7B80         MOV     R3,#-0x80
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00001D   E9           MOV     A,R1
   1315          #endif
   1316          #if ZG_BUILD_COORDINATOR_TYPE
   1317            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1318            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1319            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1320          #endif
   1321          #if defined ( REFLECTOR )
   1322            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \   00001E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001E   7A21         MOV     R2,#0x21
   \   000020   7B00         MOV     R3,#0x0
   \   000022   90....       MOV     DPTR,#ZDAppTaskID
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F9           MOV     R1,A
   \   000027   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00002A   E9           MOV     A,R1
   1323            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \   00002B                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00002B   7A22         MOV     R2,#0x22
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000037   E9           MOV     A,R1
   1324          #endif
   1325          }
   \   000038   D083         POP     DPH
   \   00003A   D082         POP     DPL
   \   00003C   02....       LJMP    ?BRET
   1326          
   1327          /*********************************************************************
   1328           * @fn      ZDApp_ProcessSecMsg()
   1329           *
   1330           * @brief   Process the incoming security message.
   1331           *
   1332           * @param   msgPtr - message to process
   1333           *
   1334           * @return  none
   1335           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1336          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1337          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1338            switch ( msgPtr->event )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   24FC         ADD     A,#-0x4
   \   000010   604A         JZ      ??ZDApp_ProcessSecMsg_0
   \   000012   14           DEC     A
   \   000013   6047         JZ      ??ZDApp_ProcessSecMsg_0
   \   000015   14           DEC     A
   \   000016   6014         JZ      ??ZDApp_ProcessSecMsg_1
   \   000018   14           DEC     A
   \   000019   6041         JZ      ??ZDApp_ProcessSecMsg_0
   \   00001B   14           DEC     A
   \   00001C   603E         JZ      ??ZDApp_ProcessSecMsg_0
   \   00001E   14           DEC     A
   \   00001F   603B         JZ      ??ZDApp_ProcessSecMsg_0
   \   000021   14           DEC     A
   \   000022   6021         JZ      ??ZDApp_ProcessSecMsg_2
   \   000024   14           DEC     A
   \   000025   6035         JZ      ??ZDApp_ProcessSecMsg_0
   \   000027   14           DEC     A
   \   000028   6032         JZ      ??ZDApp_ProcessSecMsg_0
   \   00002A   8030         SJMP    ??ZDApp_ProcessSecMsg_0
   1339            {
   1340              case ZDO_ESTABLISH_KEY_CFM:
   1341                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1342                {
   1343                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1344                }
   1345                break;
   1346          
   1347              case ZDO_ESTABLISH_KEY_IND:
   1348                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1349                {
   1350                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1351                  {
   1352                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1353                  }
   1354                }
   1355                break;
   1356          
   1357              case ZDO_TRANSPORT_KEY_IND:
   1358                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6401         XRL     A,#0x1
   \   000032   6008         JZ      ??ZDApp_ProcessSecMsg_3
   \   000034   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6402         XRL     A,#0x2
   \   00003A   7020         JNZ     ??ZDApp_ProcessSecMsg_0
   1359                {
   1360                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_3:
   \   00003C                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   00003C   EE           MOV     A,R6
   \   00003D   FA           MOV     R2,A
   \   00003E   EF           MOV     A,R7
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   1361                }
   1362                break;
   \   000043   8017         SJMP    ??ZDApp_ProcessSecMsg_0
   1363          
   1364              case ZDO_UPDATE_DEVICE_IND:
   1365                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1366                {
   1367                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1368                }
   1369                break;
   1370          
   1371              case ZDO_REMOVE_DEVICE_IND:
   1372                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1373                {
   1374                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1375                }
   1376                break;
   1377          
   1378              case ZDO_REQUEST_KEY_IND:
   1379                if (( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH ) ||
   1380                    ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD ))
   1381                {
   1382                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1383                  {
   1384                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1385                  }
   1386                }
   1387                break;
   1388          
   1389              case ZDO_SWITCH_KEY_IND:
   1390                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000045   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000048   E0           MOVX    A,@DPTR
   \   000049   6401         XRL     A,#0x1
   \   00004B   6008         JZ      ??ZDApp_ProcessSecMsg_4
   \   00004D   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000050   E0           MOVX    A,@DPTR
   \   000051   6402         XRL     A,#0x2
   \   000053   7007         JNZ     ??ZDApp_ProcessSecMsg_0
   1391                {
   1392                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000055                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1393                }
   1394                break;
   1395          
   1396              case ZDO_AUTHENTICATE_IND:
   1397                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1398                {
   1399                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1400                }
   1401                break;
   1402          
   1403              case ZDO_AUTHENTICATE_CFM:
   1404                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1405                {
   1406                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1407                }
   1408                break;
   1409          
   1410              default:
   1411                // Unsupported messages
   1412                break;
   1413            }
   1414          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   00005C   7F01         MOV     R7,#0x1
   \   00005E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1415          
   1416          /*********************************************************************
   1417           * @fn      ZDApp_ProcessNetworkJoin()
   1418           *
   1419           * @brief
   1420           *
   1421           *   Save off the Network key information.
   1422           *
   1423           * @param   none
   1424           *
   1425           * @return  none
   1426           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1427          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1428          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1429            if ( (devState == DEV_NWK_JOINING) ||
   1430                ((devState == DEV_NWK_ORPHAN)  &&
   1431                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6018         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   90....       MOV     DPTR,#devState
   \   000015   E0           MOVX    A,@DPTR
   \   000016   640A         XRL     A,#0xa
   \   000018   6003         JZ      $+5
   \   00001A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000020   E0           MOVX    A,@DPTR
   \   000021   5407         ANL     A,#0x7
   \   000023   6401         XRL     A,#0x1
   \   000025   6003         JZ      $+5
   \   000027   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   1432            {
   1433              // Result of a Join attempt by this device.
   1434              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   00002A   90....       MOV     DPTR,#nwkStatus
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   7042         JNZ     ??ZDApp_ProcessNetworkJoin_2
   1435              {
   1436                zdoDiscCounter = 1;//@@@
   \   000030   90....       MOV     DPTR,#zdoDiscCounter
   \   000033   7401         MOV     A,#0x1
   \   000035   F0           MOVX    @DPTR,A
   1437                
   1438                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000036                ; Setup parameters for call to function osal_set_event
   \   000036   7A10         MOV     R2,#0x10
   \   000038   7B00         MOV     R3,#0x0
   \   00003A   90....       MOV     DPTR,#ZDAppTaskID
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F9           MOV     R1,A
   \   00003F   12....       LCALL   ??osal_set_event?relay
   \   000042   E9           MOV     A,R1
   1439          
   1440          #if defined ( POWER_SAVING )
   1441                osal_pwrmgr_device( PWRMGR_BATTERY );
   \   000043                ; Setup parameters for call to function osal_pwrmgr_device
   \   000043   7901         MOV     R1,#0x1
   \   000045   12....       LCALL   ??osal_pwrmgr_device?relay
   1442          #endif
   1443          
   1444                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   \   000048                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000048   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   7010         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1445                {
   1446                  // wait for auth from trust center!!
   1447                  devState = DEV_END_DEVICE_UNAUTH;
   \   00004E   90....       MOV     DPTR,#devState
   \   000051   7405         MOV     A,#0x5
   \   000053   F0           MOVX    @DPTR,A
   1448          
   1449                  // Start the reset timer for MAX UNAUTH time
   1450                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   \   000054                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000054   7A10         MOV     R2,#0x10
   \   000056   7B27         MOV     R3,#0x27
   \   000058   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   \   00005B   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1451                }
   1452                else
   1453                {
   1454                  if ( ZSTACK_ROUTER_BUILD )
   1455                  {
   1456                    if ( devState == DEV_NWK_ORPHAN
   1457                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1458                    {
   1459                      // Change NIB state to router for restore
   1460                      _NIB.nwkState = NWK_ROUTER;
   1461                    }
   1462                  }
   1463          
   1464                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   00005E   90....       MOV     DPTR,#devState
   \   000061   E0           MOVX    A,@DPTR
   \   000062   6403         XRL     A,#0x3
   \   000064   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1465                  {
   1466                    ZDApp_AnnounceNewAddress();
   \   000066                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000066   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1467                  }
   1468          
   1469                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000069   90....       MOV     DPTR,#devState
   \   00006C   7406         MOV     A,#0x6
   \   00006E   F0           MOVX    @DPTR,A
   1470                  if ( ZSTACK_ROUTER_BUILD )
   \   00006F   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1471                  {
   1472                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1473                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1474                    {
   1475                      NLME_StartRouterRequest( 0, 0, false );
   1476                    }
   1477                  }
   1478                }
   1479              }
   1480              else
   1481              {
   1482                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   000072   90....       MOV     DPTR,#devStartMode
   \   000075   E0           MOVX    A,@DPTR
   \   000076   6401         XRL     A,#0x1
   \   000078   703F         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   00007A   90....       MOV     DPTR,#retryCnt
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   2401         ADD     A,#0x1
   \   000080   90....       MOV     DPTR,#retryCnt
   \   000083   F0           MOVX    @DPTR,A
   \   000084   C3           CLR     C
   \   000085   9403         SUBB    A,#0x3
   \   000087   4030         JC      ??ZDApp_ProcessNetworkJoin_6
   1483                {
   1484                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000089   90....       MOV     DPTR,#_NIB + 33
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   64FF         XRL     A,#0xff
   \   00008F   7004         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   000091   A3           INC     DPTR
   \   000092   E0           MOVX    A,@DPTR
   \   000093   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000095   600E         JZ      ??ZDApp_ProcessNetworkJoin_8
   \   000097   90....       MOV     DPTR,#_NIB + 33
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   64FE         XRL     A,#0xfe
   \   00009D   7004         JNZ     ??ZDApp_ProcessNetworkJoin_9
   \   00009F   A3           INC     DPTR
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   0000A3   7008         JNZ     ??ZDApp_ProcessNetworkJoin_10
   1485                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   0000A5   90....       MOV     DPTR,#devStartMode
   \   0000A8   7400         MOV     A,#0x0
   \   0000AA   F0           MOVX    @DPTR,A
   \   0000AB   800C         SJMP    ??ZDApp_ProcessNetworkJoin_6
   1486                  else
   1487                  {
   1488                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000AD   90....       MOV     DPTR,#devStartMode
   \   0000B0   7403         MOV     A,#0x3
   \   0000B2   F0           MOVX    @DPTR,A
   1489                    _tmpRejoinState = true;
   \   0000B3   90....       MOV     DPTR,#_tmpRejoinState
   \   0000B6   7401         MOV     A,#0x1
   \   0000B8   F0           MOVX    @DPTR,A
   1490                  }
   1491                }
   1492          
   1493                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1494                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   0000B9                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000B9   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000BC   8A..         MOV     ?V0 + 0,R2
   \   0000BE   8B..         MOV     ?V0 + 1,R3
   \   0000C0   74FE         MOV     A,#-0x2
   \   0000C2   65..         XRL     A,?V0 + 0
   \   0000C4   7004         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   0000C6   74FF         MOV     A,#-0x1
   \   0000C8   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000CA   700E         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000CC   90....       MOV     DPTR,#_NIB + 20
   \   0000CF   E0           MOVX    A,@DPTR
   \   0000D0   64FE         XRL     A,#0xfe
   \   0000D2   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000D4   A3           INC     DPTR
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000D8   6027         JZ      ??ZDApp_ProcessNetworkJoin_14
   1495                {
   1496                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000DA   85..82       MOV     DPL,?XSP + 0
   \   0000DD   85..83       MOV     DPH,?XSP + 1
   \   0000E0   74FE         MOV     A,#-0x2
   \   0000E2   F0           MOVX    @DPTR,A
   \   0000E3   A3           INC     DPTR
   \   0000E4   74FF         MOV     A,#-0x1
   \   0000E6   F0           MOVX    @DPTR,A
   1497                  // Invalidate nwk addr so end device does not use in its data reqs.
   1498                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000E7   90....       MOV     DPTR,#_NIB + 20
   \   0000EA   74FE         MOV     A,#-0x2
   \   0000EC   F0           MOVX    @DPTR,A
   \   0000ED   A3           INC     DPTR
   \   0000EE   74FF         MOV     A,#-0x1
   \   0000F0   F0           MOVX    @DPTR,A
   1499                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000F1                ; Setup parameters for call to function ZMacSetReq
   \   0000F1   85..82       MOV     DPL,?XSP + 0
   \   0000F4   85..83       MOV     DPH,?XSP + 1
   \   0000F7   AA82         MOV     R2,DPL
   \   0000F9   AB83         MOV     R3,DPH
   \   0000FB   7953         MOV     R1,#0x53
   \   0000FD   12....       LCALL   ??ZMacSetReq?relay
   \   000100   E9           MOV     A,R1
   1500                }
   1501          
   1502                // Clear the neighbor Table and network discovery tables.
   1503                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   000101                ; Setup parameters for call to function nwkNeighborInitTable
   \   000101   12....       LCALL   ??nwkNeighborInitTable?relay
   1504                NLME_NwkDiscTerm();
   \   000104                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   000104   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1505          
   1506                zdoDiscCounter = 1;
   \   000107   90....       MOV     DPTR,#zdoDiscCounter
   \   00010A   7401         MOV     A,#0x1
   \   00010C   F0           MOVX    @DPTR,A
   1507          
   1508          //      ZDApp_NetworkInit( (uint16)
   1509          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1510          //                          (NWK_START_DELAY * 5)) );
   1511                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1512                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   00010D                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00010D                ; Setup parameters for call to function osal_rand
   \   00010D   12....       LCALL   ??osal_rand?relay
   \   000110   8A..         MOV     ?V0 + 0,R2
   \   000112   8B..         MOV     ?V0 + 1,R3
   \   000114   E5..         MOV     A,?V0 + 0
   \   000116   547F         ANL     A,#0x7f
   \   000118   F8           MOV     R0,A
   \   000119   E5..         MOV     A,?V0 + 1
   \   00011B   5400         ANL     A,#0x0
   \   00011D   F9           MOV     R1,A
   \   00011E   E8           MOV     A,R0
   \   00011F   2464         ADD     A,#0x64
   \   000121   FA           MOV     R2,A
   \   000122   E9           MOV     A,R1
   \   000123   3400         ADDC    A,#0x0
   \   000125   FB           MOV     R3,A
   \   000126   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000129   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1513              }
   1514            }
   1515            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   00012C   90....       MOV     DPTR,#devState
   \   00012F   E0           MOVX    A,@DPTR
   \   000130   640A         XRL     A,#0xa
   \   000132   600B         JZ      ??ZDApp_ProcessNetworkJoin_15
   \   000134   90....       MOV     DPTR,#devState
   \   000137   E0           MOVX    A,@DPTR
   \   000138   6404         XRL     A,#0x4
   \   00013A   6003         JZ      $+5
   \   00013C   02....       LJMP    ??ZDApp_ProcessNetworkJoin_16 & 0xFFFF
   1516            {
   1517              // results of an orphaning attempt by this device
   1518              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   00013F   90....       MOV     DPTR,#nwkStatus
   \   000142   E0           MOVX    A,@DPTR
   \   000143   7045         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1519              {
   1520                if ( ZG_SECURE_ENABLED )
   1521                {
   1522                  ZDApp_RestoreNwkKey();
   \   000145                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000145   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   000148   E9           MOV     A,R1
   1523                }
   1524          
   1525                devState = DEV_END_DEVICE;
   \   000149   90....       MOV     DPTR,#devState
   \   00014C   7406         MOV     A,#0x6
   \   00014E   F0           MOVX    @DPTR,A
   1526                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00014F                ; Setup parameters for call to function osal_set_event
   \   00014F   7A10         MOV     R2,#0x10
   \   000151   7B00         MOV     R3,#0x0
   \   000153   90....       MOV     DPTR,#ZDAppTaskID
   \   000156   E0           MOVX    A,@DPTR
   \   000157   F9           MOV     R1,A
   \   000158   12....       LCALL   ??osal_set_event?relay
   \   00015B   E9           MOV     A,R1
   1527                zdoDiscCounter = 1;
   \   00015C   90....       MOV     DPTR,#zdoDiscCounter
   \   00015F   7401         MOV     A,#0x1
   \   000161   F0           MOVX    @DPTR,A
   1528                
   1529                // setup Power Manager Device
   1530          #if defined ( POWER_SAVING )
   1531                osal_pwrmgr_device( PWRMGR_BATTERY );
   \   000162                ; Setup parameters for call to function osal_pwrmgr_device
   \   000162   7901         MOV     R1,#0x1
   \   000164   12....       LCALL   ??osal_pwrmgr_device?relay
   1532          #endif
   1533          
   1534                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   000167   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00016A   E0           MOVX    A,@DPTR
   \   00016B   A2E3         MOV     C,0xE0 /* A   */.3
   \   00016D   5015         JNC     ??ZDApp_ProcessNetworkJoin_18
   1535                {
   1536                  // The receiver is on, turn network layer polling off.
   1537                  NLME_SetPollRate( 0 );
   \   00016F                ; Setup parameters for call to function NLME_SetPollRate
   \   00016F   7A00         MOV     R2,#0x0
   \   000171   7B00         MOV     R3,#0x0
   \   000173   12....       LCALL   ??NLME_SetPollRate?relay
   1538                  NLME_SetQueuedPollRate( 0 );
   \   000176                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000176   7A00         MOV     R2,#0x0
   \   000178   7B00         MOV     R3,#0x0
   \   00017A   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1539                  NLME_SetResponseRate( 0 );
   \   00017D                ; Setup parameters for call to function NLME_SetResponseRate
   \   00017D   7A00         MOV     R2,#0x0
   \   00017F   7B00         MOV     R3,#0x0
   \   000181   12....       LCALL   ??NLME_SetResponseRate?relay
   1540                }
   1541          
   1542                if ( ZSTACK_ROUTER_BUILD )
   1543                {
   1544                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1545                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1546                  {
   1547                    NLME_StartRouterRequest( 0, 0, false );
   1548                  }
   1549                }
   1550          
   1551                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000184                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000184   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000187   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1552              }
   1553              else
   1554              {
   1555                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   00018A   90....       MOV     DPTR,#devStartMode
   \   00018D   E0           MOVX    A,@DPTR
   \   00018E   6401         XRL     A,#0x1
   \   000190   704F         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1556                {
   1557                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000192   90....       MOV     DPTR,#retryCnt
   \   000195   E0           MOVX    A,@DPTR
   \   000196   2401         ADD     A,#0x1
   \   000198   90....       MOV     DPTR,#retryCnt
   \   00019B   F0           MOVX    @DPTR,A
   \   00019C   C3           CLR     C
   \   00019D   9404         SUBB    A,#0x4
   \   00019F   5032         JNC     ??ZDApp_ProcessNetworkJoin_20
   1558                  {
   1559                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   0001A1   90....       MOV     DPTR,#_NIB + 33
   \   0001A4   E0           MOVX    A,@DPTR
   \   0001A5   64FF         XRL     A,#0xff
   \   0001A7   7004         JNZ     ??ZDApp_ProcessNetworkJoin_21
   \   0001A9   A3           INC     DPTR
   \   0001AA   E0           MOVX    A,@DPTR
   \   0001AB   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   0001AD   600E         JZ      ??ZDApp_ProcessNetworkJoin_22
   \   0001AF   90....       MOV     DPTR,#_NIB + 33
   \   0001B2   E0           MOVX    A,@DPTR
   \   0001B3   64FE         XRL     A,#0xfe
   \   0001B5   7004         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   0001B7   A3           INC     DPTR
   \   0001B8   E0           MOVX    A,@DPTR
   \   0001B9   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   0001BB   7008         JNZ     ??ZDApp_ProcessNetworkJoin_24
   1560                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   0001BD   90....       MOV     DPTR,#devStartMode
   \   0001C0   7400         MOV     A,#0x0
   \   0001C2   F0           MOVX    @DPTR,A
   \   0001C3   801C         SJMP    ??ZDApp_ProcessNetworkJoin_19
   1561                    else
   1562                    {
   1563                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   0001C5   90....       MOV     DPTR,#devStartMode
   \   0001C8   7403         MOV     A,#0x3
   \   0001CA   F0           MOVX    @DPTR,A
   1564                      _tmpRejoinState = true;
   \   0001CB   90....       MOV     DPTR,#_tmpRejoinState
   \   0001CE   7401         MOV     A,#0x1
   \   0001D0   F0           MOVX    @DPTR,A
   \   0001D1   800E         SJMP    ??ZDApp_ProcessNetworkJoin_19
   1565                    }
   1566                  }
   1567                  // Do a normal join to the network after certain times of rejoin retries
   1568                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   0001D3   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   0001D6   E0           MOVX    A,@DPTR
   \   0001D7   6401         XRL     A,#0x1
   \   0001D9   7006         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1569                  {
   1570                    devStartMode = MODE_JOIN;
   \   0001DB   90....       MOV     DPTR,#devStartMode
   \   0001DE   7400         MOV     A,#0x0
   \   0001E0   F0           MOVX    @DPTR,A
   1571                  }
   1572                }
   1573          
   1574                // Clear the neighbor Table and network discovery tables.
   1575                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   0001E1                ; Setup parameters for call to function nwkNeighborInitTable
   \   0001E1   12....       LCALL   ??nwkNeighborInitTable?relay
   1576                NLME_NwkDiscTerm();
   \   0001E4                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0001E4   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1577          
   1578                
   1579                
   1580               
   1581           
   1582                // setup a retry for later...
   1583                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1584                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   0001E7                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001E7                ; Setup parameters for call to function osal_rand
   \   0001E7   12....       LCALL   ??osal_rand?relay
   \   0001EA   8A..         MOV     ?V0 + 0,R2
   \   0001EC   8B..         MOV     ?V0 + 1,R3
   \   0001EE   E5..         MOV     A,?V0 + 0
   \   0001F0   547F         ANL     A,#0x7f
   \   0001F2   F8           MOV     R0,A
   \   0001F3   E5..         MOV     A,?V0 + 1
   \   0001F5   5400         ANL     A,#0x0
   \   0001F7   F9           MOV     R1,A
   \   0001F8   E8           MOV     A,R0
   \   0001F9   2464         ADD     A,#0x64
   \   0001FB   FA           MOV     R2,A
   \   0001FC   E9           MOV     A,R1
   \   0001FD   3400         ADDC    A,#0x0
   \   0001FF   FB           MOV     R3,A
   \   000200   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000203   8018         SJMP    ??ZDApp_ProcessNetworkJoin_4
   1585               
   1586                 
   1587              }
   1588            }
   1589          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1590            else
   1591            {
   1592              // Assume from address conflict
   1593              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   000205   90....       MOV     DPTR,#_NIB + 96
   \   000208   E0           MOVX    A,@DPTR
   \   000209   6402         XRL     A,#0x2
   \   00020B   7010         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1594              {
   1595                // Notify the network
   1596                ZDApp_AnnounceNewAddress();
   \   00020D                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00020D   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1597          
   1598                // Notify apps
   1599                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000210                ; Setup parameters for call to function osal_set_event
   \   000210   7A10         MOV     R2,#0x10
   \   000212   7B00         MOV     R3,#0x0
   \   000214   90....       MOV     DPTR,#ZDAppTaskID
   \   000217   E0           MOVX    A,@DPTR
   \   000218   F9           MOV     R1,A
   \   000219   12....       LCALL   ??osal_set_event?relay
   \   00021C   E9           MOV     A,R1
   1600              }
   1601            }
   1602          #endif
   1603          }
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   00021D   7402         MOV     A,#0x2
   \   00021F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000222   7F02         MOV     R7,#0x2
   \   000224   02....       LJMP    ?BANKED_LEAVE_XDATA
   1604          
   1605          /*********************************************************************
   1606           * @fn      ZDApp_SaveNwkKey()
   1607           *
   1608           * @brief   Save off the Network key information.
   1609           *
   1610           * @param   none
   1611           *
   1612           * @return  none
   1613           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1614          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1615          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1616            nwkActiveKeyItems keyItems;
   1617          
   1618            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1619            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1620          
   1621            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1622                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7C00         MOV     R4,#0x0
   \   000047   7D00         MOV     R5,#0x0
   \   000049   7A82         MOV     R2,#-0x7e
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_write?relay
   \   000050   7404         MOV     A,#0x4
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   \   000055   E9           MOV     A,R1
   1623          
   1624            nwkFrameCounterChanges = 0;
   \   000056   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000059   7400         MOV     A,#0x0
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   7400         MOV     A,#0x0
   \   00005F   F0           MOVX    @DPTR,A
   1625          
   1626            // Clear copy in RAM before return.
   1627            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \   000060                ; Setup parameters for call to function osal_memset
   \   000060   7C15         MOV     R4,#0x15
   \   000062   7D00         MOV     R5,#0x0
   \   000064   7900         MOV     R1,#0x0
   \   000066   85..82       MOV     DPL,?XSP + 0
   \   000069   85..83       MOV     DPH,?XSP + 1
   \   00006C   AA82         MOV     R2,DPL
   \   00006E   AB83         MOV     R3,DPH
   \   000070   12....       LCALL   ??osal_memset?relay
   1628          
   1629          }
   \   000073   7415         MOV     A,#0x15
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   7F04         MOV     R7,#0x4
   \   00007A   02....       LJMP    ?BANKED_LEAVE_XDATA
   1630          
   1631          /*********************************************************************
   1632           * @fn      ZDApp_ResetNwkKey()
   1633           *
   1634           * @brief   Reset the Network key information in NV.
   1635           *
   1636           * @param   none
   1637           *
   1638           * @return  none
   1639           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1640          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1641          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1642            nwkActiveKeyItems keyItems;
   1643          
   1644            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1645            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1646                          (void *)&keyItems );
   \   00001D                ; Setup parameters for call to function osal_nv_write
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..15       MOV     ?V0 + 0,#0x15
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A82         MOV     R2,#-0x7e
   \   00003F   7B00         MOV     R3,#0x0
   \   000041   12....       LCALL   ??osal_nv_write?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   1647          }
   \   00004A   7415         MOV     A,#0x15
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004F   7F02         MOV     R7,#0x2
   \   000051   02....       LJMP    ?BANKED_LEAVE_XDATA
   1648          
   1649          /*********************************************************************
   1650           * @fn      ZDApp_RestoreNwkKey()
   1651           *
   1652           * @brief
   1653           *
   1654           *   Save off the Network key information.
   1655           *
   1656           * @param   none
   1657           *
   1658           * @return  true if restored from NV, false if not
   1659           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1660          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1661          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1662            nwkActiveKeyItems keyItems;
   1663            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1664          
   1665            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1666                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   75..00       MOV     ?V0 + 1,#0x0
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   7C00         MOV     R4,#0x0
   \   00002A   7D00         MOV     R5,#0x0
   \   00002C   7A82         MOV     R2,#-0x7e
   \   00002E   7B00         MOV     R3,#0x0
   \   000030   12....       LCALL   ??osal_nv_read?relay
   \   000033   7404         MOV     A,#0x4
   \   000035   12....       LCALL   ?DEALLOC_XSTACK8
   \   000038   E9           MOV     A,R1
   \   000039   7040         JNZ     ??ZDApp_RestoreNwkKey_0
   1667            {
   1668              if ( keyItems.frameCounter > 0 )
   \   00003B   7411         MOV     A,#0x11
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?L_MOV_X
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   45..         ORL     A,?V0 + 1
   \   000049   45..         ORL     A,?V0 + 2
   \   00004B   45..         ORL     A,?V0 + 3
   \   00004D   6022         JZ      ??ZDApp_RestoreNwkKey_1
   1669              {
   1670                // Restore the key information
   1671                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   \   00004F   90....       MOV     DPTR,#__Constant_3e8
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?L_MOV_X
   \   000057   7411         MOV     A,#0x11
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   78..         MOV     R0,#?V0 + 0
   \   00005E   12....       LCALL   ?L_ADD_TO_X
   1672                nwkFrameCounter = keyItems.frameCounter;
   \   000061   7411         MOV     A,#0x11
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   12....       LCALL   ?XLOAD_R2345
   \   000069   90....       MOV     DPTR,#nwkFrameCounter
   \   00006C   12....       LCALL   ?XSTORE_R2345
   1673                ret = true;
   \   00006F   7E01         MOV     R6,#0x1
   1674              }
   1675          
   1676              // Force a save for the first frame counter increment
   1677              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   000071   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000074   74E9         MOV     A,#-0x17
   \   000076   F0           MOVX    @DPTR,A
   \   000077   A3           INC     DPTR
   \   000078   7403         MOV     A,#0x3
   \   00007A   F0           MOVX    @DPTR,A
   1678            }
   1679            // Clear copy in RAM before return.
   1680            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   00007B                ; Setup parameters for call to function osal_memset
   \   00007B   7C15         MOV     R4,#0x15
   \   00007D   7D00         MOV     R5,#0x0
   \   00007F   7900         MOV     R1,#0x0
   \   000081   85..82       MOV     DPL,?XSP + 0
   \   000084   85..83       MOV     DPH,?XSP + 1
   \   000087   AA82         MOV     R2,DPL
   \   000089   AB83         MOV     R3,DPH
   \   00008B   12....       LCALL   ??osal_memset?relay
   1681          
   1682            return ( ret );
   \   00008E   EE           MOV     A,R6
   \   00008F   F9           MOV     R1,A
   \   000090   7415         MOV     A,#0x15
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   7F04         MOV     R7,#0x4
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA
   1683          }
   1684          
   1685          /*********************************************************************
   1686           * @fn      ZDApp_ResetTimerStart
   1687           *
   1688           * @brief   Start the reset timer.
   1689           *
   1690           * @param   delay - delay time(ms) before reset
   1691           *
   1692           * @return  none
   1693           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1694          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1695          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1696            // Start the rest timer
   1697            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   EE           MOV     A,R6
   \   00000A   FC           MOV     R4,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FD           MOV     R5,A
   \   00000D   7A04         MOV     R2,#0x4
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   90....       MOV     DPTR,#ZDAppTaskID
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F9           MOV     R1,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
   \   000019   E9           MOV     A,R1
   1698          }
   \   00001A   7F01         MOV     R7,#0x1
   \   00001C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1699          
   1700          /*********************************************************************
   1701           * @fn      ZDApp_ResetTimerCancel
   1702           *
   1703           * @brief   Cancel the reset timer.
   1704           *
   1705           * @param   none
   1706           *
   1707           * @return  none
   1708           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1709          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1710          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1711            // Cancel the reset timer
   1712            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   \   000010   E9           MOV     A,R1
   1713          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
   1714          
   1715          /*********************************************************************
   1716           * @fn      ZDApp_LeaveCtrlInit
   1717           *
   1718           * @brief   Initialize the leave control logic.
   1719           *
   1720           * @param   none
   1721           *
   1722           * @return  none
   1723           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1724          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1725          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1726            uint8 status;
   1727          
   1728          
   1729            // Initialize control state
   1730            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1731          
   1732            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1733                                        sizeof(ZDApp_LeaveCtrl),
   1734                                        &ZDApp_LeaveCtrl );
   \   00000B                ; Setup parameters for call to function osal_nv_item_init
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   7C01         MOV     R4,#0x1
   \   000018   7D00         MOV     R5,#0x0
   \   00001A   7A85         MOV     R2,#-0x7b
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??osal_nv_item_init?relay
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?DEALLOC_XSTACK8
   \   000026   E9           MOV     A,R1
   \   000027   FE           MOV     R6,A
   1735          
   1736            if ( status == ZSUCCESS )
   \   000028   7027         JNZ     ??ZDApp_LeaveCtrlInit_0
   1737            {
   1738              // Read saved control
   1739              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1740                            0,
   1741                            sizeof( uint8 ),
   1742                            &ZDApp_LeaveCtrl);
   \   00002A                ; Setup parameters for call to function osal_nv_read
   \   00002A   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00002D   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   75..01       MOV     ?V0 + 0,#0x1
   \   000038   75..00       MOV     ?V0 + 1,#0x0
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000040   7C00         MOV     R4,#0x0
   \   000042   7D00         MOV     R5,#0x0
   \   000044   7A85         MOV     R2,#-0x7b
   \   000046   7B00         MOV     R3,#0x0
   \   000048   12....       LCALL   ??osal_nv_read?relay
   \   00004B   7404         MOV     A,#0x4
   \   00004D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000050   E9           MOV     A,R1
   1743            }
   1744          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   000051   7F02         MOV     R7,#0x2
   \   000053   02....       LJMP    ?BANKED_LEAVE_XDATA
   1745          
   1746          /*********************************************************************
   1747           * @fn      ZDApp_LeaveCtrlSet
   1748           *
   1749           * @brief   Set the leave control logic.
   1750           *
   1751           * @param   ra - reassociate flag
   1752           *
   1753           * @return  none
   1754           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1755          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1756          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1757            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1758          
   1759            if ( ra == TRUE )
   \   00000D   7401         MOV     A,#0x1
   \   00000F   6E           XRL     A,R6
   \   000010   7007         JNZ     ??ZDApp_LeaveCtrlSet_0
   1760            {
   1761              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000012   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000015   E0           MOVX    A,@DPTR
   \   000016   D2E1         SETB    0xE0 /* A   */.1
   \   000018   F0           MOVX    @DPTR,A
   1762            }
   1763          
   1764            // Write the leave control
   1765            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1766                           0,
   1767                           sizeof( uint8 ),
   1768                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000019                ; Setup parameters for call to function osal_nv_write
   \   000019   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00001C   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000024   75..01       MOV     ?V0 + 0,#0x1
   \   000027   75..00       MOV     ?V0 + 1,#0x0
   \   00002A   78..         MOV     R0,#?V0 + 0
   \   00002C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002F   7C00         MOV     R4,#0x0
   \   000031   7D00         MOV     R5,#0x0
   \   000033   7A85         MOV     R2,#-0x7b
   \   000035   7B00         MOV     R3,#0x0
   \   000037   12....       LCALL   ??osal_nv_write?relay
   \   00003A   7404         MOV     A,#0x4
   \   00003C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003F   E9           MOV     A,R1
   1769          }
   \   000040   7F02         MOV     R7,#0x2
   \   000042   02....       LJMP    ?BANKED_LEAVE_XDATA
   1770          
   1771          /*********************************************************************
   1772           * @fn      ZDApp_LeaveCtrlReset
   1773           *
   1774           * @brief   Re-initialize the leave control logic.
   1775           *
   1776           * @param   none
   1777           *
   1778           * @return  none
   1779           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1780          void ZDApp_LeaveCtrlReset( void )
   \                     ZDApp_LeaveCtrlReset:
   1781          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1782            // Set leave control to initialized state
   1783            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1784          
   1785            // Write initialized control
   1786            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1787                          0,
   1788                          sizeof( uint8 ),
   1789                          &ZDApp_LeaveCtrl);
   \   00000B                ; Setup parameters for call to function osal_nv_write
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   75..01       MOV     ?V0 + 0,#0x1
   \   000019   75..00       MOV     ?V0 + 1,#0x0
   \   00001C   78..         MOV     R0,#?V0 + 0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   7C00         MOV     R4,#0x0
   \   000023   7D00         MOV     R5,#0x0
   \   000025   7A85         MOV     R2,#-0x7b
   \   000027   7B00         MOV     R3,#0x0
   \   000029   12....       LCALL   ??osal_nv_write?relay
   \   00002C   7404         MOV     A,#0x4
   \   00002E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000031   E9           MOV     A,R1
   1790          }
   \   000032   7F02         MOV     R7,#0x2
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
   1791          
   1792          /*********************************************************************
   1793           * @fn      ZDApp_LeaveCtrlBypass
   1794           *
   1795           * @brief   Check if NV restore should be skipped during a leave reset.
   1796           *
   1797           * @param   none
   1798           *
   1799           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1800           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1801          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1802          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1803            uint8 bypass;
   1804          
   1805            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   5004         JNC     ??ZDApp_LeaveCtrlBypass_0
   1806            {
   1807              bypass = TRUE;
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   8002         SJMP    ??ZDApp_LeaveCtrlBypass_1
   1808            }
   1809            else
   1810            {
   1811              bypass = FALSE;
   \                     ??ZDApp_LeaveCtrlBypass_0:
   \   000010   7900         MOV     R1,#0x0
   1812            }
   1813          
   1814            return bypass;
   \                     ??ZDApp_LeaveCtrlBypass_1:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1815          }
   1816          
   1817          /*********************************************************************
   1818           * @fn      ZDApp_LeaveCtrlStartup
   1819           *
   1820           * @brief   Check for startup conditions during a leave reset.
   1821           *
   1822           * @param   state      - devState_t determined by leave control logic
   1823           * @param   startDelay - startup delay
   1824           *
   1825           * @return  none
   1826           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1827          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1828          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   1829            *startDelay = 0;
   \   00000D   85..82       MOV     DPL,?V0 + 0
   \   000010   85..83       MOV     DPH,?V0 + 1
   \   000013   7400         MOV     A,#0x0
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   1830          
   1831            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00001A   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000020   5021         JNC     ??ZDApp_LeaveCtrlStartup_0
   1832            {
   1833              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000022   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000025   E0           MOVX    A,@DPTR
   \   000026   A2E1         MOV     C,0xE0 /* A   */.1
   \   000028   500F         JNC     ??ZDApp_LeaveCtrlStartup_1
   1834              {
   1835                *startDelay = LEAVE_RESET_DELAY;
   \   00002A   85..82       MOV     DPL,?V0 + 0
   \   00002D   85..83       MOV     DPH,?V0 + 1
   \   000030   7488         MOV     A,#-0x78
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   7413         MOV     A,#0x13
   \   000036   F0           MOVX    @DPTR,A
   \   000037   8007         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1836              }
   1837              else
   1838              {
   1839                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000039   8E82         MOV     DPL,R6
   \   00003B   8F83         MOV     DPH,R7
   \   00003D   7400         MOV     A,#0x0
   \   00003F   F0           MOVX    @DPTR,A
   1840              }
   1841          
   1842              // Reset leave control logic
   1843              ZDApp_LeaveCtrlReset();
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   000040                ; Setup parameters for call to function ZDApp_LeaveCtrlReset
   \   000040   12....       LCALL   ??ZDApp_LeaveCtrlReset?relay
   1844            }
   1845          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   1846          
   1847          /*********************************************************************
   1848           * @fn      ZDApp_LeaveReset
   1849           *
   1850           * @brief   Setup a device reset due to a leave indication/confirm.
   1851           *
   1852           * @param   ra - reassociate flag
   1853           *
   1854           * @return  none
   1855           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1856          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1857          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1858            ZDApp_LeaveCtrlSet( ra );
   \   000007                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000007   F9           MOV     R1,A
   \   000008   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1859          
   1860            ZDApp_ResetTimerStart( LEAVE_RESET_DELAY );
   \   00000B                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   00000B   7A88         MOV     R2,#-0x78
   \   00000D   7B13         MOV     R3,#0x13
   \   00000F   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1861          }
   \   000012   7F01         MOV     R7,#0x1
   \   000014   02....       LJMP    ?BANKED_LEAVE_XDATA
   1862          
   1863          /*********************************************************************
   1864           * @fn      ZDApp_LeaveUpdate
   1865           *
   1866           * @brief   Update local device data related to leaving device.
   1867           *
   1868           * @param   nwkAddr        - NWK address of leaving device
   1869           * @param   extAddr        - EXT address of leaving device
   1870           * @param   removeChildren - remove children of leaving device
   1871           *
   1872           * @return  none
   1873           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1874          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1875                                  uint8 removeChildren )
   1876          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   1877            // Remove Apps Key for leaving device
   1878            ZDSecMgrDeviceRemoveByExtAddr(extAddr);
   \   000014                ; Setup parameters for call to function ZDSecMgrDeviceRemoveByExtAddr
   \   000014   EE           MOV     A,R6
   \   000015   FA           MOV     R2,A
   \   000016   EF           MOV     A,R7
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??ZDSecMgrDeviceRemoveByExtAddr?relay
   \   00001B   E9           MOV     A,R1
   1879          
   1880            // Clear SECURITY bit from Address Manager
   1881            ZDSecMgrAddrClear( extAddr );
   \   00001C                ; Setup parameters for call to function ZDSecMgrAddrClear
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   12....       LCALL   ??ZDSecMgrAddrClear?relay
   \   000023   E9           MOV     A,R1
   1882          
   1883            if ( pbindRemoveDev )
   \   000024   90....       MOV     DPTR,#pbindRemoveDev
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F8           MOV     R0,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   E8           MOV     A,R0
   \   00002D   49           ORL     A,R1
   \   00002E   6041         JZ      ??ZDApp_LeaveUpdate_0
   1884            {
   1885              zAddrType_t devAddr;
   1886          
   1887              // Remove bind entry and all related data
   1888              devAddr.addrMode = Addr64Bit;
   \   000030   7408         MOV     A,#0x8
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7403         MOV     A,#0x3
   \   000037   F0           MOVX    @DPTR,A
   1889              osal_memcpy(devAddr.addr.extAddr, extAddr, Z_EXTADDR_LEN);
   \   000038                ; Setup parameters for call to function osal_memcpy
   \   000038   8E..         MOV     ?V0 + 4,R6
   \   00003A   8F..         MOV     ?V0 + 5,R7
   \   00003C   75..00       MOV     ?V0 + 6,#0x0
   \   00003F   78..         MOV     R0,#?V0 + 4
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000044   7C08         MOV     R4,#0x8
   \   000046   7D00         MOV     R5,#0x0
   \   000048   7403         MOV     A,#0x3
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   AA82         MOV     R2,DPL
   \   00004F   AB83         MOV     R3,DPH
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   1890          
   1891              pbindRemoveDev(&devAddr);
   \   000059                ; Setup parameters for indirect call
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   AA82         MOV     R2,DPL
   \   000061   AB83         MOV     R3,DPH
   \   000063   90....       MOV     DPTR,#pbindRemoveDev
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F583         MOV     DPH,A
   \   00006C   8882         MOV     DPL,R0
   \   00006E   12....       LCALL   ?CALL_IND
   1892            }
   1893          
   1894            // Remove if child
   1895            if ( ZSTACK_ROUTER_BUILD )
   1896            {
   1897              NLME_RemoveChild( extAddr, removeChildren );
   1898            }
   1899          
   1900            // Remove Routing table related entry
   1901            RTG_RemoveRtgEntry( nwkAddr, 0 );
   \                     ??ZDApp_LeaveUpdate_0:
   \   000071                ; Setup parameters for call to function RTG_RemoveRtgEntry
   \   000071   7900         MOV     R1,#0x0
   \   000073   AA..         MOV     R2,?V0 + 0
   \   000075   AB..         MOV     R3,?V0 + 1
   \   000077   12....       LCALL   ??RTG_RemoveRtgEntry?relay
   \   00007A   E9           MOV     A,R1
   1902          
   1903            // Remove entry from neighborTable
   1904            nwkNeighborRemove( nwkAddr, _NIB.nwkPanId );
   \   00007B                ; Setup parameters for call to function nwkNeighborRemove
   \   00007B   90....       MOV     DPTR,#_NIB + 33
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   FC           MOV     R4,A
   \   000080   A3           INC     DPTR
   \   000081   E0           MOVX    A,@DPTR
   \   000082   FD           MOV     R5,A
   \   000083   AA..         MOV     R2,?V0 + 0
   \   000085   AB..         MOV     R3,?V0 + 1
   \   000087   12....       LCALL   ??nwkNeighborRemove?relay
   1905          
   1906            // Schedule to save data to NV
   1907            ZDApp_NwkWriteNVRequest();
   \   00008A                ; Setup parameters for call to function AddrMgrWriteNVRequest
   \   00008A   12....       LCALL   ??AddrMgrWriteNVRequest?relay
   1908          }
   \   00008D   7409         MOV     A,#0x9
   \   00008F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000092   7F07         MOV     R7,#0x7
   \   000094   02....       LJMP    ?BANKED_LEAVE_XDATA
   1909          
   1910          /*********************************************************************
   1911           * @fn      ZDApp_NetworkDiscoveryReq
   1912           *
   1913           * @brief   Request a network discovery.
   1914           *
   1915           * @param  scanChannels -
   1916           * @param  scanDuration -
   1917           *
   1918           * @return  ZStatus_t
   1919           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1920          ZStatus_t ZDApp_NetworkDiscoveryReq( uint32 scanChannels, uint8 scanDuration)
   \                     ZDApp_NetworkDiscoveryReq:
   1921          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
   \   00000D   E9           MOV     A,R1
   \   00000E   FE           MOV     R6,A
   1922            // Setup optional filters - tbd
   1923          
   1924            // Request NLME network discovery
   1925            return NLME_NetworkDiscoveryRequest(scanChannels, scanDuration);
   \   00000F                ; Setup parameters for call to function NLME_NetworkDiscoveryRequest
   \   00000F   F9           MOV     R1,A
   \   000010   AA..         MOV     R2,?V0 + 0
   \   000012   AB..         MOV     R3,?V0 + 1
   \   000014   AC..         MOV     R4,?V0 + 2
   \   000016   AD..         MOV     R5,?V0 + 3
   \   000018   12....       LCALL   ??NLME_NetworkDiscoveryRequest?relay
   \   00001B   7F04         MOV     R7,#0x4
   \   00001D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1926          }
   1927          
   1928          /*********************************************************************
   1929           * @fn      ZDApp_JoinReq
   1930           *
   1931           * @brief   Request the device to join a parent in a network.
   1932           *
   1933           * @param   channel -
   1934           * @param   panID -
   1935           *
   1936           * @return  ZStatus_t
   1937           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1938          ZStatus_t ZDApp_JoinReq( uint8 channel, uint16 panID, uint8 *extendedPanID,
   \                     ZDApp_JoinReq:
   1939                                   uint16 chosenParent, uint8 parentDepth, uint8 stackProfile )
   1940          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 3,R1
   \   000007   8A..         MOV     ?V0 + 0,R2
   \   000009   8B..         MOV     ?V0 + 1,R3
   \   00000B   EC           MOV     A,R4
   \   00000C   FE           MOV     R6,A
   \   00000D   ED           MOV     A,R5
   \   00000E   FF           MOV     R7,A
   \   00000F   7410         MOV     A,#0x10
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 6,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 7,A
   \   00001B   7412         MOV     A,#0x12
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 4,A
   \   000023   7413         MOV     A,#0x13
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F5..         MOV     ?V0 + 2,A
   1941            // Sync up the node with the stack profile (In the case where a pro device
   1942            // joins a non-pro network, or verse versa)
   1943            ZDApp_NodeProfileSync( stackProfile);
   \   00002B                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00002B   A9..         MOV     R1,?V0 + 2
   \   00002D   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1944          
   1945            // Request NLME Join Request
   1946            return NLME_JoinRequest(extendedPanID, panID,channel,
   1947                                    ZDO_Config_Node_Descriptor.CapabilityFlags,
   1948                                    chosenParent, parentDepth);
   \   000030                ; Setup parameters for call to function NLME_JoinRequest
   \   000030   E5..         MOV     A,?V0 + 4
   \   000032   F5..         MOV     ?V0 + 5,A
   \   000034   78..         MOV     R0,#?V0 + 5
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000039   78..         MOV     R0,#?V0 + 6
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F5..         MOV     ?V0 + 5,A
   \   000044   78..         MOV     R0,#?V0 + 5
   \   000046   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000049   A9..         MOV     R1,?V0 + 3
   \   00004B   AC..         MOV     R4,?V0 + 0
   \   00004D   AD..         MOV     R5,?V0 + 1
   \   00004F   EE           MOV     A,R6
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   FB           MOV     R3,A
   \   000053   12....       LCALL   ??NLME_JoinRequest?relay
   \   000056   7404         MOV     A,#0x4
   \   000058   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005B   7F08         MOV     R7,#0x8
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1949          
   1950          }
   1951          
   1952          /*********************************************************************
   1953           * @fn      ZDApp_DeviceConfigured
   1954           *
   1955           * @brief   Check to see if the local device is configured (i.e., part
   1956           *          of a network).
   1957           *
   1958           * @param   none
   1959           *
   1960           * @return  TRUE if configured. FALSE, otherwise.
   1961           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1962          uint8 ZDApp_DeviceConfigured( void )
   \                     ZDApp_DeviceConfigured:
   1963          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1964            uint16 nwkAddr = INVALID_NODE_ADDR;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   74FE         MOV     A,#-0x2
   \   000012   F0           MOVX    @DPTR,A
   \   000013   A3           INC     DPTR
   \   000014   74FF         MOV     A,#-0x1
   \   000016   F0           MOVX    @DPTR,A
   1965          
   1966            osal_nv_read( ZCD_NV_NIB, osal_offsetof( nwkIB_t, nwkDevAddress ),
   1967                          sizeof( uint16), &nwkAddr );
   \   000017                ; Setup parameters for call to function osal_nv_read
   \   000017   85..82       MOV     DPL,?XSP + 0
   \   00001A   85..83       MOV     DPH,?XSP + 1
   \   00001D   8582..       MOV     ?V0 + 0,DPL
   \   000020   8583..       MOV     ?V0 + 1,DPH
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..02       MOV     ?V0 + 0,#0x2
   \   00002B   75..00       MOV     ?V0 + 1,#0x0
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7C14         MOV     R4,#0x14
   \   000035   7D00         MOV     R5,#0x0
   \   000037   7A21         MOV     R2,#0x21
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   12....       LCALL   ??osal_nv_read?relay
   \   00003E   7404         MOV     A,#0x4
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
   \   000043   E9           MOV     A,R1
   1968          
   1969            // Does the NIB have anything more than default?
   1970            return ( nwkAddr == INVALID_NODE_ADDR ? FALSE : TRUE );
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   64FE         XRL     A,#0xfe
   \   00004D   7004         JNZ     ??ZDApp_DeviceConfigured_0
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   64FF         XRL     A,#0xff
   \                     ??ZDApp_DeviceConfigured_0:
   \   000053   7004         JNZ     ??ZDApp_DeviceConfigured_1
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_DeviceConfigured_2
   \                     ??ZDApp_DeviceConfigured_1:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_DeviceConfigured_2:
   \   00005B   7402         MOV     A,#0x2
   \   00005D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000060   7F02         MOV     R7,#0x2
   \   000062   02....       LJMP    ?BANKED_LEAVE_XDATA
   1971          }
   1972          
   1973          /*********************************************************************
   1974           * CALLBACK FUNCTIONS
   1975           */
   1976          
   1977          
   1978          /*********************************************************************
   1979           * @fn      ZDApp_SendEventMsg()
   1980           *
   1981           * @brief
   1982           *
   1983           *   Sends a Network Join message
   1984           *
   1985           * @param  cmd - command ID
   1986           * @param  len - length (in bytes) of the buf field
   1987           * @param  buf - buffer for the rest of the message.
   1988           *
   1989           * @return  none
   1990           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1991          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1992          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   1993            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   00000D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   AB..         MOV     R3,?V0 + 1
   \   000013   AA..         MOV     R2,?V0 + 0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDApp_SendMsg?relay
   1994          }
   \   00001D   7F02         MOV     R7,#0x2
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1995          
   1996          /*********************************************************************
   1997           * @fn      ZDApp_SendMsg()
   1998           *
   1999           * @brief   Sends a OSAL message
   2000           *
   2001           * @param  taskID - Where to send the message
   2002           * @param  cmd - command ID
   2003           * @param  len - length (in bytes) of the buf field
   2004           * @param  buf - buffer for the rest of the message.
   2005           *
   2006           * @return  none
   2007           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2008          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   2009          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   8A..         MOV     ?V0 + 3,R2
   \   000009   8B..         MOV     ?V0 + 7,R3
   \   00000B   8C..         MOV     ?V0 + 0,R4
   \   00000D   8D..         MOV     ?V0 + 1,R5
   2010            osal_event_hdr_t *msgPtr;
   2011          
   2012            // Send the address to the task
   2013            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   85....       MOV     ?V0 + 4,?V0 + 7
   \   000012   75..00       MOV     ?V0 + 5,#0x0
   \   000015   AA..         MOV     R2,?V0 + 4
   \   000017   AB..         MOV     R3,?V0 + 5
   \   000019   12....       LCALL   ??osal_msg_allocate?relay
   \   00001C   8A..         MOV     ?V0 + 4,R2
   \   00001E   8B..         MOV     ?V0 + 5,R3
   \   000020   AE..         MOV     R6,?V0 + 4
   \   000022   AF..         MOV     R7,?V0 + 5
   2014            if ( msgPtr )
   \   000024   EE           MOV     A,R6
   \   000025   4F           ORL     A,R7
   \   000026   6044         JZ      ??ZDApp_SendMsg_0
   2015            {
   2016              if ( (len > 0) && (buf != NULL) )
   \   000028   E5..         MOV     A,?V0 + 7
   \   00002A   C3           CLR     C
   \   00002B   9401         SUBB    A,#0x1
   \   00002D   402A         JC      ??ZDApp_SendMsg_1
   \   00002F   E5..         MOV     A,?V0 + 0
   \   000031   45..         ORL     A,?V0 + 1
   \   000033   6024         JZ      ??ZDApp_SendMsg_1
   2017                osal_memcpy( msgPtr, buf, len );
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 0
   \   000038   85....       MOV     ?V0 + 5,?V0 + 1
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   85....       MOV     ?V0 + 4,?V0 + 7
   \   000046   75..00       MOV     ?V0 + 5,#0x0
   \   000049   AC..         MOV     R4,?V0 + 4
   \   00004B   AD..         MOV     R5,?V0 + 5
   \   00004D   EE           MOV     A,R6
   \   00004E   FA           MOV     R2,A
   \   00004F   EF           MOV     A,R7
   \   000050   FB           MOV     R3,A
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   2018          
   2019              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   000059   E5..         MOV     A,?V0 + 3
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   E5..         MOV     A,?V0 + 3
   \   000061   F0           MOVX    @DPTR,A
   2020              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000062                ; Setup parameters for call to function osal_msg_send
   \   000062   EE           MOV     A,R6
   \   000063   FA           MOV     R2,A
   \   000064   EF           MOV     A,R7
   \   000065   FB           MOV     R3,A
   \   000066   A9..         MOV     R1,?V0 + 2
   \   000068   12....       LCALL   ??osal_msg_send?relay
   \   00006B   E9           MOV     A,R1
   2021            }
   2022          }
   \                     ??ZDApp_SendMsg_0:
   \   00006C   7F08         MOV     R7,#0x8
   \   00006E   02....       LJMP    ?BANKED_LEAVE_XDATA
   2023          
   2024          /*********************************************************************
   2025           * Call Back Functions from NWK  - API
   2026           */
   2027          
   2028          /*********************************************************************
   2029           * @fn          ZDO_NetworkDiscoveryConfirmCB
   2030           *
   2031           * @brief       This function returns a choice of PAN to join.
   2032           *
   2033           * @param       status - return status of the nwk discovery confirm
   2034           *
   2035           * @return      ZStatus_t
   2036           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2037          ZStatus_t ZDO_NetworkDiscoveryConfirmCB(uint8 status)
   \                     ZDO_NetworkDiscoveryConfirmCB:
   2038          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
   2039            osal_event_hdr_t msg;
   2040          
   2041            // If Scan is initiated by ZDO_MGMT_NWK_DISC_REQ
   2042            // Send ZDO_MGMT_NWK_DISC_RSP back
   2043          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   2044            if ( zdappMgmtNwkDiscReqInProgress )
   2045            {
   2046              zdappMgmtNwkDiscReqInProgress = false;
   2047              ZDO_FinishProcessingMgmtNwkDiscReq();
   2048            }
   2049            else
   2050          #endif
   2051            {
   2052              // Pass the confirm to another task if it registers the callback
   2053              // Otherwise, pass the confirm to ZDApp.
   2054              if (zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID] != NULL )
   \   000011   90....       MOV     DPTR,#zdoCBFunc + 4
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F8           MOV     R0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F9           MOV     R1,A
   \   000019   E8           MOV     A,R0
   \   00001A   49           ORL     A,R1
   \   00001B   601A         JZ      ??ZDO_NetworkDiscoveryConfirmCB_0
   2055              {
   2056                zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID]( (void*)&status );
   \   00001D                ; Setup parameters for indirect call
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   AA82         MOV     R2,DPL
   \   000025   AB83         MOV     R3,DPH
   \   000027   90....       MOV     DPTR,#zdoCBFunc + 4
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F8           MOV     R0,A
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F583         MOV     DPH,A
   \   000030   8882         MOV     DPL,R0
   \   000032   12....       LCALL   ?CALL_IND
   \   000035   801D         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   2057              }
   2058              else
   2059              {
   2060                // Otherwise, send scan confirm to ZDApp task to proceed
   2061                msg.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000037   7402         MOV     A,#0x2
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   7400         MOV     A,#0x0
   \   00003E   F0           MOVX    @DPTR,A
   2062                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(osal_event_hdr_t), (uint8 *)&msg );
   \   00003F                ; Setup parameters for call to function ZDApp_SendMsg
   \   00003F   7401         MOV     A,#0x1
   \   000041   12....       LCALL   ?XSTACK_DISP0_8
   \   000044   AC82         MOV     R4,DPL
   \   000046   AD83         MOV     R5,DPH
   \   000048   7B02         MOV     R3,#0x2
   \   00004A   7A01         MOV     R2,#0x1
   \   00004C   90....       MOV     DPTR,#ZDAppTaskID
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   F9           MOV     R1,A
   \   000051   12....       LCALL   ??ZDApp_SendMsg?relay
   2063              }
   2064            }
   2065            return (ZSuccess);
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   000054   7900         MOV     R1,#0x0
   \   000056   7403         MOV     A,#0x3
   \   000058   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005B   D083         POP     DPH
   \   00005D   D082         POP     DPL
   \   00005F   02....       LJMP    ?BRET
   2066          }  // ZDO_NetworkDiscoveryConfirmCB
   2067          
   2068          /*********************************************************************
   2069           * @fn          ZDApp_NwkDescListProcessing
   2070           *
   2071           * @brief       This function process the network discovery result and select
   2072           *              a parent device to join itself.
   2073           *
   2074           * @param       none
   2075           *
   2076           * @return      ZStatus_t
   2077           */
   2078          /*
   2079          #define STACK_PROFILE_MAX 2
   2080          networkDesc_t* ZDApp_NwkDescListProcessing(void)
   2081          {
   2082            networkDesc_t *pNwkDesc;
   2083            uint8 i, ResultCount = 0;
   2084            uint8 stackProfile;
   2085            uint8 stackProfilePro;
   2086            uint8 selected;
   2087            
   2088            networkDesc_t *test_pNwkDesc;
   2089            uint8 MaxLinkQuality=0;
   2090            uint8 MaxLinkQuality_Channel=0x0B;
   2091            uint16 MaxLinkQuality_Panid=0xFFFF;
   2092          
   2093            // Count the number of nwk descriptors in the list
   2094            pNwkDesc = nwk_getNwkDescList();
   2095            while (pNwkDesc)
   2096            {
   2097              ResultCount++;
   2098              pNwkDesc = pNwkDesc->nextDesc;
   2099            }
   2100            
   2101              // process discovery results
   2102            stackProfilePro = FALSE;
   2103            selected = FALSE;
   2104            
   2105            if ( devStartMode == MODE_JOIN )
   2106            {  
   2107              pNwkDesc = nwk_getNwkDescList();
   2108              MaxLinkQuality=pNwkDesc->chosenRouterLinkQuality;
   2109              MaxLinkQuality_Channel=pNwkDesc->logicalChannel;
   2110              MaxLinkQuality_Panid = pNwkDesc->panId;
   2111              for(uint8 j=0;j<ResultCount-1;j++,pNwkDesc = pNwkDesc->nextDesc)
   2112              {
   2113               test_pNwkDesc=pNwkDesc->nextDesc;
   2114               if(test_pNwkDesc!=NULL)
   2115               {
   2116               if(MaxLinkQuality <=test_pNwkDesc->chosenRouterLinkQuality )
   2117                {
   2118                  MaxLinkQuality=test_pNwkDesc->chosenRouterLinkQuality;
   2119                  MaxLinkQuality_Channel=test_pNwkDesc->logicalChannel;
   2120                  MaxLinkQuality_Panid = test_pNwkDesc->panId;
   2121                }
   2122               }
   2123                
   2124              }
   2125            }
   2126          
   2127            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   2128            {
   2129              pNwkDesc = nwk_getNwkDescList();
   2130              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   2131              {
   2132                if ( zgConfigPANID != 0xFFFF )
   2133                {
   2134                  if ( pNwkDesc->panId != zgConfigPANID )
   2135                    continue;
   2136                }
   2137                
   2138                if( devStartMode == MODE_REJOIN )
   2139                {
   2140                 if ( _NIB.nwkPanId != INVALID_PAN_ID )
   2141                {
   2142                  if ( pNwkDesc->panId != _NIB.nwkPanId )
   2143                    continue;
   2144                }
   2145                }
   2146                
   2147                
   2148                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   2149                {
   2150                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   2151                    continue;
   2152          
   2153                }
   2154          
   2155                if ( ZSTACK_ROUTER_BUILD )
   2156                {
   2157                  if ( stackProfilePro == FALSE )
   2158                  {
   2159                    if ( !pNwkDesc->routerCapacity )
   2160                    {
   2161                      continue;
   2162                    }
   2163                  }
   2164                  else
   2165                  {
   2166                    if ( !pNwkDesc->deviceCapacity )
   2167                    {
   2168                      continue;
   2169                    }
   2170                  }
   2171                }
   2172                else if ( ZSTACK_END_DEVICE_BUILD )
   2173                {
   2174                  if ( !pNwkDesc->deviceCapacity )
   2175                  {
   2176                    continue;
   2177                  }
   2178                }
   2179          
   2180                // check version of zigbee protocol
   2181                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   2182                  continue;
   2183          
   2184                // check version of stack profile
   2185                if ( pNwkDesc->stackProfile != zgStackProfile  )
   2186                {
   2187                  if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   2188                      || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   2189                  {
   2190                    stackProfilePro = TRUE;
   2191                  }
   2192          
   2193                  if ( stackProfile == 0 )
   2194                  {
   2195                    continue;
   2196                  }
   2197                }
   2198                
   2199                
   2200               // break;
   2201                
   2202              if ( devStartMode == MODE_JOIN )
   2203                {  
   2204                  if( (pNwkDesc->logicalChannel==MaxLinkQuality_Channel) && (pNwkDesc->panId==MaxLinkQuality_Panid) )
   2205                  {
   2206                   break;
   2207                  }
   2208                 else
   2209                  {
   2210                   continue;
   2211                  }
   2212                }
   2213              else
   2214                {
   2215                  break; 
   2216                }
   2217              }
   2218          
   2219              if (i < ResultCount)
   2220              {
   2221               selected = TRUE;
   2222                break;
   2223              }
   2224          
   2225              // break if selected or stack profile pro wasn't found
   2226              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   2227              {
   2228                break;
   2229              }
   2230            }
   2231          
   2232            if ( i == ResultCount )
   2233            {
   2234              return (NULL);   // couldn't find appropriate PAN to join !
   2235            }
   2236            else
   2237            {
   2238              return (pNwkDesc);
   2239            }
   2240          
   2241          }// ZDApp_NwkDescListProcessing()
   2242          */
   2243          /*********************************************************************
   2244           * @fn          ZDO_NetworkFormationConfirmCB
   2245           *
   2246           * @brief       This function reports the results of the request to
   2247           *              initialize a coordinator in a network.
   2248           *
   2249           * @param       Status - Result of NLME_NetworkFormationRequest()
   2250           *
   2251           * @return      none
   2252           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2253          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2254          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2255            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2256          
   2257            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   701E         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2258            {
   2259              // LED on shows Coordinator started
   2260              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000F                ; Setup parameters for call to function HalLedSet
   \   00000F   7A01         MOV     R2,#0x1
   \   000011   7904         MOV     R1,#0x4
   \   000013   12....       LCALL   ??HalLedSet?relay
   \   000016   E9           MOV     A,R1
   2261          
   2262              // LED off forgets HOLD_AUTO_START
   2263              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
   \   00001E   E9           MOV     A,R1
   2264          
   2265          #if defined ( ZBIT )
   2266              SIM_SetColor(0xd0ffd0);
   2267          #endif
   2268          
   2269              if ( devState == DEV_HOLD )
   \   00001F   90....       MOV     DPTR,#devState
   \   000022   E0           MOVX    A,@DPTR
   \   000023   7010         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   2270              {
   2271                // Began with HOLD_AUTO_START
   2272                devState = DEV_COORD_STARTING;
   \   000025   90....       MOV     DPTR,#devState
   \   000028   7408         MOV     A,#0x8
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   8008         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   2273              }
   2274            }
   2275          #if defined(BLINK_LEDS)
   2276            else
   2277            {
   2278              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   00002D                ; Setup parameters for call to function HalLedSet
   \   00002D   7A04         MOV     R2,#0x4
   \   00002F   7904         MOV     R1,#0x4
   \   000031   12....       LCALL   ??HalLedSet?relay
   \   000034   E9           MOV     A,R1
   2279            }
   2280          #endif
   2281          
   2282            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   000035                ; Setup parameters for call to function osal_set_event
   \   000035   7A02         MOV     R2,#0x2
   \   000037   7B00         MOV     R3,#0x0
   \   000039   90....       MOV     DPTR,#ZDAppTaskID
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F9           MOV     R1,A
   \   00003E   12....       LCALL   ??osal_set_event?relay
   \   000041   E9           MOV     A,R1
   2283          }
   \   000042   7F01         MOV     R7,#0x1
   \   000044   02....       LJMP    ?BANKED_LEAVE_XDATA
   2284          
   2285          /****************************************************************************
   2286           * @fn          ZDApp_beaconIndProcessing
   2287           *
   2288           * @brief       This function processes the incoming beacon indication.
   2289           *
   2290           *              When another task (MT or App) is registered to process
   2291           *              beacon indication themselves, this function will parse the
   2292           *              beacon payload and pass the beacon descriptor to that task
   2293           *              If no other tasks registered, this function will process
   2294           *              the beacon payload and generate the network descriptor link
   2295           *              list.
   2296           *
   2297           * @param
   2298           *
   2299           * @return      none
   2300           *
   2301           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2302          void ZDO_beaconNotifyIndCB( NLME_beaconInd_t *pBeacon )
   \                     ZDO_beaconNotifyIndCB:
   2303          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2304            // Pass the beacon Indication to another task if it registers the callback
   2305            // Otherwise, process the beacon notification here.
   2306            if (zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID] != NULL )
   \   000009   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F8           MOV     R0,A
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   E8           MOV     A,R0
   \   000012   49           ORL     A,R1
   \   000013   6015         JZ      ??ZDO_beaconNotifyIndCB_0
   2307            {
   2308              zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID]( (void*)pBeacon );
   \   000015                ; Setup parameters for indirect call
   \   000015   AA..         MOV     R2,?V0 + 0
   \   000017   AB..         MOV     R3,?V0 + 1
   \   000019   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F8           MOV     R0,A
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F583         MOV     DPH,A
   \   000022   8882         MOV     DPL,R0
   \   000024   12....       LCALL   ?CALL_IND
   \   000027   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2309            }
   2310            else
   2311            {
   2312              networkDesc_t *pNwkDesc;
   2313              networkDesc_t *pLastNwkDesc;
   2314              uint8 found = false;
   \                     ??ZDO_beaconNotifyIndCB_0:
   \   00002A   75..00       MOV     ?V0 + 2,#0x0
   2315          
   2316              // Add the network to the Network Descriptor List
   2317              pNwkDesc = NwkDescList;
   \   00002D   90....       MOV     DPTR,#NwkDescList
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F8           MOV     R0,A
   \   000032   A3           INC     DPTR
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F9           MOV     R1,A
   \   000035   E8           MOV     A,R0
   \   000036   FE           MOV     R6,A
   \   000037   E9           MOV     A,R1
   \   000038   FF           MOV     R7,A
   2318              pLastNwkDesc = NwkDescList;
   \   000039   90....       MOV     DPTR,#NwkDescList
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F8           MOV     R0,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   88..         MOV     ?V0 + 4,R0
   \   000043   89..         MOV     ?V0 + 5,R1
   2319              while (pNwkDesc)
   \                     ??ZDO_beaconNotifyIndCB_2:
   \   000045   EE           MOV     A,R6
   \   000046   4F           ORL     A,R7
   \   000047   604A         JZ      ??ZDO_beaconNotifyIndCB_3
   2320              {
   2321                if ((pNwkDesc->panId == pBeacon->panID) &&
   2322                    (pNwkDesc->logicalChannel == pBeacon->logicalChannel))
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F8           MOV     R0,A
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   85..82       MOV     DPL,?V0 + 0
   \   000055   85..83       MOV     DPH,?V0 + 1
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   68           XRL     A,R0
   \   00005C   7003         JNZ     ??ZDO_beaconNotifyIndCB_4
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   69           XRL     A,R1
   \                     ??ZDO_beaconNotifyIndCB_4:
   \   000061   701B         JNZ     ??ZDO_beaconNotifyIndCB_5
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   85..82       MOV     DPL,?V0 + 0
   \   00006E   85..83       MOV     DPH,?V0 + 1
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   68           XRL     A,R0
   \   000077   7005         JNZ     ??ZDO_beaconNotifyIndCB_5
   2323                {
   2324                  found = true;
   \   000079   75..01       MOV     ?V0 + 2,#0x1
   2325                  break;
   \   00007C   8015         SJMP    ??ZDO_beaconNotifyIndCB_3
   2326                }
   2327                pLastNwkDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_5:
   \   00007E   8E..         MOV     ?V0 + 4,R6
   \   000080   8F..         MOV     ?V0 + 5,R7
   2328                pNwkDesc = pNwkDesc->nextDesc;
   \   000082   EE           MOV     A,R6
   \   000083   2414         ADD     A,#0x14
   \   000085   F582         MOV     DPL,A
   \   000087   EF           MOV     A,R7
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F583         MOV     DPH,A
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   FE           MOV     R6,A
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FF           MOV     R7,A
   \   000091   80B2         SJMP    ??ZDO_beaconNotifyIndCB_2
   2329              }
   2330          
   2331              // If no existing descriptor found, make a new one and add to the list
   2332              if (found == false)
   \                     ??ZDO_beaconNotifyIndCB_3:
   \   000093   E5..         MOV     A,?V0 + 2
   \   000095   706D         JNZ     ??ZDO_beaconNotifyIndCB_6
   2333              {
   2334                pNwkDesc = osal_mem_alloc( sizeof(networkDesc_t)  );
   \   000097                ; Setup parameters for call to function osal_mem_alloc
   \   000097   7A16         MOV     R2,#0x16
   \   000099   7B00         MOV     R3,#0x0
   \   00009B   12....       LCALL   ??osal_mem_alloc?relay
   \   00009E   8A..         MOV     ?V0 + 6,R2
   \   0000A0   8B..         MOV     ?V0 + 7,R3
   \   0000A2   AE..         MOV     R6,?V0 + 6
   \   0000A4   AF..         MOV     R7,?V0 + 7
   2335                if ( !pNwkDesc )
   \   0000A6   EE           MOV     A,R6
   \   0000A7   4F           ORL     A,R7
   \   0000A8   7003         JNZ     $+5
   \   0000AA   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2336                {
   2337                  // Memory alloc failed, discard this beacon
   2338                  return;
   2339                }
   2340          
   2341                // Clear the network descriptor
   2342                osal_memset( pNwkDesc, 0, sizeof(networkDesc_t)  );
   \   0000AD                ; Setup parameters for call to function osal_memset
   \   0000AD   7C16         MOV     R4,#0x16
   \   0000AF   7D00         MOV     R5,#0x0
   \   0000B1   7900         MOV     R1,#0x0
   \   0000B3   EE           MOV     A,R6
   \   0000B4   FA           MOV     R2,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   FB           MOV     R3,A
   \   0000B7   12....       LCALL   ??osal_memset?relay
   2343          
   2344                // Initialize the descriptor
   2345                pNwkDesc->chosenRouter = INVALID_NODE_ADDR;
   \   0000BA   8E82         MOV     DPL,R6
   \   0000BC   8F83         MOV     DPH,R7
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   74FE         MOV     A,#-0x2
   \   0000C7   F0           MOVX    @DPTR,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   74FF         MOV     A,#-0x1
   \   0000CB   F0           MOVX    @DPTR,A
   2346                pNwkDesc->chosenRouterDepth = 0xFF;
   \   0000CC   8E82         MOV     DPL,R6
   \   0000CE   8F83         MOV     DPH,R7
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   74FF         MOV     A,#-0x1
   \   0000DC   F0           MOVX    @DPTR,A
   2347          
   2348                // Save new entry into the descriptor list
   2349                if ( !NwkDescList )
   \   0000DD   90....       MOV     DPTR,#NwkDescList
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F8           MOV     R0,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   F9           MOV     R1,A
   \   0000E5   E8           MOV     A,R0
   \   0000E6   49           ORL     A,R1
   \   0000E7   700A         JNZ     ??ZDO_beaconNotifyIndCB_7
   2350                {
   2351                  NwkDescList = pNwkDesc;
   \   0000E9   90....       MOV     DPTR,#NwkDescList
   \   0000EC   EE           MOV     A,R6
   \   0000ED   F0           MOVX    @DPTR,A
   \   0000EE   A3           INC     DPTR
   \   0000EF   EF           MOV     A,R7
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   8011         SJMP    ??ZDO_beaconNotifyIndCB_6
   2352                }
   2353                else
   2354                {
   2355                  pLastNwkDesc->nextDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_7:
   \   0000F3   E5..         MOV     A,?V0 + 4
   \   0000F5   2414         ADD     A,#0x14
   \   0000F7   F582         MOV     DPL,A
   \   0000F9   E5..         MOV     A,?V0 + 5
   \   0000FB   3400         ADDC    A,#0x0
   \   0000FD   F583         MOV     DPH,A
   \   0000FF   EE           MOV     A,R6
   \   000100   F0           MOVX    @DPTR,A
   \   000101   A3           INC     DPTR
   \   000102   EF           MOV     A,R7
   \   000103   F0           MOVX    @DPTR,A
   2356                }
   2357              }
   2358          
   2359              // Update the descriptor with the incoming beacon
   2360              pNwkDesc->stackProfile   = pBeacon->stackProfile;
   \                     ??ZDO_beaconNotifyIndCB_6:
   \   000104   85..82       MOV     DPL,?V0 + 0
   \   000107   85..83       MOV     DPH,?V0 + 1
   \   00010A   A3           INC     DPTR
   \   00010B   A3           INC     DPTR
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   A3           INC     DPTR
   \   00010F   A3           INC     DPTR
   \   000110   A3           INC     DPTR
   \   000111   A3           INC     DPTR
   \   000112   A3           INC     DPTR
   \   000113   E0           MOVX    A,@DPTR
   \   000114   8E82         MOV     DPL,R6
   \   000116   8F83         MOV     DPH,R7
   \   000118   A3           INC     DPTR
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   A3           INC     DPTR
   \   00011E   F0           MOVX    @DPTR,A
   2361              pNwkDesc->version        = pBeacon->protocolVersion;
   \   00011F   85..82       MOV     DPL,?V0 + 0
   \   000122   85..83       MOV     DPH,?V0 + 1
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   A3           INC     DPTR
   \   000129   A3           INC     DPTR
   \   00012A   A3           INC     DPTR
   \   00012B   A3           INC     DPTR
   \   00012C   A3           INC     DPTR
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   A3           INC     DPTR
   \   000133   A3           INC     DPTR
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   A3           INC     DPTR
   \   000137   F0           MOVX    @DPTR,A
   2362              pNwkDesc->logicalChannel = pBeacon->logicalChannel;
   \   000138   85..82       MOV     DPL,?V0 + 0
   \   00013B   85..83       MOV     DPH,?V0 + 1
   \   00013E   A3           INC     DPTR
   \   00013F   A3           INC     DPTR
   \   000140   A3           INC     DPTR
   \   000141   A3           INC     DPTR
   \   000142   E0           MOVX    A,@DPTR
   \   000143   8E82         MOV     DPL,R6
   \   000145   8F83         MOV     DPH,R7
   \   000147   A3           INC     DPTR
   \   000148   A3           INC     DPTR
   \   000149   F0           MOVX    @DPTR,A
   2363              pNwkDesc->panId          = pBeacon->panID;
   \   00014A   85..82       MOV     DPL,?V0 + 0
   \   00014D   85..83       MOV     DPH,?V0 + 1
   \   000150   A3           INC     DPTR
   \   000151   A3           INC     DPTR
   \   000152   E0           MOVX    A,@DPTR
   \   000153   F8           MOV     R0,A
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   8E82         MOV     DPL,R6
   \   000159   8F83         MOV     DPH,R7
   \   00015B   E8           MOV     A,R0
   \   00015C   F0           MOVX    @DPTR,A
   \   00015D   A3           INC     DPTR
   \   00015E   E9           MOV     A,R1
   \   00015F   F0           MOVX    @DPTR,A
   2364              pNwkDesc->updateId       = pBeacon->updateID;
   \   000160   E5..         MOV     A,?V0 + 0
   \   000162   240C         ADD     A,#0xc
   \   000164   F582         MOV     DPL,A
   \   000166   E5..         MOV     A,?V0 + 1
   \   000168   3400         ADDC    A,#0x0
   \   00016A   F583         MOV     DPH,A
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   C0E0         PUSH    A
   \   00016F   EE           MOV     A,R6
   \   000170   2413         ADD     A,#0x13
   \   000172   F582         MOV     DPL,A
   \   000174   EF           MOV     A,R7
   \   000175   3400         ADDC    A,#0x0
   \   000177   F583         MOV     DPH,A
   \   000179   D0E0         POP     A
   \   00017B   F0           MOVX    @DPTR,A
   2365          
   2366              // Save the extended PAN ID from the beacon payload only if 1.1 version network
   2367              if ( pBeacon->protocolVersion != ZB_PROT_V1_0 )
   \   00017C   85..82       MOV     DPL,?V0 + 0
   \   00017F   85..83       MOV     DPH,?V0 + 1
   \   000182   A3           INC     DPTR
   \   000183   A3           INC     DPTR
   \   000184   A3           INC     DPTR
   \   000185   A3           INC     DPTR
   \   000186   A3           INC     DPTR
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   A3           INC     DPTR
   \   00018A   E0           MOVX    A,@DPTR
   \   00018B   6401         XRL     A,#0x1
   \   00018D   6017         JZ      ??ZDO_beaconNotifyIndCB_8
   2368              {
   2369                osal_cpyExtAddr( pNwkDesc->extendedPANID, pBeacon->extendedPanID );
   \   00018F                ; Setup parameters for call to function sAddrExtCpy
   \   00018F   E5..         MOV     A,?V0 + 0
   \   000191   240D         ADD     A,#0xd
   \   000193   FC           MOV     R4,A
   \   000194   E5..         MOV     A,?V0 + 1
   \   000196   3400         ADDC    A,#0x0
   \   000198   FD           MOV     R5,A
   \   000199   EE           MOV     A,R6
   \   00019A   240B         ADD     A,#0xb
   \   00019C   FA           MOV     R2,A
   \   00019D   EF           MOV     A,R7
   \   00019E   3400         ADDC    A,#0x0
   \   0001A0   FB           MOV     R3,A
   \   0001A1   12....       LCALL   ??sAddrExtCpy?relay
   \   0001A4   8011         SJMP    ??ZDO_beaconNotifyIndCB_9
   2370              }
   2371              else
   2372              {
   2373                osal_memset( pNwkDesc->extendedPANID, 0xFF, Z_EXTADDR_LEN );
   \                     ??ZDO_beaconNotifyIndCB_8:
   \   0001A6                ; Setup parameters for call to function osal_memset
   \   0001A6   7C08         MOV     R4,#0x8
   \   0001A8   7D00         MOV     R5,#0x0
   \   0001AA   79FF         MOV     R1,#-0x1
   \   0001AC   EE           MOV     A,R6
   \   0001AD   240B         ADD     A,#0xb
   \   0001AF   FA           MOV     R2,A
   \   0001B0   EF           MOV     A,R7
   \   0001B1   3400         ADDC    A,#0x0
   \   0001B3   FB           MOV     R3,A
   \   0001B4   12....       LCALL   ??osal_memset?relay
   2374              }
   2375          
   2376              // check if this device is a better choice to join...
   2377              // ...dont bother checking assocPermit flag is doing a rejoin
   2378              if ( ( pBeacon->LQI > gMIN_TREE_LINK_COST ) &&
   2379                  ( ( pBeacon->permitJoining == TRUE ) || ( _tmpRejoinState ) || (devStartMode == MODE_REJOIN) ) )
   \                     ??ZDO_beaconNotifyIndCB_9:
   \   0001B7   85..82       MOV     DPL,?V0 + 0
   \   0001BA   85..83       MOV     DPH,?V0 + 1
   \   0001BD   A3           INC     DPTR
   \   0001BE   A3           INC     DPTR
   \   0001BF   A3           INC     DPTR
   \   0001C0   A3           INC     DPTR
   \   0001C1   A3           INC     DPTR
   \   0001C2   A3           INC     DPTR
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   A3           INC     DPTR
   \   0001C7   E0           MOVX    A,@DPTR
   \   0001C8   F8           MOV     R0,A
   \   0001C9   90....       MOV     DPTR,#gMIN_TREE_LINK_COST
   \   0001CC   E0           MOVX    A,@DPTR
   \   0001CD   C3           CLR     C
   \   0001CE   98           SUBB    A,R0
   \   0001CF   4003         JC      $+5
   \   0001D1   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   \   0001D4   85..82       MOV     DPL,?V0 + 0
   \   0001D7   85..83       MOV     DPH,?V0 + 1
   \   0001DA   A3           INC     DPTR
   \   0001DB   A3           INC     DPTR
   \   0001DC   A3           INC     DPTR
   \   0001DD   A3           INC     DPTR
   \   0001DE   A3           INC     DPTR
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   6401         XRL     A,#0x1
   \   0001E2   6011         JZ      ??ZDO_beaconNotifyIndCB_10
   \   0001E4   90....       MOV     DPTR,#_tmpRejoinState
   \   0001E7   E0           MOVX    A,@DPTR
   \   0001E8   700B         JNZ     ??ZDO_beaconNotifyIndCB_10
   \   0001EA   90....       MOV     DPTR,#devStartMode
   \   0001ED   E0           MOVX    A,@DPTR
   \   0001EE   6403         XRL     A,#0x3
   \   0001F0   6003         JZ      $+5
   \   0001F2   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2380              {
   2381                uint8 selected = FALSE;
   \                     ??ZDO_beaconNotifyIndCB_10:
   \   0001F5   7A00         MOV     R2,#0x0
   2382                uint8 capacity = FALSE;
   \   0001F7   7B00         MOV     R3,#0x0
   2383          
   2384                if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \   0001F9   90....       MOV     DPTR,#_NIB + 96
   \   0001FC   E0           MOVX    A,@DPTR
   \   0001FD   6402         XRL     A,#0x2
   \   0001FF   707E         JNZ     ??ZDO_beaconNotifyIndCB_11
   2385                {
   2386                  if ( ((pBeacon->LQI   > pNwkDesc->chosenRouterLinkQuality) &&
   2387                        (pBeacon->depth < MAX_NODE_DEPTH)) ||
   2388                      ((pBeacon->LQI   == pNwkDesc->chosenRouterLinkQuality) &&
   2389                       (pBeacon->depth < pNwkDesc->chosenRouterDepth)) )
   \   000201   85..82       MOV     DPL,?V0 + 0
   \   000204   85..83       MOV     DPH,?V0 + 1
   \   000207   A3           INC     DPTR
   \   000208   A3           INC     DPTR
   \   000209   A3           INC     DPTR
   \   00020A   A3           INC     DPTR
   \   00020B   A3           INC     DPTR
   \   00020C   A3           INC     DPTR
   \   00020D   A3           INC     DPTR
   \   00020E   A3           INC     DPTR
   \   00020F   A3           INC     DPTR
   \   000210   A3           INC     DPTR
   \   000211   E0           MOVX    A,@DPTR
   \   000212   F8           MOV     R0,A
   \   000213   8E82         MOV     DPL,R6
   \   000215   8F83         MOV     DPH,R7
   \   000217   A3           INC     DPTR
   \   000218   A3           INC     DPTR
   \   000219   A3           INC     DPTR
   \   00021A   A3           INC     DPTR
   \   00021B   A3           INC     DPTR
   \   00021C   A3           INC     DPTR
   \   00021D   A3           INC     DPTR
   \   00021E   A3           INC     DPTR
   \   00021F   A3           INC     DPTR
   \   000220   E0           MOVX    A,@DPTR
   \   000221   C3           CLR     C
   \   000222   98           SUBB    A,R0
   \   000223   5012         JNC     ??ZDO_beaconNotifyIndCB_12
   \   000225   E5..         MOV     A,?V0 + 0
   \   000227   240B         ADD     A,#0xb
   \   000229   F582         MOV     DPL,A
   \   00022B   E5..         MOV     A,?V0 + 1
   \   00022D   3400         ADDC    A,#0x0
   \   00022F   F583         MOV     DPH,A
   \   000231   E0           MOVX    A,@DPTR
   \   000232   C3           CLR     C
   \   000233   9414         SUBB    A,#0x14
   \   000235   4044         JC      ??ZDO_beaconNotifyIndCB_13
   \                     ??ZDO_beaconNotifyIndCB_12:
   \   000237   85..82       MOV     DPL,?V0 + 0
   \   00023A   85..83       MOV     DPH,?V0 + 1
   \   00023D   A3           INC     DPTR
   \   00023E   A3           INC     DPTR
   \   00023F   A3           INC     DPTR
   \   000240   A3           INC     DPTR
   \   000241   A3           INC     DPTR
   \   000242   A3           INC     DPTR
   \   000243   A3           INC     DPTR
   \   000244   A3           INC     DPTR
   \   000245   A3           INC     DPTR
   \   000246   A3           INC     DPTR
   \   000247   E0           MOVX    A,@DPTR
   \   000248   F8           MOV     R0,A
   \   000249   8E82         MOV     DPL,R6
   \   00024B   8F83         MOV     DPH,R7
   \   00024D   A3           INC     DPTR
   \   00024E   A3           INC     DPTR
   \   00024F   A3           INC     DPTR
   \   000250   A3           INC     DPTR
   \   000251   A3           INC     DPTR
   \   000252   A3           INC     DPTR
   \   000253   A3           INC     DPTR
   \   000254   A3           INC     DPTR
   \   000255   A3           INC     DPTR
   \   000256   E0           MOVX    A,@DPTR
   \   000257   68           XRL     A,R0
   \   000258   7048         JNZ     ??ZDO_beaconNotifyIndCB_14
   \   00025A   8E82         MOV     DPL,R6
   \   00025C   8F83         MOV     DPH,R7
   \   00025E   A3           INC     DPTR
   \   00025F   A3           INC     DPTR
   \   000260   A3           INC     DPTR
   \   000261   A3           INC     DPTR
   \   000262   A3           INC     DPTR
   \   000263   A3           INC     DPTR
   \   000264   A3           INC     DPTR
   \   000265   A3           INC     DPTR
   \   000266   A3           INC     DPTR
   \   000267   A3           INC     DPTR
   \   000268   E0           MOVX    A,@DPTR
   \   000269   F8           MOV     R0,A
   \   00026A   E5..         MOV     A,?V0 + 0
   \   00026C   240B         ADD     A,#0xb
   \   00026E   F582         MOV     DPL,A
   \   000270   E5..         MOV     A,?V0 + 1
   \   000272   3400         ADDC    A,#0x0
   \   000274   F583         MOV     DPH,A
   \   000276   E0           MOVX    A,@DPTR
   \   000277   C3           CLR     C
   \   000278   98           SUBB    A,R0
   \   000279   5027         JNC     ??ZDO_beaconNotifyIndCB_14
   2390                  {
   2391                    selected = TRUE;
   \                     ??ZDO_beaconNotifyIndCB_13:
   \   00027B   7A01         MOV     R2,#0x1
   \   00027D   8023         SJMP    ??ZDO_beaconNotifyIndCB_14
   2392                  }
   2393                }
   2394                else
   2395                {
   2396                  if ( pBeacon->depth < pNwkDesc->chosenRouterDepth )
   \                     ??ZDO_beaconNotifyIndCB_11:
   \   00027F   8E82         MOV     DPL,R6
   \   000281   8F83         MOV     DPH,R7
   \   000283   A3           INC     DPTR
   \   000284   A3           INC     DPTR
   \   000285   A3           INC     DPTR
   \   000286   A3           INC     DPTR
   \   000287   A3           INC     DPTR
   \   000288   A3           INC     DPTR
   \   000289   A3           INC     DPTR
   \   00028A   A3           INC     DPTR
   \   00028B   A3           INC     DPTR
   \   00028C   A3           INC     DPTR
   \   00028D   E0           MOVX    A,@DPTR
   \   00028E   F8           MOV     R0,A
   \   00028F   E5..         MOV     A,?V0 + 0
   \   000291   240B         ADD     A,#0xb
   \   000293   F582         MOV     DPL,A
   \   000295   E5..         MOV     A,?V0 + 1
   \   000297   3400         ADDC    A,#0x0
   \   000299   F583         MOV     DPH,A
   \   00029B   E0           MOVX    A,@DPTR
   \   00029C   C3           CLR     C
   \   00029D   98           SUBB    A,R0
   \   00029E   5002         JNC     ??ZDO_beaconNotifyIndCB_14
   2397                  {
   2398                    selected = TRUE;
   \   0002A0   7A01         MOV     R2,#0x1
   2399                  }
   2400                }
   2401          
   2402                if ( ZSTACK_ROUTER_BUILD )
   2403                {
   2404                  capacity = pBeacon->routerCapacity;
   2405                }
   2406                else if ( ZSTACK_END_DEVICE_BUILD )
   2407                {
   2408                  capacity = pBeacon->deviceCapacity;
   \                     ??ZDO_beaconNotifyIndCB_14:
   \   0002A2   85..82       MOV     DPL,?V0 + 0
   \   0002A5   85..83       MOV     DPH,?V0 + 1
   \   0002A8   A3           INC     DPTR
   \   0002A9   A3           INC     DPTR
   \   0002AA   A3           INC     DPTR
   \   0002AB   A3           INC     DPTR
   \   0002AC   A3           INC     DPTR
   \   0002AD   A3           INC     DPTR
   \   0002AE   A3           INC     DPTR
   \   0002AF   E0           MOVX    A,@DPTR
   \   0002B0   FB           MOV     R3,A
   2409                }
   2410          
   2411                if ( (capacity) && (selected) )
   \   0002B1   6059         JZ      ??ZDO_beaconNotifyIndCB_15
   \   0002B3   EA           MOV     A,R2
   \   0002B4   6056         JZ      ??ZDO_beaconNotifyIndCB_15
   2412                {
   2413                  // this is the new chosen router for joining...
   2414                  pNwkDesc->chosenRouter            = pBeacon->sourceAddr;
   \   0002B6   85..82       MOV     DPL,?V0 + 0
   \   0002B9   85..83       MOV     DPH,?V0 + 1
   \   0002BC   E0           MOVX    A,@DPTR
   \   0002BD   F8           MOV     R0,A
   \   0002BE   A3           INC     DPTR
   \   0002BF   E0           MOVX    A,@DPTR
   \   0002C0   F9           MOV     R1,A
   \   0002C1   8E82         MOV     DPL,R6
   \   0002C3   8F83         MOV     DPH,R7
   \   0002C5   A3           INC     DPTR
   \   0002C6   A3           INC     DPTR
   \   0002C7   A3           INC     DPTR
   \   0002C8   A3           INC     DPTR
   \   0002C9   A3           INC     DPTR
   \   0002CA   A3           INC     DPTR
   \   0002CB   A3           INC     DPTR
   \   0002CC   E8           MOV     A,R0
   \   0002CD   F0           MOVX    @DPTR,A
   \   0002CE   A3           INC     DPTR
   \   0002CF   E9           MOV     A,R1
   \   0002D0   F0           MOVX    @DPTR,A
   2415                  pNwkDesc->chosenRouterLinkQuality = pBeacon->LQI;
   \   0002D1   85..82       MOV     DPL,?V0 + 0
   \   0002D4   85..83       MOV     DPH,?V0 + 1
   \   0002D7   A3           INC     DPTR
   \   0002D8   A3           INC     DPTR
   \   0002D9   A3           INC     DPTR
   \   0002DA   A3           INC     DPTR
   \   0002DB   A3           INC     DPTR
   \   0002DC   A3           INC     DPTR
   \   0002DD   A3           INC     DPTR
   \   0002DE   A3           INC     DPTR
   \   0002DF   A3           INC     DPTR
   \   0002E0   A3           INC     DPTR
   \   0002E1   E0           MOVX    A,@DPTR
   \   0002E2   8E82         MOV     DPL,R6
   \   0002E4   8F83         MOV     DPH,R7
   \   0002E6   A3           INC     DPTR
   \   0002E7   A3           INC     DPTR
   \   0002E8   A3           INC     DPTR
   \   0002E9   A3           INC     DPTR
   \   0002EA   A3           INC     DPTR
   \   0002EB   A3           INC     DPTR
   \   0002EC   A3           INC     DPTR
   \   0002ED   A3           INC     DPTR
   \   0002EE   A3           INC     DPTR
   \   0002EF   F0           MOVX    @DPTR,A
   2416                  pNwkDesc->chosenRouterDepth       = pBeacon->depth;
   \   0002F0   E5..         MOV     A,?V0 + 0
   \   0002F2   240B         ADD     A,#0xb
   \   0002F4   F582         MOV     DPL,A
   \   0002F6   E5..         MOV     A,?V0 + 1
   \   0002F8   3400         ADDC    A,#0x0
   \   0002FA   F583         MOV     DPH,A
   \   0002FC   E0           MOVX    A,@DPTR
   \   0002FD   8E82         MOV     DPL,R6
   \   0002FF   8F83         MOV     DPH,R7
   \   000301   A3           INC     DPTR
   \   000302   A3           INC     DPTR
   \   000303   A3           INC     DPTR
   \   000304   A3           INC     DPTR
   \   000305   A3           INC     DPTR
   \   000306   A3           INC     DPTR
   \   000307   A3           INC     DPTR
   \   000308   A3           INC     DPTR
   \   000309   A3           INC     DPTR
   \   00030A   A3           INC     DPTR
   \   00030B   F0           MOVX    @DPTR,A
   2417                }
   2418          
   2419                if ( pBeacon->deviceCapacity )
   \                     ??ZDO_beaconNotifyIndCB_15:
   \   00030C   85..82       MOV     DPL,?V0 + 0
   \   00030F   85..83       MOV     DPH,?V0 + 1
   \   000312   A3           INC     DPTR
   \   000313   A3           INC     DPTR
   \   000314   A3           INC     DPTR
   \   000315   A3           INC     DPTR
   \   000316   A3           INC     DPTR
   \   000317   A3           INC     DPTR
   \   000318   A3           INC     DPTR
   \   000319   E0           MOVX    A,@DPTR
   \   00031A   600B         JZ      ??ZDO_beaconNotifyIndCB_16
   2420                  pNwkDesc->deviceCapacity = 1;
   \   00031C   8E82         MOV     DPL,R6
   \   00031E   8F83         MOV     DPH,R7
   \   000320   A3           INC     DPTR
   \   000321   A3           INC     DPTR
   \   000322   A3           INC     DPTR
   \   000323   A3           INC     DPTR
   \   000324   7401         MOV     A,#0x1
   \   000326   F0           MOVX    @DPTR,A
   2421          
   2422                if ( pBeacon->routerCapacity )
   \                     ??ZDO_beaconNotifyIndCB_16:
   \   000327   85..82       MOV     DPL,?V0 + 0
   \   00032A   85..83       MOV     DPH,?V0 + 1
   \   00032D   A3           INC     DPTR
   \   00032E   A3           INC     DPTR
   \   00032F   A3           INC     DPTR
   \   000330   A3           INC     DPTR
   \   000331   A3           INC     DPTR
   \   000332   A3           INC     DPTR
   \   000333   E0           MOVX    A,@DPTR
   \   000334   600A         JZ      ??ZDO_beaconNotifyIndCB_1
   2423                  pNwkDesc->routerCapacity = 1;
   \   000336   8E82         MOV     DPL,R6
   \   000338   8F83         MOV     DPH,R7
   \   00033A   A3           INC     DPTR
   \   00033B   A3           INC     DPTR
   \   00033C   A3           INC     DPTR
   \   00033D   7401         MOV     A,#0x1
   \   00033F   F0           MOVX    @DPTR,A
   2424              }
   2425            }
   2426          }
   \                     ??ZDO_beaconNotifyIndCB_1:
   \   000340   7F08         MOV     R7,#0x8
   \   000342   02....       LJMP    ?BANKED_LEAVE_XDATA
   2427          
   2428          /*********************************************************************
   2429           * @fn          ZDO_StartRouterConfirmCB
   2430           *
   2431           * @brief       This function reports the results of the request to
   2432           *              start functioning as a router in a network.
   2433           *
   2434           * @param       Status - Result of NLME_StartRouterRequest()
   2435           *
   2436           * @return      none
   2437           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2438          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2439          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2440            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2441          
   2442            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   700C         JNZ     ??ZDO_StartRouterConfirmCB_0
   2443            {
   2444              // LED on shows Router started
   2445            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   2446              // LED off forgets HOLD_AUTO_START
   2447             // HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2448              if ( devState == DEV_HOLD )
   \   00000F   90....       MOV     DPTR,#devState
   \   000012   E0           MOVX    A,@DPTR
   \   000013   7006         JNZ     ??ZDO_StartRouterConfirmCB_0
   2449              {
   2450                // Began with HOLD_AUTO_START
   2451                devState = DEV_END_DEVICE;
   \   000015   90....       MOV     DPTR,#devState
   \   000018   7406         MOV     A,#0x6
   \   00001A   F0           MOVX    @DPTR,A
   2452              }
   2453            }
   2454          #if defined(BLINK_LEDS)
   2455            else
   2456            {
   2457            //  HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2458            }
   2459          #endif
   2460          
   2461            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   00001B                ; Setup parameters for call to function osal_set_event
   \   00001B   7A20         MOV     R2,#0x20
   \   00001D   7B00         MOV     R3,#0x0
   \   00001F   90....       MOV     DPTR,#ZDAppTaskID
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F9           MOV     R1,A
   \   000024   12....       LCALL   ??osal_set_event?relay
   \   000027   E9           MOV     A,R1
   2462          }
   \   000028   7F01         MOV     R7,#0x1
   \   00002A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2463          
   2464          /*********************************************************************
   2465           * @fn          ZDO_JoinConfirmCB
   2466           *
   2467           * @brief       This function allows the next hight layer to be notified
   2468           *              of the results of its request to join itself or another
   2469           *              device to a network.
   2470           *
   2471           * @param       Status - Result of NLME_JoinRequest()
   2472           *
   2473           * @return      none
   2474           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2475          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2476          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   \   00000E   89..         MOV     ?V0 + 0,R1
   2477            (void)PanId;  // remove if this parameter is used.
   2478          
   2479            nwkStatus = (byte)Status;
   \   000010   E5..         MOV     A,?V0 + 0
   \   000012   90....       MOV     DPTR,#nwkStatus
   \   000015   F0           MOVX    @DPTR,A
   2480          
   2481            if ( Status == ZSUCCESS )
   \   000016   E5..         MOV     A,?V0 + 0
   \   000018   700C         JNZ     ??ZDO_JoinConfirmCB_0
   2482            {
   2483              // LED on shows device joined
   2484            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   2485              // LED off forgets HOLD_AUTO_START
   2486           //   HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2487              if ( (devState == DEV_HOLD) )
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   7006         JNZ     ??ZDO_JoinConfirmCB_0
   2488              {
   2489                // Began with HOLD_AUTO_START
   2490                devState = DEV_NWK_JOINING;
   \   000020   90....       MOV     DPTR,#devState
   \   000023   7403         MOV     A,#0x3
   \   000025   F0           MOVX    @DPTR,A
   2491              }
   2492          
   2493              if ( !ZG_SECURE_ENABLED )
   2494              {
   2495                // Notify to save info into NV
   2496                ZDApp_NVUpdate();
   2497              }
   2498            }
   2499            else
   2500            {
   2501          #if defined(BLINK_LEDS)
   2502            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2503          #endif    
   2504           
   2505              
   2506            }
   2507          
   2508            // Pass the join confirm to higher layer if callback registered
   2509            if (zdoCBFunc[ZDO_JOIN_CNF_CBID] != NULL )
   \                     ??ZDO_JoinConfirmCB_0:
   \   000026   90....       MOV     DPTR,#zdoCBFunc + 8
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F8           MOV     R0,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F9           MOV     R1,A
   \   00002E   E8           MOV     A,R0
   \   00002F   49           ORL     A,R1
   \   000030   6047         JZ      ??ZDO_JoinConfirmCB_1
   2510            {
   2511              zdoJoinCnf_t joinCnf;
   2512          
   2513              joinCnf.status = Status;
   \   000032   E5..         MOV     A,?V0 + 0
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   E5..         MOV     A,?V0 + 0
   \   00003C   F0           MOVX    @DPTR,A
   2514              joinCnf.deviceAddr = _NIB.nwkDevAddress;
   \   00003D   90....       MOV     DPTR,#_NIB + 20
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F8           MOV     R0,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F9           MOV     R1,A
   \   000045   7401         MOV     A,#0x1
   \   000047   12....       LCALL   ?XSTACK_DISP0_8
   \   00004A   E8           MOV     A,R0
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   A3           INC     DPTR
   \   00004D   E9           MOV     A,R1
   \   00004E   F0           MOVX    @DPTR,A
   2515              joinCnf.parentAddr = _NIB.nwkCoordAddress;
   \   00004F   90....       MOV     DPTR,#_NIB + 23
   \   000052   E0           MOVX    A,@DPTR
   \   000053   F8           MOV     R0,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F9           MOV     R1,A
   \   000057   7403         MOV     A,#0x3
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   E8           MOV     A,R0
   \   00005D   F0           MOVX    @DPTR,A
   \   00005E   A3           INC     DPTR
   \   00005F   E9           MOV     A,R1
   \   000060   F0           MOVX    @DPTR,A
   2516          
   2517              zdoCBFunc[ZDO_JOIN_CNF_CBID]( (void*)&joinCnf );
   \   000061                ; Setup parameters for indirect call
   \   000061   85..82       MOV     DPL,?XSP + 0
   \   000064   85..83       MOV     DPH,?XSP + 1
   \   000067   AA82         MOV     R2,DPL
   \   000069   AB83         MOV     R3,DPH
   \   00006B   90....       MOV     DPTR,#zdoCBFunc + 8
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F583         MOV     DPH,A
   \   000074   8882         MOV     DPL,R0
   \   000076   12....       LCALL   ?CALL_IND
   2518            }
   2519          
   2520            // Notify ZDApp
   2521            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   000079                ; Setup parameters for call to function ZDApp_SendMsg
   \   000079   7C00         MOV     R4,#0x0
   \   00007B   7D00         MOV     R5,#0x0
   \   00007D   7B02         MOV     R3,#0x2
   \   00007F   7A02         MOV     R2,#0x2
   \   000081   90....       MOV     DPTR,#ZDAppTaskID
   \   000084   E0           MOVX    A,@DPTR
   \   000085   F9           MOV     R1,A
   \   000086   12....       LCALL   ??ZDApp_SendMsg?relay
   2522          
   2523            
   2524            
   2525            
   2526          }
   \   000089   7405         MOV     A,#0x5
   \   00008B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008E   7F01         MOV     R7,#0x1
   \   000090   02....       LJMP    ?BANKED_LEAVE_XDATA
   2527          
   2528          /*********************************************************************
   2529           * @fn          ZDO_AddrChangeIndicationCB
   2530           *
   2531           * @brief       This function notifies the application that this
   2532           *              device's address has changed.  Could happen in
   2533           *              a network with stochastic addressing (PRO).
   2534           *
   2535           * @param       newAddr - the new address
   2536           *
   2537           * @return      none
   2538           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2539          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2540          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   2541            ZDO_AddrChangeInd_t *pZDOAddrChangeMsg;
   2542            epList_t *pItem = epList;
   \   000009   90....       MOV     DPTR,#epList
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   2543          
   2544            // Notify to save info into NV
   2545            ZDApp_NVUpdate();
   \   000013                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000013   12....       LCALL   ??ZDApp_NVUpdate?relay
   2546          
   2547            // Notify the applications
   2548            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000016                ; Setup parameters for call to function osal_set_event
   \   000016   7A10         MOV     R2,#0x10
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   90....       MOV     DPTR,#ZDAppTaskID
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??osal_set_event?relay
   \   000022   E9           MOV     A,R1
   2549          
   2550            while (pItem != NULL)
   \                     ??ZDO_AddrChangeIndicationCB_0:
   \   000023   E5..         MOV     A,?V0 + 0
   \   000025   45..         ORL     A,?V0 + 1
   \   000027   606C         JZ      ??ZDO_AddrChangeIndicationCB_1
   2551            {
   2552              if (pItem->epDesc->endPoint != ZDO_EP)
   \   000029   85..82       MOV     DPL,?V0 + 0
   \   00002C   85..83       MOV     DPH,?V0 + 1
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F8           MOV     R0,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F583         MOV     DPH,A
   \   000037   8882         MOV     DPL,R0
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   604A         JZ      ??ZDO_AddrChangeIndicationCB_2
   2553              {
   2554                pZDOAddrChangeMsg = (ZDO_AddrChangeInd_t *)osal_msg_allocate( sizeof( ZDO_AddrChangeInd_t ) );
   \   00003C                ; Setup parameters for call to function osal_msg_allocate
   \   00003C   7A04         MOV     R2,#0x4
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??osal_msg_allocate?relay
   \   000043   8A..         MOV     ?V0 + 4,R2
   \   000045   8B..         MOV     ?V0 + 5,R3
   \   000047   AE..         MOV     R6,?V0 + 4
   \   000049   AF..         MOV     R7,?V0 + 5
   2555                if (pZDOAddrChangeMsg != NULL)
   \   00004B   EE           MOV     A,R6
   \   00004C   4F           ORL     A,R7
   \   00004D   6037         JZ      ??ZDO_AddrChangeIndicationCB_2
   2556                {
   2557                  pZDOAddrChangeMsg->hdr.event = ZDO_ADDR_CHANGE_IND;
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   74D6         MOV     A,#-0x2a
   \   000055   F0           MOVX    @DPTR,A
   2558                  pZDOAddrChangeMsg->shortAddr = newAddr;
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   A3           INC     DPTR
   \   00005B   A3           INC     DPTR
   \   00005C   E5..         MOV     A,?V0 + 2
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E5..         MOV     A,?V0 + 3
   \   000062   F0           MOVX    @DPTR,A
   2559                  osal_msg_send( *(pItem->epDesc->task_id), (uint8 *)pZDOAddrChangeMsg );
   \   000063                ; Setup parameters for call to function osal_msg_send
   \   000063   EE           MOV     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   EF           MOV     A,R7
   \   000066   FB           MOV     R3,A
   \   000067   85..82       MOV     DPL,?V0 + 0
   \   00006A   85..83       MOV     DPH,?V0 + 1
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F583         MOV     DPH,A
   \   000075   8882         MOV     DPL,R0
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   F8           MOV     R0,A
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F583         MOV     DPH,A
   \   00007E   8882         MOV     DPL,R0
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   12....       LCALL   ??osal_msg_send?relay
   \   000085   E9           MOV     A,R1
   2560                }
   2561              }
   2562              pItem = pItem->nextDesc;
   \                     ??ZDO_AddrChangeIndicationCB_2:
   \   000086   85..82       MOV     DPL,?V0 + 0
   \   000089   85..83       MOV     DPH,?V0 + 1
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F5..         MOV     ?V0 + 0,A
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F5..         MOV     ?V0 + 1,A
   \   000093   808E         SJMP    ??ZDO_AddrChangeIndicationCB_0
   2563            }
   2564          
   2565            // Send out a device announce
   2566            ZDApp_AnnounceNewAddress();
   \                     ??ZDO_AddrChangeIndicationCB_1:
   \   000095                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000095   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2567          }
   \   000098   7F06         MOV     R7,#0x6
   \   00009A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2568          
   2569          /*********************************************************************
   2570           * @fn          ZDO_JoinIndicationCB
   2571           *
   2572           * @brief       This function allows the next higher layer of a
   2573           *              coordinator to be notified of a remote join request.
   2574           *
   2575           * @param       ShortAddress - 16-bit address
   2576           * @param       ExtendedAddress - IEEE (64-bit) address
   2577           * @param       CapabilityFlags - Association Capability Flags
   2578           * @param       type - of joining -
   2579           *                          NWK_ASSOC_JOIN
   2580           *                          NWK_ASSOC_REJOIN_UNSECURE
   2581           *                          NWK_ASSOC_REJOIN_SECURE
   2582           *
   2583           * @return      ZStatus_t
   2584           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2585          ZStatus_t ZDO_JoinIndicationCB(uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2586                                          uint8 CapabilityFlags, uint8 type)
   2587          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 2,R1
   \   00000F   740C         MOV     A,#0xc
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 3,A
   2588            (void)ShortAddress;
   2589            (void)ExtendedAddress;
   2590          #if ZDO_NV_SAVE_RFDs
   2591            (void)CapabilityFlags;
   2592          
   2593          #else  // if !ZDO_NV_SAVE_RFDs
   2594            if (CapabilityFlags & CAPINFO_DEVICETYPE_FFD)
   2595          #endif
   2596            {
   2597              ZDApp_NVUpdate();  // Notify to save info into NV.
   \   000017                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000017   12....       LCALL   ??ZDApp_NVUpdate?relay
   2598            }
   2599          
   2600            if (ZG_SECURE_ENABLED)  // Send notification to TC of new device.
   2601            {
   2602              if (type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE)
   \   00001A   E5..         MOV     A,?V0 + 3
   \   00001C   6006         JZ      ??ZDO_JoinIndicationCB_0
   \   00001E   7401         MOV     A,#0x1
   \   000020   65..         XRL     A,?V0 + 3
   \   000022   7011         JNZ     ??ZDO_JoinIndicationCB_1
   2603              {
   2604                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   \                     ??ZDO_JoinIndicationCB_0:
   \   000024                ; Setup parameters for call to function osal_start_timerEx
   \   000024   7C58         MOV     R4,#0x58
   \   000026   7D02         MOV     R5,#0x2
   \   000028   7A40         MOV     R2,#0x40
   \   00002A   7B00         MOV     R3,#0x0
   \   00002C   90....       MOV     DPTR,#ZDAppTaskID
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   12....       LCALL   ??osal_start_timerEx?relay
   \   000034   E9           MOV     A,R1
   2605              }
   2606            }
   2607          
   2608            return ZSuccess;
   \                     ??ZDO_JoinIndicationCB_1:
   \   000035   7900         MOV     R1,#0x0
   \   000037   7F04         MOV     R7,#0x4
   \   000039   02....       LJMP    ?BANKED_LEAVE_XDATA
   2609          }
   2610          
   2611          /*********************************************************************
   2612           * @fn          ZDO_ConcentratorIndicationCB
   2613           *
   2614           * @brief       This function allows the next higher layer of a
   2615           *              device to be notified of existence of the concentrator.
   2616           *
   2617           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2618           * @param       extAddr - pointer to extended Address
   2619           *                        NULL if not available
   2620           * @param       pktCost - PktCost from RREQ
   2621           *
   2622           * @return      void
   2623           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2624          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr, uint8 *extAddr, uint8 pktCost )
   \                     ZDO_ConcentratorIndicationCB:
   2625          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   2626            zdoConcentratorInd_t conInd;
   2627          
   2628            conInd.nwkAddr = nwkAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   2629            conInd.extAddr = extAddr;
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   EE           MOV     A,R6
   \   000027   F0           MOVX    @DPTR,A
   \   000028   A3           INC     DPTR
   \   000029   EF           MOV     A,R7
   \   00002A   F0           MOVX    @DPTR,A
   2630            conInd.pktCost = pktCost;
   \   00002B   E5..         MOV     A,?V0 + 2
   \   00002D   7404         MOV     A,#0x4
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   E5..         MOV     A,?V0 + 2
   \   000034   F0           MOVX    @DPTR,A
   2631          
   2632            if( zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc + 2
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_ConcentratorIndicationCB_0
   2633            {
   2634              zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID]( (void*)&conInd );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc + 2
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   2635            }
   2636          }
   \                     ??ZDO_ConcentratorIndicationCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   2637          
   2638          /*********************************************************************
   2639           * @fn          ZDO_LeaveCnf
   2640           *
   2641           * @brief       This function allows the next higher layer to be
   2642           *              notified of the results of its request for this or
   2643           *              a child device to leave the network.
   2644           *
   2645           * @param       cnf - NLME_LeaveCnf_t
   2646           *
   2647           * @return      none
   2648           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2649          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2650          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2651            // Check for this device
   2652            if ( osal_ExtAddrEqual( cnf->extAddr,
   2653                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function sAddrExtCmp
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??sAddrExtCmp?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7037         JNZ     ??ZDO_LeaveCnf_0
   2654            {
   2655              // Pass the leave confirm to higher layer if callback registered
   2656              if ( ( zdoCBFunc[ZDO_LEAVE_CNF_CBID] == NULL ) ||
   2657                   ( (*zdoCBFunc[ZDO_LEAVE_CNF_CBID])( cnf ) == NULL ) )
   \   000020   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   601C         JZ      ??ZDO_LeaveCnf_1
   \   00002C                ; Setup parameters for indirect call
   \   00002C   EE           MOV     A,R6
   \   00002D   FA           MOV     R2,A
   \   00002E   EF           MOV     A,R7
   \   00002F   FB           MOV     R3,A
   \   000030   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F583         MOV     DPH,A
   \   000039   8882         MOV     DPL,R0
   \   00003B   12....       LCALL   ?CALL_IND
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   E5..         MOV     A,?V0 + 0
   \   000044   45..         ORL     A,?V0 + 1
   \   000046   700F         JNZ     ??ZDO_LeaveCnf_0
   2658              {
   2659                // Prepare to leave with reset
   2660                ZDApp_LeaveReset( cnf->rejoin );
   \                     ??ZDO_LeaveCnf_1:
   \   000048                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000048   EE           MOV     A,R6
   \   000049   240B         ADD     A,#0xb
   \   00004B   F582         MOV     DPL,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   F583         MOV     DPH,A
   \   000052   E0           MOVX    A,@DPTR
   \   000053   F9           MOV     R1,A
   \   000054   12....       LCALL   ??ZDApp_LeaveReset?relay
   2661              }
   2662            }
   2663            else if ( ZSTACK_ROUTER_BUILD )
   2664            {
   2665              // Remove device address(optionally descendents) from data
   2666              ZDApp_LeaveUpdate( cnf->dstAddr,
   2667                                 cnf->extAddr,
   2668                                 cnf->removeChildren );
   2669            }
   2670          }
   \                     ??ZDO_LeaveCnf_0:
   \   000057   7F02         MOV     R7,#0x2
   \   000059   02....       LJMP    ?BANKED_LEAVE_XDATA
   2671          
   2672          /*********************************************************************
   2673           * @fn          ZDO_LeaveInd
   2674           *
   2675           * @brief       This function allows the next higher layer of a
   2676           *              device to be notified of a remote leave request or
   2677           *              indication.
   2678           *
   2679           * @param       ind - NLME_LeaveInd_t
   2680           *
   2681           * @return      none
   2682           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2683          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2684          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2685            uint8 leave;
   2686          
   2687          
   2688            // Parent is requesting the leave - NWK layer filters out illegal
   2689            // requests
   2690            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7011         JNZ     ??ZDO_LeaveInd_0
   2691            {
   2692              // Notify network of leave
   2693              if ( ZSTACK_ROUTER_BUILD )
   2694              {
   2695                NLME_LeaveRsp_t rsp;
   2696                rsp.rejoin         = ind->rejoin;
   2697                rsp.removeChildren = ind->removeChildren;
   2698                NLME_LeaveRsp( &rsp );
   2699              }
   2700          
   2701              // Prepare to leave with reset
   2702              ZDApp_LeaveReset( ind->rejoin );
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   F582         MOV     DPL,A
   \   000021   EF           MOV     A,R7
   \   000022   3400         ADDC    A,#0x0
   \   000024   F583         MOV     DPH,A
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00002B   8074         SJMP    ??ZDO_LeaveInd_1
   2703            }
   2704            else
   2705            {
   2706              leave = FALSE;
   \                     ??ZDO_LeaveInd_0:
   \   00002D   75..00       MOV     ?V0 + 0,#0x0
   2707          
   2708              // Check if this device needs to leave as a child or descendent
   2709              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   C082         PUSH    DPL
   \   000036   C083         PUSH    DPH
   \   000038                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000038   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00003B   8A..         MOV     ?V0 + 2,R2
   \   00003D   8B..         MOV     ?V0 + 3,R3
   \   00003F   D083         POP     DPH
   \   000041   D082         POP     DPL
   \   000043   E0           MOVX    A,@DPTR
   \   000044   65..         XRL     A,?V0 + 2
   \   000046   7004         JNZ     ??ZDO_LeaveInd_2
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   65..         XRL     A,?V0 + 3
   \                     ??ZDO_LeaveInd_2:
   \   00004C   701C         JNZ     ??ZDO_LeaveInd_3
   2710              {
   2711                if ( ( ind->removeChildren == TRUE               ) ||
   2712                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2713                       NODETYPE_DEVICE                           )    )
   \   00004E   EE           MOV     A,R6
   \   00004F   240B         ADD     A,#0xb
   \   000051   F582         MOV     DPL,A
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   F583         MOV     DPH,A
   \   000058   E0           MOVX    A,@DPTR
   \   000059   6401         XRL     A,#0x1
   \   00005B   600A         JZ      ??ZDO_LeaveInd_4
   \   00005D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000060   E0           MOVX    A,@DPTR
   \   000061   5407         ANL     A,#0x7
   \   000063   6402         XRL     A,#0x2
   \   000065   7003         JNZ     ??ZDO_LeaveInd_3
   2714                {
   2715                  leave = TRUE;
   \                     ??ZDO_LeaveInd_4:
   \   000067   75..01       MOV     ?V0 + 0,#0x1
   2716                }
   2717              }
   2718              else if ( ind->removeChildren == TRUE )
   2719              {
   2720                // Check NWK address allocation algorithm
   2721                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2722              }
   2723          
   2724              if ( leave == TRUE )
   \                     ??ZDO_LeaveInd_3:
   \   00006A   7401         MOV     A,#0x1
   \   00006C   65..         XRL     A,?V0 + 0
   \   00006E   7011         JNZ     ??ZDO_LeaveInd_5
   2725              {
   2726                // Prepare to leave with reset
   2727                ZDApp_LeaveReset( ind->rejoin );
   \   000070                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000070   EE           MOV     A,R6
   \   000071   240C         ADD     A,#0xc
   \   000073   F582         MOV     DPL,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   F9           MOV     R1,A
   \   00007C   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00007F   8020         SJMP    ??ZDO_LeaveInd_1
   2728              }
   2729              else
   2730              {
   2731                // Remove device address(optionally descendents) from data
   2732                ZDApp_LeaveUpdate( ind->srcAddr,
   2733                                   ind->extAddr,
   2734                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_5:
   \   000081                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000081   EE           MOV     A,R6
   \   000082   240B         ADD     A,#0xb
   \   000084   F582         MOV     DPL,A
   \   000086   EF           MOV     A,R7
   \   000087   3400         ADDC    A,#0x0
   \   000089   F583         MOV     DPH,A
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F9           MOV     R1,A
   \   00008D   EE           MOV     A,R6
   \   00008E   2402         ADD     A,#0x2
   \   000090   FC           MOV     R4,A
   \   000091   EF           MOV     A,R7
   \   000092   3400         ADDC    A,#0x0
   \   000094   FD           MOV     R5,A
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   FA           MOV     R2,A
   \   00009B   A3           INC     DPTR
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   FB           MOV     R3,A
   \   00009E   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2735              }
   2736            }
   2737          
   2738            // Pass the leave indication to higher layer if callback registered.
   2739            if (zdoCBFunc[ZDO_LEAVE_IND_CBID] != NULL)
   \                     ??ZDO_LeaveInd_1:
   \   0000A1   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F8           MOV     R0,A
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F9           MOV     R1,A
   \   0000A9   E8           MOV     A,R0
   \   0000AA   49           ORL     A,R1
   \   0000AB   601C         JZ      ??ZDO_LeaveInd_6
   2740            {
   2741              (void)zdoCBFunc[ZDO_LEAVE_IND_CBID](ind);
   \   0000AD                ; Setup parameters for indirect call
   \   0000AD   EE           MOV     A,R6
   \   0000AE   FA           MOV     R2,A
   \   0000AF   EF           MOV     A,R7
   \   0000B0   FB           MOV     R3,A
   \   0000B1   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   8882         MOV     DPL,R0
   \   0000BC   12....       LCALL   ?CALL_IND
   \   0000BF   8A..         MOV     ?V0 + 2,R2
   \   0000C1   8B..         MOV     ?V0 + 3,R3
   \   0000C3   85..82       MOV     DPL,?V0 + 2
   \   0000C6   85..83       MOV     DPH,?V0 + 3
   2742            }
   2743          }
   \                     ??ZDO_LeaveInd_6:
   \   0000C9   7F04         MOV     R7,#0x4
   \   0000CB   02....       LJMP    ?BANKED_LEAVE_XDATA
   2744          
   2745          /*********************************************************************
   2746           * @fn          ZDO_SyncIndicationCB
   2747           *
   2748           * @brief       This function allows the next higher layer of a
   2749           *              coordinator to be notified of a loss of synchronization
   2750           *                          with the parent/child device.
   2751           *
   2752           * @param       type: 0 - child; 1 - parent
   2753           *
   2754           *
   2755           * @return      none
   2756           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2757          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2758          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   2759            (void)shortAddr;  // Remove this line if this parameter is used.
   2760          
   2761            if ( ZSTACK_END_DEVICE_BUILD
   2762              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityFlags & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   2763            {
   2764              if ( type == 1 )
   \   00000B   7401         MOV     A,#0x1
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   7013         JNZ     ??ZDO_SyncIndicationCB_0
   2765              {
   2766                // We lost contact with our parent.  Clear the neighbor Table.
   2767                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2768          
   2769                // Start the rejoin process.
   2770                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   90....       MOV     DPTR,#ZDAppTaskID
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F9           MOV     R1,A
   \   000021   12....       LCALL   ??ZDApp_SendMsg?relay
   2771              }
   2772            }
   2773          }
   \                     ??ZDO_SyncIndicationCB_0:
   \   000024   7F01         MOV     R7,#0x1
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA
   2774          
   2775          /*********************************************************************
   2776           * @fn          ZDO_ManytoOneFailureIndicationCB
   2777           *
   2778           * @brief       This function allows the next higher layer of a
   2779           *              concentrator to be notified of a many-to-one route
   2780           *              failure.
   2781           *
   2782           * @param       none
   2783           *
   2784           *
   2785           * @return      none
   2786           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2787          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2788          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2789            // By default, the concentrator automatically redo many-to-one route
   2790            // discovery to update all many-to-one routes in the network
   2791            // If you want anything processing other than the default,
   2792            // please replace the following code.
   2793          
   2794            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2795          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
   2796          
   2797          /*********************************************************************
   2798           * @fn          ZDO_PollConfirmCB
   2799           *
   2800           * @brief       This function allows the next higher layer to be
   2801           *              notified of a Poll Confirm.
   2802           *
   2803           * @param       none
   2804           *
   2805           * @return      none
   2806           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2807          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2808          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2809            (void)status;  // Remove this line if this parameter is used.
   2810            return;
   \   000000   02....       LJMP    ?BRET
   2811          }
   2812          
   2813          /******************************************************************************
   2814           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2815           *
   2816           * @brief       Stub routine implemented by NHLE. NHLE should call
   2817           *              <AddrMgrWriteNV> when appropriate.
   2818           *
   2819           * @param       none
   2820           *
   2821           * @return      none
   2822           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2823          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2824          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2825          #if defined ( NV_RESTORE )
   2826            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   E5..         MOV     A,?V0 + 0
   \   000017   45..         ORL     A,?V0 + 1
   \   000019   7003         JNZ     ??AddrMgrWriteNVRequest_0
   2827            {
   2828              // Trigger to save info into NV
   2829              ZDApp_NVUpdate();
   \   00001B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00001B   12....       LCALL   ??ZDApp_NVUpdate?relay
   2830            }
   2831          #endif
   2832          }
   \                     ??AddrMgrWriteNVRequest_0:
   \   00001E   7F02         MOV     R7,#0x2
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA
   2833          
   2834          /*********************************************************************
   2835           * Call Back Functions from Security  - API
   2836           */
   2837          
   2838           /*********************************************************************
   2839           * @fn          ZDO_UpdateDeviceIndication
   2840           *
   2841           * @brief       This function notifies the "Trust Center" of a
   2842           *              network when a device joins or leaves the network.
   2843           *
   2844           * @param       extAddr - pointer to 64 bit address of new device
   2845           * @param       status  - 0 if a new device joined securely
   2846           *                      - 1 if a new device joined un-securely
   2847           *                      - 2 if a device left the network
   2848           *
   2849           * @return      true if newly joined device should be allowed to
   2850           *                                              remain on network
   2851           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2852          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2853          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
   2854            // can implement a network access policy based on the
   2855            // IEEE address of newly joining devices...
   2856            (void)extAddr;
   2857            (void)status;
   2858          
   2859            return ZSuccess;
   \   000002   7900         MOV     R1,#0x0
   \   000004   02....       LJMP    ?BRET
   2860          }
   2861          
   2862          /*********************************************************************
   2863           * @fn          ZDApp_InMsgCB
   2864           *
   2865           * @brief       This function is called to pass up any message that is
   2866           *              not yet supported.  This allows for the developer to
   2867           *              support features themselves..
   2868           *
   2869           * @return      none
   2870           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2871          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2872          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2873            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   5400         ANL     A,#0x0
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   5480         ANL     A,#0x80
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   49           ORL     A,R1
   \   00001E   7071         JNZ     ??ZDApp_InMsgCB_0
   2874            {
   2875              // Handle the response message
   2876            }
   2877            else
   2878            {
   2879              // Handle the request message by sending a generic "not supported".
   2880              // Device Announce doesn't have a response.
   2881              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7064         JNZ     ??ZDApp_InMsgCB_0
   \   00002D   EE           MOV     A,R6
   \   00002E   240C         ADD     A,#0xc
   \   000030   F582         MOV     DPL,A
   \   000032   EF           MOV     A,R7
   \   000033   3400         ADDC    A,#0x0
   \   000035   F583         MOV     DPH,A
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6413         XRL     A,#0x13
   \   00003A   7004         JNZ     ??ZDApp_InMsgCB_1
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6400         XRL     A,#0x0
   \                     ??ZDApp_InMsgCB_1:
   \   000040   604F         JZ      ??ZDApp_InMsgCB_0
   2882              {
   2883                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2884                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000042                ; Setup parameters for call to function ZDP_GenericRsp
   \   000042   EE           MOV     A,R6
   \   000043   240C         ADD     A,#0xc
   \   000045   F582         MOV     DPL,A
   \   000047   EF           MOV     A,R7
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F583         MOV     DPH,A
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   4400         ORL     A,#0x0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   4480         ORL     A,#0x80
   \   000055   F5..         MOV     ?V0 + 1,A
   \   000057   78..         MOV     R0,#?V0 + 0
   \   000059   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005C   E4           CLR     A
   \   00005D   F5..         MOV     ?V0 + 0,A
   \   00005F   F5..         MOV     ?V0 + 1,A
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   EE           MOV     A,R6
   \   000067   240E         ADD     A,#0xe
   \   000069   F582         MOV     DPL,A
   \   00006B   EF           MOV     A,R7
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F583         MOV     DPH,A
   \   000070   E0           MOVX    A,@DPTR
   \   000071   FD           MOV     R5,A
   \   000072   7C84         MOV     R4,#-0x7c
   \   000074   EE           MOV     A,R6
   \   000075   2402         ADD     A,#0x2
   \   000077   FA           MOV     R2,A
   \   000078   EF           MOV     A,R7
   \   000079   3400         ADDC    A,#0x0
   \   00007B   FB           MOV     R3,A
   \   00007C   EE           MOV     A,R6
   \   00007D   240F         ADD     A,#0xf
   \   00007F   F582         MOV     DPL,A
   \   000081   EF           MOV     A,R7
   \   000082   3400         ADDC    A,#0x0
   \   000084   F583         MOV     DPH,A
   \   000086   E0           MOVX    A,@DPTR
   \   000087   F9           MOV     R1,A
   \   000088   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00008B   7404         MOV     A,#0x4
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000090   E9           MOV     A,R1
   2885              }
   2886            }
   2887          }
   \                     ??ZDApp_InMsgCB_0:
   \   000091   7F02         MOV     R7,#0x2
   \   000093   02....       LJMP    ?BANKED_LEAVE_XDATA
   2888          
   2889          
   2890          /*********************************************************************
   2891           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2892           *
   2893           * @brief   Changes the Match Descriptor Response permission.
   2894           *
   2895           * @param   endpoint - endpoint to allow responses
   2896           * @param   action - true to allow responses, false to not
   2897           *
   2898           * @return  none
   2899           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2900          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2901          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   2902            // Store the action
   2903            afSetMatch( endpoint, action );
   \   000009                ; Setup parameters for call to function afSetMatch
   \   000009   FA           MOV     R2,A
   \   00000A   EF           MOV     A,R7
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??afSetMatch?relay
   \   00000F   E9           MOV     A,R1
   2904          }
   \   000010   7F01         MOV     R7,#0x1
   \   000012   02....       LJMP    ?BANKED_LEAVE_XDATA
   2905          
   2906          /*********************************************************************
   2907           * @fn      ZDApp_NetworkInit()
   2908           *
   2909           * @brief   Used to start the network joining process
   2910           *
   2911           * @param   delay - mSec delay to wait before starting
   2912           *
   2913           * @return  none
   2914           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2915          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2916          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2917            if ( delay )
   \   000009   EE           MOV     A,R6
   \   00000A   4F           ORL     A,R7
   \   00000B   6013         JZ      ??ZDApp_NetworkInit_0
   2918            {
   2919              // Wait awhile before starting the device
   2920              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000D                ; Setup parameters for call to function osal_start_timerEx
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7B00         MOV     R3,#0x0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??osal_start_timerEx?relay
   \   00001D   E9           MOV     A,R1
   \   00001E   800D         SJMP    ??ZDApp_NetworkInit_1
   2921            }
   2922            else
   2923            {
   2924              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000020                ; Setup parameters for call to function osal_set_event
   \   000020   7A01         MOV     R2,#0x1
   \   000022   7B00         MOV     R3,#0x0
   \   000024   90....       MOV     DPTR,#ZDAppTaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??osal_set_event?relay
   \   00002C   E9           MOV     A,R1
   2925            }
   2926          }
   \                     ??ZDApp_NetworkInit_1:
   \   00002D   7F01         MOV     R7,#0x1
   \   00002F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2927          
   2928          /*********************************************************************
   2929           * @fn      ZDApp_NwkStateUpdateCB()
   2930           *
   2931           * @brief   This function notifies that this device's network
   2932           *          state info has been changed.
   2933           *
   2934           * @param   none
   2935           *
   2936           * @return  none
   2937           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2938          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2939          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2940            // Notify to save info into NV
   2941            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   E5..         MOV     A,?V0 + 0
   \   000017   45..         ORL     A,?V0 + 1
   \   000019   7003         JNZ     ??ZDApp_NwkStateUpdateCB_0
   2942            {
   2943              // Trigger to save info into NV
   2944              ZDApp_NVUpdate();
   \   00001B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00001B   12....       LCALL   ??ZDApp_NVUpdate?relay
   2945            }
   2946          }
   \                     ??ZDApp_NwkStateUpdateCB_0:
   \   00001E   7F02         MOV     R7,#0x2
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA
   2947          
   2948          /*********************************************************************
   2949           * @fn      ZDApp_NodeProfileSync()
   2950           *
   2951           * @brief   Sync node with stack profile.
   2952           *
   2953           * @param   stackProfile - stack profile of the network to join
   2954           *
   2955           * @return  none
   2956           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2957          void ZDApp_NodeProfileSync( uint8 stackProfile )
   \                     ZDApp_NodeProfileSync:
   2958          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2959            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000007   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5021         JNC     ??ZDApp_NodeProfileSync_0
   2960            {
   2961              if ( stackProfile != zgStackProfile )
   \   00000F   90....       MOV     DPTR,#zgStackProfile
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6E           XRL     A,R6
   \   000014   601A         JZ      ??ZDApp_NodeProfileSync_0
   2962              {
   2963                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000016   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   54F8         ANL     A,#0xf8
   \   00001C   4402         ORL     A,#0x2
   \   00001E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000021   F0           MOVX    @DPTR,A
   2964                ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   000022   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000025   740C         MOV     A,#0xc
   \   000027   F0           MOVX    @DPTR,A
   2965                NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000028                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2966              }
   2967            }
   2968          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000030   7F01         MOV     R7,#0x1
   \   000032   02....       LJMP    ?BANKED_LEAVE_XDATA
   2969          
   2970          /*********************************************************************
   2971           * @fn      ZDApp_StartJoiningCycle()
   2972           *
   2973           * @brief   Starts the joining cycle of a device.  This will only
   2974           *          continue an already started (or stopped) joining cycle.
   2975           *
   2976           * @param   none
   2977           *
   2978           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2979           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2980          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2981          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2982            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2983            {
   2984              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7401         MOV     A,#0x1
   \   000019   F0           MOVX    @DPTR,A
   2985              ZDApp_NetworkInit( 0 );
   \   00001A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00001A   7A00         MOV     R2,#0x0
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??ZDApp_NetworkInit?relay
   2986          
   2987              return ( TRUE );
   \   000021   7901         MOV     R1,#0x1
   \   000023   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2988            }
   2989            else
   2990              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000025   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000027   D083         POP     DPH
   \   000029   D082         POP     DPL
   \   00002B   02....       LJMP    ?BRET
   2991          }
   2992          
   2993          /*********************************************************************
   2994           * @fn      ZDApp_StopJoiningCycle()
   2995           *
   2996           * @brief   Stops the joining or rejoining process of a device.
   2997           *
   2998           * @param   none
   2999           *
   3000           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   3001           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3002          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   3003          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3004            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   700A         JNZ     ??ZDApp_StopJoiningCycle_1
   3005            {
   3006              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   3007              return ( TRUE );
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   3008            }
   3009            else
   3010              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001E   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   3011          }
   3012          
   3013          /*********************************************************************
   3014           * @fn      ZDApp_AnnounceNewAddress()
   3015           *
   3016           * @brief   Send Device Announce and hold all transmissions for
   3017           *          new address timeout.
   3018           *
   3019           * @param   none
   3020           *
   3021           * @return  none
   3022           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3023          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   3024          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   3025          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   3026            // Turn off data request hold
   3027            APSME_HoldDataRequests( 0 );
   \   000005                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B00         MOV     R3,#0x0
   \   000009   12....       LCALL   ??APSME_HoldDataRequests?relay
   3028          #endif
   3029          
   3030            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   3031                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   00000C                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000C   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   AE..         MOV     R6,?V0 + 0
   \   000015   AF..         MOV     R7,?V0 + 1
   \   000017                ; Setup parameters for call to function NLME_GetShortAddr
   \   000017   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00001A   8A..         MOV     ?V0 + 0,R2
   \   00001C   8B..         MOV     ?V0 + 1,R3
   \   00001E   AA..         MOV     R2,?V0 + 0
   \   000020   AB..         MOV     R3,?V0 + 1
   \   000022                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000022   75..00       MOV     ?V0 + 0,#0x0
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F9           MOV     R1,A
   \   00002F   EE           MOV     A,R6
   \   000030   FC           MOV     R4,A
   \   000031   EF           MOV     A,R7
   \   000032   FD           MOV     R5,A
   \   000033   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000036   7401         MOV     A,#0x1
   \   000038   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003B   E9           MOV     A,R1
   3032          
   3033          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   3034            // Setup the timeout
   3035            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   \   00003C                ; Setup parameters for call to function APSME_HoldDataRequests
   \   00003C   7A00         MOV     R2,#0x0
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??APSME_HoldDataRequests?relay
   3036          #endif
   3037          }
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   3038          
   3039          /*********************************************************************
   3040           * @fn          ZDApp_NVUpdate
   3041           *
   3042           * @brief       Set the NV Update Timer.
   3043           *
   3044           * @param       none
   3045           *
   3046           * @return      none
   3047           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3048          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   3049          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3050          #if defined ( NV_RESTORE )
   3051            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   7CBC         MOV     R4,#-0x44
   \   000006   7D02         MOV     R5,#0x2
   \   000008   7A00         MOV     R2,#0x0
   \   00000A   7B02         MOV     R3,#0x2
   \   00000C   90....       MOV     DPTR,#ZDAppTaskID
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??osal_start_timerEx?relay
   \   000014   E9           MOV     A,R1
   3052          #endif
   3053          }
   \   000015   D083         POP     DPH
   \   000017   D082         POP     DPL
   \   000019   02....       LJMP    ?BRET
   3054          
   3055          /*********************************************************************
   3056           * @fn      ZDApp_CoordStartPANIDConflictCB()
   3057           *
   3058           * @brief   Returns a PAN ID for the network layer to use during
   3059           *          a coordinator start and there is another network with
   3060           *          the intended PANID.
   3061           *
   3062           * @param   panid - the intended PAN ID
   3063           *
   3064           * @return  PANID to try
   3065           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3066          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   3067          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   3068            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   FA           MOV     R2,A
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   3069          }
   3070          
   3071          /*********************************************************************
   3072           * @fn          ZDO_SrcRtgIndCB
   3073           *
   3074           * @brief       This function notifies the ZDO available src route record received.
   3075           *
   3076           * @param       srcAddr - source address of the source route
   3077           * @param       relayCnt - number of devices in the relay list
   3078           * @param       relayList - relay list of the source route
   3079           *
   3080           * @return      none
   3081           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3082          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   3083          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   89..         MOV     ?V0 + 2,R1
   \   000010   EC           MOV     A,R4
   \   000011   FE           MOV     R6,A
   \   000012   ED           MOV     A,R5
   \   000013   FF           MOV     R7,A
   3084            zdoSrcRtg_t srcRtg;
   3085          
   3086            srcRtg.srcAddr = srcAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   3087            srcRtg.relayCnt = relayCnt;
   \   000021   E5..         MOV     A,?V0 + 2
   \   000023   7402         MOV     A,#0x2
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E5..         MOV     A,?V0 + 2
   \   00002A   F0           MOVX    @DPTR,A
   3088            srcRtg.pRelayList = pRelayList;
   \   00002B   7403         MOV     A,#0x3
   \   00002D   12....       LCALL   ?XSTACK_DISP0_8
   \   000030   EE           MOV     A,R6
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   EF           MOV     A,R7
   \   000034   F0           MOVX    @DPTR,A
   3089          
   3090            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_SrcRtgIndCB_0
   3091            {
   3092              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   3093            }
   3094          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   3095          
   3096          /*********************************************************************
   3097           * @fn          ZDApp_InitZdoCBFunc
   3098           *
   3099           * @brief       Call this function to initialize zdoCBFunc[]
   3100           *
   3101           * @param       none
   3102           *
   3103           * @return      none
   3104           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3105          void ZDApp_InitZdoCBFunc( void )
   \                     ZDApp_InitZdoCBFunc:
   3106          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3107            uint8 i;
   3108          
   3109            for ( i=0; i< MAX_ZDO_CB_FUNC; i++ )
   \   000004   7B00         MOV     R3,#0x0
   \                     ??ZDApp_InitZdoCBFunc_0:
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502D         JNC     ??ZDApp_InitZdoCBFunc_1
   3110            {
   3111              zdoCBFunc[i] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   3112            }
   \   000036   0B           INC     R3
   \   000037   80CD         SJMP    ??ZDApp_InitZdoCBFunc_0
   3113          }
   \                     ??ZDApp_InitZdoCBFunc_1:
   \   000039   D083         POP     DPH
   \   00003B   D082         POP     DPL
   \   00003D   02....       LJMP    ?BRET
   3114          
   3115          /*********************************************************************
   3116           * @fn          ZDO_RegisterForZdoCB
   3117           *
   3118           * @brief       Call this function to register the higher layer (for
   3119           *              example, the Application layer or MT layer) with ZDO
   3120           *              callbacks to get notified of some ZDO indication like
   3121           *              existence of a concentrator or receipt of a source
   3122           *              route record.
   3123           *
   3124           * @param       indID - ZDO Indication ID
   3125           * @param       pFn   - Callback function pointer
   3126           *
   3127           * @return      ZSuccess - successful, ZInvalidParameter if not
   3128           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3129          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   3130          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FD           MOV     R5,A
   3131            // Check the range of the indication ID
   3132            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   ED           MOV     A,R5
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502C         JNC     ??ZDO_RegisterForZdoCB_0
   3133            {
   3134              zdoCBFunc[indID] = pFn;
   \   00000C   ED           MOV     A,R5
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   ACF0         MOV     R4,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2C           ADD     A,R4
   \   00001D   FC           MOV     R4,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2C           ADD     A,R4
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   EA           MOV     A,R2
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   EB           MOV     A,R3
   \   000033   F0           MOVX    @DPTR,A
   3135              return ZSuccess;
   \   000034   7900         MOV     R1,#0x0
   \   000036   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   3136            }
   3137          
   3138            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000038   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   00003A   D083         POP     DPH
   \   00003C   D082         POP     DPL
   \   00003E   02....       LJMP    ?BRET
   3139          }
   3140          
   3141          /*********************************************************************
   3142           * @fn          ZDO_DeregisterForZdoCB
   3143           *
   3144           * @brief       Call this function to de-register the higher layer (for
   3145           *              example, the Application layer or MT layer) with ZDO
   3146           *              callbacks to get notified of some ZDO indication like
   3147           *              existence of a concentrator or receipt of a source
   3148           *              route record.
   3149           *
   3150           * @param       indID - ZDO Indication ID
   3151           *
   3152           * @return      ZSuccess - successful, ZInvalidParameter if not
   3153           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3154          ZStatus_t ZDO_DeregisterForZdoCB( uint8 indID )
   \                     ZDO_DeregisterForZdoCB:
   3155          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FB           MOV     R3,A
   3156            // Check the range of the indication ID
   3157            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502E         JNC     ??ZDO_DeregisterForZdoCB_0
   3158            {
   3159              zdoCBFunc[indID] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   3160              return ZSuccess;
   \   000036   7900         MOV     R1,#0x0
   \   000038   8002         SJMP    ??ZDO_DeregisterForZdoCB_1
   3161            }
   3162          
   3163            return ZInvalidParameter;
   \                     ??ZDO_DeregisterForZdoCB_0:
   \   00003A   7902         MOV     R1,#0x2
   \                     ??ZDO_DeregisterForZdoCB_1:
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
   3164          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   401F         DW 8000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkDiscoveryReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkDiscoveryReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_JoinReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_JoinReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceConfigured?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceConfigured

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_beaconNotifyIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_beaconNotifyIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitZdoCBFunc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitZdoCBFunc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_DeregisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_DeregisterForZdoCB
   3165          
   3166          /*********************************************************************
   3167          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     34
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDAppCheckForHoldKey               2      0     12
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     14
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     25
       -> APSME_HoldDataRequests        0      0     20
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> APSME_HoldDataRequests        0      0     20
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> osal_pwrmgr_device            4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
       -> ZDApp_NVUpdate                4      0      0
     ZDApp_DeviceConfigured             0      0     16
       -> osal_nv_read                  0      0     32
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0     12
       -> NLME_GetExtAddr               0      0     24
       -> ZDAppCheckForHoldKey          0      0     24
       -> ZDO_Init                      0      0     24
       -> afRegister                    0      0     24
       -> ZDApp_InitUserDesc            0      0     24
       -> ZDOInitDevice                 0      0     24
       -> ZDOInitDevice                 0      0     24
       -> osal_pwrmgr_device            0      0     24
       -> ZDApp_InitZdoCBFunc           0      0     24
       -> ZDApp_RegisterCBs             0      0     24
     ZDApp_InitUserDesc                 0      0     43
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_InitZdoCBFunc                2      0     12
     ZDApp_JoinReq                      0      0     24
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     40
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     28
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlReset               0      0     24
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             0      0     10
       -> ZDApp_LeaveCtrlReset          0      0     20
     ZDApp_LeaveReset                   0      0     21
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0     39
       -> ZDSecMgrDeviceRemoveByExtAddr
                                        0      0     48
       -> ZDSecMgrAddrClear             0      0     48
       -> osal_memcpy                   0      0     54
       -> RTG_RemoveRtgEntry            0      0     48
       -> nwkNeighborRemove             0      0     48
       -> AddrMgrWriteNVRequest         0      0     48
     ZDApp_NVUpdate                     2      0     14
       -> osal_start_timerEx            4      0      0
     ZDApp_NetworkDiscoveryReq          0      0     12
       -> NLME_NetworkDiscoveryRequest
                                        0      0     24
     ZDApp_NetworkInit                  0      0     26
       -> osal_start_timerEx            0      0     18
       -> osal_set_event                0      0     18
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> NLME_SetBroadcastFilter       0      0     18
     ZDApp_NwkStateUpdateCB             0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDApp_ProcessMsgCBs                0      0     50
       -> ZDO_ParseAddrRsp              0      0     66
       -> ZDO_UpdateAddrManager         0      0     66
       -> osal_mem_free                 0      0     66
       -> ZDO_ParseBindUnbindReq        0      0     66
       -> ZDO_ProcessBindUnbindReq      0      0     66
     ZDApp_ProcessNetworkJoin           0      0     29
       -> osal_set_event                0      0     24
       -> osal_pwrmgr_device            0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> ZDApp_ResetTimerStart         0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> osal_set_event                0      0     24
       -> osal_pwrmgr_device            0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_set_event                0      0     24
     ZDApp_ProcessOSALMsg               0      0     35
       -> ZDP_IncomingData              0      0     34
       -> ZDApp_ProcessMsgCBs           0      0     34
       -> ZDApp_NwkDescListProcessing
                                        0      0     34
       -> ZDApp_NodeProfileSync         0      0     34
       -> NLME_JoinRequest              0      0     42
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> osal_start_timerEx            0      0     34
       -> osal_rand                     0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZDApp_RestoreNwkKey           0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZMacSetReq                    0      0     34
       -> NLME_ReJoinRequest            0      0     34
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> NLME_SetPollRate              0      0     34
       -> NLME_SetQueuedPollRate        0      0     34
       -> NLME_SetResponseRate          0      0     34
       -> NLME_SetPollRate              0      0     34
       -> osal_set_event                0      0     34
       -> ZDApp_ProcessNetworkJoin      0      0     34
       -> sAddrExtCpy                   0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> ZDApp_ProcessSecMsg           0      0     34
     ZDApp_ProcessSecEvent              0      0     23
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
       -> ZDSecMgrSaveApsLinkKey        0      0     18
       -> ZDSecMgrSaveTCLinkKey         0      0     18
     ZDApp_ProcessSecMsg                0      0     26
       -> ZDSecMgrTransportKeyInd       0      0     18
       -> ZDSecMgrSwitchKeyInd          0      0     18
     ZDApp_ReadNetworkRestoreState      0      0     23
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0     12
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              0      0     21
       -> osal_start_timerEx            0      0     18
     ZDApp_RestoreNetworkState          0      0     23
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     54
       -> osal_nv_read                  0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SaveNetworkStateEvt          2      0     14
       -> NLME_UpdateNV                 4      0      0
       -> zgWriteStartupOptions         4      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SecInit                      0      0     39
       -> ZDSecMgrInit                  0      0     50
       -> ZDSecMgrReadKeyFromNv         0      0     50
       -> SSP_UpdateNwkKey              0      0     50
       -> SSP_SwitchNwkKey              0      0     50
       -> osal_memset                   0      0     50
     ZDApp_SendEventMsg                 0      0     10
       -> ZDApp_SendMsg                 0      0     20
     ZDApp_SendMsg                      1      0     33
       -> osal_msg_allocate             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_msg_send                 0      0     32
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     14
       -> osal_msg_receive              0      0     28
       -> ZDApp_ProcessOSALMsg          0      0     28
       -> osal_msg_deallocate           0      0     28
       -> USER_ZDO_JOINING_MSG          0      0     28
       -> osal_set_event                0      0     28
       -> ZDO_StartDevice               0      0     28
       -> ZDO_DEVICE_DISC               0      0     28
       -> ZDO_ACK_DEAL_WITH             0      0     28
       -> ZDO_UpdateNwkStatus           0      0     28
       -> osal_start_timerEx            0      0     28
       -> ZDApp_SaveNetworkStateEvt     0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> Onboard_soft_reset            0      0     28
       -> ZDApp_ProcessSecEvent         0      0     28
     ZDOInitDevice                      0      0     26
       -> zgInitItems                   0      0     28
       -> ZDConfig_InitDescriptors      0      0     28
       -> HalKeyRead                    0      0     28
       -> ZDApp_ReadNetworkRestoreState
                                        0      0     28
       -> ZDApp_RestoreNetworkState     0      0     28
       -> NLME_InitNV                   0      0     28
       -> NLME_SetDefaultNV             0      0     28
       -> ZDSecMgrClearNVKeyValues      0      0     28
       -> ZDAppDetermineDeviceType      0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_SecInit                 0      0     28
       -> ZDApp_LeaveCtrlInit           0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> osal_set_event                0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_SetBroadcastFilter       0      0     28
     ZDO_AddrChangeIndicationCB         0      0     14
       -> ZDApp_NVUpdate                0      0     28
       -> osal_set_event                0      0     28
       -> osal_msg_allocate             0      0     28
       -> osal_msg_send                 0      0     28
       -> ZDApp_AnnounceNewAddress      0      0     28
     ZDO_ConcentratorIndicationCB       1      0     16
     ZDO_DeregisterForZdoCB             2      0      0
     ZDO_JoinConfirmCB                  1      0     14
       -> ZDApp_SendMsg                 0      0     28
     ZDO_JoinIndicationCB               0      0     13
       -> ZDApp_NVUpdate                0      0     24
       -> osal_start_timerEx            0      0     24
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
     ZDO_LeaveInd                       2      0     12
       -> ZDApp_LeaveReset              0      0     24
       -> NLME_GetCoordShortAddr        4      0     24
       -> ZDApp_LeaveReset              0      0     24
       -> ZDApp_LeaveUpdate             0      0     24
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      3      0      3
       -> ZDApp_SendMsg                 4      0      6
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     16
     ZDO_StartRouterConfirmCB           0      0      9
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0
     ZDO_beaconNotifyIndCB              1      0     16
       -> osal_mem_alloc                0      0     32
       -> osal_memset                   0      0     32
       -> sAddrExtCpy                   0      0     32
       -> osal_memset                   0      0     32


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_P0                                          1
     _A_P1                                          1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                     14
     ZDO_FIRST_join_flag                            1
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                   101
     ZDApp_SecInit                                119
     ZDApp_event_loop                             346
     ZDApp_ProcessSecEvent                        146
     ZDOInitDevice                                204
     ZDApp_ReadNetworkRestoreState                 25
     ZDAppDetermineDeviceType                      98
     ZDApp_NetworkStartEvt                        123
     ZDApp_DeviceAuthEvt                           79
     ZDApp_SaveNetworkStateEvt                     24
     ZDApp_RestoreNetworkState                     96
     ZDApp_InitUserDesc                           138
     ZDAppCheckForHoldKey                          25
     ZDApp_ProcessOSALMsg                         682
     ZDApp_ProcessMsgCBs                          164
     ZDApp_RegisterCBs                             63
     ZDApp_ProcessSecMsg                           97
     ZDApp_ProcessNetworkJoin                     551
     ZDApp_SaveNwkKey                             125
     ZDApp_ResetNwkKey                             84
     ZDApp_RestoreNwkKey                          154
     ZDApp_ResetTimerStart                         31
     ZDApp_ResetTimerCancel                        24
     ZDApp_LeaveCtrlInit                           86
     ZDApp_LeaveCtrlSet                            69
     ZDApp_LeaveCtrlReset                          55
     ZDApp_LeaveCtrlBypass                         25
     ZDApp_LeaveCtrlStartup                        72
     ZDApp_LeaveReset                              23
     ZDApp_LeaveUpdate                            151
     ZDApp_NetworkDiscoveryReq                     32
     ZDApp_JoinReq                                 96
     ZDApp_DeviceConfigured                       101
     ZDApp_SendEventMsg                            34
     ZDApp_SendMsg                                113
     ZDO_NetworkDiscoveryConfirmCB                 98
     ZDO_NetworkFormationConfirmCB                 71
     ZDO_beaconNotifyIndCB                        837
     ZDO_StartRouterConfirmCB                      45
     ZDO_JoinConfirmCB                            147
     ZDO_AddrChangeIndicationCB                   157
     ZDO_JoinIndicationCB                          60
     ZDO_ConcentratorIndicationCB                  99
     ZDO_LeaveCnf                                  92
     ZDO_LeaveInd                                 206
     ZDO_SyncIndicationCB                          41
     ZDO_ManytoOneFailureIndicationCB
                                                   14
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                         35
     ZDO_UpdateDeviceIndication                     7
     ZDApp_InMsgCB                                150
     ZDApp_ChangeMatchDescRespPermission
                                                   21
     ZDApp_NetworkInit                             50
     ZDApp_NwkStateUpdateCB                        35
     ZDApp_NodeProfileSync                         53
     ZDApp_StartJoiningCycle                       46
     ZDApp_StopJoiningCycle                        39
     ZDApp_AnnounceNewAddress                      72
     ZDApp_NVUpdate                                28
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               99
     ZDApp_InitZdoCBFunc                           64
     ZDO_RegisterForZdoCB                          65
     ZDO_DeregisterForZdoCB                        67
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_0                                   4
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlReset?relay                   6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_NetworkDiscoveryReq?relay              6
     ??ZDApp_JoinReq?relay                          6
     ??ZDApp_DeviceConfigured?relay                 6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_beaconNotifyIndCB?relay                  6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDApp_InitZdoCBFunc?relay                    6
     ??ZDO_RegisterForZdoCB?relay                   6
     ??ZDO_DeregisterForZdoCB?relay                 6

 
 7 068 bytes in segment BANKED_CODE
   384 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    10 bytes in segment XDATA_I
    10 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    56 bytes in segment XDATA_Z
 
 7 462 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    66 bytes of XDATA memory

Errors: none
Warnings: none
