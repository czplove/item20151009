###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         10/Feb/2015  23:47:40 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\sta #
#                          ck\zdo\ZDApp.c                                     #
#    Command line       =  -f "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\z #
#                          stack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wRouter.cfg" (-DCPU32MHZ                  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC253 #
#                          0DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=1         #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=60            #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=30           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=4 -DASSERT_RESET         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=8000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=1000)  #
#                          -DREJOIN_POLL_RATE=440 "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Components\stack\zdo\ZDApp.c" -D         #
#                          NV_INIT -D NV_RESTORE -D HOLD_AUTO_START -D        #
#                          MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC -D           #
#                          MT_ZDO_FUNC -D MT_ZDO_MGMT -D ISR_KEYINTERRUPT -D  #
#                          WDT_IN_PM1 -D OSC32K_CRYSTAL_INSTALLED=0 -D        #
#                          xLARGER_NETWORK -D xNO_32768_XOSC -D POWER_PA -D   #
#                          xEN_WALL_SOKET -D LN_1_SCEEN_1 -lC                 #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\LN_1_SCEEN_1_ROUTER\ #
#                          List\" -lA "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Pr #
#                          ojects\zstack\Samples\SampleApp\CC2530DB\LN_1_SCEE #
#                          N_1_ROUTER\List\" --diag_suppress Pe001,Pa010 -o   #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\LN_1_SCEEN_1_ROUTER\ #
#                          Obj\" -e --no_cse --no_unroll --no_inline          #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\RE_1_2_0_FORMAL_APP(25 #
#                          1)-14-12-8\Projects\zstack\Samples\SampleApp\CC253 #
#                          0DB\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\Source\" #
#                           -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\..\Source\LN_1_S #
#                          CEEN_1_device\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14 #
#                          -12-8\Projects\zstack\Samples\SampleApp\CC2530DB\. #
#                          .\..\..\ZMain\TI2530DB\" -I                        #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\include\" -I "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\Components\hal\target\CC2530EB\" #
#                           -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\C #
#                          omponents\mac\include\" -I                         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\high_level\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\" -I                     #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\single_chip\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mt\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8 #
#                          \Projects\zstack\Samples\SampleApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\osal\include\" -I              #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\saddr\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\sdata\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\af\" -I "D:\RE_1_2_0_FORMAL_APP(251)-1 #
#                          4-12-8\Projects\zstack\Samples\SampleApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\nwk\" -I           #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sapi\" -I "D:\RE_1_2_0_FORMAL_APP(251) #
#                          -14-12-8\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\Components\stack\sec\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sys\" -I "D:\RE_1_2_0_FORMAL_APP(251)- #
#                          14-12-8\Projects\zstack\Samples\SampleApp\CC2530DB #
#                          \..\..\..\..\..\Components\stack\zdo\" -I          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\zmac\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12 #
#                          -8\Projects\zstack\Samples\SampleApp\CC2530DB\..\. #
#                          .\..\..\..\Components\zmac\f8w\" -On               #
#                          --require_prototypes                               #
#    List file          =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\LN_1_SCEEN_1_ROUTER\L #
#                          ist\ZDApp.lst                                      #
#    Object file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\LN_1_SCEEN_1_ROUTER\O #
#                          bj\ZDApp.r51                                       #
#                                                                             #
#                                                                             #
###############################################################################

D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2012-02-16 16:04:32 -0800 (Thu, 16 Feb 2012) $
      4            Revision:       $Revision: 29348 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the user can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "ZMac.h"
     47          #include "OSAL.h"
     48          #include "OSAL_Tasks.h"
     49          #include "OSAL_PwrMgr.h"
     50          #include "OSAL_Nv.h"
     51          #include "AF.h"
     52          #include "APSMEDE.h"
     53          #include "NLMEDE.h"
     54          #include "AddrMgr.h"
     55          #include "ZDProfile.h"
     56          #include "ZDObject.h"
     57          #include "ZDConfig.h"
     58          #include "ZDSecMgr.h"
     59          #include "ZDApp.h"
     60          #include "DebugTrace.h"
     61          #include "nwk_util.h"
     62          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa0
   \   union <unnamed> volatile __sfr _A_P2
   \                     _A_P2:
   \   000000                DS 1
     63          #include "ZGlobals.h"
     64          #include "ZDNwkMgr.h"
     65          #include "rtg.h"
     66          
     67          #include "ssp.h"
     68          
     69          /* HAL */
     70          #include "hal_led.h"
     71          #include "hal_lcd.h"
     72          #include "hal_key.h"
     73          //#include "my_time.h"
     74          #include "MT_UART.h"
     75          #include "ZDO_LIB.h"
     76          #include "common_device.h"
     77          
     78          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     79            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     80          #endif
     81          
     82          /*********************************************************************
     83           * CONSTANTS
     84           */
     85          
     86          #if !defined( NWK_START_DELAY )
     87            #define NWK_START_DELAY             100   // in milliseconds
     88          #endif
     89          
     90          #if !defined( LEAVE_RESET_DELAY )
     91            #define LEAVE_RESET_DELAY           5000  // in milliseconds
     92          #endif
     93          
     94          // Init ZDO, but hold and wait for application to start the joining or
     95          // forming network
     96          #define ZDO_INIT_HOLD_NWK_START       0xFFFF
     97          
     98          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     99            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
    100          #endif
    101          
    102          #if !defined( BEACON_REQUEST_DELAY )
    103            #define BEACON_REQUEST_DELAY        100   // in milliseconds
    104          #endif
    105          
    106          #if !defined( BEACON_REQ_DELAY_MASK )
    107            #define BEACON_REQ_DELAY_MASK       0x007F
    108          #endif
    109          
    110          #define MAX_RESUME_RETRY            3
    111          
    112          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    113          
    114          // Beacon Order Settings (see NLMEDE.h)
    115          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    116          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    117          
    118          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    119            // The number of times the frame counter can change before
    120            // saving to NV
    121            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    122          #endif
    123          
    124          // Leave control bits
    125          #define ZDAPP_LEAVE_CTRL_INIT 0
    126          #define ZDAPP_LEAVE_CTRL_SET  1
    127          #define ZDAPP_LEAVE_CTRL_RA   2
    128          
    129          // Address Manager Stub Implementation
    130          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    131          
    132          
    133          #if !defined ZDO_NV_SAVE_RFDs
    134          #define ZDO_NV_SAVE_RFDs  TRUE
    135          #endif
    136          
    137          // Delay time before updating NWK NV data to force fewer writes during high activity.
    138          #if ZDO_NV_SAVE_RFDs
    139          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    140          #else
    141          #define ZDAPP_UPDATE_NWK_NV_TIME 65000
    142          #endif
    143          
    144          /*********************************************************************
    145           * GLOBAL VARIABLES
    146           */
    147          
    148          #if defined( LCD_SUPPORTED )
    149            uint8 MatchRsps = 0;
    150          #endif
    151          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    152          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    155          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    161          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    162          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    163          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    164          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    165          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    166          
    167          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    168          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    169          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 14
   \   00000E                REQUIRE __INIT_XDATA_Z
    171          
    172          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    173             uint8 ZDO_FIRST_join_flag = 0; //¼ûNOTE
   \                     ZDO_FIRST_join_flag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    174                
    175                extern uint8  SampleApp_TaskID;
    176          
    177          
    178            
    179            
    180              void ZDO_DEVICE_DISC(void);
    181            
    182          /*********************************************************************
    183           * EXTERNAL VARIABLES
    184           */
    185          
    186          /*********************************************************************
    187           * EXTERNAL FUNCTIONS
    188           */
    189          
    190          /*********************************************************************
    191           * LOCAL FUNCTIONS
    192           */
    193          
    194          void ZDApp_NetworkStartEvt( void );
    195          void ZDApp_DeviceAuthEvt( void );
    196          void ZDApp_SaveNetworkStateEvt( void );
    197          
    198          uint8 ZDApp_ReadNetworkRestoreState( void );
    199          uint8 ZDApp_RestoreNetworkState( void );
    200          void ZDAppDetermineDeviceType( void );
    201          void ZDApp_InitUserDesc( void );
    202          void ZDAppCheckForHoldKey( void );
    203          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    204          void ZDApp_ProcessNetworkJoin( void );
    205          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    206          uint8 ZDApp_RestoreNwkKey( void );
    207          networkDesc_t* ZDApp_NwkDescListProcessing(void);
    208          
    209          void ZDApp_SecInit( uint8 state );
    210          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    211          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    212          
    213          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    214          
    215          void ZDApp_ResetTimerStart( uint16 delay );
    216          void ZDApp_ResetTimerCancel( void );
    217          void ZDApp_LeaveCtrlInit( void );
    218          void ZDApp_LeaveCtrlSet( uint8 ra );
    219          uint8 ZDApp_LeaveCtrlBypass( void );
    220          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    221          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    222                                  uint8 removeChildren );
    223          void ZDApp_NodeProfileSync( uint8 stackProfile );
    224          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    225          void ZDApp_RegisterCBs( void );
    226          void ZDApp_InitZdoCBFunc(void);
    227          
    228          /*********************************************************************
    229           * LOCAL VARIABLES
    230           */
    231          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    232          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    233          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    234          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    235          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    236          
    237          #if defined( HOLD_AUTO_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    238            devStates_t devState = DEV_HOLD;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    239          #else
    240            devStates_t devState = DEV_INIT;
    241          #endif
    242          
    243          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    244            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    245            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    246                                  // to parent. Set to make the device do an Orphan scan.
    247          #else
    248            // Set the default to coodinator
    249            devStartModes_t devStartMode = MODE_HARD;
    250          #endif
    251          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    252          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    253          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    254          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    255          {
    256            ZDO_EP,
    257            &ZDAppTaskID,
    258            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    259            (afNetworkLatencyReq_t)0            // No Network Latency req
    260          };
    261          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    262          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    263          
    264          /*********************************************************************
    265           * @fn      ZDApp_Init
    266           *
    267           * @brief   ZDApp Initialization function.
    268           *
    269           * @param   task_id - ZDApp Task ID
    270           *
    271           * @return  None
    272           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    273          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    274          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    275            // Save the task ID
    276            ZDAppTaskID = task_id;
   \   000007   90....       MOV     DPTR,#ZDAppTaskID
   \   00000A   F0           MOVX    @DPTR,A
    277          
    278            // Initialize the ZDO global device short address storage
    279            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000B   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000E   7402         MOV     A,#0x2
   \   000010   F0           MOVX    @DPTR,A
    280            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000011   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000014   74FE         MOV     A,#-0x2
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   74FF         MOV     A,#-0x1
   \   00001A   F0           MOVX    @DPTR,A
    281            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001B                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001B   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00001E   8A..         MOV     ?V0 + 2,R2
   \   000020   8B..         MOV     ?V0 + 3,R3
   \   000022   85....       MOV     ?V0 + 0,?V0 + 2
   \   000025   85....       MOV     ?V0 + 1,?V0 + 3
    282          
    283            // Check for manual "Hold Auto Start"
    284            ZDAppCheckForHoldKey();
   \   000028                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   000028   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    285          
    286            // Initialize ZDO items and setup the device - type of device to create.
    287            ZDO_Init();
   \   00002B                ; Setup parameters for call to function ZDO_Init
   \   00002B   12....       LCALL   ??ZDO_Init?relay
    288          
    289            // Register the endpoint description with the AF
    290            // This task doesn't have a Simple description, but we still need
    291            // to register the endpoint.
    292            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   00002E                ; Setup parameters for call to function afRegister
   \   00002E   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000030   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000032   12....       LCALL   ??afRegister?relay
   \   000035   E9           MOV     A,R1
    293          
    294          #if defined( ZDO_USERDESC_RESPONSE )
    295            ZDApp_InitUserDesc();
   \   000036                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000036   12....       LCALL   ??ZDApp_InitUserDesc?relay
    296          #endif // ZDO_USERDESC_RESPONSE
    297          
    298            // Start the device?
    299            if ( devState != DEV_HOLD )
   \   000039   90....       MOV     DPTR,#devState
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   600A         JZ      ??ZDApp_Init_0
    300            {
    301              ZDOInitDevice( 0 );
   \   00003F                ; Setup parameters for call to function ZDOInitDevice
   \   00003F   7A00         MOV     R2,#0x0
   \   000041   7B00         MOV     R3,#0x0
   \   000043   12....       LCALL   ??ZDOInitDevice?relay
   \   000046   E9           MOV     A,R1
   \   000047   800C         SJMP    ??ZDApp_Init_1
    302            }
    303            else
    304            {
    305              ZDOInitDevice( ZDO_INIT_HOLD_NWK_START );
   \                     ??ZDApp_Init_0:
   \   000049                ; Setup parameters for call to function ZDOInitDevice
   \   000049   7AFF         MOV     R2,#-0x1
   \   00004B   7BFF         MOV     R3,#-0x1
   \   00004D   12....       LCALL   ??ZDOInitDevice?relay
   \   000050   E9           MOV     A,R1
    306              // Blink LED to indicate HOLD_START
    307             // HalLedBlink ( HAL_LED_4, 0, 50, 500 );
    308              HAL_TURN_OFF_LED1();
   \   000051   D2A0         SETB    0xa0.0
    309              HAL_TURN_OFF_LED2();
   \   000053   C294         CLR     0x90.4
    310              #if defined ( POWER_SAVING )
    311               osal_pwrmgr_device( PWRMGR_BATTERY );
    312              #endif
    313               
    314            }
    315          
    316            // Initialize the ZDO callback function pointers zdoCBFunc[]
    317            ZDApp_InitZdoCBFunc();
   \                     ??ZDApp_Init_1:
   \   000055                ; Setup parameters for call to function ZDApp_InitZdoCBFunc
   \   000055   12....       LCALL   ??ZDApp_InitZdoCBFunc?relay
    318          
    319            ZDApp_RegisterCBs();
   \   000058                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000058   12....       LCALL   ??ZDApp_RegisterCBs?relay
    320          } /* ZDApp_Init() */
   \   00005B   7F04         MOV     R7,#0x4
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000060                REQUIRE _A_P2
   \   000060                REQUIRE _A_P1
    321          
    322          /*********************************************************************
    323           * @fn          ZDApp_SecInit
    324           *
    325           * @brief       ZDApp initialize security.
    326           *
    327           * @param       state - device initialization state
    328           *
    329           * @return      none
    330           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    331          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    332          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    333            uint8 zgPreConfigKey[SEC_KEY_LEN];
    334          
    335            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    336            {
    337              // Set the Trust Center bit
    338              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    339            }
    340          
    341            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    342            {
    343              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    344            }
    345          
    346            // Initialize ZigBee Device Security Manager
    347            ZDSecMgrInit(state);
   \   00000C                ; Setup parameters for call to function ZDSecMgrInit
   \   00000C   EE           MOV     A,R6
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??ZDSecMgrInit?relay
    348          
    349            if ( ZG_SECURE_ENABLED )
    350            {
    351              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
   \   000011   EE           MOV     A,R6
   \   000012   6059         JZ      ??ZDApp_SecInit_0
    352              {
    353                nwkFrameCounter = 0;
   \   000014   90....       MOV     DPTR,#__Constant_0
   \   000017   12....       LCALL   ?XLOAD_R2345
   \   00001A   90....       MOV     DPTR,#nwkFrameCounter
   \   00001D   12....       LCALL   ?XSTORE_R2345
    354          
    355                if( _NIB.nwkKeyLoaded == FALSE )
   \   000020   90....       MOV     DPTR,#_NIB + 61
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7047         JNZ     ??ZDApp_SecInit_0
    356                {
    357                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    358                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
   \   000026   90....       MOV     DPTR,#zgSecurityMode
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   6401         XRL     A,#0x1
   \   00002C   703F         JNZ     ??ZDApp_SecInit_0
   \   00002E   90....       MOV     DPTR,#zgPreConfigKeys
   \   000031   E0           MOVX    A,@DPTR
   \   000032   6039         JZ      ??ZDApp_SecInit_0
    359                  {
    360                      ZDSecMgrReadKeyFromNv(ZCD_NV_PRECFGKEY, zgPreConfigKey);
   \   000034                ; Setup parameters for call to function ZDSecMgrReadKeyFromNv
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A62         MOV     R2,#0x62
   \   000040   7B00         MOV     R3,#0x0
   \   000042   12....       LCALL   ??ZDSecMgrReadKeyFromNv?relay
   \   000045   E9           MOV     A,R1
    361                      SSP_UpdateNwkKey( zgPreConfigKey, 0);
   \   000046                ; Setup parameters for call to function SSP_UpdateNwkKey
   \   000046   7900         MOV     R1,#0x0
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   AA82         MOV     R2,DPL
   \   000050   AB83         MOV     R3,DPH
   \   000052   12....       LCALL   ??SSP_UpdateNwkKey?relay
    362                      SSP_SwitchNwkKey( 0 );
   \   000055                ; Setup parameters for call to function SSP_SwitchNwkKey
   \   000055   7900         MOV     R1,#0x0
   \   000057   12....       LCALL   ??SSP_SwitchNwkKey?relay
    363          
    364                      // clear local copy of key
    365                      osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
   \   00005A                ; Setup parameters for call to function osal_memset
   \   00005A   7C10         MOV     R4,#0x10
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   7900         MOV     R1,#0x0
   \   000060   85..82       MOV     DPL,?XSP + 0
   \   000063   85..83       MOV     DPH,?XSP + 1
   \   000066   AA82         MOV     R2,DPL
   \   000068   AB83         MOV     R3,DPH
   \   00006A   12....       LCALL   ??osal_memset?relay
    366                  }
    367                }
    368              }
    369            }
    370          }
   \                     ??ZDApp_SecInit_0:
   \   00006D   7410         MOV     A,#0x10
   \   00006F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000072   7F01         MOV     R7,#0x1
   \   000074   02....       LJMP    ?BANKED_LEAVE_XDATA
    371          
    372          /*********************************************************************
    373           * @fn      ZDApp_event_loop()
    374           *
    375           * @brief   Main event loop for Zigbee device objects task. This function
    376           *          should be called at periodic intervals.
    377           *
    378           * @param   task_id - Task ID
    379           * @param   events  - Bitmap of events
    380           *
    381           * @return  none
    382           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    383          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    384          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    385            uint8 *msg_ptr;
    386          
    387            if ( events & SYS_EVENT_MSG )
   \   00000B   EE           MOV     A,R6
   \   00000C   5400         ANL     A,#0x0
   \   00000E   F8           MOV     R0,A
   \   00000F   EF           MOV     A,R7
   \   000010   5480         ANL     A,#0x80
   \   000012   F9           MOV     R1,A
   \   000013   E8           MOV     A,R0
   \   000014   49           ORL     A,R1
   \   000015   6034         JZ      ??ZDApp_event_loop_0
    388            {
    389              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
   \                     ??ZDApp_event_loop_1:
   \   000017                ; Setup parameters for call to function osal_msg_receive
   \   000017   90....       MOV     DPTR,#ZDAppTaskID
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??osal_msg_receive?relay
   \   00001F   8A..         MOV     ?V0 + 4,R2
   \   000021   8B..         MOV     ?V0 + 5,R3
   \   000023   A8..         MOV     R0,?V0 + 4
   \   000025   A9..         MOV     R1,?V0 + 5
   \   000027   88..         MOV     ?V0 + 2,R0
   \   000029   89..         MOV     ?V0 + 3,R1
   \   00002B   E8           MOV     A,R0
   \   00002C   49           ORL     A,R1
   \   00002D   6011         JZ      ??ZDApp_event_loop_2
    390              {
    391                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
   \   00002F                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00002F   AA..         MOV     R2,?V0 + 2
   \   000031   AB..         MOV     R3,?V0 + 3
   \   000033   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
    392          
    393                // Release the memory
    394                osal_msg_deallocate( msg_ptr );
   \   000036                ; Setup parameters for call to function osal_msg_deallocate
   \   000036   AA..         MOV     R2,?V0 + 2
   \   000038   AB..         MOV     R3,?V0 + 3
   \   00003A   12....       LCALL   ??osal_msg_deallocate?relay
   \   00003D   E9           MOV     A,R1
   \   00003E   80D7         SJMP    ??ZDApp_event_loop_1
    395              }
    396          
    397              // Return unprocessed events
    398              return (events ^ SYS_EVENT_MSG);
   \                     ??ZDApp_event_loop_2:
   \   000040   EE           MOV     A,R6
   \   000041   6400         XRL     A,#0x0
   \   000043   FA           MOV     R2,A
   \   000044   EF           MOV     A,R7
   \   000045   6480         XRL     A,#0x80
   \   000047   FB           MOV     R3,A
   \   000048   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    399            }
    400          
    401            if ( events & ZDO_NETWORK_INIT )
   \                     ??ZDApp_event_loop_0:
   \   00004B   EE           MOV     A,R6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   5051         JNC     ??ZDApp_event_loop_4
    402            {
    403              // Initialize apps and start the network
    404              
    405            if(zdoDiscCounter<10)
   \   000050   90....       MOV     DPTR,#zdoDiscCounter
   \   000053   E0           MOVX    A,@DPTR
   \   000054   C3           CLR     C
   \   000055   940A         SUBB    A,#0xa
   \   000057   5003         JNC     ??ZDApp_event_loop_5
    406            {  
    407              // HalLedBlink ( HAL_LED_1, 1, 30, 1000 );
    408                  USER_ZDO_JOINING_MSG();
   \   000059                ; Setup parameters for call to function USER_ZDO_JOINING_MSG
   \   000059   12....       LCALL   ??USER_ZDO_JOINING_MSG?relay
    409            } 
    410            
    411              devState = DEV_INIT;
   \                     ??ZDApp_event_loop_5:
   \   00005C   90....       MOV     DPTR,#devState
   \   00005F   7401         MOV     A,#0x1
   \   000061   F0           MOVX    @DPTR,A
    412              
    413              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000062                ; Setup parameters for call to function osal_set_event
   \   000062   7A10         MOV     R2,#0x10
   \   000064   7B00         MOV     R3,#0x0
   \   000066   90....       MOV     DPTR,#ZDAppTaskID
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F9           MOV     R1,A
   \   00006B   12....       LCALL   ??osal_set_event?relay
   \   00006E   E9           MOV     A,R1
    414          
    415              
    416               if( (devStartMode == MODE_HARD) || (devStartMode == MODE_JOIN))
   \   00006F   90....       MOV     DPTR,#devStartMode
   \   000072   E0           MOVX    A,@DPTR
   \   000073   6402         XRL     A,#0x2
   \   000075   6006         JZ      ??ZDApp_event_loop_6
   \   000077   90....       MOV     DPTR,#devStartMode
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   7006         JNZ     ??ZDApp_event_loop_7
    417             {
    418               ZDO_FIRST_join_flag = 1;
   \                     ??ZDApp_event_loop_6:
   \   00007D   90....       MOV     DPTR,#ZDO_FIRST_join_flag
   \   000080   7401         MOV     A,#0x1
   \   000082   F0           MOVX    @DPTR,A
    419             }
    420              
    421              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    422                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \                     ??ZDApp_event_loop_7:
   \   000083                ; Setup parameters for call to function ZDO_StartDevice
   \   000083   7C0F         MOV     R4,#0xf
   \   000085   7B0F         MOV     R3,#0xf
   \   000087   90....       MOV     DPTR,#devStartMode
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   FA           MOV     R2,A
   \   00008C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   5407         ANL     A,#0x7
   \   000092   F9           MOV     R1,A
   \   000093   12....       LCALL   ??ZDO_StartDevice?relay
    423          
    424              // Return unprocessed events
    425              return (events ^ ZDO_NETWORK_INIT);
   \   000096   EE           MOV     A,R6
   \   000097   6401         XRL     A,#0x1
   \   000099   FA           MOV     R2,A
   \   00009A   EF           MOV     A,R7
   \   00009B   6400         XRL     A,#0x0
   \   00009D   FB           MOV     R3,A
   \   00009E   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    426            }
    427            
    428          
    429             if ( events & ZDO_ENDDIVCE_DISC )
   \                     ??ZDApp_event_loop_4:
   \   0000A1   EE           MOV     A,R6
   \   0000A2   5400         ANL     A,#0x0
   \   0000A4   F8           MOV     R0,A
   \   0000A5   EF           MOV     A,R7
   \   0000A6   5420         ANL     A,#0x20
   \   0000A8   F9           MOV     R1,A
   \   0000A9   E8           MOV     A,R0
   \   0000AA   49           ORL     A,R1
   \   0000AB   600E         JZ      ??ZDApp_event_loop_8
    430            
    431             { 
    432              ZDO_DEVICE_DISC();     
   \   0000AD                ; Setup parameters for call to function ZDO_DEVICE_DISC
   \   0000AD   12....       LCALL   ??ZDO_DEVICE_DISC?relay
    433              return (events ^ ZDO_ENDDIVCE_DISC);
   \   0000B0   EE           MOV     A,R6
   \   0000B1   6400         XRL     A,#0x0
   \   0000B3   FA           MOV     R2,A
   \   0000B4   EF           MOV     A,R7
   \   0000B5   6420         XRL     A,#0x20
   \   0000B7   FB           MOV     R3,A
   \   0000B8   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    434            }
    435            
    436             if ( events & ZDO_ENDDIVCE_REJOIN )
   \                     ??ZDApp_event_loop_8:
   \   0000BB   EE           MOV     A,R6
   \   0000BC   5400         ANL     A,#0x0
   \   0000BE   F8           MOV     R0,A
   \   0000BF   EF           MOV     A,R7
   \   0000C0   5440         ANL     A,#0x40
   \   0000C2   F9           MOV     R1,A
   \   0000C3   E8           MOV     A,R0
   \   0000C4   49           ORL     A,R1
   \   0000C5   601E         JZ      ??ZDApp_event_loop_9
    437            {
    438              if((devState ==DEV_NWK_REJOIN)|| (devState ==DEV_NWK_DISC))
   \   0000C7   90....       MOV     DPTR,#devState
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   6404         XRL     A,#0x4
   \   0000CD   6008         JZ      ??ZDApp_event_loop_10
   \   0000CF   90....       MOV     DPTR,#devState
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   6402         XRL     A,#0x2
   \   0000D5   7003         JNZ     ??ZDApp_event_loop_11
    439              {
    440                ZDO_ACK_DEAL_WITH();
   \                     ??ZDApp_event_loop_10:
   \   0000D7                ; Setup parameters for call to function ZDO_ACK_DEAL_WITH
   \   0000D7   12....       LCALL   ??ZDO_ACK_DEAL_WITH?relay
    441              }
    442              
    443             return (events ^ ZDO_ENDDIVCE_REJOIN);
   \                     ??ZDApp_event_loop_11:
   \   0000DA   EE           MOV     A,R6
   \   0000DB   6400         XRL     A,#0x0
   \   0000DD   FA           MOV     R2,A
   \   0000DE   EF           MOV     A,R7
   \   0000DF   6440         XRL     A,#0x40
   \   0000E1   FB           MOV     R3,A
   \   0000E2   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    444            }
    445            
    446          
    447          
    448            
    449          
    450            if ( ZSTACK_ROUTER_BUILD )
    451            {
    452              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_9:
   \   0000E5   EE           MOV     A,R6
   \   0000E6   5402         ANL     A,#0x2
   \   0000E8   600E         JZ      ??ZDApp_event_loop_12
    453              {
    454                ZDApp_NetworkStartEvt();
   \   0000EA                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   0000EA   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    455          
    456                // Return unprocessed events
    457                return (events ^ ZDO_NETWORK_START);
   \   0000ED   EE           MOV     A,R6
   \   0000EE   6402         XRL     A,#0x2
   \   0000F0   FA           MOV     R2,A
   \   0000F1   EF           MOV     A,R7
   \   0000F2   6400         XRL     A,#0x0
   \   0000F4   FB           MOV     R3,A
   \   0000F5   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    458              }
    459          
    460              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_12:
   \   0000F8   EE           MOV     A,R6
   \   0000F9   5420         ANL     A,#0x20
   \   0000FB   6030         JZ      ??ZDApp_event_loop_13
    461              {
    462                if ( nwkStatus == ZSuccess )
   \   0000FD   90....       MOV     DPTR,#nwkStatus
   \   000100   E0           MOVX    A,@DPTR
   \   000101   7013         JNZ     ??ZDApp_event_loop_14
    463                {
    464                  if ( devState == DEV_END_DEVICE )
   \   000103   90....       MOV     DPTR,#devState
   \   000106   E0           MOVX    A,@DPTR
   \   000107   6406         XRL     A,#0x6
   \   000109   7006         JNZ     ??ZDApp_event_loop_15
    465                    devState = DEV_ROUTER;
   \   00010B   90....       MOV     DPTR,#devState
   \   00010E   7407         MOV     A,#0x7
   \   000110   F0           MOVX    @DPTR,A
    466          
    467                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_15:
   \   000111                ; Setup parameters for call to function osal_pwrmgr_device
   \   000111   7900         MOV     R1,#0x0
   \   000113   12....       LCALL   ??osal_pwrmgr_device?relay
    468                }
    469                else
    470                {
    471                  // remain as end device!!
    472                }
    473                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_14:
   \   000116                ; Setup parameters for call to function osal_set_event
   \   000116   7A10         MOV     R2,#0x10
   \   000118   7B00         MOV     R3,#0x0
   \   00011A   90....       MOV     DPTR,#ZDAppTaskID
   \   00011D   E0           MOVX    A,@DPTR
   \   00011E   F9           MOV     R1,A
   \   00011F   12....       LCALL   ??osal_set_event?relay
   \   000122   E9           MOV     A,R1
    474          
    475                // Return unprocessed events
    476                return (events ^ ZDO_ROUTER_START);
   \   000123   EE           MOV     A,R6
   \   000124   6420         XRL     A,#0x20
   \   000126   FA           MOV     R2,A
   \   000127   EF           MOV     A,R7
   \   000128   6400         XRL     A,#0x0
   \   00012A   FB           MOV     R3,A
   \   00012B   8071         SJMP    ??ZDApp_event_loop_3
    477              }
    478            }
    479          
    480            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_13:
   \   00012D   EE           MOV     A,R6
   \   00012E   5410         ANL     A,#0x10
   \   000130   602B         JZ      ??ZDApp_event_loop_16
    481            {
    482              ZDO_UpdateNwkStatus( devState );
   \   000132                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000132   90....       MOV     DPTR,#devState
   \   000135   E0           MOVX    A,@DPTR
   \   000136   F9           MOV     R1,A
   \   000137   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    483          
    484              // At start up, do one MTO route discovery if the device is a concentrator
    485              if ( zgConcentratorEnable == TRUE )
   \   00013A   90....       MOV     DPTR,#zgConcentratorEnable
   \   00013D   E0           MOVX    A,@DPTR
   \   00013E   6401         XRL     A,#0x1
   \   000140   7011         JNZ     ??ZDApp_event_loop_17
    486              {
    487                // Start next event
    488                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   000142                ; Setup parameters for call to function osal_start_timerEx
   \   000142   7C64         MOV     R4,#0x64
   \   000144   7D00         MOV     R5,#0x0
   \   000146   7A00         MOV     R2,#0x0
   \   000148   7B08         MOV     R3,#0x8
   \   00014A   90....       MOV     DPTR,#NWK_TaskID
   \   00014D   E0           MOVX    A,@DPTR
   \   00014E   F9           MOV     R1,A
   \   00014F   12....       LCALL   ??osal_start_timerEx?relay
   \   000152   E9           MOV     A,R1
    489              }
    490          
    491              // Return unprocessed events
    492              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??ZDApp_event_loop_17:
   \   000153   EE           MOV     A,R6
   \   000154   6410         XRL     A,#0x10
   \   000156   FA           MOV     R2,A
   \   000157   EF           MOV     A,R7
   \   000158   6400         XRL     A,#0x0
   \   00015A   FB           MOV     R3,A
   \   00015B   8041         SJMP    ??ZDApp_event_loop_3
    493            }
    494          
    495            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_16:
   \   00015D   EE           MOV     A,R6
   \   00015E   5408         ANL     A,#0x8
   \   000160   600A         JZ      ??ZDApp_event_loop_18
    496            {
    497              // User defined logic
    498          
    499              // Return unprocessed events
    500              return (events ^ ZDO_COMMAND_CNF);
   \   000162   EE           MOV     A,R6
   \   000163   6408         XRL     A,#0x8
   \   000165   FA           MOV     R2,A
   \   000166   EF           MOV     A,R7
   \   000167   6400         XRL     A,#0x0
   \   000169   FB           MOV     R3,A
   \   00016A   8032         SJMP    ??ZDApp_event_loop_3
    501            }
    502          
    503            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_18:
   \   00016C   EE           MOV     A,R6
   \   00016D   5400         ANL     A,#0x0
   \   00016F   F8           MOV     R0,A
   \   000170   EF           MOV     A,R7
   \   000171   5402         ANL     A,#0x2
   \   000173   F9           MOV     R1,A
   \   000174   E8           MOV     A,R0
   \   000175   49           ORL     A,R1
   \   000176   600D         JZ      ??ZDApp_event_loop_19
    504            {
    505              ZDApp_SaveNetworkStateEvt();
   \   000178                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   000178   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    506          
    507              // Return unprocessed events
    508              return (events ^ ZDO_NWK_UPDATE_NV);
   \   00017B   EE           MOV     A,R6
   \   00017C   6400         XRL     A,#0x0
   \   00017E   FA           MOV     R2,A
   \   00017F   EF           MOV     A,R7
   \   000180   6402         XRL     A,#0x2
   \   000182   FB           MOV     R3,A
   \   000183   8019         SJMP    ??ZDApp_event_loop_3
    509            }
    510          
    511            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_19:
   \   000185   EE           MOV     A,R6
   \   000186   5404         ANL     A,#0x4
   \   000188   600B         JZ      ??ZDApp_event_loop_20
    512            {
    513          #ifdef ZBA_FALLBACK_NWKKEY
    514              if ( devState == DEV_END_DEVICE_UNAUTH )
    515              {
    516                ZDSecMgrFallbackNwkKey();
    517              }
    518              else
    519          #endif
    520              {
    521                // Set the NV startup option to force a "new" join.
    522                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   00018A                ; Setup parameters for call to function zgWriteStartupOptions
   \   00018A   7A02         MOV     R2,#0x2
   \   00018C   79FF         MOV     R1,#-0x1
   \   00018E   12....       LCALL   ??zgWriteStartupOptions?relay
   \   000191   E9           MOV     A,R1
    523          
    524                // The device has been in the UNAUTH state, so reset
    525                // Note: there will be no return from this call
    526                SystemResetSoft();
   \   000192                ; Setup parameters for call to function Onboard_soft_reset
   \   000192   12....       LCALL   Onboard_soft_reset & 0xFFFF
    527              }
    528            }
    529          
    530            if ( ZG_SECURE_ENABLED )
    531            {
    532              return ( ZDApp_ProcessSecEvent( task_id, events ) );
   \                     ??ZDApp_event_loop_20:
   \   000195                ; Setup parameters for call to function ZDApp_ProcessSecEvent
   \   000195   EE           MOV     A,R6
   \   000196   FA           MOV     R2,A
   \   000197   EF           MOV     A,R7
   \   000198   FB           MOV     R3,A
   \   000199   A9..         MOV     R1,?V0 + 0
   \   00019B   12....       LCALL   ??ZDApp_ProcessSecEvent?relay
   \                     ??ZDApp_event_loop_3:
   \   00019E   7F06         MOV     R7,#0x6
   \   0001A0   02....       LJMP    ?BANKED_LEAVE_XDATA
    533            }
    534            else
    535            {
    536              // Discard or make more handlers
    537              return 0;
    538            }
    539          }
    540          
    541          /*********************************************************************
    542           * @fn      ZDApp_ProcessSecEvent()
    543           *
    544           * @brief   Process incoming security events.
    545           *
    546           * @param   task_id - Task ID
    547           * @param   events  - Bitmap of events
    548           *
    549           * @return  none
    550           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    551          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    552          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    553            (void)task_id;  // Intentionally unreferenced parameter
    554          
    555            if ( ZSTACK_ROUTER_BUILD )
    556            {
    557              if ( events & ZDO_NEW_DEVICE )
   \   00000B   EE           MOV     A,R6
   \   00000C   5440         ANL     A,#0x40
   \   00000E   6024         JZ      ??ZDApp_ProcessSecEvent_0
    558              {
    559                // process the new device event
    560                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   000010                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   000010   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000013   E9           MOV     A,R1
   \   000014   6401         XRL     A,#0x1
   \   000016   7011         JNZ     ??ZDApp_ProcessSecEvent_1
    561                {
    562                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000018                ; Setup parameters for call to function osal_start_timerEx
   \   000018   7CE8         MOV     R4,#-0x18
   \   00001A   7D03         MOV     R5,#0x3
   \   00001C   7A40         MOV     R2,#0x40
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   90....       MOV     DPTR,#ZDAppTaskID
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   12....       LCALL   ??osal_start_timerEx?relay
   \   000028   E9           MOV     A,R1
    563                }
    564          
    565                // Return unprocessed events
    566                return (events ^ ZDO_NEW_DEVICE);
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000029   EE           MOV     A,R6
   \   00002A   6440         XRL     A,#0x40
   \   00002C   FA           MOV     R2,A
   \   00002D   EF           MOV     A,R7
   \   00002E   6400         XRL     A,#0x0
   \   000030   FB           MOV     R3,A
   \   000031   02....       LJMP    ??ZDApp_ProcessSecEvent_2 & 0xFFFF
    567              }
    568            }
    569          
    570            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    571                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    572            {
    573              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    574              {
    575                if ( events & ZDO_SECMGR_EVENT )
    576                {
    577                  ZDSecMgrEvent();
    578          
    579                  // Return unprocessed events
    580                  return (events ^ ZDO_SECMGR_EVENT);
    581                }
    582              }
    583            }
    584          
    585            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000034   EE           MOV     A,R6
   \   000035   5480         ANL     A,#0x80
   \   000037   600D         JZ      ??ZDApp_ProcessSecEvent_3
    586            {
    587              ZDApp_DeviceAuthEvt();
   \   000039                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   000039   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    588          
    589              // Return unprocessed events
    590              return (events ^ ZDO_DEVICE_AUTH);
   \   00003C   EE           MOV     A,R6
   \   00003D   6480         XRL     A,#0x80
   \   00003F   FA           MOV     R2,A
   \   000040   EF           MOV     A,R7
   \   000041   6400         XRL     A,#0x0
   \   000043   FB           MOV     R3,A
   \   000044   8070         SJMP    ??ZDApp_ProcessSecEvent_2
    591            }
    592          
    593            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000046   EE           MOV     A,R6
   \   000047   5400         ANL     A,#0x0
   \   000049   F8           MOV     R0,A
   \   00004A   EF           MOV     A,R7
   \   00004B   5404         ANL     A,#0x4
   \   00004D   F9           MOV     R1,A
   \   00004E   E8           MOV     A,R0
   \   00004F   49           ORL     A,R1
   \   000050   602E         JZ      ??ZDApp_ProcessSecEvent_4
    594            {
    595              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000052   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F8           MOV     R0,A
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   F9           MOV     R1,A
   \   00005A   E8           MOV     A,R0
   \   00005B   2401         ADD     A,#0x1
   \   00005D   FA           MOV     R2,A
   \   00005E   E9           MOV     A,R1
   \   00005F   3400         ADDC    A,#0x0
   \   000061   FB           MOV     R3,A
   \   000062   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000065   EA           MOV     A,R2
   \   000066   F0           MOVX    @DPTR,A
   \   000067   A3           INC     DPTR
   \   000068   EB           MOV     A,R3
   \   000069   F0           MOVX    @DPTR,A
   \   00006A   C3           CLR     C
   \   00006B   E8           MOV     A,R0
   \   00006C   94E9         SUBB    A,#-0x17
   \   00006E   E9           MOV     A,R1
   \   00006F   9403         SUBB    A,#0x3
   \   000071   4003         JC      ??ZDApp_ProcessSecEvent_5
    596              {
    597                ZDApp_SaveNwkKey();
   \   000073                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000073   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    598              }
    599          
    600              // Return unprocessed events
    601              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000076   EE           MOV     A,R6
   \   000077   6400         XRL     A,#0x0
   \   000079   FA           MOV     R2,A
   \   00007A   EF           MOV     A,R7
   \   00007B   6404         XRL     A,#0x4
   \   00007D   FB           MOV     R3,A
   \   00007E   8036         SJMP    ??ZDApp_ProcessSecEvent_2
    602            }
    603          
    604            if ( events & ZDO_APS_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   000080   EE           MOV     A,R6
   \   000081   5400         ANL     A,#0x0
   \   000083   F8           MOV     R0,A
   \   000084   EF           MOV     A,R7
   \   000085   5410         ANL     A,#0x10
   \   000087   F9           MOV     R1,A
   \   000088   E8           MOV     A,R0
   \   000089   49           ORL     A,R1
   \   00008A   600D         JZ      ??ZDApp_ProcessSecEvent_6
    605            {
    606          #if defined (NV_RESTORE)
    607              ZDSecMgrSaveApsLinkKey();
   \   00008C                ; Setup parameters for call to function ZDSecMgrSaveApsLinkKey
   \   00008C   12....       LCALL   ??ZDSecMgrSaveApsLinkKey?relay
    608          #endif // (NV_RESTORE)
    609          
    610              // Return unprocessed events
    611              return (events ^ ZDO_APS_FRAMECOUNTER_CHANGE);
   \   00008F   EE           MOV     A,R6
   \   000090   6400         XRL     A,#0x0
   \   000092   FA           MOV     R2,A
   \   000093   EF           MOV     A,R7
   \   000094   6410         XRL     A,#0x10
   \   000096   FB           MOV     R3,A
   \   000097   801D         SJMP    ??ZDApp_ProcessSecEvent_2
    612            }
    613          
    614            if ( events & ZDO_TCLK_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_6:
   \   000099   EE           MOV     A,R6
   \   00009A   5400         ANL     A,#0x0
   \   00009C   F8           MOV     R0,A
   \   00009D   EF           MOV     A,R7
   \   00009E   5408         ANL     A,#0x8
   \   0000A0   F9           MOV     R1,A
   \   0000A1   E8           MOV     A,R0
   \   0000A2   49           ORL     A,R1
   \   0000A3   600D         JZ      ??ZDApp_ProcessSecEvent_7
    615            {
    616              ZDSecMgrSaveTCLinkKey();
   \   0000A5                ; Setup parameters for call to function ZDSecMgrSaveTCLinkKey
   \   0000A5   12....       LCALL   ??ZDSecMgrSaveTCLinkKey?relay
    617          
    618              // Return unprocessed events
    619              return (events ^ ZDO_TCLK_FRAMECOUNTER_CHANGE);
   \   0000A8   EE           MOV     A,R6
   \   0000A9   6400         XRL     A,#0x0
   \   0000AB   FA           MOV     R2,A
   \   0000AC   EF           MOV     A,R7
   \   0000AD   6408         XRL     A,#0x8
   \   0000AF   FB           MOV     R3,A
   \   0000B0   8004         SJMP    ??ZDApp_ProcessSecEvent_2
    620            }
    621          
    622            // Discard or make more handlers
    623            return 0;
   \                     ??ZDApp_ProcessSecEvent_7:
   \   0000B2   7A00         MOV     R2,#0x0
   \   0000B4   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   0000B6   7F01         MOV     R7,#0x1
   \   0000B8   02....       LJMP    ?BANKED_LEAVE_XDATA
    624          }
    625          
    626          /*********************************************************************
    627           * Application Functions
    628           */
    629          
    630          /*********************************************************************
    631           * @fn      ZDOInitDevice
    632           *
    633           * @brief   Start the device in the network.  This function will read
    634           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    635           *   restore the network state of the device.
    636           *
    637           * @param   startDelay - timeDelay to start device (in milliseconds).
    638           *                       There is a jitter added to this delay:
    639           *                       ((NWK_START_DELAY + startDelay)
    640           *                       + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    641           *                       When startDelay is set to ZDO_INIT_HOLD_NWK_START
    642           *                       this function will hold the network init. Application
    643           *                       can start the device.
    644           *
    645           * NOTE:    If the application would like to force a "new" join, the
    646           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    647           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    648           *          this function. "new" join means to not restore the network
    649           *          state of the device. Use zgWriteStartupOptions() to set these
    650           *          options.
    651           *
    652           * @return
    653           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    654           *          restored.
    655           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    656           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    657           *          it could mean that there was no network state to restore.
    658           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    659           *          with the rejoin option set to TRUE.  So, the device was not
    660           *          started in the network (one time only).  The next time this
    661           *          function is called it will start.
    662           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    663          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    664          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    665            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000009   75..01       MOV     ?V0 + 2,#0x1
    666            uint16 extendedDelay = 0;
   \   00000C   7E00         MOV     R6,#0x0
   \   00000E   7F00         MOV     R7,#0x0
    667          
    668            if ( devState == DEV_HOLD )
   \   000010   90....       MOV     DPTR,#devState
   \   000013   E0           MOVX    A,@DPTR
   \   000014   7005         JNZ     ??ZDOInitDevice_0
    669            {
    670              // Initialize the RAM items table, in case an NV item has been updated.
    671              zgInitItems( FALSE );
   \   000016                ; Setup parameters for call to function zgInitItems
   \   000016   7900         MOV     R1,#0x0
   \   000018   12....       LCALL   ??zgInitItems?relay
    672            }
    673          
    674            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   00001B                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   00001B   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    675            //devtag.071807.todo - fix this temporary solution
    676            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000021   E0           MOVX    A,@DPTR
   \   000022   90....       MOV     DPTR,#_NIB + 14
   \   000025   F0           MOVX    @DPTR,A
    677          
    678          #if defined ( NV_RESTORE )
    679            // Get Keypad directly to see if a reset nv is needed.
    680            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    681            // while booting to skip past NV Restore.
    682            if ( HalKeyRead() == SW_BYPASS_NV )
   \   000026                ; Setup parameters for call to function HalKeyRead
   \   000026   12....       LCALL   ??HalKeyRead?relay
   \   000029   E9           MOV     A,R1
   \   00002A   6404         XRL     A,#0x4
   \   00002C   7005         JNZ     ??ZDOInitDevice_1
    683              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00002E   75..01       MOV     ?V0 + 2,#0x1
   \   000031   8006         SJMP    ??ZDOInitDevice_2
    684            else
    685            {
    686              // Determine if NV should be restored
    687              networkStateNV = ZDApp_ReadNetworkRestoreState();
   \                     ??ZDOInitDevice_1:
   \   000033                ; Setup parameters for call to function ZDApp_ReadNetworkRestoreState
   \   000033   12....       LCALL   ??ZDApp_ReadNetworkRestoreState?relay
   \   000036   E9           MOV     A,R1
   \   000037   F5..         MOV     ?V0 + 2,A
    688            }
    689          
    690            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
   \                     ??ZDOInitDevice_2:
   \   000039   E5..         MOV     A,?V0 + 2
   \   00003B   7008         JNZ     ??ZDOInitDevice_3
    691            {
    692              networkStateNV = ZDApp_RestoreNetworkState();
   \   00003D                ; Setup parameters for call to function ZDApp_RestoreNetworkState
   \   00003D   12....       LCALL   ??ZDApp_RestoreNetworkState?relay
   \   000040   E9           MOV     A,R1
   \   000041   F5..         MOV     ?V0 + 2,A
   \   000043   800A         SJMP    ??ZDOInitDevice_4
    693            }
    694            else
    695            {
    696              // Wipe out the network state in NV
    697              NLME_InitNV();
   \                     ??ZDOInitDevice_3:
   \   000045                ; Setup parameters for call to function NLME_InitNV
   \   000045   12....       LCALL   ??NLME_InitNV?relay
   \   000048   E9           MOV     A,R1
    698              NLME_SetDefaultNV();
   \   000049                ; Setup parameters for call to function NLME_SetDefaultNV
   \   000049   12....       LCALL   ??NLME_SetDefaultNV?relay
    699              // clear NWK key values
    700              ZDSecMgrClearNVKeyValues();
   \   00004C                ; Setup parameters for call to function ZDSecMgrClearNVKeyValues
   \   00004C   12....       LCALL   ??ZDSecMgrClearNVKeyValues?relay
    701            }
    702          #endif
    703          
    704            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
   \                     ??ZDOInitDevice_4:
   \   00004F   7401         MOV     A,#0x1
   \   000051   65..         XRL     A,?V0 + 2
   \   000053   7028         JNZ     ??ZDOInitDevice_5
    705            {
    706              ZDAppDetermineDeviceType();
   \   000055                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000055   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    707          
    708              // Only delay if joining network - not restoring network state
    709              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    710                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000058                ; Setup parameters for call to function osal_rand
   \   000058   12....       LCALL   ??osal_rand?relay
   \   00005B   8A..         MOV     ?V0 + 4,R2
   \   00005D   8B..         MOV     ?V0 + 5,R3
   \   00005F   E5..         MOV     A,?V0 + 4
   \   000061   547F         ANL     A,#0x7f
   \   000063   F8           MOV     R0,A
   \   000064   E5..         MOV     A,?V0 + 5
   \   000066   5400         ANL     A,#0x0
   \   000068   F9           MOV     R1,A
   \   000069   E5..         MOV     A,?V0 + 0
   \   00006B   28           ADD     A,R0
   \   00006C   F8           MOV     R0,A
   \   00006D   E5..         MOV     A,?V0 + 1
   \   00006F   39           ADDC    A,R1
   \   000070   F9           MOV     R1,A
   \   000071   E8           MOV     A,R0
   \   000072   2464         ADD     A,#0x64
   \   000074   F8           MOV     R0,A
   \   000075   E9           MOV     A,R1
   \   000076   3400         ADDC    A,#0x0
   \   000078   F9           MOV     R1,A
   \   000079   E8           MOV     A,R0
   \   00007A   FE           MOV     R6,A
   \   00007B   E9           MOV     A,R1
   \   00007C   FF           MOV     R7,A
    711            }
    712          
    713            // Initialize the security for type of device
    714            ZDApp_SecInit( networkStateNV );
   \                     ??ZDOInitDevice_5:
   \   00007D                ; Setup parameters for call to function ZDApp_SecInit
   \   00007D   A9..         MOV     R1,?V0 + 2
   \   00007F   12....       LCALL   ??ZDApp_SecInit?relay
    715          
    716            if( ZDO_INIT_HOLD_NWK_START != startDelay )
   \   000082   74FF         MOV     A,#-0x1
   \   000084   65..         XRL     A,?V0 + 0
   \   000086   7004         JNZ     ??ZDOInitDevice_6
   \   000088   74FF         MOV     A,#-0x1
   \   00008A   65..         XRL     A,?V0 + 1
   \                     ??ZDOInitDevice_6:
   \   00008C   602F         JZ      ??ZDOInitDevice_7
    717            {
    718              devState = DEV_INIT;    // Remove the Hold state
   \   00008E   90....       MOV     DPTR,#devState
   \   000091   7401         MOV     A,#0x1
   \   000093   F0           MOVX    @DPTR,A
    719          
    720              // Initialize leave control logic
    721              ZDApp_LeaveCtrlInit();
   \   000094                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000094   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    722          
    723              // Check leave control reset settings
    724             // ZDApp_LeaveCtrlStartup( &devState, &startDelay );
    725          
    726              // Leave may make the hold state come back
    727              if ( devState == DEV_HOLD )
   \   000097   90....       MOV     DPTR,#devState
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   7019         JNZ     ??ZDOInitDevice_8
    728              {
    729                // Set the NV startup option to force a "new" join.
    730                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   00009D                ; Setup parameters for call to function zgWriteStartupOptions
   \   00009D   7A02         MOV     R2,#0x2
   \   00009F   79FF         MOV     R1,#-0x1
   \   0000A1   12....       LCALL   ??zgWriteStartupOptions?relay
   \   0000A4   E9           MOV     A,R1
    731          
    732                // Notify the applications
    733                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   0000A5                ; Setup parameters for call to function osal_set_event
   \   0000A5   7A10         MOV     R2,#0x10
   \   0000A7   7B00         MOV     R3,#0x0
   \   0000A9   90....       MOV     DPTR,#ZDAppTaskID
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   F9           MOV     R1,A
   \   0000AE   12....       LCALL   ??osal_set_event?relay
   \   0000B1   E9           MOV     A,R1
    734          
    735                return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   0000B2   7902         MOV     R1,#0x2
   \   0000B4   8011         SJMP    ??ZDOInitDevice_9
    736              }
    737          
    738              // Trigger the network start
    739              ZDApp_NetworkInit( extendedDelay );
   \                     ??ZDOInitDevice_8:
   \   0000B6                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000B6   EE           MOV     A,R6
   \   0000B7   FA           MOV     R2,A
   \   0000B8   EF           MOV     A,R7
   \   0000B9   FB           MOV     R3,A
   \   0000BA   12....       LCALL   ??ZDApp_NetworkInit?relay
    740            }
    741          
    742            // set broadcast address mask to support broadcast filtering
    743            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \                     ??ZDOInitDevice_7:
   \   0000BD                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   0000BD   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F9           MOV     R1,A
   \   0000C2   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    744          
    745            return ( networkStateNV );
   \   0000C5   A9..         MOV     R1,?V0 + 2
   \                     ??ZDOInitDevice_9:
   \   0000C7   7F06         MOV     R7,#0x6
   \   0000C9   02....       LJMP    ?BANKED_LEAVE_XDATA
    746          }
    747          
    748          /*********************************************************************
    749           * @fn      ZDApp_ReadNetworkRestoreState
    750           *
    751           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    752           *          or not to restore the network state.
    753           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    754           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    755           *
    756           * @param   none
    757           *
    758           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    759           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    760           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    761           *          ZCD_NV_STARTUP_OPTION
    762           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    763          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    764          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    765            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    766          
    767            // Look for the New Network State option.
    768            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   F8           MOV     R0,A
   \   00000C   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000E   5002         JNC     ??ZDApp_ReadNetworkRestoreState_0
    769            {
    770              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000010   7E01         MOV     R6,#0x1
    771            }
    772          
    773            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000012   EE           MOV     A,R6
   \   000013   F9           MOV     R1,A
   \   000014   7F01         MOV     R7,#0x1
   \   000016   02....       LJMP    ?BANKED_LEAVE_XDATA
    774          }
    775          
    776          /*********************************************************************
    777           * @fn      ZDAppDetermineDeviceType()
    778           *
    779           * @brief   Determines the type of device to start.
    780           *
    781           *          Looks at zgDeviceLogicalType and determines what type of
    782           *          device to start.  The types are:
    783           *            ZG_DEVICETYPE_COORDINATOR
    784           *            ZG_DEVICETYPE_ROUTER
    785           *            ZG_DEVICETYPE_ENDDEVICE
    786           *
    787           * @param   none
    788           *
    789           * @return  none
    790           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    791          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    792          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    793            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700F         JNZ     ??ZDAppDetermineDeviceType_0
    794            {
    795              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    796              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   F0           MOVX    @DPTR,A
   \   000017   8042         SJMP    ??ZDAppDetermineDeviceType_1
    797            }
    798            else
    799            {
    800              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000019   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   700E         JNZ     ??ZDAppDetermineDeviceType_2
    801                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   54F8         ANL     A,#0xf8
   \   000027   4401         ORL     A,#0x1
   \   000029   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   8014         SJMP    ??ZDAppDetermineDeviceType_3
    802              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   00002F   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6402         XRL     A,#0x2
   \   000035   700C         JNZ     ??ZDAppDetermineDeviceType_3
    803                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000037   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   54F8         ANL     A,#0xf8
   \   00003D   4402         ORL     A,#0x2
   \   00003F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000042   F0           MOVX    @DPTR,A
    804          
    805              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    806              // The device shall do rejoin the network. Otherwise, do normal join
    807              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_3:
   \   000043                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000043   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000045   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000047   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00004A   E9           MOV     A,R1
   \   00004B   7008         JNZ     ??ZDAppDetermineDeviceType_4
    808              {
    809                devStartMode = MODE_JOIN;     // Assume joining
   \   00004D   90....       MOV     DPTR,#devStartMode
   \   000050   7400         MOV     A,#0x0
   \   000052   F0           MOVX    @DPTR,A
   \   000053   8006         SJMP    ??ZDAppDetermineDeviceType_1
    810              }
    811              else
    812              {
    813                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_4:
   \   000055   90....       MOV     DPTR,#devStartMode
   \   000058   7403         MOV     A,#0x3
   \   00005A   F0           MOVX    @DPTR,A
    814              }
    815            }
    816          }
   \                     ??ZDAppDetermineDeviceType_1:
   \   00005B   D083         POP     DPH
   \   00005D   D082         POP     DPL
   \   00005F   02....       LJMP    ?BRET
    817          
    818          /*********************************************************************
    819           * @fn      ZDApp_NetworkStartEvt()
    820           *
    821           * @brief   Process the Network Start Event
    822           *
    823           * @param   none
    824           *
    825           * @return  none
    826           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    827          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    828          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    829            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7022         JNZ     ??ZDApp_NetworkStartEvt_0
    830            {
    831              // Successfully started a ZigBee network
    832              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7006         JNZ     ??ZDApp_NetworkStartEvt_1
    833              {
    834                devState = DEV_ZB_COORD;
   \   000012   90....       MOV     DPTR,#devState
   \   000015   7409         MOV     A,#0x9
   \   000017   F0           MOVX    @DPTR,A
    835              }
    836          
    837              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000018                ; Setup parameters for call to function osal_pwrmgr_device
   \   000018   7900         MOV     R1,#0x0
   \   00001A   12....       LCALL   ??osal_pwrmgr_device?relay
    838              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A10         MOV     R2,#0x10
   \   00001F   7B00         MOV     R3,#0x0
   \   000021   90....       MOV     DPTR,#ZDAppTaskID
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??osal_set_event?relay
   \   000029   E9           MOV     A,R1
   \   00002A   8048         SJMP    ??ZDApp_NetworkStartEvt_2
    839            }
    840            else
    841            {
    842              // Try again with a higher energy threshold !!
    843              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00002C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00002C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00002F   E9           MOV     A,R1
   \   000030   F8           MOV     R0,A
   \   000031   7900         MOV     R1,#0x0
   \   000033   2410         ADD     A,#0x10
   \   000035   F8           MOV     R0,A
   \   000036   E9           MOV     A,R1
   \   000037   3400         ADDC    A,#0x0
   \   000039   F9           MOV     R1,A
   \   00003A   C3           CLR     C
   \   00003B   E8           MOV     A,R0
   \   00003C   94FF         SUBB    A,#-0x1
   \   00003E   E9           MOV     A,R1
   \   00003F   9400         SUBB    A,#0x0
   \   000041   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000043   65D0         XRL     A,PSW
   \   000045   33           RLC     A
   \   000046   5019         JNC     ??ZDApp_NetworkStartEvt_3
    844              {
    845                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000048                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000048                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000048   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   2410         ADD     A,#0x10
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    846                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7B00         MOV     R3,#0x0
   \   000056   90....       MOV     DPTR,#ZDAppTaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??osal_set_event?relay
   \   00005E   E9           MOV     A,R1
   \   00005F   8013         SJMP    ??ZDApp_NetworkStartEvt_2
    847              }
    848              else
    849              {
    850                // Failed to start network. Enter a dormant state (until user intervenes)
    851                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000061   90....       MOV     DPTR,#devState
   \   000064   7401         MOV     A,#0x1
   \   000066   F0           MOVX    @DPTR,A
    852                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000067                ; Setup parameters for call to function osal_set_event
   \   000067   7A10         MOV     R2,#0x10
   \   000069   7B00         MOV     R3,#0x0
   \   00006B   90....       MOV     DPTR,#ZDAppTaskID
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F9           MOV     R1,A
   \   000070   12....       LCALL   ??osal_set_event?relay
   \   000073   E9           MOV     A,R1
    853              }
    854            }
    855          }
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000074   D083         POP     DPH
   \   000076   D082         POP     DPL
   \   000078   02....       LJMP    ?BRET
    856          
    857          /*********************************************************************
    858           * @fn      ZDApp_DeviceAuthEvt()
    859           *
    860           * @brief   Process the Device Authentic Event
    861           *
    862           * @param   none
    863           *
    864           * @return  none
    865           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    866          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    867          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    868            // received authentication from trust center
    869            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   7048         JNZ     ??ZDApp_DeviceAuthEvt_0
    870            {
    871              // Stop the reset timer so it doesn't reset
    872              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    873          
    874              devState = DEV_END_DEVICE;
   \   00000F   90....       MOV     DPTR,#devState
   \   000012   7406         MOV     A,#0x6
   \   000014   F0           MOVX    @DPTR,A
    875              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A10         MOV     R2,#0x10
   \   000017   7B00         MOV     R3,#0x0
   \   000019   90....       MOV     DPTR,#ZDAppTaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??osal_set_event?relay
   \   000021   E9           MOV     A,R1
    876          
    877              // Set the Power Manager Device
    878          #if defined ( POWER_SAVING )
    879              osal_pwrmgr_device( PWRMGR_BATTERY );
    880          #endif
    881          
    882              if ( ZSTACK_ROUTER_BUILD )
    883              {
    884                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000022   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000025   E0           MOVX    A,@DPTR
   \   000026   5407         ANL     A,#0x7
   \   000028   6402         XRL     A,#0x2
   \   00002A   600A         JZ      ??ZDApp_DeviceAuthEvt_1
    885                {
    886                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    887                  NLME_StartRouterRequest( 0, 0, false );
   \   00002C                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00002C   7B00         MOV     R3,#0x0
   \   00002E   7A00         MOV     R2,#0x0
   \   000030   7900         MOV     R1,#0x0
   \   000032   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000035   E9           MOV     A,R1
    888                }
    889              }
    890          
    891              // Notify to save info into NV
    892              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000036                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000036   12....       LCALL   ??ZDApp_NVUpdate?relay
    893          
    894              // Save off the security
    895              ZDApp_SaveNwkKey();
   \   000039                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000039   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    896          
    897              ZDApp_AnnounceNewAddress();
   \   00003C                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00003C   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    898          
    899              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   00003F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000042   E0           MOVX    A,@DPTR
   \   000043   A2E3         MOV     C,0xE0 /* A   */.3
   \   000045   4010         JC      ??ZDApp_DeviceAuthEvt_2
    900              {
    901                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000047                ; Setup parameters for call to function NLME_SetPollRate
   \   000047   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   FA           MOV     R2,A
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   FB           MOV     R3,A
   \   00004F   12....       LCALL   ??NLME_SetPollRate?relay
   \   000052   8003         SJMP    ??ZDApp_DeviceAuthEvt_2
    902              }
    903            }
    904            else
    905            {
    906              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000054                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000054   12....       LCALL   ??ZDApp_NVUpdate?relay
    907            }
    908          }
   \                     ??ZDApp_DeviceAuthEvt_2:
   \   000057   D083         POP     DPH
   \   000059   D082         POP     DPL
   \   00005B   02....       LJMP    ?BRET
    909          
    910          /*********************************************************************
    911           * @fn      ZDApp_SaveNetworkStateEvt()
    912           *
    913           * @brief   Process the Save the Network State Event
    914           *
    915           * @param   none
    916           *
    917           * @return  none
    918           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    919          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    920          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    921          #if defined ( NV_RESTORE )
    922           #if defined ( NV_TURN_OFF_RADIO )
    923            // Turn off the radio's receiver during an NV update
    924            uint8 RxOnIdle;
    925            uint8 x = false;
    926            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    927            ZMacSetReq( ZMacRxOnIdle, &x );
    928           #endif
    929          
    930            // Update the Network State in NV
    931            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    932                           NWK_NV_DEVICELIST_ENABLE |
    933                           NWK_NV_BINDING_ENABLE    |
    934                           NWK_NV_ADDRMGR_ENABLE );
   \   000004                ; Setup parameters for call to function NLME_UpdateNV
   \   000004   790F         MOV     R1,#0xf
   \   000006   12....       LCALL   ??NLME_UpdateNV?relay
    935          
    936            // Reset the NV startup option to resume from NV by
    937            // clearing the "New" join option.
    938            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000009                ; Setup parameters for call to function zgWriteStartupOptions
   \   000009   7A02         MOV     R2,#0x2
   \   00000B   7900         MOV     R1,#0x0
   \   00000D   12....       LCALL   ??zgWriteStartupOptions?relay
   \   000010   E9           MOV     A,R1
    939          
    940           #if defined ( NV_TURN_OFF_RADIO )
    941            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    942           #endif
    943          #endif  // NV_RESTORE
    944          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
    945          
    946          /*********************************************************************
    947           * @fn      ZDApp_RestoreNetworkState()
    948           *
    949           * @brief   This function will restore the network state of the
    950           *          device if the network state is stored in NV.
    951           *
    952           * @param   none
    953           *
    954           * @return
    955           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    956           *          restored.
    957           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    958           *          This could mean that zgStartupOption said to not restore, or
    959           *          it could mean that there was no network state to restore.
    960           *
    961           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    962          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    963          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    964            uint8 nvStat;
    965          
    966            // Initialize NWK NV items
    967            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    968          
    969            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   6043         JZ      ??ZDApp_RestoreNetworkState_0
    970            {
    971              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6031         JZ      ??ZDApp_RestoreNetworkState_1
    972              {
    973                // Are we a coordinator
    974                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    975                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    976                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   54F8         ANL     A,#0xf8
   \   000032   F0           MOVX    @DPTR,A
    977                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   7401         MOV     A,#0x1
   \   000038   F0           MOVX    @DPTR,A
    978                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000039                ; Setup parameters for call to function sAddrExtCpy
   \   000039   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   00003B   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   00003D   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00003F   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000041   12....       LCALL   ??sAddrExtCpy?relay
   \   000044   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    979              }
    980              else
    981                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000046   7E09         MOV     R6,#0x9
    982          
    983              if ( ZG_SECURE_ENABLED )
    984              {
    985                nwkFrameCounterChanges = 0;
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000048   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004B   7400         MOV     A,#0x0
   \   00004D   F0           MOVX    @DPTR,A
   \   00004E   A3           INC     DPTR
   \   00004F   7400         MOV     A,#0x0
   \   000051   F0           MOVX    @DPTR,A
    986          
    987                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    988                {
    989                  ZDApp_RestoreNwkKey();
    990                }
    991              }
    992          
    993              // The default for RxOnWhenIdle is true for Routers and false for end devices
    994              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    995              // other than default.
    996            }
    997          
    998            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000052   EE           MOV     A,R6
   \   000053   7004         JNZ     ??ZDApp_RestoreNetworkState_4
    999              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_RestoreNetworkState_5
   1000            else
   1001              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_5:
   \   00005B   7F01         MOV     R7,#0x1
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1002          }
   1003          
   1004          /*********************************************************************
   1005           * @fn      ZDApp_InitUserDesc()
   1006           *
   1007           * @brief   Initialize the User Descriptor, the descriptor is read from NV
   1008           *          when needed.  If you want to initialize the User descriptor to
   1009           *          something other than all zero, do it here.
   1010           *
   1011           * @param   none
   1012           *
   1013           * @return  none
   1014           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1015          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
   1016          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1017            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
   1018          
   1019            // Initialize the User Descriptor, the descriptor is read from NV
   1020            // when needed.  If you want to initialize the User descriptor to something
   1021            // other than all zero, do it here.
   1022            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1023            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
   1024                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   703F         JNZ     ??ZDApp_InitUserDesc_0
   1025            {
   1026              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
   1027                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   8582..       MOV     ?V0 + 0,DPL
   \   00004A   8583..       MOV     ?V0 + 1,DPH
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000052   75..11       MOV     ?V0 + 0,#0x11
   \   000055   75..00       MOV     ?V0 + 1,#0x0
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   7C00         MOV     R4,#0x0
   \   00005F   7D00         MOV     R5,#0x0
   \   000061   7A81         MOV     R2,#-0x7f
   \   000063   7B00         MOV     R3,#0x0
   \   000065   12....       LCALL   ??osal_nv_read?relay
   \   000068   7404         MOV     A,#0x4
   \   00006A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006D   E9           MOV     A,R1
   \   00006E   7010         JNZ     ??ZDApp_InitUserDesc_0
   1028              {
   1029                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6007         JZ      ??ZDApp_InitUserDesc_0
   1030                {
   1031                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000079   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   D2E4         SETB    0xE0 /* A   */.4
   \   00007F   F0           MOVX    @DPTR,A
   1032                }
   1033              }
   1034            }
   1035          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000080   7411         MOV     A,#0x11
   \   000082   12....       LCALL   ?DEALLOC_XSTACK8
   \   000085   7F02         MOV     R7,#0x2
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
   1036          
   1037          /*********************************************************************
   1038           * @fn      ZDAppCheckForHoldKey()
   1039           *
   1040           * @brief   Check for key to set the device into Hold Auto Start
   1041           *
   1042           * @param   none
   1043           *
   1044           * @return  none
   1045           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1046          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
   1047          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1048          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
   1049            // Get Keypad directly to see if a HOLD_START is needed.
   1050            // Hold down the SW_BYPASS_START key (see OnBoard.h)
   1051            // while booting to avoid starting up the device.
   1052            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7006         JNZ     ??ZDAppCheckForHoldKey_0
   1053            {
   1054              // Change the device state to HOLD on start up
   1055              devState = DEV_HOLD;
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   7400         MOV     A,#0x0
   \   000011   F0           MOVX    @DPTR,A
   1056            }
   1057          #endif // HAL_KEY
   1058          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1059          
   1060          /*********************************************************************
   1061           * @fn      ZDApp_ProcessOSALMsg()
   1062           *
   1063           * @brief   Process the incoming task message.
   1064           *
   1065           * @param   msgPtr - message to process
   1066           *
   1067           * @return  none
   1068           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1069          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
   1070          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   1071            // Data Confirmation message fields
   1072            uint8 sentEP;       // This should always be 0
   1073            uint8 sentStatus;
   1074            afDataConfirm_t *afDataConfirm;
   1075            uint8 tmp;
   1076          
   1077            switch ( msgPtr->event )
   \   00000E   85..82       MOV     DPL,?V0 + 0
   \   000011   85..83       MOV     DPH,?V0 + 1
   \   000014   E0           MOVX    A,@DPTR
   \   000015   14           DEC     A
   \   000016   606B         JZ      ??ZDApp_ProcessOSALMsg_0
   \   000018   14           DEC     A
   \   000019   7003         JNZ     $+5
   \   00001B   02....       LJMP    ??ZDApp_ProcessOSALMsg_1 & 0xFFFF
   \   00001E   14           DEC     A
   \   00001F   7003         JNZ     $+5
   \   000021   02....       LJMP    ??ZDApp_ProcessOSALMsg_2 & 0xFFFF
   \   000024   24E9         ADD     A,#-0x17
   \   000026   600B         JZ      ??ZDApp_ProcessOSALMsg_3
   \   000028   2447         ADD     A,#0x47
   \   00002A   6011         JZ      ??ZDApp_ProcessOSALMsg_4
   \   00002C   24D6         ADD     A,#-0x2a
   \   00002E   6017         JZ      ??ZDApp_ProcessOSALMsg_5
   \   000030   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1078            {
   1079              // Incoming ZDO Message
   1080              case AF_INCOMING_MSG_CMD:
   1081                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000033                ; Setup parameters for call to function ZDP_IncomingData
   \   000033   AA..         MOV     R2,?V0 + 0
   \   000035   AB..         MOV     R3,?V0 + 1
   \   000037   12....       LCALL   ??ZDP_IncomingData?relay
   1082                break;
   \   00003A   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1083          
   1084              case ZDO_CB_MSG:
   1085                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00003D                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   1086                break;
   \   000044   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1087          
   1088              case AF_DATA_CONFIRM_CMD:
   1089                // This message is received as a confirmation of a data packet sent.
   1090                // The status is of ZStatus_t type [defined in NLMEDE.h]
   1091                // The message fields are defined in AF.h
   1092                afDataConfirm = (afDataConfirm_t *)msgPtr;
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000047   85....       MOV     ?V0 + 2,?V0 + 0
   \   00004A   85....       MOV     ?V0 + 3,?V0 + 1
   1093                sentEP = afDataConfirm->endpoint;
   \   00004D   85..82       MOV     DPL,?V0 + 2
   \   000050   85..83       MOV     DPH,?V0 + 3
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F5..         MOV     ?V0 + 5,A
   1094                sentStatus = afDataConfirm->hdr.status;
   \   000058   85..82       MOV     DPL,?V0 + 2
   \   00005B   85..83       MOV     DPH,?V0 + 3
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F5..         MOV     ?V0 + 4,A
   1095          
   1096                // Action taken when confirmation is received.
   1097          #if defined ( ZIGBEE_FREQ_AGILITY )
   1098                if ( pZDNwkMgr_ProcessDataConfirm )
   \   000062   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F8           MOV     R0,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F9           MOV     R1,A
   \   00006A   E8           MOV     A,R0
   \   00006B   49           ORL     A,R1
   \   00006C   6012         JZ      ??ZDApp_ProcessOSALMsg_8
   1099                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   00006E                ; Setup parameters for indirect call
   \   00006E   AA..         MOV     R2,?V0 + 2
   \   000070   AB..         MOV     R3,?V0 + 3
   \   000072   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000075   E0           MOVX    A,@DPTR
   \   000076   F8           MOV     R0,A
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   F583         MOV     DPH,A
   \   00007B   8882         MOV     DPL,R0
   \   00007D   12....       LCALL   ?CALL_IND
   1100          #endif
   1101                (void)sentEP;
   1102                (void)sentStatus;
   1103                break;
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   000080   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1104          
   1105              case ZDO_NWK_DISC_CNF:
   1106                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000083   90....       MOV     DPTR,#devState
   \   000086   E0           MOVX    A,@DPTR
   \   000087   6402         XRL     A,#0x2
   \   000089   6003         JZ      $+5
   \   00008B   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1107                  break;
   1108          
   1109                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   00008E   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000091   E0           MOVX    A,@DPTR
   \   000092   6401         XRL     A,#0x1
   \   000094   600B         JZ      ??ZDApp_ProcessOSALMsg_9
   \   000096   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   6402         XRL     A,#0x2
   \   00009C   6003         JZ      $+5
   \   00009E   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1110                {
   1111                  // Process the network discovery scan results and choose a parent
   1112                  // device to join/rejoin itself
   1113                  networkDesc_t *pChosenNwk;
   1114                  if ( ( (pChosenNwk = ZDApp_NwkDescListProcessing()) != NULL ) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   0000A1                ; Setup parameters for call to function ZDApp_NwkDescListProcessing
   \   0000A1   12....       LCALL   ??ZDApp_NwkDescListProcessing?relay
   \   0000A4   8A..         MOV     ?V0 + 6,R2
   \   0000A6   8B..         MOV     ?V0 + 7,R3
   \   0000A8   A8..         MOV     R0,?V0 + 6
   \   0000AA   A9..         MOV     R1,?V0 + 7
   \   0000AC   E8           MOV     A,R0
   \   0000AD   FE           MOV     R6,A
   \   0000AE   E9           MOV     A,R1
   \   0000AF   FF           MOV     R7,A
   \   0000B0   E8           MOV     A,R0
   \   0000B1   49           ORL     A,R1
   \   0000B2   7003         JNZ     $+5
   \   0000B4   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   \   0000B7   90....       MOV     DPTR,#zdoDiscCounter
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   C3           CLR     C
   \   0000BC   9403         SUBB    A,#0x3
   \   0000BE   5003         JNC     $+5
   \   0000C0   02....       LJMP    ??ZDApp_ProcessOSALMsg_10 & 0xFFFF
   1115                  {
   1116                    if ( devStartMode == MODE_JOIN )
   \   0000C3   90....       MOV     DPTR,#devStartMode
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   6003         JZ      $+5
   \   0000C9   02....       LJMP    ??ZDApp_ProcessOSALMsg_11 & 0xFFFF
   1117                    {
   1118                      devState = DEV_NWK_JOINING;
   \   0000CC   90....       MOV     DPTR,#devState
   \   0000CF   7403         MOV     A,#0x3
   \   0000D1   F0           MOVX    @DPTR,A
   1119          
   1120                      ZDApp_NodeProfileSync( pChosenNwk->stackProfile);
   \   0000D2                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   0000D2   8E82         MOV     DPL,R6
   \   0000D4   8F83         MOV     DPH,R7
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   E0           MOVX    A,@DPTR
   \   0000DD   F9           MOV     R1,A
   \   0000DE   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1121          
   1122                      if ( NLME_JoinRequest( pChosenNwk->extendedPANID, pChosenNwk->panId,
   1123                                            pChosenNwk->logicalChannel,
   1124                                            ZDO_Config_Node_Descriptor.CapabilityFlags,
   1125                                            pChosenNwk->chosenRouter, pChosenNwk->chosenRouterDepth ) != ZSuccess )
   \   0000E1                ; Setup parameters for call to function NLME_JoinRequest
   \   0000E1   8E82         MOV     DPL,R6
   \   0000E3   8F83         MOV     DPH,R7
   \   0000E5   A3           INC     DPTR
   \   0000E6   A3           INC     DPTR
   \   0000E7   A3           INC     DPTR
   \   0000E8   A3           INC     DPTR
   \   0000E9   A3           INC     DPTR
   \   0000EA   A3           INC     DPTR
   \   0000EB   A3           INC     DPTR
   \   0000EC   A3           INC     DPTR
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   F5..         MOV     ?V0 + 6,A
   \   0000F2   78..         MOV     R0,#?V0 + 6
   \   0000F4   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000F7   8E82         MOV     DPL,R6
   \   0000F9   8F83         MOV     DPH,R7
   \   0000FB   A3           INC     DPTR
   \   0000FC   A3           INC     DPTR
   \   0000FD   A3           INC     DPTR
   \   0000FE   A3           INC     DPTR
   \   0000FF   A3           INC     DPTR
   \   000100   A3           INC     DPTR
   \   000101   A3           INC     DPTR
   \   000102   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000105   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000108   E0           MOVX    A,@DPTR
   \   000109   F5..         MOV     ?V0 + 6,A
   \   00010B   78..         MOV     R0,#?V0 + 6
   \   00010D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000110   8E82         MOV     DPL,R6
   \   000112   8F83         MOV     DPH,R7
   \   000114   A3           INC     DPTR
   \   000115   A3           INC     DPTR
   \   000116   E0           MOVX    A,@DPTR
   \   000117   F9           MOV     R1,A
   \   000118   8E82         MOV     DPL,R6
   \   00011A   8F83         MOV     DPH,R7
   \   00011C   E0           MOVX    A,@DPTR
   \   00011D   FC           MOV     R4,A
   \   00011E   A3           INC     DPTR
   \   00011F   E0           MOVX    A,@DPTR
   \   000120   FD           MOV     R5,A
   \   000121   EE           MOV     A,R6
   \   000122   240B         ADD     A,#0xb
   \   000124   FA           MOV     R2,A
   \   000125   EF           MOV     A,R7
   \   000126   3400         ADDC    A,#0x0
   \   000128   FB           MOV     R3,A
   \   000129   12....       LCALL   ??NLME_JoinRequest?relay
   \   00012C   7404         MOV     A,#0x4
   \   00012E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000131   E9           MOV     A,R1
   \   000132   7003         JNZ     $+5
   \   000134   02....       LJMP    ??ZDApp_ProcessOSALMsg_12 & 0xFFFF
   1126                      {
   1127                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1128                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000137                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000137                ; Setup parameters for call to function osal_rand
   \   000137   12....       LCALL   ??osal_rand?relay
   \   00013A   8A..         MOV     ?V0 + 6,R2
   \   00013C   8B..         MOV     ?V0 + 7,R3
   \   00013E   E5..         MOV     A,?V0 + 6
   \   000140   547F         ANL     A,#0x7f
   \   000142   F8           MOV     R0,A
   \   000143   E5..         MOV     A,?V0 + 7
   \   000145   5400         ANL     A,#0x0
   \   000147   F9           MOV     R1,A
   \   000148   E8           MOV     A,R0
   \   000149   2464         ADD     A,#0x64
   \   00014B   FA           MOV     R2,A
   \   00014C   E9           MOV     A,R1
   \   00014D   3400         ADDC    A,#0x0
   \   00014F   FB           MOV     R3,A
   \   000150   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000153   02....       LJMP    ??ZDApp_ProcessOSALMsg_12 & 0xFFFF
   1129                      }
   1130                    } // if ( devStartMode == MODE_JOIN )
   1131                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   000156   90....       MOV     DPTR,#devStartMode
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   6403         XRL     A,#0x3
   \   00015C   6003         JZ      $+5
   \   00015E   02....       LJMP    ??ZDApp_ProcessOSALMsg_12 & 0xFFFF
   1132                    {
   1133                      devState = DEV_NWK_REJOIN;
   \   000161   90....       MOV     DPTR,#devState
   \   000164   7404         MOV     A,#0x4
   \   000166   F0           MOVX    @DPTR,A
   1134          
   1135                      
   1136                     osal_start_timerEx( ZDAppTaskID,ZDO_ENDDIVCE_REJOIN, 30000 );//°ë·ÖÖÓºó·¢ÏÖREJOINÊ§°ÜÔò¸´Î»Ò»ÏÂ
   \   000167                ; Setup parameters for call to function osal_start_timerEx
   \   000167   7C30         MOV     R4,#0x30
   \   000169   7D75         MOV     R5,#0x75
   \   00016B   7A00         MOV     R2,#0x0
   \   00016D   7B40         MOV     R3,#0x40
   \   00016F   90....       MOV     DPTR,#ZDAppTaskID
   \   000172   E0           MOVX    A,@DPTR
   \   000173   F9           MOV     R1,A
   \   000174   12....       LCALL   ??osal_start_timerEx?relay
   \   000177   E9           MOV     A,R1
   1137          
   1138          
   1139                                  
   1140                      // Before trying to do rejoin, check if the device has a valid short address
   1141                      // If not, generate a random short address for itself
   1142                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   000178   90....       MOV     DPTR,#_NIB + 20
   \   00017B   E0           MOVX    A,@DPTR
   \   00017C   64FE         XRL     A,#0xfe
   \   00017E   7004         JNZ     ??ZDApp_ProcessOSALMsg_13
   \   000180   A3           INC     DPTR
   \   000181   E0           MOVX    A,@DPTR
   \   000182   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   000184   7015         JNZ     ??ZDApp_ProcessOSALMsg_14
   1143                      {
   1144                        _NIB.nwkDevAddress = osal_rand();
   \   000186                ; Setup parameters for call to function osal_rand
   \   000186   12....       LCALL   ??osal_rand?relay
   \   000189   90....       MOV     DPTR,#_NIB + 20
   \   00018C   EA           MOV     A,R2
   \   00018D   F0           MOVX    @DPTR,A
   \   00018E   A3           INC     DPTR
   \   00018F   EB           MOV     A,R3
   \   000190   F0           MOVX    @DPTR,A
   1145                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \   000191                ; Setup parameters for call to function ZMacSetReq
   \   000191   7A..         MOV     R2,#(_NIB + 20) & 0xff
   \   000193   7B..         MOV     R3,#((_NIB + 20) >> 8) & 0xff
   \   000195   7953         MOV     R1,#0x53
   \   000197   12....       LCALL   ??ZMacSetReq?relay
   \   00019A   E9           MOV     A,R1
   1146                      }
   1147          
   1148                      if ( ZG_SECURE_ENABLED )
   1149                      {
   1150                        ZDApp_RestoreNwkKey();
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   00019B                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   00019B   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   00019E   E9           MOV     A,R1
   1151                      }
   1152          
   1153                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1154                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \   00019F   90....       MOV     DPTR,#_NIB + 33
   \   0001A2   E0           MOVX    A,@DPTR
   \   0001A3   64FE         XRL     A,#0xfe
   \   0001A5   7004         JNZ     ??ZDApp_ProcessOSALMsg_15
   \   0001A7   A3           INC     DPTR
   \   0001A8   E0           MOVX    A,@DPTR
   \   0001A9   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   0001AB   701B         JNZ     ??ZDApp_ProcessOSALMsg_16
   1155                      {
   1156                        _NIB.nwkPanId = pChosenNwk->panId;
   \   0001AD   8E82         MOV     DPL,R6
   \   0001AF   8F83         MOV     DPH,R7
   \   0001B1   E0           MOVX    A,@DPTR
   \   0001B2   F8           MOV     R0,A
   \   0001B3   A3           INC     DPTR
   \   0001B4   E0           MOVX    A,@DPTR
   \   0001B5   F9           MOV     R1,A
   \   0001B6   90....       MOV     DPTR,#_NIB + 33
   \   0001B9   E8           MOV     A,R0
   \   0001BA   F0           MOVX    @DPTR,A
   \   0001BB   A3           INC     DPTR
   \   0001BC   E9           MOV     A,R1
   \   0001BD   F0           MOVX    @DPTR,A
   1157                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   0001BE                ; Setup parameters for call to function ZMacSetReq
   \   0001BE   7A..         MOV     R2,#(_NIB + 33) & 0xff
   \   0001C0   7B..         MOV     R3,#((_NIB + 33) >> 8) & 0xff
   \   0001C2   7950         MOV     R1,#0x50
   \   0001C4   12....       LCALL   ??ZMacSetReq?relay
   \   0001C7   E9           MOV     A,R1
   1158                      }
   1159          #if defined (RESUME_TIME_TEST)
   1160                        osal_pwrmgr_device( PWRMGR_BATTERY );
   1161          #else  
   1162                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   0001C8   85..82       MOV     DPL,?XSP + 0
   \   0001CB   85..83       MOV     DPH,?XSP + 1
   \   0001CE   7401         MOV     A,#0x1
   \   0001D0   F0           MOVX    @DPTR,A
   1163                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   0001D1                ; Setup parameters for call to function ZMacSetReq
   \   0001D1   85..82       MOV     DPL,?XSP + 0
   \   0001D4   85..83       MOV     DPH,?XSP + 1
   \   0001D7   AA82         MOV     R2,DPL
   \   0001D9   AB83         MOV     R3,DPH
   \   0001DB   7952         MOV     R1,#0x52
   \   0001DD   12....       LCALL   ??ZMacSetReq?relay
   \   0001E0   E9           MOV     A,R1
   1164          #endif
   1165                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, pChosenNwk->logicalChannel) != ZSuccess )
   \   0001E1                ; Setup parameters for call to function NLME_ReJoinRequest
   \   0001E1   8E82         MOV     DPL,R6
   \   0001E3   8F83         MOV     DPH,R7
   \   0001E5   A3           INC     DPTR
   \   0001E6   A3           INC     DPTR
   \   0001E7   E0           MOVX    A,@DPTR
   \   0001E8   F9           MOV     R1,A
   \   0001E9   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   0001EB   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   0001ED   12....       LCALL   ??NLME_ReJoinRequest?relay
   \   0001F0   E9           MOV     A,R1
   \   0001F1   601C         JZ      ??ZDApp_ProcessOSALMsg_12
   1166                      {
   1167                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1168                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0001F3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001F3                ; Setup parameters for call to function osal_rand
   \   0001F3   12....       LCALL   ??osal_rand?relay
   \   0001F6   8A..         MOV     ?V0 + 6,R2
   \   0001F8   8B..         MOV     ?V0 + 7,R3
   \   0001FA   E5..         MOV     A,?V0 + 6
   \   0001FC   547F         ANL     A,#0x7f
   \   0001FE   F8           MOV     R0,A
   \   0001FF   E5..         MOV     A,?V0 + 7
   \   000201   5400         ANL     A,#0x0
   \   000203   F9           MOV     R1,A
   \   000204   E8           MOV     A,R0
   \   000205   2464         ADD     A,#0x64
   \   000207   FA           MOV     R2,A
   \   000208   E9           MOV     A,R1
   \   000209   3400         ADDC    A,#0x0
   \   00020B   FB           MOV     R3,A
   \   00020C   12....       LCALL   ??ZDApp_NetworkInit?relay
   1169                      }
   1170                    } 
   1171          
   1172                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   00020F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000212   E0           MOVX    A,@DPTR
   \   000213   A2E3         MOV     C,0xE0 /* A   */.3
   \   000215   5017         JNC     ??ZDApp_ProcessOSALMsg_17
   1173                    {
   1174                      // The receiver is on, turn network layer polling off.
   1175                      NLME_SetPollRate( 0 );
   \   000217                ; Setup parameters for call to function NLME_SetPollRate
   \   000217   7A00         MOV     R2,#0x0
   \   000219   7B00         MOV     R3,#0x0
   \   00021B   12....       LCALL   ??NLME_SetPollRate?relay
   1176                      NLME_SetQueuedPollRate( 0 );
   \   00021E                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   00021E   7A00         MOV     R2,#0x0
   \   000220   7B00         MOV     R3,#0x0
   \   000222   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1177                      NLME_SetResponseRate( 0 );
   \   000225                ; Setup parameters for call to function NLME_SetResponseRate
   \   000225   7A00         MOV     R2,#0x0
   \   000227   7B00         MOV     R3,#0x0
   \   000229   12....       LCALL   ??NLME_SetResponseRate?relay
   \   00022C   8036         SJMP    ??ZDApp_ProcessOSALMsg_18
   1178                    }
   1179                    else
   1180                    {
   1181                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   00022E   90....       MOV     DPTR,#devStartMode
   \   000231   E0           MOVX    A,@DPTR
   \   000232   7030         JNZ     ??ZDApp_ProcessOSALMsg_18
   1182                      {
   1183                        ZDApp_SavedPollRate = zgPollRate;
   \   000234   90....       MOV     DPTR,#zgPollRate
   \   000237   E0           MOVX    A,@DPTR
   \   000238   F8           MOV     R0,A
   \   000239   A3           INC     DPTR
   \   00023A   E0           MOVX    A,@DPTR
   \   00023B   F9           MOV     R1,A
   \   00023C   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   00023F   E8           MOV     A,R0
   \   000240   F0           MOVX    @DPTR,A
   \   000241   A3           INC     DPTR
   \   000242   E9           MOV     A,R1
   \   000243   F0           MOVX    @DPTR,A
   1184                        NLME_SetPollRate( zgRejoinPollRate );
   \   000244                ; Setup parameters for call to function NLME_SetPollRate
   \   000244   90....       MOV     DPTR,#zgRejoinPollRate
   \   000247   E0           MOVX    A,@DPTR
   \   000248   FA           MOV     R2,A
   \   000249   A3           INC     DPTR
   \   00024A   E0           MOVX    A,@DPTR
   \   00024B   FB           MOV     R3,A
   \   00024C   12....       LCALL   ??NLME_SetPollRate?relay
   \   00024F   806D         SJMP    ??ZDApp_ProcessOSALMsg_7
   1185                      }
   1186                    }
   1187                  }
   1188                  else
   1189                  {
   1190                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   000251   90....       MOV     DPTR,#continueJoining
   \   000254   E0           MOVX    A,@DPTR
   \   000255   6067         JZ      ??ZDApp_ProcessOSALMsg_7
   1191                    {
   1192              #if defined ( MANAGED_SCAN )
   1193                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1194              #else
   1195                      
   1196                  osal_set_event( ZDAppTaskID, ZDO_ENDDIVCE_DISC );
   \   000257                ; Setup parameters for call to function osal_set_event
   \   000257   7A00         MOV     R2,#0x0
   \   000259   7B20         MOV     R3,#0x20
   \   00025B   90....       MOV     DPTR,#ZDAppTaskID
   \   00025E   E0           MOVX    A,@DPTR
   \   00025F   F9           MOV     R1,A
   \   000260   12....       LCALL   ??osal_set_event?relay
   \   000263   E9           MOV     A,R1
   1197                      
   1198              #endif
   1199                    }
   1200                  }
   1201                }
   1202                break;
   \                     ??ZDApp_ProcessOSALMsg_18:
   \   000264   8058         SJMP    ??ZDApp_ProcessOSALMsg_7
   1203          
   1204              case ZDO_NWK_JOIN_IND:
   1205                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000266   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000269   E0           MOVX    A,@DPTR
   \   00026A   6401         XRL     A,#0x1
   \   00026C   6008         JZ      ??ZDApp_ProcessOSALMsg_19
   \   00026E   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000271   E0           MOVX    A,@DPTR
   \   000272   6402         XRL     A,#0x2
   \   000274   7048         JNZ     ??ZDApp_ProcessOSALMsg_7
   1206                {
   1207                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_19:
   \   000276                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   000276   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   1208                }
   1209                break;
   \   000279   8043         SJMP    ??ZDApp_ProcessOSALMsg_7
   1210          
   1211              case ZDO_NWK_JOIN_REQ:
   1212                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   00027B   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00027E   E0           MOVX    A,@DPTR
   \   00027F   6401         XRL     A,#0x1
   \   000281   6008         JZ      ??ZDApp_ProcessOSALMsg_20
   \   000283   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000286   E0           MOVX    A,@DPTR
   \   000287   6402         XRL     A,#0x2
   \   000289   7033         JNZ     ??ZDApp_ProcessOSALMsg_7
   1213                {
   1214                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_20:
   \   00028B   90....       MOV     DPTR,#retryCnt
   \   00028E   7400         MOV     A,#0x0
   \   000290   F0           MOVX    @DPTR,A
   1215                  devStartMode = MODE_RESUME;
   \   000291   90....       MOV     DPTR,#devStartMode
   \   000294   7401         MOV     A,#0x1
   \   000296   F0           MOVX    @DPTR,A
   1216                  _tmpRejoinState = true;
   \   000297   90....       MOV     DPTR,#_tmpRejoinState
   \   00029A   7401         MOV     A,#0x1
   \   00029C   F0           MOVX    @DPTR,A
   1217                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   00029D                ; Setup parameters for call to function sAddrExtCpy
   \   00029D   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   00029F   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   0002A1   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   0002A3   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   0002A5   12....       LCALL   ??sAddrExtCpy?relay
   1218                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   0002A8   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0002AB   7402         MOV     A,#0x2
   \   0002AD   F0           MOVX    @DPTR,A
   1219                  ZDApp_NetworkInit( 0 );
   \   0002AE                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0002AE   7A00         MOV     R2,#0x0
   \   0002B0   7B00         MOV     R3,#0x0
   \   0002B2   12....       LCALL   ??ZDApp_NetworkInit?relay
   1220                }
   1221                break;
   \   0002B5   8007         SJMP    ??ZDApp_ProcessOSALMsg_7
   1222          
   1223              default:
   1224                if ( ZG_SECURE_ENABLED )
   1225                  ZDApp_ProcessSecMsg( msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   0002B7                ; Setup parameters for call to function ZDApp_ProcessSecMsg
   \   0002B7   AA..         MOV     R2,?V0 + 0
   \   0002B9   AB..         MOV     R3,?V0 + 1
   \   0002BB   12....       LCALL   ??ZDApp_ProcessSecMsg?relay
   1226                break;
   1227            }
   1228          
   1229          }
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   0002BE   7401         MOV     A,#0x1
   \   0002C0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002C3   7F08         MOV     R7,#0x8
   \   0002C5   02....       LJMP    ?BANKED_LEAVE_XDATA
   1230          
   1231          /*********************************************************************
   1232           * @fn      ZDApp_ProcessMsgCBs()
   1233           *
   1234           * @brief   Process response messages
   1235           *
   1236           * @param   none
   1237           *
   1238           * @return  none
   1239           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1240          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1241          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1242            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 0,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 1,A
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000024   0200         DW        2
   \   000026   2100         DW        33
   \   000028   2200         DW        34
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002C   0080         DW        32768
   \   00002E   0180         DW        32769
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000032   0000         DW        0
   \   000034   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1243            {
   1244          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1245              case NWK_addr_rsp:
   1246              case IEEE_addr_rsp:
   1247                {
   1248                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1249                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000036                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000036   EE           MOV     A,R6
   \   000037   FA           MOV     R2,A
   \   000038   EF           MOV     A,R7
   \   000039   FB           MOV     R3,A
   \   00003A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003D   8A..         MOV     ?V0 + 2,R2
   \   00003F   8B..         MOV     ?V0 + 3,R3
   \   000041   85....       MOV     ?V0 + 0,?V0 + 2
   \   000044   85....       MOV     ?V0 + 1,?V0 + 3
   1250                  if ( pAddrRsp )
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   45..         ORL     A,?V0 + 1
   \   00004B   604D         JZ      ??ZDApp_ProcessMsgCBs_2
   1251                  {
   1252                    if ( pAddrRsp->status == ZSuccess )
   \   00004D   85..82       MOV     DPL,?V0 + 0
   \   000050   85..83       MOV     DPH,?V0 + 1
   \   000053   E0           MOVX    A,@DPTR
   \   000054   7019         JNZ     ??ZDApp_ProcessMsgCBs_3
   1253                    {
   1254                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000056                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000056   E5..         MOV     A,?V0 + 0
   \   000058   2403         ADD     A,#0x3
   \   00005A   FC           MOV     R4,A
   \   00005B   E5..         MOV     A,?V0 + 1
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FD           MOV     R5,A
   \   000060   85..82       MOV     DPL,?V0 + 0
   \   000063   85..83       MOV     DPH,?V0 + 1
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   FA           MOV     R2,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FB           MOV     R3,A
   \   00006C   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1255                    }
   1256                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   00006F                ; Setup parameters for call to function osal_mem_free
   \   00006F   AA..         MOV     R2,?V0 + 0
   \   000071   AB..         MOV     R3,?V0 + 1
   \   000073   12....       LCALL   ??osal_mem_free?relay
   1257                  }
   1258                }
   1259                break;
   \   000076   8022         SJMP    ??ZDApp_ProcessMsgCBs_2
   1260          #endif
   1261          
   1262          #if defined ( REFLECTOR )
   1263              case Bind_req:
   1264              case Unbind_req:
   1265                {
   1266                  ZDO_BindUnbindReq_t bindReq;
   1267                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000078                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000078   85..82       MOV     DPL,?XSP + 0
   \   00007B   85..83       MOV     DPH,?XSP + 1
   \   00007E   AC82         MOV     R4,DPL
   \   000080   AD83         MOV     R5,DPH
   \   000082   EE           MOV     A,R6
   \   000083   FA           MOV     R2,A
   \   000084   EF           MOV     A,R7
   \   000085   FB           MOV     R3,A
   \   000086   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1268                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000089                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000089   85..82       MOV     DPL,?XSP + 0
   \   00008C   85..83       MOV     DPH,?XSP + 1
   \   00008F   AC82         MOV     R4,DPL
   \   000091   AD83         MOV     R5,DPH
   \   000093   EE           MOV     A,R6
   \   000094   FA           MOV     R2,A
   \   000095   EF           MOV     A,R7
   \   000096   FB           MOV     R3,A
   \   000097   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1269                }
   1270                break;
   1271          #endif
   1272          
   1273          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1274              case Bind_rsp:
   1275              case Unbind_rsp:
   1276                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1277                {
   1278                  ZDMatchSendState(
   1279                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1280                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1281                }
   1282                break;
   1283          
   1284              case End_Device_Bind_req:
   1285                if (ZG_DEVICE_COORDINATOR_TYPE)
   1286                {
   1287                  ZDEndDeviceBind_t bindReq;
   1288                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1289                  ZDO_MatchEndDeviceBind( &bindReq );
   1290          
   1291                  // Freeing the cluster lists - if allocated.
   1292                  if ( bindReq.numInClusters )
   1293                    osal_mem_free( bindReq.inClusters );
   1294                  if ( bindReq.numOutClusters )
   1295                    osal_mem_free( bindReq.outClusters );
   1296                }
   1297                break;
   1298          #endif
   1299            }
   1300          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00009A   7415         MOV     A,#0x15
   \   00009C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009F   7F04         MOV     R7,#0x4
   \   0000A1   02....       LJMP    ?BANKED_LEAVE_XDATA
   1301          
   1302          /*********************************************************************
   1303           * @fn      ZDApp_RegisterCBs()
   1304           *
   1305           * @brief   Process response messages
   1306           *
   1307           * @param   none
   1308           *
   1309           * @return  none
   1310           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1311          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1312          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1313          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1314            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B80         MOV     R3,#-0x80
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000010   E9           MOV     A,R1
   1315          #endif
   1316          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1317            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \   000011                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000011   7A00         MOV     R2,#0x0
   \   000013   7B80         MOV     R3,#-0x80
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00001D   E9           MOV     A,R1
   1318          #endif
   1319          #if ZG_BUILD_COORDINATOR_TYPE
   1320            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1321            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1322            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1323          #endif
   1324          #if defined ( REFLECTOR )
   1325            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \   00001E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001E   7A21         MOV     R2,#0x21
   \   000020   7B00         MOV     R3,#0x0
   \   000022   90....       MOV     DPTR,#ZDAppTaskID
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F9           MOV     R1,A
   \   000027   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00002A   E9           MOV     A,R1
   1326            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \   00002B                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00002B   7A22         MOV     R2,#0x22
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000037   E9           MOV     A,R1
   1327          #endif
   1328          }
   \   000038   D083         POP     DPH
   \   00003A   D082         POP     DPL
   \   00003C   02....       LJMP    ?BRET
   1329          
   1330          /*********************************************************************
   1331           * @fn      ZDApp_ProcessSecMsg()
   1332           *
   1333           * @brief   Process the incoming security message.
   1334           *
   1335           * @param   msgPtr - message to process
   1336           *
   1337           * @return  none
   1338           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1339          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1340          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1341            switch ( msgPtr->event )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   24FC         ADD     A,#-0x4
   \   000010   605B         JZ      ??ZDApp_ProcessSecMsg_0
   \   000012   14           DEC     A
   \   000013   6058         JZ      ??ZDApp_ProcessSecMsg_0
   \   000015   14           DEC     A
   \   000016   6014         JZ      ??ZDApp_ProcessSecMsg_1
   \   000018   14           DEC     A
   \   000019   6052         JZ      ??ZDApp_ProcessSecMsg_0
   \   00001B   14           DEC     A
   \   00001C   6027         JZ      ??ZDApp_ProcessSecMsg_2
   \   00001E   14           DEC     A
   \   00001F   604C         JZ      ??ZDApp_ProcessSecMsg_0
   \   000021   14           DEC     A
   \   000022   6032         JZ      ??ZDApp_ProcessSecMsg_3
   \   000024   14           DEC     A
   \   000025   6046         JZ      ??ZDApp_ProcessSecMsg_0
   \   000027   14           DEC     A
   \   000028   6043         JZ      ??ZDApp_ProcessSecMsg_0
   \   00002A   8041         SJMP    ??ZDApp_ProcessSecMsg_0
   1342            {
   1343              case ZDO_ESTABLISH_KEY_CFM:
   1344                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1345                {
   1346                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1347                }
   1348                break;
   1349          
   1350              case ZDO_ESTABLISH_KEY_IND:
   1351                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1352                {
   1353                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1354                  {
   1355                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1356                  }
   1357                }
   1358                break;
   1359          
   1360              case ZDO_TRANSPORT_KEY_IND:
   1361                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6401         XRL     A,#0x1
   \   000032   6008         JZ      ??ZDApp_ProcessSecMsg_4
   \   000034   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6402         XRL     A,#0x2
   \   00003A   7031         JNZ     ??ZDApp_ProcessSecMsg_0
   1362                {
   1363                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   00003C                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   00003C   EE           MOV     A,R6
   \   00003D   FA           MOV     R2,A
   \   00003E   EF           MOV     A,R7
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   1364                }
   1365                break;
   \   000043   8028         SJMP    ??ZDApp_ProcessSecMsg_0
   1366          
   1367              case ZDO_UPDATE_DEVICE_IND:
   1368                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1369                {
   1370                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1371                }
   1372                break;
   1373          
   1374              case ZDO_REMOVE_DEVICE_IND:
   1375                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000045   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000048   E0           MOVX    A,@DPTR
   \   000049   6401         XRL     A,#0x1
   \   00004B   7020         JNZ     ??ZDApp_ProcessSecMsg_0
   1376                {
   1377                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   \   00004D                ; Setup parameters for call to function ZDSecMgrRemoveDeviceInd
   \   00004D   EE           MOV     A,R6
   \   00004E   FA           MOV     R2,A
   \   00004F   EF           MOV     A,R7
   \   000050   FB           MOV     R3,A
   \   000051   12....       LCALL   ??ZDSecMgrRemoveDeviceInd?relay
   1378                }
   1379                break;
   \   000054   8017         SJMP    ??ZDApp_ProcessSecMsg_0
   1380          
   1381              case ZDO_REQUEST_KEY_IND:
   1382                if (( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH ) ||
   1383                    ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD ))
   1384                {
   1385                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1386                  {
   1387                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1388                  }
   1389                }
   1390                break;
   1391          
   1392              case ZDO_SWITCH_KEY_IND:
   1393                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000056   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   6401         XRL     A,#0x1
   \   00005C   6008         JZ      ??ZDApp_ProcessSecMsg_5
   \   00005E   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000061   E0           MOVX    A,@DPTR
   \   000062   6402         XRL     A,#0x2
   \   000064   7007         JNZ     ??ZDApp_ProcessSecMsg_0
   1394                {
   1395                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_5:
   \   000066                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000066   EE           MOV     A,R6
   \   000067   FA           MOV     R2,A
   \   000068   EF           MOV     A,R7
   \   000069   FB           MOV     R3,A
   \   00006A   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1396                }
   1397                break;
   1398          
   1399              case ZDO_AUTHENTICATE_IND:
   1400                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1401                {
   1402                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1403                }
   1404                break;
   1405          
   1406              case ZDO_AUTHENTICATE_CFM:
   1407                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1408                {
   1409                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1410                }
   1411                break;
   1412          
   1413              default:
   1414                // Unsupported messages
   1415                break;
   1416            }
   1417          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   00006D   7F01         MOV     R7,#0x1
   \   00006F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1418          
   1419          /*********************************************************************
   1420           * @fn      ZDApp_ProcessNetworkJoin()
   1421           *
   1422           * @brief
   1423           *
   1424           *   Save off the Network key information.
   1425           *
   1426           * @param   none
   1427           *
   1428           * @return  none
   1429           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1430          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1431          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1432            if ( (devState == DEV_NWK_JOINING) ||
   1433                ((devState == DEV_NWK_ORPHAN)  &&
   1434                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6018         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   90....       MOV     DPTR,#devState
   \   000015   E0           MOVX    A,@DPTR
   \   000016   640A         XRL     A,#0xa
   \   000018   6003         JZ      $+5
   \   00001A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000020   E0           MOVX    A,@DPTR
   \   000021   5407         ANL     A,#0x7
   \   000023   6401         XRL     A,#0x1
   \   000025   6003         JZ      $+5
   \   000027   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   1435            {
   1436              // Result of a Join attempt by this device.
   1437              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   00002A   90....       MOV     DPTR,#nwkStatus
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   706C         JNZ     ??ZDApp_ProcessNetworkJoin_2
   1438              {
   1439                zdoDiscCounter = 1;//@@@
   \   000030   90....       MOV     DPTR,#zdoDiscCounter
   \   000033   7401         MOV     A,#0x1
   \   000035   F0           MOVX    @DPTR,A
   1440                
   1441                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000036                ; Setup parameters for call to function osal_set_event
   \   000036   7A10         MOV     R2,#0x10
   \   000038   7B00         MOV     R3,#0x0
   \   00003A   90....       MOV     DPTR,#ZDAppTaskID
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F9           MOV     R1,A
   \   00003F   12....       LCALL   ??osal_set_event?relay
   \   000042   E9           MOV     A,R1
   1442          
   1443          #if defined ( POWER_SAVING )
   1444                osal_pwrmgr_device( PWRMGR_BATTERY );
   1445          #endif
   1446          
   1447                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   \   000043                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000043   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   000046   E9           MOV     A,R1
   \   000047   7010         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1448                {
   1449                  // wait for auth from trust center!!
   1450                  devState = DEV_END_DEVICE_UNAUTH;
   \   000049   90....       MOV     DPTR,#devState
   \   00004C   7405         MOV     A,#0x5
   \   00004E   F0           MOVX    @DPTR,A
   1451          
   1452                  // Start the reset timer for MAX UNAUTH time
   1453                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   \   00004F                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   00004F   7A10         MOV     R2,#0x10
   \   000051   7B27         MOV     R3,#0x27
   \   000053   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   \   000056   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1454                }
   1455                else
   1456                {
   1457                  if ( ZSTACK_ROUTER_BUILD )
   1458                  {
   1459                    if ( devState == DEV_NWK_ORPHAN
   1460                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000059   90....       MOV     DPTR,#devState
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   640A         XRL     A,#0xa
   \   00005F   7010         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000061   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000064   E0           MOVX    A,@DPTR
   \   000065   5407         ANL     A,#0x7
   \   000067   6402         XRL     A,#0x2
   \   000069   6006         JZ      ??ZDApp_ProcessNetworkJoin_5
   1461                    {
   1462                      // Change NIB state to router for restore
   1463                      _NIB.nwkState = NWK_ROUTER;
   \   00006B   90....       MOV     DPTR,#_NIB + 35
   \   00006E   7408         MOV     A,#0x8
   \   000070   F0           MOVX    @DPTR,A
   1464                    }
   1465                  }
   1466          
   1467                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000071   90....       MOV     DPTR,#devState
   \   000074   E0           MOVX    A,@DPTR
   \   000075   6403         XRL     A,#0x3
   \   000077   7003         JNZ     ??ZDApp_ProcessNetworkJoin_6
   1468                  {
   1469                    ZDApp_AnnounceNewAddress();
   \   000079                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000079   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1470                  }
   1471          
   1472                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   00007C   90....       MOV     DPTR,#devState
   \   00007F   7406         MOV     A,#0x6
   \   000081   F0           MOVX    @DPTR,A
   1473                  if ( ZSTACK_ROUTER_BUILD )
   1474                  {
   1475                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1476                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000082   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000085   E0           MOVX    A,@DPTR
   \   000086   5407         ANL     A,#0x7
   \   000088   6402         XRL     A,#0x2
   \   00008A   7003         JNZ     $+5
   \   00008C   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1477                    {
   1478                      NLME_StartRouterRequest( 0, 0, false );
   \   00008F                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00008F   7B00         MOV     R3,#0x0
   \   000091   7A00         MOV     R2,#0x0
   \   000093   7900         MOV     R1,#0x0
   \   000095   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000098   E9           MOV     A,R1
   \   000099   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1479                    }
   1480                  }
   1481                }
   1482              }
   1483              else
   1484              {
   1485                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   00009C   90....       MOV     DPTR,#devStartMode
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   6401         XRL     A,#0x1
   \   0000A2   703F         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   0000A4   90....       MOV     DPTR,#retryCnt
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   2401         ADD     A,#0x1
   \   0000AA   90....       MOV     DPTR,#retryCnt
   \   0000AD   F0           MOVX    @DPTR,A
   \   0000AE   C3           CLR     C
   \   0000AF   9403         SUBB    A,#0x3
   \   0000B1   4030         JC      ??ZDApp_ProcessNetworkJoin_7
   1486                {
   1487                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   0000B3   90....       MOV     DPTR,#_NIB + 33
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FF         XRL     A,#0xff
   \   0000B9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   0000BF   600E         JZ      ??ZDApp_ProcessNetworkJoin_9
   \   0000C1   90....       MOV     DPTR,#_NIB + 33
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   64FE         XRL     A,#0xfe
   \   0000C7   7004         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   0000C9   A3           INC     DPTR
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000CD   7008         JNZ     ??ZDApp_ProcessNetworkJoin_11
   1488                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   0000CF   90....       MOV     DPTR,#devStartMode
   \   0000D2   7400         MOV     A,#0x0
   \   0000D4   F0           MOVX    @DPTR,A
   \   0000D5   800C         SJMP    ??ZDApp_ProcessNetworkJoin_7
   1489                  else
   1490                  {
   1491                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000D7   90....       MOV     DPTR,#devStartMode
   \   0000DA   7403         MOV     A,#0x3
   \   0000DC   F0           MOVX    @DPTR,A
   1492                    _tmpRejoinState = true;
   \   0000DD   90....       MOV     DPTR,#_tmpRejoinState
   \   0000E0   7401         MOV     A,#0x1
   \   0000E2   F0           MOVX    @DPTR,A
   1493                  }
   1494                }
   1495          
   1496                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1497                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   0000E3                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000E3   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000E6   8A..         MOV     ?V0 + 0,R2
   \   0000E8   8B..         MOV     ?V0 + 1,R3
   \   0000EA   74FE         MOV     A,#-0x2
   \   0000EC   65..         XRL     A,?V0 + 0
   \   0000EE   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000F0   74FF         MOV     A,#-0x1
   \   0000F2   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000F4   700E         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000F6   90....       MOV     DPTR,#_NIB + 20
   \   0000F9   E0           MOVX    A,@DPTR
   \   0000FA   64FE         XRL     A,#0xfe
   \   0000FC   7004         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000FE   A3           INC     DPTR
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   000102   6027         JZ      ??ZDApp_ProcessNetworkJoin_15
   1498                {
   1499                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   000104   85..82       MOV     DPL,?XSP + 0
   \   000107   85..83       MOV     DPH,?XSP + 1
   \   00010A   74FE         MOV     A,#-0x2
   \   00010C   F0           MOVX    @DPTR,A
   \   00010D   A3           INC     DPTR
   \   00010E   74FF         MOV     A,#-0x1
   \   000110   F0           MOVX    @DPTR,A
   1500                  // Invalidate nwk addr so end device does not use in its data reqs.
   1501                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   000111   90....       MOV     DPTR,#_NIB + 20
   \   000114   74FE         MOV     A,#-0x2
   \   000116   F0           MOVX    @DPTR,A
   \   000117   A3           INC     DPTR
   \   000118   74FF         MOV     A,#-0x1
   \   00011A   F0           MOVX    @DPTR,A
   1502                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   00011B                ; Setup parameters for call to function ZMacSetReq
   \   00011B   85..82       MOV     DPL,?XSP + 0
   \   00011E   85..83       MOV     DPH,?XSP + 1
   \   000121   AA82         MOV     R2,DPL
   \   000123   AB83         MOV     R3,DPH
   \   000125   7953         MOV     R1,#0x53
   \   000127   12....       LCALL   ??ZMacSetReq?relay
   \   00012A   E9           MOV     A,R1
   1503                }
   1504          
   1505                // Clear the neighbor Table and network discovery tables.
   1506                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   00012B                ; Setup parameters for call to function nwkNeighborInitTable
   \   00012B   12....       LCALL   ??nwkNeighborInitTable?relay
   1507                NLME_NwkDiscTerm();
   \   00012E                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   00012E   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1508          
   1509                zdoDiscCounter = 1;
   \   000131   90....       MOV     DPTR,#zdoDiscCounter
   \   000134   7401         MOV     A,#0x1
   \   000136   F0           MOVX    @DPTR,A
   1510          
   1511          //      ZDApp_NetworkInit( (uint16)
   1512          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1513          //                          (NWK_START_DELAY * 5)) );
   1514                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1515                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000137                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000137                ; Setup parameters for call to function osal_rand
   \   000137   12....       LCALL   ??osal_rand?relay
   \   00013A   8A..         MOV     ?V0 + 0,R2
   \   00013C   8B..         MOV     ?V0 + 1,R3
   \   00013E   E5..         MOV     A,?V0 + 0
   \   000140   547F         ANL     A,#0x7f
   \   000142   F8           MOV     R0,A
   \   000143   E5..         MOV     A,?V0 + 1
   \   000145   5400         ANL     A,#0x0
   \   000147   F9           MOV     R1,A
   \   000148   E8           MOV     A,R0
   \   000149   2464         ADD     A,#0x64
   \   00014B   FA           MOV     R2,A
   \   00014C   E9           MOV     A,R1
   \   00014D   3400         ADDC    A,#0x0
   \   00014F   FB           MOV     R3,A
   \   000150   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000153   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1516              }
   1517            }
   1518            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   000156   90....       MOV     DPTR,#devState
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   640A         XRL     A,#0xa
   \   00015C   600B         JZ      ??ZDApp_ProcessNetworkJoin_16
   \   00015E   90....       MOV     DPTR,#devState
   \   000161   E0           MOVX    A,@DPTR
   \   000162   6404         XRL     A,#0x4
   \   000164   6003         JZ      $+5
   \   000166   02....       LJMP    ??ZDApp_ProcessNetworkJoin_17 & 0xFFFF
   1519            {
   1520              // results of an orphaning attempt by this device
   1521              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   000169   90....       MOV     DPTR,#nwkStatus
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   7054         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1522              {
   1523                if ( ZG_SECURE_ENABLED )
   1524                {
   1525                  ZDApp_RestoreNwkKey();
   \   00016F                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   00016F   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   000172   E9           MOV     A,R1
   1526                }
   1527          
   1528                devState = DEV_END_DEVICE;
   \   000173   90....       MOV     DPTR,#devState
   \   000176   7406         MOV     A,#0x6
   \   000178   F0           MOVX    @DPTR,A
   1529                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000179                ; Setup parameters for call to function osal_set_event
   \   000179   7A10         MOV     R2,#0x10
   \   00017B   7B00         MOV     R3,#0x0
   \   00017D   90....       MOV     DPTR,#ZDAppTaskID
   \   000180   E0           MOVX    A,@DPTR
   \   000181   F9           MOV     R1,A
   \   000182   12....       LCALL   ??osal_set_event?relay
   \   000185   E9           MOV     A,R1
   1530                zdoDiscCounter = 1;
   \   000186   90....       MOV     DPTR,#zdoDiscCounter
   \   000189   7401         MOV     A,#0x1
   \   00018B   F0           MOVX    @DPTR,A
   1531                
   1532                // setup Power Manager Device
   1533          #if defined ( POWER_SAVING )
   1534                osal_pwrmgr_device( PWRMGR_BATTERY );
   1535          #endif
   1536          
   1537                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   00018C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00018F   E0           MOVX    A,@DPTR
   \   000190   A2E3         MOV     C,0xE0 /* A   */.3
   \   000192   5015         JNC     ??ZDApp_ProcessNetworkJoin_19
   1538                {
   1539                  // The receiver is on, turn network layer polling off.
   1540                  NLME_SetPollRate( 0 );
   \   000194                ; Setup parameters for call to function NLME_SetPollRate
   \   000194   7A00         MOV     R2,#0x0
   \   000196   7B00         MOV     R3,#0x0
   \   000198   12....       LCALL   ??NLME_SetPollRate?relay
   1541                  NLME_SetQueuedPollRate( 0 );
   \   00019B                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   00019B   7A00         MOV     R2,#0x0
   \   00019D   7B00         MOV     R3,#0x0
   \   00019F   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1542                  NLME_SetResponseRate( 0 );
   \   0001A2                ; Setup parameters for call to function NLME_SetResponseRate
   \   0001A2   7A00         MOV     R2,#0x0
   \   0001A4   7B00         MOV     R3,#0x0
   \   0001A6   12....       LCALL   ??NLME_SetResponseRate?relay
   1543                }
   1544          
   1545                if ( ZSTACK_ROUTER_BUILD )
   1546                {
   1547                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1548                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   0001A9   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   0001AC   E0           MOVX    A,@DPTR
   \   0001AD   5407         ANL     A,#0x7
   \   0001AF   6402         XRL     A,#0x2
   \   0001B1   600A         JZ      ??ZDApp_ProcessNetworkJoin_20
   1549                  {
   1550                    NLME_StartRouterRequest( 0, 0, false );
   \   0001B3                ; Setup parameters for call to function NLME_StartRouterRequest
   \   0001B3   7B00         MOV     R3,#0x0
   \   0001B5   7A00         MOV     R2,#0x0
   \   0001B7   7900         MOV     R1,#0x0
   \   0001B9   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   0001BC   E9           MOV     A,R1
   1551                  }
   1552                }
   1553          
   1554                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   0001BD                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   0001BD   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   0001C0   02....       LJMP    ??ZDApp_ProcessNetworkJoin_4 & 0xFFFF
   1555              }
   1556              else
   1557              {
   1558                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   0001C3   90....       MOV     DPTR,#devStartMode
   \   0001C6   E0           MOVX    A,@DPTR
   \   0001C7   6401         XRL     A,#0x1
   \   0001C9   704F         JNZ     ??ZDApp_ProcessNetworkJoin_21
   1559                {
   1560                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   0001CB   90....       MOV     DPTR,#retryCnt
   \   0001CE   E0           MOVX    A,@DPTR
   \   0001CF   2401         ADD     A,#0x1
   \   0001D1   90....       MOV     DPTR,#retryCnt
   \   0001D4   F0           MOVX    @DPTR,A
   \   0001D5   C3           CLR     C
   \   0001D6   9404         SUBB    A,#0x4
   \   0001D8   5032         JNC     ??ZDApp_ProcessNetworkJoin_22
   1561                  {
   1562                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   0001DA   90....       MOV     DPTR,#_NIB + 33
   \   0001DD   E0           MOVX    A,@DPTR
   \   0001DE   64FF         XRL     A,#0xff
   \   0001E0   7004         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   0001E2   A3           INC     DPTR
   \   0001E3   E0           MOVX    A,@DPTR
   \   0001E4   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   0001E6   600E         JZ      ??ZDApp_ProcessNetworkJoin_24
   \   0001E8   90....       MOV     DPTR,#_NIB + 33
   \   0001EB   E0           MOVX    A,@DPTR
   \   0001EC   64FE         XRL     A,#0xfe
   \   0001EE   7004         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   0001F0   A3           INC     DPTR
   \   0001F1   E0           MOVX    A,@DPTR
   \   0001F2   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   0001F4   7008         JNZ     ??ZDApp_ProcessNetworkJoin_26
   1563                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   0001F6   90....       MOV     DPTR,#devStartMode
   \   0001F9   7400         MOV     A,#0x0
   \   0001FB   F0           MOVX    @DPTR,A
   \   0001FC   801C         SJMP    ??ZDApp_ProcessNetworkJoin_21
   1564                    else
   1565                    {
   1566                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   0001FE   90....       MOV     DPTR,#devStartMode
   \   000201   7403         MOV     A,#0x3
   \   000203   F0           MOVX    @DPTR,A
   1567                      _tmpRejoinState = true;
   \   000204   90....       MOV     DPTR,#_tmpRejoinState
   \   000207   7401         MOV     A,#0x1
   \   000209   F0           MOVX    @DPTR,A
   \   00020A   800E         SJMP    ??ZDApp_ProcessNetworkJoin_21
   1568                    }
   1569                  }
   1570                  // Do a normal join to the network after certain times of rejoin retries
   1571                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00020C   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00020F   E0           MOVX    A,@DPTR
   \   000210   6401         XRL     A,#0x1
   \   000212   7006         JNZ     ??ZDApp_ProcessNetworkJoin_21
   1572                  {
   1573                    devStartMode = MODE_JOIN;
   \   000214   90....       MOV     DPTR,#devStartMode
   \   000217   7400         MOV     A,#0x0
   \   000219   F0           MOVX    @DPTR,A
   1574                  }
   1575                }
   1576          
   1577                // Clear the neighbor Table and network discovery tables.
   1578                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00021A                ; Setup parameters for call to function nwkNeighborInitTable
   \   00021A   12....       LCALL   ??nwkNeighborInitTable?relay
   1579                NLME_NwkDiscTerm();
   \   00021D                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   00021D   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1580          
   1581                
   1582                
   1583               
   1584           
   1585                // setup a retry for later...
   1586                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1587                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   000220                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000220                ; Setup parameters for call to function osal_rand
   \   000220   12....       LCALL   ??osal_rand?relay
   \   000223   8A..         MOV     ?V0 + 0,R2
   \   000225   8B..         MOV     ?V0 + 1,R3
   \   000227   E5..         MOV     A,?V0 + 0
   \   000229   547F         ANL     A,#0x7f
   \   00022B   F8           MOV     R0,A
   \   00022C   E5..         MOV     A,?V0 + 1
   \   00022E   5400         ANL     A,#0x0
   \   000230   F9           MOV     R1,A
   \   000231   E8           MOV     A,R0
   \   000232   2464         ADD     A,#0x64
   \   000234   FA           MOV     R2,A
   \   000235   E9           MOV     A,R1
   \   000236   3400         ADDC    A,#0x0
   \   000238   FB           MOV     R3,A
   \   000239   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   00023C   8018         SJMP    ??ZDApp_ProcessNetworkJoin_4
   1588               
   1589                 
   1590              }
   1591            }
   1592          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1593            else
   1594            {
   1595              // Assume from address conflict
   1596              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   00023E   90....       MOV     DPTR,#_NIB + 96
   \   000241   E0           MOVX    A,@DPTR
   \   000242   6402         XRL     A,#0x2
   \   000244   7010         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1597              {
   1598                // Notify the network
   1599                ZDApp_AnnounceNewAddress();
   \   000246                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000246   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1600          
   1601                // Notify apps
   1602                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000249                ; Setup parameters for call to function osal_set_event
   \   000249   7A10         MOV     R2,#0x10
   \   00024B   7B00         MOV     R3,#0x0
   \   00024D   90....       MOV     DPTR,#ZDAppTaskID
   \   000250   E0           MOVX    A,@DPTR
   \   000251   F9           MOV     R1,A
   \   000252   12....       LCALL   ??osal_set_event?relay
   \   000255   E9           MOV     A,R1
   1603              }
   1604            }
   1605          #endif
   1606          }
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000256   7402         MOV     A,#0x2
   \   000258   12....       LCALL   ?DEALLOC_XSTACK8
   \   00025B   7F02         MOV     R7,#0x2
   \   00025D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1607          
   1608          /*********************************************************************
   1609           * @fn      ZDApp_SaveNwkKey()
   1610           *
   1611           * @brief   Save off the Network key information.
   1612           *
   1613           * @param   none
   1614           *
   1615           * @return  none
   1616           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1617          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1618          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1619            nwkActiveKeyItems keyItems;
   1620          
   1621            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1622            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1623          
   1624            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1625                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7C00         MOV     R4,#0x0
   \   000047   7D00         MOV     R5,#0x0
   \   000049   7A82         MOV     R2,#-0x7e
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_write?relay
   \   000050   7404         MOV     A,#0x4
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   \   000055   E9           MOV     A,R1
   1626          
   1627            nwkFrameCounterChanges = 0;
   \   000056   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000059   7400         MOV     A,#0x0
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   7400         MOV     A,#0x0
   \   00005F   F0           MOVX    @DPTR,A
   1628          
   1629            // Clear copy in RAM before return.
   1630            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \   000060                ; Setup parameters for call to function osal_memset
   \   000060   7C15         MOV     R4,#0x15
   \   000062   7D00         MOV     R5,#0x0
   \   000064   7900         MOV     R1,#0x0
   \   000066   85..82       MOV     DPL,?XSP + 0
   \   000069   85..83       MOV     DPH,?XSP + 1
   \   00006C   AA82         MOV     R2,DPL
   \   00006E   AB83         MOV     R3,DPH
   \   000070   12....       LCALL   ??osal_memset?relay
   1631          
   1632          }
   \   000073   7415         MOV     A,#0x15
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   7F04         MOV     R7,#0x4
   \   00007A   02....       LJMP    ?BANKED_LEAVE_XDATA
   1633          
   1634          /*********************************************************************
   1635           * @fn      ZDApp_ResetNwkKey()
   1636           *
   1637           * @brief   Reset the Network key information in NV.
   1638           *
   1639           * @param   none
   1640           *
   1641           * @return  none
   1642           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1643          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1644          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1645            nwkActiveKeyItems keyItems;
   1646          
   1647            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1648            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1649                          (void *)&keyItems );
   \   00001D                ; Setup parameters for call to function osal_nv_write
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..15       MOV     ?V0 + 0,#0x15
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A82         MOV     R2,#-0x7e
   \   00003F   7B00         MOV     R3,#0x0
   \   000041   12....       LCALL   ??osal_nv_write?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   1650          }
   \   00004A   7415         MOV     A,#0x15
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004F   7F02         MOV     R7,#0x2
   \   000051   02....       LJMP    ?BANKED_LEAVE_XDATA
   1651          
   1652          /*********************************************************************
   1653           * @fn      ZDApp_RestoreNwkKey()
   1654           *
   1655           * @brief
   1656           *
   1657           *   Save off the Network key information.
   1658           *
   1659           * @param   none
   1660           *
   1661           * @return  true if restored from NV, false if not
   1662           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1663          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1664          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1665            nwkActiveKeyItems keyItems;
   1666            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1667          
   1668            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1669                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   75..00       MOV     ?V0 + 1,#0x0
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   7C00         MOV     R4,#0x0
   \   00002A   7D00         MOV     R5,#0x0
   \   00002C   7A82         MOV     R2,#-0x7e
   \   00002E   7B00         MOV     R3,#0x0
   \   000030   12....       LCALL   ??osal_nv_read?relay
   \   000033   7404         MOV     A,#0x4
   \   000035   12....       LCALL   ?DEALLOC_XSTACK8
   \   000038   E9           MOV     A,R1
   \   000039   7040         JNZ     ??ZDApp_RestoreNwkKey_0
   1670            {
   1671              if ( keyItems.frameCounter > 0 )
   \   00003B   7411         MOV     A,#0x11
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?L_MOV_X
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   45..         ORL     A,?V0 + 1
   \   000049   45..         ORL     A,?V0 + 2
   \   00004B   45..         ORL     A,?V0 + 3
   \   00004D   6022         JZ      ??ZDApp_RestoreNwkKey_1
   1672              {
   1673                // Restore the key information
   1674                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   \   00004F   90....       MOV     DPTR,#__Constant_3e8
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?L_MOV_X
   \   000057   7411         MOV     A,#0x11
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   78..         MOV     R0,#?V0 + 0
   \   00005E   12....       LCALL   ?L_ADD_TO_X
   1675                nwkFrameCounter = keyItems.frameCounter;
   \   000061   7411         MOV     A,#0x11
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   12....       LCALL   ?XLOAD_R2345
   \   000069   90....       MOV     DPTR,#nwkFrameCounter
   \   00006C   12....       LCALL   ?XSTORE_R2345
   1676                ret = true;
   \   00006F   7E01         MOV     R6,#0x1
   1677              }
   1678          
   1679              // Force a save for the first frame counter increment
   1680              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   000071   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000074   74E9         MOV     A,#-0x17
   \   000076   F0           MOVX    @DPTR,A
   \   000077   A3           INC     DPTR
   \   000078   7403         MOV     A,#0x3
   \   00007A   F0           MOVX    @DPTR,A
   1681            }
   1682            // Clear copy in RAM before return.
   1683            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   00007B                ; Setup parameters for call to function osal_memset
   \   00007B   7C15         MOV     R4,#0x15
   \   00007D   7D00         MOV     R5,#0x0
   \   00007F   7900         MOV     R1,#0x0
   \   000081   85..82       MOV     DPL,?XSP + 0
   \   000084   85..83       MOV     DPH,?XSP + 1
   \   000087   AA82         MOV     R2,DPL
   \   000089   AB83         MOV     R3,DPH
   \   00008B   12....       LCALL   ??osal_memset?relay
   1684          
   1685            return ( ret );
   \   00008E   EE           MOV     A,R6
   \   00008F   F9           MOV     R1,A
   \   000090   7415         MOV     A,#0x15
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   7F04         MOV     R7,#0x4
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA
   1686          }
   1687          
   1688          /*********************************************************************
   1689           * @fn      ZDApp_ResetTimerStart
   1690           *
   1691           * @brief   Start the reset timer.
   1692           *
   1693           * @param   delay - delay time(ms) before reset
   1694           *
   1695           * @return  none
   1696           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1697          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1698          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1699            // Start the rest timer
   1700            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   EE           MOV     A,R6
   \   00000A   FC           MOV     R4,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FD           MOV     R5,A
   \   00000D   7A04         MOV     R2,#0x4
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   90....       MOV     DPTR,#ZDAppTaskID
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F9           MOV     R1,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
   \   000019   E9           MOV     A,R1
   1701          }
   \   00001A   7F01         MOV     R7,#0x1
   \   00001C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1702          
   1703          /*********************************************************************
   1704           * @fn      ZDApp_ResetTimerCancel
   1705           *
   1706           * @brief   Cancel the reset timer.
   1707           *
   1708           * @param   none
   1709           *
   1710           * @return  none
   1711           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1712          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1713          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1714            // Cancel the reset timer
   1715            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   \   000010   E9           MOV     A,R1
   1716          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
   1717          
   1718          /*********************************************************************
   1719           * @fn      ZDApp_LeaveCtrlInit
   1720           *
   1721           * @brief   Initialize the leave control logic.
   1722           *
   1723           * @param   none
   1724           *
   1725           * @return  none
   1726           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1727          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1728          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1729            uint8 status;
   1730          
   1731          
   1732            // Initialize control state
   1733            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1734          
   1735            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1736                                        sizeof(ZDApp_LeaveCtrl),
   1737                                        &ZDApp_LeaveCtrl );
   \   00000B                ; Setup parameters for call to function osal_nv_item_init
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   7C01         MOV     R4,#0x1
   \   000018   7D00         MOV     R5,#0x0
   \   00001A   7A85         MOV     R2,#-0x7b
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??osal_nv_item_init?relay
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?DEALLOC_XSTACK8
   \   000026   E9           MOV     A,R1
   \   000027   FE           MOV     R6,A
   1738          
   1739            if ( status == ZSUCCESS )
   \   000028   7027         JNZ     ??ZDApp_LeaveCtrlInit_0
   1740            {
   1741              // Read saved control
   1742              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1743                            0,
   1744                            sizeof( uint8 ),
   1745                            &ZDApp_LeaveCtrl);
   \   00002A                ; Setup parameters for call to function osal_nv_read
   \   00002A   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00002D   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   75..01       MOV     ?V0 + 0,#0x1
   \   000038   75..00       MOV     ?V0 + 1,#0x0
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000040   7C00         MOV     R4,#0x0
   \   000042   7D00         MOV     R5,#0x0
   \   000044   7A85         MOV     R2,#-0x7b
   \   000046   7B00         MOV     R3,#0x0
   \   000048   12....       LCALL   ??osal_nv_read?relay
   \   00004B   7404         MOV     A,#0x4
   \   00004D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000050   E9           MOV     A,R1
   1746            }
   1747          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   000051   7F02         MOV     R7,#0x2
   \   000053   02....       LJMP    ?BANKED_LEAVE_XDATA
   1748          
   1749          /*********************************************************************
   1750           * @fn      ZDApp_LeaveCtrlSet
   1751           *
   1752           * @brief   Set the leave control logic.
   1753           *
   1754           * @param   ra - reassociate flag
   1755           *
   1756           * @return  none
   1757           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1758          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1759          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1760            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1761          
   1762            if ( ra == TRUE )
   \   00000D   7401         MOV     A,#0x1
   \   00000F   6E           XRL     A,R6
   \   000010   7007         JNZ     ??ZDApp_LeaveCtrlSet_0
   1763            {
   1764              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000012   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000015   E0           MOVX    A,@DPTR
   \   000016   D2E1         SETB    0xE0 /* A   */.1
   \   000018   F0           MOVX    @DPTR,A
   1765            }
   1766          
   1767            // Write the leave control
   1768            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1769                           0,
   1770                           sizeof( uint8 ),
   1771                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000019                ; Setup parameters for call to function osal_nv_write
   \   000019   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00001C   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000024   75..01       MOV     ?V0 + 0,#0x1
   \   000027   75..00       MOV     ?V0 + 1,#0x0
   \   00002A   78..         MOV     R0,#?V0 + 0
   \   00002C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002F   7C00         MOV     R4,#0x0
   \   000031   7D00         MOV     R5,#0x0
   \   000033   7A85         MOV     R2,#-0x7b
   \   000035   7B00         MOV     R3,#0x0
   \   000037   12....       LCALL   ??osal_nv_write?relay
   \   00003A   7404         MOV     A,#0x4
   \   00003C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003F   E9           MOV     A,R1
   1772          }
   \   000040   7F02         MOV     R7,#0x2
   \   000042   02....       LJMP    ?BANKED_LEAVE_XDATA
   1773          
   1774          /*********************************************************************
   1775           * @fn      ZDApp_LeaveCtrlReset
   1776           *
   1777           * @brief   Re-initialize the leave control logic.
   1778           *
   1779           * @param   none
   1780           *
   1781           * @return  none
   1782           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1783          void ZDApp_LeaveCtrlReset( void )
   \                     ZDApp_LeaveCtrlReset:
   1784          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1785            // Set leave control to initialized state
   1786            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   7400         MOV     A,#0x0
   \   00000A   F0           MOVX    @DPTR,A
   1787          
   1788            // Write initialized control
   1789            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1790                          0,
   1791                          sizeof( uint8 ),
   1792                          &ZDApp_LeaveCtrl);
   \   00000B                ; Setup parameters for call to function osal_nv_write
   \   00000B   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000E   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   75..01       MOV     ?V0 + 0,#0x1
   \   000019   75..00       MOV     ?V0 + 1,#0x0
   \   00001C   78..         MOV     R0,#?V0 + 0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   7C00         MOV     R4,#0x0
   \   000023   7D00         MOV     R5,#0x0
   \   000025   7A85         MOV     R2,#-0x7b
   \   000027   7B00         MOV     R3,#0x0
   \   000029   12....       LCALL   ??osal_nv_write?relay
   \   00002C   7404         MOV     A,#0x4
   \   00002E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000031   E9           MOV     A,R1
   1793          }
   \   000032   7F02         MOV     R7,#0x2
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
   1794          
   1795          /*********************************************************************
   1796           * @fn      ZDApp_LeaveCtrlBypass
   1797           *
   1798           * @brief   Check if NV restore should be skipped during a leave reset.
   1799           *
   1800           * @param   none
   1801           *
   1802           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1803           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1804          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1805          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1806            uint8 bypass;
   1807          
   1808            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   5004         JNC     ??ZDApp_LeaveCtrlBypass_0
   1809            {
   1810              bypass = TRUE;
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   8002         SJMP    ??ZDApp_LeaveCtrlBypass_1
   1811            }
   1812            else
   1813            {
   1814              bypass = FALSE;
   \                     ??ZDApp_LeaveCtrlBypass_0:
   \   000010   7900         MOV     R1,#0x0
   1815            }
   1816          
   1817            return bypass;
   \                     ??ZDApp_LeaveCtrlBypass_1:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1818          }
   1819          
   1820          /*********************************************************************
   1821           * @fn      ZDApp_LeaveCtrlStartup
   1822           *
   1823           * @brief   Check for startup conditions during a leave reset.
   1824           *
   1825           * @param   state      - devState_t determined by leave control logic
   1826           * @param   startDelay - startup delay
   1827           *
   1828           * @return  none
   1829           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1830          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1831          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   1832            *startDelay = 0;
   \   00000D   85..82       MOV     DPL,?V0 + 0
   \   000010   85..83       MOV     DPH,?V0 + 1
   \   000013   7400         MOV     A,#0x0
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   1833          
   1834            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00001A   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000020   5021         JNC     ??ZDApp_LeaveCtrlStartup_0
   1835            {
   1836              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000022   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000025   E0           MOVX    A,@DPTR
   \   000026   A2E1         MOV     C,0xE0 /* A   */.1
   \   000028   500F         JNC     ??ZDApp_LeaveCtrlStartup_1
   1837              {
   1838                *startDelay = LEAVE_RESET_DELAY;
   \   00002A   85..82       MOV     DPL,?V0 + 0
   \   00002D   85..83       MOV     DPH,?V0 + 1
   \   000030   7488         MOV     A,#-0x78
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   7413         MOV     A,#0x13
   \   000036   F0           MOVX    @DPTR,A
   \   000037   8007         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1839              }
   1840              else
   1841              {
   1842                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000039   8E82         MOV     DPL,R6
   \   00003B   8F83         MOV     DPH,R7
   \   00003D   7400         MOV     A,#0x0
   \   00003F   F0           MOVX    @DPTR,A
   1843              }
   1844          
   1845              // Reset leave control logic
   1846              ZDApp_LeaveCtrlReset();
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   000040                ; Setup parameters for call to function ZDApp_LeaveCtrlReset
   \   000040   12....       LCALL   ??ZDApp_LeaveCtrlReset?relay
   1847            }
   1848          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   1849          
   1850          /*********************************************************************
   1851           * @fn      ZDApp_LeaveReset
   1852           *
   1853           * @brief   Setup a device reset due to a leave indication/confirm.
   1854           *
   1855           * @param   ra - reassociate flag
   1856           *
   1857           * @return  none
   1858           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1859          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1860          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1861            ZDApp_LeaveCtrlSet( ra );
   \   000007                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000007   F9           MOV     R1,A
   \   000008   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1862          
   1863            ZDApp_ResetTimerStart( LEAVE_RESET_DELAY );
   \   00000B                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   00000B   7A88         MOV     R2,#-0x78
   \   00000D   7B13         MOV     R3,#0x13
   \   00000F   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1864          }
   \   000012   7F01         MOV     R7,#0x1
   \   000014   02....       LJMP    ?BANKED_LEAVE_XDATA
   1865          
   1866          /*********************************************************************
   1867           * @fn      ZDApp_LeaveUpdate
   1868           *
   1869           * @brief   Update local device data related to leaving device.
   1870           *
   1871           * @param   nwkAddr        - NWK address of leaving device
   1872           * @param   extAddr        - EXT address of leaving device
   1873           * @param   removeChildren - remove children of leaving device
   1874           *
   1875           * @return  none
   1876           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1877          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1878                                  uint8 removeChildren )
   1879          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   1880            // Remove Apps Key for leaving device
   1881            ZDSecMgrDeviceRemoveByExtAddr(extAddr);
   \   000014                ; Setup parameters for call to function ZDSecMgrDeviceRemoveByExtAddr
   \   000014   EE           MOV     A,R6
   \   000015   FA           MOV     R2,A
   \   000016   EF           MOV     A,R7
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??ZDSecMgrDeviceRemoveByExtAddr?relay
   \   00001B   E9           MOV     A,R1
   1882          
   1883            // Clear SECURITY bit from Address Manager
   1884            ZDSecMgrAddrClear( extAddr );
   \   00001C                ; Setup parameters for call to function ZDSecMgrAddrClear
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   12....       LCALL   ??ZDSecMgrAddrClear?relay
   \   000023   E9           MOV     A,R1
   1885          
   1886            if ( pbindRemoveDev )
   \   000024   90....       MOV     DPTR,#pbindRemoveDev
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F8           MOV     R0,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   E8           MOV     A,R0
   \   00002D   49           ORL     A,R1
   \   00002E   6041         JZ      ??ZDApp_LeaveUpdate_0
   1887            {
   1888              zAddrType_t devAddr;
   1889          
   1890              // Remove bind entry and all related data
   1891              devAddr.addrMode = Addr64Bit;
   \   000030   7408         MOV     A,#0x8
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7403         MOV     A,#0x3
   \   000037   F0           MOVX    @DPTR,A
   1892              osal_memcpy(devAddr.addr.extAddr, extAddr, Z_EXTADDR_LEN);
   \   000038                ; Setup parameters for call to function osal_memcpy
   \   000038   8E..         MOV     ?V0 + 4,R6
   \   00003A   8F..         MOV     ?V0 + 5,R7
   \   00003C   75..00       MOV     ?V0 + 6,#0x0
   \   00003F   78..         MOV     R0,#?V0 + 4
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000044   7C08         MOV     R4,#0x8
   \   000046   7D00         MOV     R5,#0x0
   \   000048   7403         MOV     A,#0x3
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   AA82         MOV     R2,DPL
   \   00004F   AB83         MOV     R3,DPH
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   1893          
   1894              pbindRemoveDev(&devAddr);
   \   000059                ; Setup parameters for indirect call
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   AA82         MOV     R2,DPL
   \   000061   AB83         MOV     R3,DPH
   \   000063   90....       MOV     DPTR,#pbindRemoveDev
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F583         MOV     DPH,A
   \   00006C   8882         MOV     DPL,R0
   \   00006E   12....       LCALL   ?CALL_IND
   1895            }
   1896          
   1897            // Remove if child
   1898            if ( ZSTACK_ROUTER_BUILD )
   1899            {
   1900              NLME_RemoveChild( extAddr, removeChildren );
   \                     ??ZDApp_LeaveUpdate_0:
   \   000071                ; Setup parameters for call to function NLME_RemoveChild
   \   000071   A9..         MOV     R1,?V0 + 2
   \   000073   EE           MOV     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   FB           MOV     R3,A
   \   000077   12....       LCALL   ??NLME_RemoveChild?relay
   1901            }
   1902          
   1903            // Remove Routing table related entry
   1904            RTG_RemoveRtgEntry( nwkAddr, 0 );
   \   00007A                ; Setup parameters for call to function RTG_RemoveRtgEntry
   \   00007A   7900         MOV     R1,#0x0
   \   00007C   AA..         MOV     R2,?V0 + 0
   \   00007E   AB..         MOV     R3,?V0 + 1
   \   000080   12....       LCALL   ??RTG_RemoveRtgEntry?relay
   \   000083   E9           MOV     A,R1
   1905          
   1906            // Remove entry from neighborTable
   1907            nwkNeighborRemove( nwkAddr, _NIB.nwkPanId );
   \   000084                ; Setup parameters for call to function nwkNeighborRemove
   \   000084   90....       MOV     DPTR,#_NIB + 33
   \   000087   E0           MOVX    A,@DPTR
   \   000088   FC           MOV     R4,A
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   FD           MOV     R5,A
   \   00008C   AA..         MOV     R2,?V0 + 0
   \   00008E   AB..         MOV     R3,?V0 + 1
   \   000090   12....       LCALL   ??nwkNeighborRemove?relay
   1908          
   1909            // Schedule to save data to NV
   1910            ZDApp_NwkWriteNVRequest();
   \   000093                ; Setup parameters for call to function AddrMgrWriteNVRequest
   \   000093   12....       LCALL   ??AddrMgrWriteNVRequest?relay
   1911          }
   \   000096   7409         MOV     A,#0x9
   \   000098   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009B   7F07         MOV     R7,#0x7
   \   00009D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1912          
   1913          /*********************************************************************
   1914           * @fn      ZDApp_NetworkDiscoveryReq
   1915           *
   1916           * @brief   Request a network discovery.
   1917           *
   1918           * @param  scanChannels -
   1919           * @param  scanDuration -
   1920           *
   1921           * @return  ZStatus_t
   1922           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1923          ZStatus_t ZDApp_NetworkDiscoveryReq( uint32 scanChannels, uint8 scanDuration)
   \                     ZDApp_NetworkDiscoveryReq:
   1924          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
   \   00000D   E9           MOV     A,R1
   \   00000E   FE           MOV     R6,A
   1925            // Setup optional filters - tbd
   1926          
   1927            // Request NLME network discovery
   1928            return NLME_NetworkDiscoveryRequest(scanChannels, scanDuration);
   \   00000F                ; Setup parameters for call to function NLME_NetworkDiscoveryRequest
   \   00000F   F9           MOV     R1,A
   \   000010   AA..         MOV     R2,?V0 + 0
   \   000012   AB..         MOV     R3,?V0 + 1
   \   000014   AC..         MOV     R4,?V0 + 2
   \   000016   AD..         MOV     R5,?V0 + 3
   \   000018   12....       LCALL   ??NLME_NetworkDiscoveryRequest?relay
   \   00001B   7F04         MOV     R7,#0x4
   \   00001D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1929          }
   1930          
   1931          /*********************************************************************
   1932           * @fn      ZDApp_JoinReq
   1933           *
   1934           * @brief   Request the device to join a parent in a network.
   1935           *
   1936           * @param   channel -
   1937           * @param   panID -
   1938           *
   1939           * @return  ZStatus_t
   1940           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1941          ZStatus_t ZDApp_JoinReq( uint8 channel, uint16 panID, uint8 *extendedPanID,
   \                     ZDApp_JoinReq:
   1942                                   uint16 chosenParent, uint8 parentDepth, uint8 stackProfile )
   1943          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 3,R1
   \   000007   8A..         MOV     ?V0 + 0,R2
   \   000009   8B..         MOV     ?V0 + 1,R3
   \   00000B   EC           MOV     A,R4
   \   00000C   FE           MOV     R6,A
   \   00000D   ED           MOV     A,R5
   \   00000E   FF           MOV     R7,A
   \   00000F   7410         MOV     A,#0x10
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 6,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 7,A
   \   00001B   7412         MOV     A,#0x12
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 4,A
   \   000023   7413         MOV     A,#0x13
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F5..         MOV     ?V0 + 2,A
   1944            // Sync up the node with the stack profile (In the case where a pro device
   1945            // joins a non-pro network, or verse versa)
   1946            ZDApp_NodeProfileSync( stackProfile);
   \   00002B                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00002B   A9..         MOV     R1,?V0 + 2
   \   00002D   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1947          
   1948            // Request NLME Join Request
   1949            return NLME_JoinRequest(extendedPanID, panID,channel,
   1950                                    ZDO_Config_Node_Descriptor.CapabilityFlags,
   1951                                    chosenParent, parentDepth);
   \   000030                ; Setup parameters for call to function NLME_JoinRequest
   \   000030   E5..         MOV     A,?V0 + 4
   \   000032   F5..         MOV     ?V0 + 5,A
   \   000034   78..         MOV     R0,#?V0 + 5
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000039   78..         MOV     R0,#?V0 + 6
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F5..         MOV     ?V0 + 5,A
   \   000044   78..         MOV     R0,#?V0 + 5
   \   000046   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000049   A9..         MOV     R1,?V0 + 3
   \   00004B   AC..         MOV     R4,?V0 + 0
   \   00004D   AD..         MOV     R5,?V0 + 1
   \   00004F   EE           MOV     A,R6
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   FB           MOV     R3,A
   \   000053   12....       LCALL   ??NLME_JoinRequest?relay
   \   000056   7404         MOV     A,#0x4
   \   000058   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005B   7F08         MOV     R7,#0x8
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1952          
   1953          }
   1954          
   1955          /*********************************************************************
   1956           * @fn      ZDApp_DeviceConfigured
   1957           *
   1958           * @brief   Check to see if the local device is configured (i.e., part
   1959           *          of a network).
   1960           *
   1961           * @param   none
   1962           *
   1963           * @return  TRUE if configured. FALSE, otherwise.
   1964           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1965          uint8 ZDApp_DeviceConfigured( void )
   \                     ZDApp_DeviceConfigured:
   1966          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1967            uint16 nwkAddr = INVALID_NODE_ADDR;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   74FE         MOV     A,#-0x2
   \   000012   F0           MOVX    @DPTR,A
   \   000013   A3           INC     DPTR
   \   000014   74FF         MOV     A,#-0x1
   \   000016   F0           MOVX    @DPTR,A
   1968          
   1969            osal_nv_read( ZCD_NV_NIB, osal_offsetof( nwkIB_t, nwkDevAddress ),
   1970                          sizeof( uint16), &nwkAddr );
   \   000017                ; Setup parameters for call to function osal_nv_read
   \   000017   85..82       MOV     DPL,?XSP + 0
   \   00001A   85..83       MOV     DPH,?XSP + 1
   \   00001D   8582..       MOV     ?V0 + 0,DPL
   \   000020   8583..       MOV     ?V0 + 1,DPH
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..02       MOV     ?V0 + 0,#0x2
   \   00002B   75..00       MOV     ?V0 + 1,#0x0
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7C14         MOV     R4,#0x14
   \   000035   7D00         MOV     R5,#0x0
   \   000037   7A21         MOV     R2,#0x21
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   12....       LCALL   ??osal_nv_read?relay
   \   00003E   7404         MOV     A,#0x4
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
   \   000043   E9           MOV     A,R1
   1971          
   1972            // Does the NIB have anything more than default?
   1973            return ( nwkAddr == INVALID_NODE_ADDR ? FALSE : TRUE );
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   64FE         XRL     A,#0xfe
   \   00004D   7004         JNZ     ??ZDApp_DeviceConfigured_0
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   64FF         XRL     A,#0xff
   \                     ??ZDApp_DeviceConfigured_0:
   \   000053   7004         JNZ     ??ZDApp_DeviceConfigured_1
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_DeviceConfigured_2
   \                     ??ZDApp_DeviceConfigured_1:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_DeviceConfigured_2:
   \   00005B   7402         MOV     A,#0x2
   \   00005D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000060   7F02         MOV     R7,#0x2
   \   000062   02....       LJMP    ?BANKED_LEAVE_XDATA
   1974          }
   1975          
   1976          /*********************************************************************
   1977           * CALLBACK FUNCTIONS
   1978           */
   1979          
   1980          
   1981          /*********************************************************************
   1982           * @fn      ZDApp_SendEventMsg()
   1983           *
   1984           * @brief
   1985           *
   1986           *   Sends a Network Join message
   1987           *
   1988           * @param  cmd - command ID
   1989           * @param  len - length (in bytes) of the buf field
   1990           * @param  buf - buffer for the rest of the message.
   1991           *
   1992           * @return  none
   1993           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1994          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1995          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   1996            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   00000D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   AB..         MOV     R3,?V0 + 1
   \   000013   AA..         MOV     R2,?V0 + 0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDApp_SendMsg?relay
   1997          }
   \   00001D   7F02         MOV     R7,#0x2
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1998          
   1999          /*********************************************************************
   2000           * @fn      ZDApp_SendMsg()
   2001           *
   2002           * @brief   Sends a OSAL message
   2003           *
   2004           * @param  taskID - Where to send the message
   2005           * @param  cmd - command ID
   2006           * @param  len - length (in bytes) of the buf field
   2007           * @param  buf - buffer for the rest of the message.
   2008           *
   2009           * @return  none
   2010           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2011          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   2012          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   8A..         MOV     ?V0 + 3,R2
   \   000009   8B..         MOV     ?V0 + 7,R3
   \   00000B   8C..         MOV     ?V0 + 0,R4
   \   00000D   8D..         MOV     ?V0 + 1,R5
   2013            osal_event_hdr_t *msgPtr;
   2014          
   2015            // Send the address to the task
   2016            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   85....       MOV     ?V0 + 4,?V0 + 7
   \   000012   75..00       MOV     ?V0 + 5,#0x0
   \   000015   AA..         MOV     R2,?V0 + 4
   \   000017   AB..         MOV     R3,?V0 + 5
   \   000019   12....       LCALL   ??osal_msg_allocate?relay
   \   00001C   8A..         MOV     ?V0 + 4,R2
   \   00001E   8B..         MOV     ?V0 + 5,R3
   \   000020   AE..         MOV     R6,?V0 + 4
   \   000022   AF..         MOV     R7,?V0 + 5
   2017            if ( msgPtr )
   \   000024   EE           MOV     A,R6
   \   000025   4F           ORL     A,R7
   \   000026   6044         JZ      ??ZDApp_SendMsg_0
   2018            {
   2019              if ( (len > 0) && (buf != NULL) )
   \   000028   E5..         MOV     A,?V0 + 7
   \   00002A   C3           CLR     C
   \   00002B   9401         SUBB    A,#0x1
   \   00002D   402A         JC      ??ZDApp_SendMsg_1
   \   00002F   E5..         MOV     A,?V0 + 0
   \   000031   45..         ORL     A,?V0 + 1
   \   000033   6024         JZ      ??ZDApp_SendMsg_1
   2020                osal_memcpy( msgPtr, buf, len );
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 0
   \   000038   85....       MOV     ?V0 + 5,?V0 + 1
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   85....       MOV     ?V0 + 4,?V0 + 7
   \   000046   75..00       MOV     ?V0 + 5,#0x0
   \   000049   AC..         MOV     R4,?V0 + 4
   \   00004B   AD..         MOV     R5,?V0 + 5
   \   00004D   EE           MOV     A,R6
   \   00004E   FA           MOV     R2,A
   \   00004F   EF           MOV     A,R7
   \   000050   FB           MOV     R3,A
   \   000051   12....       LCALL   ??osal_memcpy?relay
   \   000054   7403         MOV     A,#0x3
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   2021          
   2022              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   000059   E5..         MOV     A,?V0 + 3
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   E5..         MOV     A,?V0 + 3
   \   000061   F0           MOVX    @DPTR,A
   2023              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000062                ; Setup parameters for call to function osal_msg_send
   \   000062   EE           MOV     A,R6
   \   000063   FA           MOV     R2,A
   \   000064   EF           MOV     A,R7
   \   000065   FB           MOV     R3,A
   \   000066   A9..         MOV     R1,?V0 + 2
   \   000068   12....       LCALL   ??osal_msg_send?relay
   \   00006B   E9           MOV     A,R1
   2024            }
   2025          }
   \                     ??ZDApp_SendMsg_0:
   \   00006C   7F08         MOV     R7,#0x8
   \   00006E   02....       LJMP    ?BANKED_LEAVE_XDATA
   2026          
   2027          /*********************************************************************
   2028           * Call Back Functions from NWK  - API
   2029           */
   2030          
   2031          /*********************************************************************
   2032           * @fn          ZDO_NetworkDiscoveryConfirmCB
   2033           *
   2034           * @brief       This function returns a choice of PAN to join.
   2035           *
   2036           * @param       status - return status of the nwk discovery confirm
   2037           *
   2038           * @return      ZStatus_t
   2039           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2040          ZStatus_t ZDO_NetworkDiscoveryConfirmCB(uint8 status)
   \                     ZDO_NetworkDiscoveryConfirmCB:
   2041          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
   2042            osal_event_hdr_t msg;
   2043          
   2044            // If Scan is initiated by ZDO_MGMT_NWK_DISC_REQ
   2045            // Send ZDO_MGMT_NWK_DISC_RSP back
   2046          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   2047            if ( zdappMgmtNwkDiscReqInProgress )
   \   000011   90....       MOV     DPTR,#zdappMgmtNwkDiscReqInProgress
   \   000014   E0           MOVX    A,@DPTR
   \   000015   600B         JZ      ??ZDO_NetworkDiscoveryConfirmCB_0
   2048            {
   2049              zdappMgmtNwkDiscReqInProgress = false;
   \   000017   90....       MOV     DPTR,#zdappMgmtNwkDiscReqInProgress
   \   00001A   7400         MOV     A,#0x0
   \   00001C   F0           MOVX    @DPTR,A
   2050              ZDO_FinishProcessingMgmtNwkDiscReq();
   \   00001D                ; Setup parameters for call to function ZDO_FinishProcessingMgmtNwkDiscReq
   \   00001D   12....       LCALL   ??ZDO_FinishProcessingMgmtNwkDiscReq?relay
   \   000020   8043         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   2051            }
   2052            else
   2053          #endif
   2054            {
   2055              // Pass the confirm to another task if it registers the callback
   2056              // Otherwise, pass the confirm to ZDApp.
   2057              if (zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID] != NULL )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000022   90....       MOV     DPTR,#zdoCBFunc + 4
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F8           MOV     R0,A
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F9           MOV     R1,A
   \   00002A   E8           MOV     A,R0
   \   00002B   49           ORL     A,R1
   \   00002C   601A         JZ      ??ZDO_NetworkDiscoveryConfirmCB_2
   2058              {
   2059                zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID]( (void*)&status );
   \   00002E                ; Setup parameters for indirect call
   \   00002E   85..82       MOV     DPL,?XSP + 0
   \   000031   85..83       MOV     DPH,?XSP + 1
   \   000034   AA82         MOV     R2,DPL
   \   000036   AB83         MOV     R3,DPH
   \   000038   90....       MOV     DPTR,#zdoCBFunc + 4
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F8           MOV     R0,A
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F583         MOV     DPH,A
   \   000041   8882         MOV     DPL,R0
   \   000043   12....       LCALL   ?CALL_IND
   \   000046   801D         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   2060              }
   2061              else
   2062              {
   2063                // Otherwise, send scan confirm to ZDApp task to proceed
   2064                msg.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   000048   7402         MOV     A,#0x2
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   7400         MOV     A,#0x0
   \   00004F   F0           MOVX    @DPTR,A
   2065                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(osal_event_hdr_t), (uint8 *)&msg );
   \   000050                ; Setup parameters for call to function ZDApp_SendMsg
   \   000050   7401         MOV     A,#0x1
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   AC82         MOV     R4,DPL
   \   000057   AD83         MOV     R5,DPH
   \   000059   7B02         MOV     R3,#0x2
   \   00005B   7A01         MOV     R2,#0x1
   \   00005D   90....       MOV     DPTR,#ZDAppTaskID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??ZDApp_SendMsg?relay
   2066              }
   2067            }
   2068            return (ZSuccess);
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   000065   7900         MOV     R1,#0x0
   \   000067   7403         MOV     A,#0x3
   \   000069   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006C   D083         POP     DPH
   \   00006E   D082         POP     DPL
   \   000070   02....       LJMP    ?BRET
   2069          }  // ZDO_NetworkDiscoveryConfirmCB
   2070          
   2071          /*********************************************************************
   2072           * @fn          ZDApp_NwkDescListProcessing
   2073           *
   2074           * @brief       This function process the network discovery result and select
   2075           *              a parent device to join itself.
   2076           *
   2077           * @param       none
   2078           *
   2079           * @return      ZStatus_t
   2080           */
   2081          /*
   2082          #define STACK_PROFILE_MAX 2
   2083          networkDesc_t* ZDApp_NwkDescListProcessing(void)
   2084          {
   2085            networkDesc_t *pNwkDesc;
   2086            uint8 i, ResultCount = 0;
   2087            uint8 stackProfile;
   2088            uint8 stackProfilePro;
   2089            uint8 selected;
   2090            
   2091            networkDesc_t *test_pNwkDesc;
   2092            uint8 MaxLinkQuality=0;
   2093            uint8 MaxLinkQuality_Channel=0x0B;
   2094            uint16 MaxLinkQuality_Panid=0xFFFF;
   2095          
   2096            // Count the number of nwk descriptors in the list
   2097            pNwkDesc = nwk_getNwkDescList();
   2098            while (pNwkDesc)
   2099            {
   2100              ResultCount++;
   2101              pNwkDesc = pNwkDesc->nextDesc;
   2102            }
   2103            
   2104              // process discovery results
   2105            stackProfilePro = FALSE;
   2106            selected = FALSE;
   2107            
   2108            if ( devStartMode == MODE_JOIN )
   2109            {  
   2110              pNwkDesc = nwk_getNwkDescList();
   2111              MaxLinkQuality=pNwkDesc->chosenRouterLinkQuality;
   2112              MaxLinkQuality_Channel=pNwkDesc->logicalChannel;
   2113              MaxLinkQuality_Panid = pNwkDesc->panId;
   2114              for(uint8 j=0;j<ResultCount-1;j++,pNwkDesc = pNwkDesc->nextDesc)
   2115              {
   2116               test_pNwkDesc=pNwkDesc->nextDesc;
   2117               if(test_pNwkDesc!=NULL)
   2118               {
   2119               if(MaxLinkQuality <=test_pNwkDesc->chosenRouterLinkQuality )
   2120                {
   2121                  MaxLinkQuality=test_pNwkDesc->chosenRouterLinkQuality;
   2122                  MaxLinkQuality_Channel=test_pNwkDesc->logicalChannel;
   2123                  MaxLinkQuality_Panid = test_pNwkDesc->panId;
   2124                }
   2125               }
   2126                
   2127              }
   2128            }
   2129          
   2130            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   2131            {
   2132              pNwkDesc = nwk_getNwkDescList();
   2133              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   2134              {
   2135                if ( zgConfigPANID != 0xFFFF )
   2136                {
   2137                  if ( pNwkDesc->panId != zgConfigPANID )
   2138                    continue;
   2139                }
   2140                
   2141                if( devStartMode == MODE_REJOIN )
   2142                {
   2143                 if ( _NIB.nwkPanId != INVALID_PAN_ID )
   2144                {
   2145                  if ( pNwkDesc->panId != _NIB.nwkPanId )
   2146                    continue;
   2147                }
   2148                }
   2149                
   2150                
   2151                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   2152                {
   2153                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   2154                    continue;
   2155          
   2156                }
   2157          
   2158                if ( ZSTACK_ROUTER_BUILD )
   2159                {
   2160                  if ( stackProfilePro == FALSE )
   2161                  {
   2162                    if ( !pNwkDesc->routerCapacity )
   2163                    {
   2164                      continue;
   2165                    }
   2166                  }
   2167                  else
   2168                  {
   2169                    if ( !pNwkDesc->deviceCapacity )
   2170                    {
   2171                      continue;
   2172                    }
   2173                  }
   2174                }
   2175                else if ( ZSTACK_END_DEVICE_BUILD )
   2176                {
   2177                  if ( !pNwkDesc->deviceCapacity )
   2178                  {
   2179                    continue;
   2180                  }
   2181                }
   2182          
   2183                // check version of zigbee protocol
   2184                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   2185                  continue;
   2186          
   2187                // check version of stack profile
   2188                if ( pNwkDesc->stackProfile != zgStackProfile  )
   2189                {
   2190                  if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   2191                      || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   2192                  {
   2193                    stackProfilePro = TRUE;
   2194                  }
   2195          
   2196                  if ( stackProfile == 0 )
   2197                  {
   2198                    continue;
   2199                  }
   2200                }
   2201                
   2202                
   2203               // break;
   2204                
   2205              if ( devStartMode == MODE_JOIN )
   2206                {  
   2207                  if( (pNwkDesc->logicalChannel==MaxLinkQuality_Channel) && (pNwkDesc->panId==MaxLinkQuality_Panid) )
   2208                  {
   2209                   break;
   2210                  }
   2211                 else
   2212                  {
   2213                   continue;
   2214                  }
   2215                }
   2216              else
   2217                {
   2218                  break; 
   2219                }
   2220              }
   2221          
   2222              if (i < ResultCount)
   2223              {
   2224               selected = TRUE;
   2225                break;
   2226              }
   2227          
   2228              // break if selected or stack profile pro wasn't found
   2229              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   2230              {
   2231                break;
   2232              }
   2233            }
   2234          
   2235            if ( i == ResultCount )
   2236            {
   2237              return (NULL);   // couldn't find appropriate PAN to join !
   2238            }
   2239            else
   2240            {
   2241              return (pNwkDesc);
   2242            }
   2243          
   2244          }// ZDApp_NwkDescListProcessing()
   2245          */
   2246          /*********************************************************************
   2247           * @fn          ZDO_NetworkFormationConfirmCB
   2248           *
   2249           * @brief       This function reports the results of the request to
   2250           *              initialize a coordinator in a network.
   2251           *
   2252           * @param       Status - Result of NLME_NetworkFormationRequest()
   2253           *
   2254           * @return      none
   2255           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2256          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2257          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2258            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2259          
   2260            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   701E         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2261            {
   2262              // LED on shows Coordinator started
   2263              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000F                ; Setup parameters for call to function HalLedSet
   \   00000F   7A01         MOV     R2,#0x1
   \   000011   7904         MOV     R1,#0x4
   \   000013   12....       LCALL   ??HalLedSet?relay
   \   000016   E9           MOV     A,R1
   2264          
   2265              // LED off forgets HOLD_AUTO_START
   2266              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
   \   00001E   E9           MOV     A,R1
   2267          
   2268          #if defined ( ZBIT )
   2269              SIM_SetColor(0xd0ffd0);
   2270          #endif
   2271          
   2272              if ( devState == DEV_HOLD )
   \   00001F   90....       MOV     DPTR,#devState
   \   000022   E0           MOVX    A,@DPTR
   \   000023   7010         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   2273              {
   2274                // Began with HOLD_AUTO_START
   2275                devState = DEV_COORD_STARTING;
   \   000025   90....       MOV     DPTR,#devState
   \   000028   7408         MOV     A,#0x8
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   8008         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   2276              }
   2277            }
   2278          #if defined(BLINK_LEDS)
   2279            else
   2280            {
   2281              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   00002D                ; Setup parameters for call to function HalLedSet
   \   00002D   7A04         MOV     R2,#0x4
   \   00002F   7904         MOV     R1,#0x4
   \   000031   12....       LCALL   ??HalLedSet?relay
   \   000034   E9           MOV     A,R1
   2282            }
   2283          #endif
   2284          
   2285            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   000035                ; Setup parameters for call to function osal_set_event
   \   000035   7A02         MOV     R2,#0x2
   \   000037   7B00         MOV     R3,#0x0
   \   000039   90....       MOV     DPTR,#ZDAppTaskID
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F9           MOV     R1,A
   \   00003E   12....       LCALL   ??osal_set_event?relay
   \   000041   E9           MOV     A,R1
   2286          }
   \   000042   7F01         MOV     R7,#0x1
   \   000044   02....       LJMP    ?BANKED_LEAVE_XDATA
   2287          
   2288          /****************************************************************************
   2289           * @fn          ZDApp_beaconIndProcessing
   2290           *
   2291           * @brief       This function processes the incoming beacon indication.
   2292           *
   2293           *              When another task (MT or App) is registered to process
   2294           *              beacon indication themselves, this function will parse the
   2295           *              beacon payload and pass the beacon descriptor to that task
   2296           *              If no other tasks registered, this function will process
   2297           *              the beacon payload and generate the network descriptor link
   2298           *              list.
   2299           *
   2300           * @param
   2301           *
   2302           * @return      none
   2303           *
   2304           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2305          void ZDO_beaconNotifyIndCB( NLME_beaconInd_t *pBeacon )
   \                     ZDO_beaconNotifyIndCB:
   2306          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2307            // Pass the beacon Indication to another task if it registers the callback
   2308            // Otherwise, process the beacon notification here.
   2309            if (zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID] != NULL )
   \   000009   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F8           MOV     R0,A
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   E8           MOV     A,R0
   \   000012   49           ORL     A,R1
   \   000013   6015         JZ      ??ZDO_beaconNotifyIndCB_0
   2310            {
   2311              zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID]( (void*)pBeacon );
   \   000015                ; Setup parameters for indirect call
   \   000015   AA..         MOV     R2,?V0 + 0
   \   000017   AB..         MOV     R3,?V0 + 1
   \   000019   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F8           MOV     R0,A
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F583         MOV     DPH,A
   \   000022   8882         MOV     DPL,R0
   \   000024   12....       LCALL   ?CALL_IND
   \   000027   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2312            }
   2313            else
   2314            {
   2315              networkDesc_t *pNwkDesc;
   2316              networkDesc_t *pLastNwkDesc;
   2317              uint8 found = false;
   \                     ??ZDO_beaconNotifyIndCB_0:
   \   00002A   75..00       MOV     ?V0 + 2,#0x0
   2318          
   2319              // Add the network to the Network Descriptor List
   2320              pNwkDesc = NwkDescList;
   \   00002D   90....       MOV     DPTR,#NwkDescList
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F8           MOV     R0,A
   \   000032   A3           INC     DPTR
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F9           MOV     R1,A
   \   000035   E8           MOV     A,R0
   \   000036   FE           MOV     R6,A
   \   000037   E9           MOV     A,R1
   \   000038   FF           MOV     R7,A
   2321              pLastNwkDesc = NwkDescList;
   \   000039   90....       MOV     DPTR,#NwkDescList
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F8           MOV     R0,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   88..         MOV     ?V0 + 4,R0
   \   000043   89..         MOV     ?V0 + 5,R1
   2322              while (pNwkDesc)
   \                     ??ZDO_beaconNotifyIndCB_2:
   \   000045   EE           MOV     A,R6
   \   000046   4F           ORL     A,R7
   \   000047   604A         JZ      ??ZDO_beaconNotifyIndCB_3
   2323              {
   2324                if ((pNwkDesc->panId == pBeacon->panID) &&
   2325                    (pNwkDesc->logicalChannel == pBeacon->logicalChannel))
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F8           MOV     R0,A
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   85..82       MOV     DPL,?V0 + 0
   \   000055   85..83       MOV     DPH,?V0 + 1
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   68           XRL     A,R0
   \   00005C   7003         JNZ     ??ZDO_beaconNotifyIndCB_4
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   69           XRL     A,R1
   \                     ??ZDO_beaconNotifyIndCB_4:
   \   000061   701B         JNZ     ??ZDO_beaconNotifyIndCB_5
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   85..82       MOV     DPL,?V0 + 0
   \   00006E   85..83       MOV     DPH,?V0 + 1
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   68           XRL     A,R0
   \   000077   7005         JNZ     ??ZDO_beaconNotifyIndCB_5
   2326                {
   2327                  found = true;
   \   000079   75..01       MOV     ?V0 + 2,#0x1
   2328                  break;
   \   00007C   8015         SJMP    ??ZDO_beaconNotifyIndCB_3
   2329                }
   2330                pLastNwkDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_5:
   \   00007E   8E..         MOV     ?V0 + 4,R6
   \   000080   8F..         MOV     ?V0 + 5,R7
   2331                pNwkDesc = pNwkDesc->nextDesc;
   \   000082   EE           MOV     A,R6
   \   000083   2414         ADD     A,#0x14
   \   000085   F582         MOV     DPL,A
   \   000087   EF           MOV     A,R7
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F583         MOV     DPH,A
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   FE           MOV     R6,A
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FF           MOV     R7,A
   \   000091   80B2         SJMP    ??ZDO_beaconNotifyIndCB_2
   2332              }
   2333          
   2334              // If no existing descriptor found, make a new one and add to the list
   2335              if (found == false)
   \                     ??ZDO_beaconNotifyIndCB_3:
   \   000093   E5..         MOV     A,?V0 + 2
   \   000095   706D         JNZ     ??ZDO_beaconNotifyIndCB_6
   2336              {
   2337                pNwkDesc = osal_mem_alloc( sizeof(networkDesc_t)  );
   \   000097                ; Setup parameters for call to function osal_mem_alloc
   \   000097   7A16         MOV     R2,#0x16
   \   000099   7B00         MOV     R3,#0x0
   \   00009B   12....       LCALL   ??osal_mem_alloc?relay
   \   00009E   8A..         MOV     ?V0 + 6,R2
   \   0000A0   8B..         MOV     ?V0 + 7,R3
   \   0000A2   AE..         MOV     R6,?V0 + 6
   \   0000A4   AF..         MOV     R7,?V0 + 7
   2338                if ( !pNwkDesc )
   \   0000A6   EE           MOV     A,R6
   \   0000A7   4F           ORL     A,R7
   \   0000A8   7003         JNZ     $+5
   \   0000AA   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2339                {
   2340                  // Memory alloc failed, discard this beacon
   2341                  return;
   2342                }
   2343          
   2344                // Clear the network descriptor
   2345                osal_memset( pNwkDesc, 0, sizeof(networkDesc_t)  );
   \   0000AD                ; Setup parameters for call to function osal_memset
   \   0000AD   7C16         MOV     R4,#0x16
   \   0000AF   7D00         MOV     R5,#0x0
   \   0000B1   7900         MOV     R1,#0x0
   \   0000B3   EE           MOV     A,R6
   \   0000B4   FA           MOV     R2,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   FB           MOV     R3,A
   \   0000B7   12....       LCALL   ??osal_memset?relay
   2346          
   2347                // Initialize the descriptor
   2348                pNwkDesc->chosenRouter = INVALID_NODE_ADDR;
   \   0000BA   8E82         MOV     DPL,R6
   \   0000BC   8F83         MOV     DPH,R7
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   74FE         MOV     A,#-0x2
   \   0000C7   F0           MOVX    @DPTR,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   74FF         MOV     A,#-0x1
   \   0000CB   F0           MOVX    @DPTR,A
   2349                pNwkDesc->chosenRouterDepth = 0xFF;
   \   0000CC   8E82         MOV     DPL,R6
   \   0000CE   8F83         MOV     DPH,R7
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   74FF         MOV     A,#-0x1
   \   0000DC   F0           MOVX    @DPTR,A
   2350          
   2351                // Save new entry into the descriptor list
   2352                if ( !NwkDescList )
   \   0000DD   90....       MOV     DPTR,#NwkDescList
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F8           MOV     R0,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   F9           MOV     R1,A
   \   0000E5   E8           MOV     A,R0
   \   0000E6   49           ORL     A,R1
   \   0000E7   700A         JNZ     ??ZDO_beaconNotifyIndCB_7
   2353                {
   2354                  NwkDescList = pNwkDesc;
   \   0000E9   90....       MOV     DPTR,#NwkDescList
   \   0000EC   EE           MOV     A,R6
   \   0000ED   F0           MOVX    @DPTR,A
   \   0000EE   A3           INC     DPTR
   \   0000EF   EF           MOV     A,R7
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   8011         SJMP    ??ZDO_beaconNotifyIndCB_6
   2355                }
   2356                else
   2357                {
   2358                  pLastNwkDesc->nextDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_7:
   \   0000F3   E5..         MOV     A,?V0 + 4
   \   0000F5   2414         ADD     A,#0x14
   \   0000F7   F582         MOV     DPL,A
   \   0000F9   E5..         MOV     A,?V0 + 5
   \   0000FB   3400         ADDC    A,#0x0
   \   0000FD   F583         MOV     DPH,A
   \   0000FF   EE           MOV     A,R6
   \   000100   F0           MOVX    @DPTR,A
   \   000101   A3           INC     DPTR
   \   000102   EF           MOV     A,R7
   \   000103   F0           MOVX    @DPTR,A
   2359                }
   2360              }
   2361          
   2362              // Update the descriptor with the incoming beacon
   2363              pNwkDesc->stackProfile   = pBeacon->stackProfile;
   \                     ??ZDO_beaconNotifyIndCB_6:
   \   000104   85..82       MOV     DPL,?V0 + 0
   \   000107   85..83       MOV     DPH,?V0 + 1
   \   00010A   A3           INC     DPTR
   \   00010B   A3           INC     DPTR
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   A3           INC     DPTR
   \   00010F   A3           INC     DPTR
   \   000110   A3           INC     DPTR
   \   000111   A3           INC     DPTR
   \   000112   A3           INC     DPTR
   \   000113   E0           MOVX    A,@DPTR
   \   000114   8E82         MOV     DPL,R6
   \   000116   8F83         MOV     DPH,R7
   \   000118   A3           INC     DPTR
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   A3           INC     DPTR
   \   00011E   F0           MOVX    @DPTR,A
   2364              pNwkDesc->version        = pBeacon->protocolVersion;
   \   00011F   85..82       MOV     DPL,?V0 + 0
   \   000122   85..83       MOV     DPH,?V0 + 1
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   A3           INC     DPTR
   \   000129   A3           INC     DPTR
   \   00012A   A3           INC     DPTR
   \   00012B   A3           INC     DPTR
   \   00012C   A3           INC     DPTR
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   A3           INC     DPTR
   \   000133   A3           INC     DPTR
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   A3           INC     DPTR
   \   000137   F0           MOVX    @DPTR,A
   2365              pNwkDesc->logicalChannel = pBeacon->logicalChannel;
   \   000138   85..82       MOV     DPL,?V0 + 0
   \   00013B   85..83       MOV     DPH,?V0 + 1
   \   00013E   A3           INC     DPTR
   \   00013F   A3           INC     DPTR
   \   000140   A3           INC     DPTR
   \   000141   A3           INC     DPTR
   \   000142   E0           MOVX    A,@DPTR
   \   000143   8E82         MOV     DPL,R6
   \   000145   8F83         MOV     DPH,R7
   \   000147   A3           INC     DPTR
   \   000148   A3           INC     DPTR
   \   000149   F0           MOVX    @DPTR,A
   2366              pNwkDesc->panId          = pBeacon->panID;
   \   00014A   85..82       MOV     DPL,?V0 + 0
   \   00014D   85..83       MOV     DPH,?V0 + 1
   \   000150   A3           INC     DPTR
   \   000151   A3           INC     DPTR
   \   000152   E0           MOVX    A,@DPTR
   \   000153   F8           MOV     R0,A
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   8E82         MOV     DPL,R6
   \   000159   8F83         MOV     DPH,R7
   \   00015B   E8           MOV     A,R0
   \   00015C   F0           MOVX    @DPTR,A
   \   00015D   A3           INC     DPTR
   \   00015E   E9           MOV     A,R1
   \   00015F   F0           MOVX    @DPTR,A
   2367              pNwkDesc->updateId       = pBeacon->updateID;
   \   000160   E5..         MOV     A,?V0 + 0
   \   000162   240C         ADD     A,#0xc
   \   000164   F582         MOV     DPL,A
   \   000166   E5..         MOV     A,?V0 + 1
   \   000168   3400         ADDC    A,#0x0
   \   00016A   F583         MOV     DPH,A
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   C0E0         PUSH    A
   \   00016F   EE           MOV     A,R6
   \   000170   2413         ADD     A,#0x13
   \   000172   F582         MOV     DPL,A
   \   000174   EF           MOV     A,R7
   \   000175   3400         ADDC    A,#0x0
   \   000177   F583         MOV     DPH,A
   \   000179   D0E0         POP     A
   \   00017B   F0           MOVX    @DPTR,A
   2368          
   2369              // Save the extended PAN ID from the beacon payload only if 1.1 version network
   2370              if ( pBeacon->protocolVersion != ZB_PROT_V1_0 )
   \   00017C   85..82       MOV     DPL,?V0 + 0
   \   00017F   85..83       MOV     DPH,?V0 + 1
   \   000182   A3           INC     DPTR
   \   000183   A3           INC     DPTR
   \   000184   A3           INC     DPTR
   \   000185   A3           INC     DPTR
   \   000186   A3           INC     DPTR
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   A3           INC     DPTR
   \   00018A   E0           MOVX    A,@DPTR
   \   00018B   6401         XRL     A,#0x1
   \   00018D   6017         JZ      ??ZDO_beaconNotifyIndCB_8
   2371              {
   2372                osal_cpyExtAddr( pNwkDesc->extendedPANID, pBeacon->extendedPanID );
   \   00018F                ; Setup parameters for call to function sAddrExtCpy
   \   00018F   E5..         MOV     A,?V0 + 0
   \   000191   240D         ADD     A,#0xd
   \   000193   FC           MOV     R4,A
   \   000194   E5..         MOV     A,?V0 + 1
   \   000196   3400         ADDC    A,#0x0
   \   000198   FD           MOV     R5,A
   \   000199   EE           MOV     A,R6
   \   00019A   240B         ADD     A,#0xb
   \   00019C   FA           MOV     R2,A
   \   00019D   EF           MOV     A,R7
   \   00019E   3400         ADDC    A,#0x0
   \   0001A0   FB           MOV     R3,A
   \   0001A1   12....       LCALL   ??sAddrExtCpy?relay
   \   0001A4   8011         SJMP    ??ZDO_beaconNotifyIndCB_9
   2373              }
   2374              else
   2375              {
   2376                osal_memset( pNwkDesc->extendedPANID, 0xFF, Z_EXTADDR_LEN );
   \                     ??ZDO_beaconNotifyIndCB_8:
   \   0001A6                ; Setup parameters for call to function osal_memset
   \   0001A6   7C08         MOV     R4,#0x8
   \   0001A8   7D00         MOV     R5,#0x0
   \   0001AA   79FF         MOV     R1,#-0x1
   \   0001AC   EE           MOV     A,R6
   \   0001AD   240B         ADD     A,#0xb
   \   0001AF   FA           MOV     R2,A
   \   0001B0   EF           MOV     A,R7
   \   0001B1   3400         ADDC    A,#0x0
   \   0001B3   FB           MOV     R3,A
   \   0001B4   12....       LCALL   ??osal_memset?relay
   2377              }
   2378          
   2379              // check if this device is a better choice to join...
   2380              // ...dont bother checking assocPermit flag is doing a rejoin
   2381              if ( ( pBeacon->LQI > gMIN_TREE_LINK_COST ) &&
   2382                  ( ( pBeacon->permitJoining == TRUE ) || ( _tmpRejoinState ) || (devStartMode == MODE_REJOIN) ) )
   \                     ??ZDO_beaconNotifyIndCB_9:
   \   0001B7   85..82       MOV     DPL,?V0 + 0
   \   0001BA   85..83       MOV     DPH,?V0 + 1
   \   0001BD   A3           INC     DPTR
   \   0001BE   A3           INC     DPTR
   \   0001BF   A3           INC     DPTR
   \   0001C0   A3           INC     DPTR
   \   0001C1   A3           INC     DPTR
   \   0001C2   A3           INC     DPTR
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   A3           INC     DPTR
   \   0001C7   E0           MOVX    A,@DPTR
   \   0001C8   F8           MOV     R0,A
   \   0001C9   90....       MOV     DPTR,#gMIN_TREE_LINK_COST
   \   0001CC   E0           MOVX    A,@DPTR
   \   0001CD   C3           CLR     C
   \   0001CE   98           SUBB    A,R0
   \   0001CF   4003         JC      $+5
   \   0001D1   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   \   0001D4   85..82       MOV     DPL,?V0 + 0
   \   0001D7   85..83       MOV     DPH,?V0 + 1
   \   0001DA   A3           INC     DPTR
   \   0001DB   A3           INC     DPTR
   \   0001DC   A3           INC     DPTR
   \   0001DD   A3           INC     DPTR
   \   0001DE   A3           INC     DPTR
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   6401         XRL     A,#0x1
   \   0001E2   6011         JZ      ??ZDO_beaconNotifyIndCB_10
   \   0001E4   90....       MOV     DPTR,#_tmpRejoinState
   \   0001E7   E0           MOVX    A,@DPTR
   \   0001E8   700B         JNZ     ??ZDO_beaconNotifyIndCB_10
   \   0001EA   90....       MOV     DPTR,#devStartMode
   \   0001ED   E0           MOVX    A,@DPTR
   \   0001EE   6403         XRL     A,#0x3
   \   0001F0   6003         JZ      $+5
   \   0001F2   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2383              {
   2384                uint8 selected = FALSE;
   \                     ??ZDO_beaconNotifyIndCB_10:
   \   0001F5   7A00         MOV     R2,#0x0
   2385                uint8 capacity = FALSE;
   \   0001F7   7B00         MOV     R3,#0x0
   2386          
   2387                if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \   0001F9   90....       MOV     DPTR,#_NIB + 96
   \   0001FC   E0           MOVX    A,@DPTR
   \   0001FD   6402         XRL     A,#0x2
   \   0001FF   707E         JNZ     ??ZDO_beaconNotifyIndCB_11
   2388                {
   2389                  if ( ((pBeacon->LQI   > pNwkDesc->chosenRouterLinkQuality) &&
   2390                        (pBeacon->depth < MAX_NODE_DEPTH)) ||
   2391                      ((pBeacon->LQI   == pNwkDesc->chosenRouterLinkQuality) &&
   2392                       (pBeacon->depth < pNwkDesc->chosenRouterDepth)) )
   \   000201   85..82       MOV     DPL,?V0 + 0
   \   000204   85..83       MOV     DPH,?V0 + 1
   \   000207   A3           INC     DPTR
   \   000208   A3           INC     DPTR
   \   000209   A3           INC     DPTR
   \   00020A   A3           INC     DPTR
   \   00020B   A3           INC     DPTR
   \   00020C   A3           INC     DPTR
   \   00020D   A3           INC     DPTR
   \   00020E   A3           INC     DPTR
   \   00020F   A3           INC     DPTR
   \   000210   A3           INC     DPTR
   \   000211   E0           MOVX    A,@DPTR
   \   000212   F8           MOV     R0,A
   \   000213   8E82         MOV     DPL,R6
   \   000215   8F83         MOV     DPH,R7
   \   000217   A3           INC     DPTR
   \   000218   A3           INC     DPTR
   \   000219   A3           INC     DPTR
   \   00021A   A3           INC     DPTR
   \   00021B   A3           INC     DPTR
   \   00021C   A3           INC     DPTR
   \   00021D   A3           INC     DPTR
   \   00021E   A3           INC     DPTR
   \   00021F   A3           INC     DPTR
   \   000220   E0           MOVX    A,@DPTR
   \   000221   C3           CLR     C
   \   000222   98           SUBB    A,R0
   \   000223   5012         JNC     ??ZDO_beaconNotifyIndCB_12
   \   000225   E5..         MOV     A,?V0 + 0
   \   000227   240B         ADD     A,#0xb
   \   000229   F582         MOV     DPL,A
   \   00022B   E5..         MOV     A,?V0 + 1
   \   00022D   3400         ADDC    A,#0x0
   \   00022F   F583         MOV     DPH,A
   \   000231   E0           MOVX    A,@DPTR
   \   000232   C3           CLR     C
   \   000233   9414         SUBB    A,#0x14
   \   000235   4044         JC      ??ZDO_beaconNotifyIndCB_13
   \                     ??ZDO_beaconNotifyIndCB_12:
   \   000237   85..82       MOV     DPL,?V0 + 0
   \   00023A   85..83       MOV     DPH,?V0 + 1
   \   00023D   A3           INC     DPTR
   \   00023E   A3           INC     DPTR
   \   00023F   A3           INC     DPTR
   \   000240   A3           INC     DPTR
   \   000241   A3           INC     DPTR
   \   000242   A3           INC     DPTR
   \   000243   A3           INC     DPTR
   \   000244   A3           INC     DPTR
   \   000245   A3           INC     DPTR
   \   000246   A3           INC     DPTR
   \   000247   E0           MOVX    A,@DPTR
   \   000248   F8           MOV     R0,A
   \   000249   8E82         MOV     DPL,R6
   \   00024B   8F83         MOV     DPH,R7
   \   00024D   A3           INC     DPTR
   \   00024E   A3           INC     DPTR
   \   00024F   A3           INC     DPTR
   \   000250   A3           INC     DPTR
   \   000251   A3           INC     DPTR
   \   000252   A3           INC     DPTR
   \   000253   A3           INC     DPTR
   \   000254   A3           INC     DPTR
   \   000255   A3           INC     DPTR
   \   000256   E0           MOVX    A,@DPTR
   \   000257   68           XRL     A,R0
   \   000258   7048         JNZ     ??ZDO_beaconNotifyIndCB_14
   \   00025A   8E82         MOV     DPL,R6
   \   00025C   8F83         MOV     DPH,R7
   \   00025E   A3           INC     DPTR
   \   00025F   A3           INC     DPTR
   \   000260   A3           INC     DPTR
   \   000261   A3           INC     DPTR
   \   000262   A3           INC     DPTR
   \   000263   A3           INC     DPTR
   \   000264   A3           INC     DPTR
   \   000265   A3           INC     DPTR
   \   000266   A3           INC     DPTR
   \   000267   A3           INC     DPTR
   \   000268   E0           MOVX    A,@DPTR
   \   000269   F8           MOV     R0,A
   \   00026A   E5..         MOV     A,?V0 + 0
   \   00026C   240B         ADD     A,#0xb
   \   00026E   F582         MOV     DPL,A
   \   000270   E5..         MOV     A,?V0 + 1
   \   000272   3400         ADDC    A,#0x0
   \   000274   F583         MOV     DPH,A
   \   000276   E0           MOVX    A,@DPTR
   \   000277   C3           CLR     C
   \   000278   98           SUBB    A,R0
   \   000279   5027         JNC     ??ZDO_beaconNotifyIndCB_14
   2393                  {
   2394                    selected = TRUE;
   \                     ??ZDO_beaconNotifyIndCB_13:
   \   00027B   7A01         MOV     R2,#0x1
   \   00027D   8023         SJMP    ??ZDO_beaconNotifyIndCB_14
   2395                  }
   2396                }
   2397                else
   2398                {
   2399                  if ( pBeacon->depth < pNwkDesc->chosenRouterDepth )
   \                     ??ZDO_beaconNotifyIndCB_11:
   \   00027F   8E82         MOV     DPL,R6
   \   000281   8F83         MOV     DPH,R7
   \   000283   A3           INC     DPTR
   \   000284   A3           INC     DPTR
   \   000285   A3           INC     DPTR
   \   000286   A3           INC     DPTR
   \   000287   A3           INC     DPTR
   \   000288   A3           INC     DPTR
   \   000289   A3           INC     DPTR
   \   00028A   A3           INC     DPTR
   \   00028B   A3           INC     DPTR
   \   00028C   A3           INC     DPTR
   \   00028D   E0           MOVX    A,@DPTR
   \   00028E   F8           MOV     R0,A
   \   00028F   E5..         MOV     A,?V0 + 0
   \   000291   240B         ADD     A,#0xb
   \   000293   F582         MOV     DPL,A
   \   000295   E5..         MOV     A,?V0 + 1
   \   000297   3400         ADDC    A,#0x0
   \   000299   F583         MOV     DPH,A
   \   00029B   E0           MOVX    A,@DPTR
   \   00029C   C3           CLR     C
   \   00029D   98           SUBB    A,R0
   \   00029E   5002         JNC     ??ZDO_beaconNotifyIndCB_14
   2400                  {
   2401                    selected = TRUE;
   \   0002A0   7A01         MOV     R2,#0x1
   2402                  }
   2403                }
   2404          
   2405                if ( ZSTACK_ROUTER_BUILD )
   2406                {
   2407                  capacity = pBeacon->routerCapacity;
   \                     ??ZDO_beaconNotifyIndCB_14:
   \   0002A2   85..82       MOV     DPL,?V0 + 0
   \   0002A5   85..83       MOV     DPH,?V0 + 1
   \   0002A8   A3           INC     DPTR
   \   0002A9   A3           INC     DPTR
   \   0002AA   A3           INC     DPTR
   \   0002AB   A3           INC     DPTR
   \   0002AC   A3           INC     DPTR
   \   0002AD   A3           INC     DPTR
   \   0002AE   E0           MOVX    A,@DPTR
   \   0002AF   FB           MOV     R3,A
   2408                }
   2409                else if ( ZSTACK_END_DEVICE_BUILD )
   2410                {
   2411                  capacity = pBeacon->deviceCapacity;
   2412                }
   2413          
   2414                if ( (capacity) && (selected) )
   \   0002B0   6059         JZ      ??ZDO_beaconNotifyIndCB_15
   \   0002B2   EA           MOV     A,R2
   \   0002B3   6056         JZ      ??ZDO_beaconNotifyIndCB_15
   2415                {
   2416                  // this is the new chosen router for joining...
   2417                  pNwkDesc->chosenRouter            = pBeacon->sourceAddr;
   \   0002B5   85..82       MOV     DPL,?V0 + 0
   \   0002B8   85..83       MOV     DPH,?V0 + 1
   \   0002BB   E0           MOVX    A,@DPTR
   \   0002BC   F8           MOV     R0,A
   \   0002BD   A3           INC     DPTR
   \   0002BE   E0           MOVX    A,@DPTR
   \   0002BF   F9           MOV     R1,A
   \   0002C0   8E82         MOV     DPL,R6
   \   0002C2   8F83         MOV     DPH,R7
   \   0002C4   A3           INC     DPTR
   \   0002C5   A3           INC     DPTR
   \   0002C6   A3           INC     DPTR
   \   0002C7   A3           INC     DPTR
   \   0002C8   A3           INC     DPTR
   \   0002C9   A3           INC     DPTR
   \   0002CA   A3           INC     DPTR
   \   0002CB   E8           MOV     A,R0
   \   0002CC   F0           MOVX    @DPTR,A
   \   0002CD   A3           INC     DPTR
   \   0002CE   E9           MOV     A,R1
   \   0002CF   F0           MOVX    @DPTR,A
   2418                  pNwkDesc->chosenRouterLinkQuality = pBeacon->LQI;
   \   0002D0   85..82       MOV     DPL,?V0 + 0
   \   0002D3   85..83       MOV     DPH,?V0 + 1
   \   0002D6   A3           INC     DPTR
   \   0002D7   A3           INC     DPTR
   \   0002D8   A3           INC     DPTR
   \   0002D9   A3           INC     DPTR
   \   0002DA   A3           INC     DPTR
   \   0002DB   A3           INC     DPTR
   \   0002DC   A3           INC     DPTR
   \   0002DD   A3           INC     DPTR
   \   0002DE   A3           INC     DPTR
   \   0002DF   A3           INC     DPTR
   \   0002E0   E0           MOVX    A,@DPTR
   \   0002E1   8E82         MOV     DPL,R6
   \   0002E3   8F83         MOV     DPH,R7
   \   0002E5   A3           INC     DPTR
   \   0002E6   A3           INC     DPTR
   \   0002E7   A3           INC     DPTR
   \   0002E8   A3           INC     DPTR
   \   0002E9   A3           INC     DPTR
   \   0002EA   A3           INC     DPTR
   \   0002EB   A3           INC     DPTR
   \   0002EC   A3           INC     DPTR
   \   0002ED   A3           INC     DPTR
   \   0002EE   F0           MOVX    @DPTR,A
   2419                  pNwkDesc->chosenRouterDepth       = pBeacon->depth;
   \   0002EF   E5..         MOV     A,?V0 + 0
   \   0002F1   240B         ADD     A,#0xb
   \   0002F3   F582         MOV     DPL,A
   \   0002F5   E5..         MOV     A,?V0 + 1
   \   0002F7   3400         ADDC    A,#0x0
   \   0002F9   F583         MOV     DPH,A
   \   0002FB   E0           MOVX    A,@DPTR
   \   0002FC   8E82         MOV     DPL,R6
   \   0002FE   8F83         MOV     DPH,R7
   \   000300   A3           INC     DPTR
   \   000301   A3           INC     DPTR
   \   000302   A3           INC     DPTR
   \   000303   A3           INC     DPTR
   \   000304   A3           INC     DPTR
   \   000305   A3           INC     DPTR
   \   000306   A3           INC     DPTR
   \   000307   A3           INC     DPTR
   \   000308   A3           INC     DPTR
   \   000309   A3           INC     DPTR
   \   00030A   F0           MOVX    @DPTR,A
   2420                }
   2421          
   2422                if ( pBeacon->deviceCapacity )
   \                     ??ZDO_beaconNotifyIndCB_15:
   \   00030B   85..82       MOV     DPL,?V0 + 0
   \   00030E   85..83       MOV     DPH,?V0 + 1
   \   000311   A3           INC     DPTR
   \   000312   A3           INC     DPTR
   \   000313   A3           INC     DPTR
   \   000314   A3           INC     DPTR
   \   000315   A3           INC     DPTR
   \   000316   A3           INC     DPTR
   \   000317   A3           INC     DPTR
   \   000318   E0           MOVX    A,@DPTR
   \   000319   600B         JZ      ??ZDO_beaconNotifyIndCB_16
   2423                  pNwkDesc->deviceCapacity = 1;
   \   00031B   8E82         MOV     DPL,R6
   \   00031D   8F83         MOV     DPH,R7
   \   00031F   A3           INC     DPTR
   \   000320   A3           INC     DPTR
   \   000321   A3           INC     DPTR
   \   000322   A3           INC     DPTR
   \   000323   7401         MOV     A,#0x1
   \   000325   F0           MOVX    @DPTR,A
   2424          
   2425                if ( pBeacon->routerCapacity )
   \                     ??ZDO_beaconNotifyIndCB_16:
   \   000326   85..82       MOV     DPL,?V0 + 0
   \   000329   85..83       MOV     DPH,?V0 + 1
   \   00032C   A3           INC     DPTR
   \   00032D   A3           INC     DPTR
   \   00032E   A3           INC     DPTR
   \   00032F   A3           INC     DPTR
   \   000330   A3           INC     DPTR
   \   000331   A3           INC     DPTR
   \   000332   E0           MOVX    A,@DPTR
   \   000333   600A         JZ      ??ZDO_beaconNotifyIndCB_1
   2426                  pNwkDesc->routerCapacity = 1;
   \   000335   8E82         MOV     DPL,R6
   \   000337   8F83         MOV     DPH,R7
   \   000339   A3           INC     DPTR
   \   00033A   A3           INC     DPTR
   \   00033B   A3           INC     DPTR
   \   00033C   7401         MOV     A,#0x1
   \   00033E   F0           MOVX    @DPTR,A
   2427              }
   2428            }
   2429          }
   \                     ??ZDO_beaconNotifyIndCB_1:
   \   00033F   7F08         MOV     R7,#0x8
   \   000341   02....       LJMP    ?BANKED_LEAVE_XDATA
   2430          
   2431          /*********************************************************************
   2432           * @fn          ZDO_StartRouterConfirmCB
   2433           *
   2434           * @brief       This function reports the results of the request to
   2435           *              start functioning as a router in a network.
   2436           *
   2437           * @param       Status - Result of NLME_StartRouterRequest()
   2438           *
   2439           * @return      none
   2440           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2441          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2442          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2443            nwkStatus = (byte)Status;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#nwkStatus
   \   00000B   F0           MOVX    @DPTR,A
   2444          
   2445            if ( Status == ZSUCCESS )
   \   00000C   EE           MOV     A,R6
   \   00000D   700C         JNZ     ??ZDO_StartRouterConfirmCB_0
   2446            {
   2447              // LED on shows Router started
   2448            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   2449              // LED off forgets HOLD_AUTO_START
   2450             // HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2451              if ( devState == DEV_HOLD )
   \   00000F   90....       MOV     DPTR,#devState
   \   000012   E0           MOVX    A,@DPTR
   \   000013   7006         JNZ     ??ZDO_StartRouterConfirmCB_0
   2452              {
   2453                // Began with HOLD_AUTO_START
   2454                devState = DEV_END_DEVICE;
   \   000015   90....       MOV     DPTR,#devState
   \   000018   7406         MOV     A,#0x6
   \   00001A   F0           MOVX    @DPTR,A
   2455              }
   2456            }
   2457          #if defined(BLINK_LEDS)
   2458            else
   2459            {
   2460            //  HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2461            }
   2462          #endif
   2463          
   2464            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   00001B                ; Setup parameters for call to function osal_set_event
   \   00001B   7A20         MOV     R2,#0x20
   \   00001D   7B00         MOV     R3,#0x0
   \   00001F   90....       MOV     DPTR,#ZDAppTaskID
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F9           MOV     R1,A
   \   000024   12....       LCALL   ??osal_set_event?relay
   \   000027   E9           MOV     A,R1
   2465          }
   \   000028   7F01         MOV     R7,#0x1
   \   00002A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2466          
   2467          /*********************************************************************
   2468           * @fn          ZDO_JoinConfirmCB
   2469           *
   2470           * @brief       This function allows the next hight layer to be notified
   2471           *              of the results of its request to join itself or another
   2472           *              device to a network.
   2473           *
   2474           * @param       Status - Result of NLME_JoinRequest()
   2475           *
   2476           * @return      none
   2477           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2478          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2479          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   \   00000E   89..         MOV     ?V0 + 0,R1
   2480            (void)PanId;  // remove if this parameter is used.
   2481          
   2482            nwkStatus = (byte)Status;
   \   000010   E5..         MOV     A,?V0 + 0
   \   000012   90....       MOV     DPTR,#nwkStatus
   \   000015   F0           MOVX    @DPTR,A
   2483          
   2484            if ( Status == ZSUCCESS )
   \   000016   E5..         MOV     A,?V0 + 0
   \   000018   700C         JNZ     ??ZDO_JoinConfirmCB_0
   2485            {
   2486              // LED on shows device joined
   2487            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   2488              // LED off forgets HOLD_AUTO_START
   2489           //   HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2490              if ( (devState == DEV_HOLD) )
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   7006         JNZ     ??ZDO_JoinConfirmCB_0
   2491              {
   2492                // Began with HOLD_AUTO_START
   2493                devState = DEV_NWK_JOINING;
   \   000020   90....       MOV     DPTR,#devState
   \   000023   7403         MOV     A,#0x3
   \   000025   F0           MOVX    @DPTR,A
   2494              }
   2495          
   2496              if ( !ZG_SECURE_ENABLED )
   2497              {
   2498                // Notify to save info into NV
   2499                ZDApp_NVUpdate();
   2500              }
   2501            }
   2502            else
   2503            {
   2504          #if defined(BLINK_LEDS)
   2505            //  HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2506          #endif    
   2507           
   2508              
   2509            }
   2510          
   2511            // Pass the join confirm to higher layer if callback registered
   2512            if (zdoCBFunc[ZDO_JOIN_CNF_CBID] != NULL )
   \                     ??ZDO_JoinConfirmCB_0:
   \   000026   90....       MOV     DPTR,#zdoCBFunc + 8
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F8           MOV     R0,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F9           MOV     R1,A
   \   00002E   E8           MOV     A,R0
   \   00002F   49           ORL     A,R1
   \   000030   6047         JZ      ??ZDO_JoinConfirmCB_1
   2513            {
   2514              zdoJoinCnf_t joinCnf;
   2515          
   2516              joinCnf.status = Status;
   \   000032   E5..         MOV     A,?V0 + 0
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   E5..         MOV     A,?V0 + 0
   \   00003C   F0           MOVX    @DPTR,A
   2517              joinCnf.deviceAddr = _NIB.nwkDevAddress;
   \   00003D   90....       MOV     DPTR,#_NIB + 20
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F8           MOV     R0,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F9           MOV     R1,A
   \   000045   7401         MOV     A,#0x1
   \   000047   12....       LCALL   ?XSTACK_DISP0_8
   \   00004A   E8           MOV     A,R0
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   A3           INC     DPTR
   \   00004D   E9           MOV     A,R1
   \   00004E   F0           MOVX    @DPTR,A
   2518              joinCnf.parentAddr = _NIB.nwkCoordAddress;
   \   00004F   90....       MOV     DPTR,#_NIB + 23
   \   000052   E0           MOVX    A,@DPTR
   \   000053   F8           MOV     R0,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F9           MOV     R1,A
   \   000057   7403         MOV     A,#0x3
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   E8           MOV     A,R0
   \   00005D   F0           MOVX    @DPTR,A
   \   00005E   A3           INC     DPTR
   \   00005F   E9           MOV     A,R1
   \   000060   F0           MOVX    @DPTR,A
   2519          
   2520              zdoCBFunc[ZDO_JOIN_CNF_CBID]( (void*)&joinCnf );
   \   000061                ; Setup parameters for indirect call
   \   000061   85..82       MOV     DPL,?XSP + 0
   \   000064   85..83       MOV     DPH,?XSP + 1
   \   000067   AA82         MOV     R2,DPL
   \   000069   AB83         MOV     R3,DPH
   \   00006B   90....       MOV     DPTR,#zdoCBFunc + 8
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F583         MOV     DPH,A
   \   000074   8882         MOV     DPL,R0
   \   000076   12....       LCALL   ?CALL_IND
   2521            }
   2522          
   2523            // Notify ZDApp
   2524            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   000079                ; Setup parameters for call to function ZDApp_SendMsg
   \   000079   7C00         MOV     R4,#0x0
   \   00007B   7D00         MOV     R5,#0x0
   \   00007D   7B02         MOV     R3,#0x2
   \   00007F   7A02         MOV     R2,#0x2
   \   000081   90....       MOV     DPTR,#ZDAppTaskID
   \   000084   E0           MOVX    A,@DPTR
   \   000085   F9           MOV     R1,A
   \   000086   12....       LCALL   ??ZDApp_SendMsg?relay
   2525          
   2526            
   2527            
   2528            
   2529          }
   \   000089   7405         MOV     A,#0x5
   \   00008B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008E   7F01         MOV     R7,#0x1
   \   000090   02....       LJMP    ?BANKED_LEAVE_XDATA
   2530          
   2531          /*********************************************************************
   2532           * @fn          ZDO_AddrChangeIndicationCB
   2533           *
   2534           * @brief       This function notifies the application that this
   2535           *              device's address has changed.  Could happen in
   2536           *              a network with stochastic addressing (PRO).
   2537           *
   2538           * @param       newAddr - the new address
   2539           *
   2540           * @return      none
   2541           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2542          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2543          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   2544            ZDO_AddrChangeInd_t *pZDOAddrChangeMsg;
   2545            epList_t *pItem = epList;
   \   000009   90....       MOV     DPTR,#epList
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   2546          
   2547            // Notify to save info into NV
   2548            ZDApp_NVUpdate();
   \   000013                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000013   12....       LCALL   ??ZDApp_NVUpdate?relay
   2549          
   2550            // Notify the applications
   2551            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000016                ; Setup parameters for call to function osal_set_event
   \   000016   7A10         MOV     R2,#0x10
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   90....       MOV     DPTR,#ZDAppTaskID
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??osal_set_event?relay
   \   000022   E9           MOV     A,R1
   2552          
   2553            while (pItem != NULL)
   \                     ??ZDO_AddrChangeIndicationCB_0:
   \   000023   E5..         MOV     A,?V0 + 0
   \   000025   45..         ORL     A,?V0 + 1
   \   000027   606C         JZ      ??ZDO_AddrChangeIndicationCB_1
   2554            {
   2555              if (pItem->epDesc->endPoint != ZDO_EP)
   \   000029   85..82       MOV     DPL,?V0 + 0
   \   00002C   85..83       MOV     DPH,?V0 + 1
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F8           MOV     R0,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F583         MOV     DPH,A
   \   000037   8882         MOV     DPL,R0
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   604A         JZ      ??ZDO_AddrChangeIndicationCB_2
   2556              {
   2557                pZDOAddrChangeMsg = (ZDO_AddrChangeInd_t *)osal_msg_allocate( sizeof( ZDO_AddrChangeInd_t ) );
   \   00003C                ; Setup parameters for call to function osal_msg_allocate
   \   00003C   7A04         MOV     R2,#0x4
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??osal_msg_allocate?relay
   \   000043   8A..         MOV     ?V0 + 4,R2
   \   000045   8B..         MOV     ?V0 + 5,R3
   \   000047   AE..         MOV     R6,?V0 + 4
   \   000049   AF..         MOV     R7,?V0 + 5
   2558                if (pZDOAddrChangeMsg != NULL)
   \   00004B   EE           MOV     A,R6
   \   00004C   4F           ORL     A,R7
   \   00004D   6037         JZ      ??ZDO_AddrChangeIndicationCB_2
   2559                {
   2560                  pZDOAddrChangeMsg->hdr.event = ZDO_ADDR_CHANGE_IND;
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   74D6         MOV     A,#-0x2a
   \   000055   F0           MOVX    @DPTR,A
   2561                  pZDOAddrChangeMsg->shortAddr = newAddr;
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   A3           INC     DPTR
   \   00005B   A3           INC     DPTR
   \   00005C   E5..         MOV     A,?V0 + 2
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E5..         MOV     A,?V0 + 3
   \   000062   F0           MOVX    @DPTR,A
   2562                  osal_msg_send( *(pItem->epDesc->task_id), (uint8 *)pZDOAddrChangeMsg );
   \   000063                ; Setup parameters for call to function osal_msg_send
   \   000063   EE           MOV     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   EF           MOV     A,R7
   \   000066   FB           MOV     R3,A
   \   000067   85..82       MOV     DPL,?V0 + 0
   \   00006A   85..83       MOV     DPH,?V0 + 1
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F583         MOV     DPH,A
   \   000075   8882         MOV     DPL,R0
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   F8           MOV     R0,A
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F583         MOV     DPH,A
   \   00007E   8882         MOV     DPL,R0
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   12....       LCALL   ??osal_msg_send?relay
   \   000085   E9           MOV     A,R1
   2563                }
   2564              }
   2565              pItem = pItem->nextDesc;
   \                     ??ZDO_AddrChangeIndicationCB_2:
   \   000086   85..82       MOV     DPL,?V0 + 0
   \   000089   85..83       MOV     DPH,?V0 + 1
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F5..         MOV     ?V0 + 0,A
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F5..         MOV     ?V0 + 1,A
   \   000093   808E         SJMP    ??ZDO_AddrChangeIndicationCB_0
   2566            }
   2567          
   2568            // Send out a device announce
   2569            ZDApp_AnnounceNewAddress();
   \                     ??ZDO_AddrChangeIndicationCB_1:
   \   000095                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000095   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2570          }
   \   000098   7F06         MOV     R7,#0x6
   \   00009A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2571          
   2572          /*********************************************************************
   2573           * @fn          ZDO_JoinIndicationCB
   2574           *
   2575           * @brief       This function allows the next higher layer of a
   2576           *              coordinator to be notified of a remote join request.
   2577           *
   2578           * @param       ShortAddress - 16-bit address
   2579           * @param       ExtendedAddress - IEEE (64-bit) address
   2580           * @param       CapabilityFlags - Association Capability Flags
   2581           * @param       type - of joining -
   2582           *                          NWK_ASSOC_JOIN
   2583           *                          NWK_ASSOC_REJOIN_UNSECURE
   2584           *                          NWK_ASSOC_REJOIN_SECURE
   2585           *
   2586           * @return      ZStatus_t
   2587           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2588          ZStatus_t ZDO_JoinIndicationCB(uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2589                                          uint8 CapabilityFlags, uint8 type)
   2590          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 2,R1
   \   00000F   740C         MOV     A,#0xc
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 3,A
   2591            (void)ShortAddress;
   2592            (void)ExtendedAddress;
   2593          #if ZDO_NV_SAVE_RFDs
   2594            (void)CapabilityFlags;
   2595          
   2596          #else  // if !ZDO_NV_SAVE_RFDs
   2597            if (CapabilityFlags & CAPINFO_DEVICETYPE_FFD)
   2598          #endif
   2599            {
   2600              ZDApp_NVUpdate();  // Notify to save info into NV.
   \   000017                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000017   12....       LCALL   ??ZDApp_NVUpdate?relay
   2601            }
   2602          
   2603            if (ZG_SECURE_ENABLED)  // Send notification to TC of new device.
   2604            {
   2605              if (type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE)
   \   00001A   E5..         MOV     A,?V0 + 3
   \   00001C   6006         JZ      ??ZDO_JoinIndicationCB_0
   \   00001E   7401         MOV     A,#0x1
   \   000020   65..         XRL     A,?V0 + 3
   \   000022   7011         JNZ     ??ZDO_JoinIndicationCB_1
   2606              {
   2607                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   \                     ??ZDO_JoinIndicationCB_0:
   \   000024                ; Setup parameters for call to function osal_start_timerEx
   \   000024   7C58         MOV     R4,#0x58
   \   000026   7D02         MOV     R5,#0x2
   \   000028   7A40         MOV     R2,#0x40
   \   00002A   7B00         MOV     R3,#0x0
   \   00002C   90....       MOV     DPTR,#ZDAppTaskID
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   12....       LCALL   ??osal_start_timerEx?relay
   \   000034   E9           MOV     A,R1
   2608              }
   2609            }
   2610          
   2611            return ZSuccess;
   \                     ??ZDO_JoinIndicationCB_1:
   \   000035   7900         MOV     R1,#0x0
   \   000037   7F04         MOV     R7,#0x4
   \   000039   02....       LJMP    ?BANKED_LEAVE_XDATA
   2612          }
   2613          
   2614          /*********************************************************************
   2615           * @fn          ZDO_ConcentratorIndicationCB
   2616           *
   2617           * @brief       This function allows the next higher layer of a
   2618           *              device to be notified of existence of the concentrator.
   2619           *
   2620           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2621           * @param       extAddr - pointer to extended Address
   2622           *                        NULL if not available
   2623           * @param       pktCost - PktCost from RREQ
   2624           *
   2625           * @return      void
   2626           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2627          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr, uint8 *extAddr, uint8 pktCost )
   \                     ZDO_ConcentratorIndicationCB:
   2628          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   2629            zdoConcentratorInd_t conInd;
   2630          
   2631            conInd.nwkAddr = nwkAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   2632            conInd.extAddr = extAddr;
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   EE           MOV     A,R6
   \   000027   F0           MOVX    @DPTR,A
   \   000028   A3           INC     DPTR
   \   000029   EF           MOV     A,R7
   \   00002A   F0           MOVX    @DPTR,A
   2633            conInd.pktCost = pktCost;
   \   00002B   E5..         MOV     A,?V0 + 2
   \   00002D   7404         MOV     A,#0x4
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   E5..         MOV     A,?V0 + 2
   \   000034   F0           MOVX    @DPTR,A
   2634          
   2635            if( zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc + 2
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_ConcentratorIndicationCB_0
   2636            {
   2637              zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID]( (void*)&conInd );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc + 2
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   2638            }
   2639          }
   \                     ??ZDO_ConcentratorIndicationCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   2640          
   2641          /*********************************************************************
   2642           * @fn          ZDO_LeaveCnf
   2643           *
   2644           * @brief       This function allows the next higher layer to be
   2645           *              notified of the results of its request for this or
   2646           *              a child device to leave the network.
   2647           *
   2648           * @param       cnf - NLME_LeaveCnf_t
   2649           *
   2650           * @return      none
   2651           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2652          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2653          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2654            // Check for this device
   2655            if ( osal_ExtAddrEqual( cnf->extAddr,
   2656                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function sAddrExtCmp
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??sAddrExtCmp?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7039         JNZ     ??ZDO_LeaveCnf_0
   2657            {
   2658              // Pass the leave confirm to higher layer if callback registered
   2659              if ( ( zdoCBFunc[ZDO_LEAVE_CNF_CBID] == NULL ) ||
   2660                   ( (*zdoCBFunc[ZDO_LEAVE_CNF_CBID])( cnf ) == NULL ) )
   \   000020   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   49           ORL     A,R1
   \   00002A   601C         JZ      ??ZDO_LeaveCnf_1
   \   00002C                ; Setup parameters for indirect call
   \   00002C   EE           MOV     A,R6
   \   00002D   FA           MOV     R2,A
   \   00002E   EF           MOV     A,R7
   \   00002F   FB           MOV     R3,A
   \   000030   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F583         MOV     DPH,A
   \   000039   8882         MOV     DPL,R0
   \   00003B   12....       LCALL   ?CALL_IND
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   E5..         MOV     A,?V0 + 0
   \   000044   45..         ORL     A,?V0 + 1
   \   000046   7035         JNZ     ??ZDO_LeaveCnf_2
   2661              {
   2662                // Prepare to leave with reset
   2663                ZDApp_LeaveReset( cnf->rejoin );
   \                     ??ZDO_LeaveCnf_1:
   \   000048                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000048   EE           MOV     A,R6
   \   000049   240B         ADD     A,#0xb
   \   00004B   F582         MOV     DPL,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   F583         MOV     DPH,A
   \   000052   E0           MOVX    A,@DPTR
   \   000053   F9           MOV     R1,A
   \   000054   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000057   8024         SJMP    ??ZDO_LeaveCnf_2
   2664              }
   2665            }
   2666            else if ( ZSTACK_ROUTER_BUILD )
   2667            {
   2668              // Remove device address(optionally descendents) from data
   2669              ZDApp_LeaveUpdate( cnf->dstAddr,
   2670                                 cnf->extAddr,
   2671                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000059                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000059   8E82         MOV     DPL,R6
   \   00005B   8F83         MOV     DPH,R7
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   A3           INC     DPTR
   \   000061   A3           INC     DPTR
   \   000062   A3           INC     DPTR
   \   000063   A3           INC     DPTR
   \   000064   A3           INC     DPTR
   \   000065   A3           INC     DPTR
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   F9           MOV     R1,A
   \   000069   EE           MOV     A,R6
   \   00006A   2402         ADD     A,#0x2
   \   00006C   FC           MOV     R4,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   FD           MOV     R5,A
   \   000071   8E82         MOV     DPL,R6
   \   000073   8F83         MOV     DPH,R7
   \   000075   E0           MOVX    A,@DPTR
   \   000076   FA           MOV     R2,A
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   FB           MOV     R3,A
   \   00007A   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2672            }
   2673          }
   \                     ??ZDO_LeaveCnf_2:
   \   00007D   7F02         MOV     R7,#0x2
   \   00007F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2674          
   2675          /*********************************************************************
   2676           * @fn          ZDO_LeaveInd
   2677           *
   2678           * @brief       This function allows the next higher layer of a
   2679           *              device to be notified of a remote leave request or
   2680           *              indication.
   2681           *
   2682           * @param       ind - NLME_LeaveInd_t
   2683           *
   2684           * @return      none
   2685           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2686          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2687          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2688            uint8 leave;
   2689          
   2690          
   2691            // Parent is requesting the leave - NWK layer filters out illegal
   2692            // requests
   2693            if ( ind->request == TRUE )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   7046         JNZ     ??ZDO_LeaveInd_0
   2694            {
   2695              // Notify network of leave
   2696              if ( ZSTACK_ROUTER_BUILD )
   2697              {
   2698                NLME_LeaveRsp_t rsp;
   2699                rsp.rejoin         = ind->rejoin;
   \   000021   EE           MOV     A,R6
   \   000022   240C         ADD     A,#0xc
   \   000024   F582         MOV     DPL,A
   \   000026   EF           MOV     A,R7
   \   000027   3400         ADDC    A,#0x0
   \   000029   F583         MOV     DPH,A
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   C0E0         PUSH    A
   \   00002E   7401         MOV     A,#0x1
   \   000030   12....       LCALL   ?XSTACK_DISP0_8
   \   000033   D0E0         POP     A
   \   000035   F0           MOVX    @DPTR,A
   2700                rsp.removeChildren = ind->removeChildren;
   \   000036   EE           MOV     A,R6
   \   000037   240B         ADD     A,#0xb
   \   000039   F582         MOV     DPL,A
   \   00003B   EF           MOV     A,R7
   \   00003C   3400         ADDC    A,#0x0
   \   00003E   F583         MOV     DPH,A
   \   000040   E0           MOVX    A,@DPTR
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   F0           MOVX    @DPTR,A
   2701                NLME_LeaveRsp( &rsp );
   \   000048                ; Setup parameters for call to function NLME_LeaveRsp
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   AA82         MOV     R2,DPL
   \   000050   AB83         MOV     R3,DPH
   \   000052   12....       LCALL   ??NLME_LeaveRsp?relay
   \   000055   E9           MOV     A,R1
   2702              }
   2703          
   2704              // Prepare to leave with reset
   2705              ZDApp_LeaveReset( ind->rejoin );
   \   000056                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000056   EE           MOV     A,R6
   \   000057   240C         ADD     A,#0xc
   \   000059   F582         MOV     DPL,A
   \   00005B   EF           MOV     A,R7
   \   00005C   3400         ADDC    A,#0x0
   \   00005E   F583         MOV     DPH,A
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000065   8074         SJMP    ??ZDO_LeaveInd_1
   2706            }
   2707            else
   2708            {
   2709              leave = FALSE;
   \                     ??ZDO_LeaveInd_0:
   \   000067   75..00       MOV     ?V0 + 0,#0x0
   2710          
   2711              // Check if this device needs to leave as a child or descendent
   2712              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \   00006A   8E82         MOV     DPL,R6
   \   00006C   8F83         MOV     DPH,R7
   \   00006E   C082         PUSH    DPL
   \   000070   C083         PUSH    DPH
   \   000072                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000072   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000075   8A..         MOV     ?V0 + 2,R2
   \   000077   8B..         MOV     ?V0 + 3,R3
   \   000079   D083         POP     DPH
   \   00007B   D082         POP     DPL
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   65..         XRL     A,?V0 + 2
   \   000080   7004         JNZ     ??ZDO_LeaveInd_2
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   65..         XRL     A,?V0 + 3
   \                     ??ZDO_LeaveInd_2:
   \   000086   701C         JNZ     ??ZDO_LeaveInd_3
   2713              {
   2714                if ( ( ind->removeChildren == TRUE               ) ||
   2715                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2716                       NODETYPE_DEVICE                           )    )
   \   000088   EE           MOV     A,R6
   \   000089   240B         ADD     A,#0xb
   \   00008B   F582         MOV     DPL,A
   \   00008D   EF           MOV     A,R7
   \   00008E   3400         ADDC    A,#0x0
   \   000090   F583         MOV     DPH,A
   \   000092   E0           MOVX    A,@DPTR
   \   000093   6401         XRL     A,#0x1
   \   000095   600A         JZ      ??ZDO_LeaveInd_4
   \   000097   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   5407         ANL     A,#0x7
   \   00009D   6402         XRL     A,#0x2
   \   00009F   7003         JNZ     ??ZDO_LeaveInd_3
   2717                {
   2718                  leave = TRUE;
   \                     ??ZDO_LeaveInd_4:
   \   0000A1   75..01       MOV     ?V0 + 0,#0x1
   2719                }
   2720              }
   2721              else if ( ind->removeChildren == TRUE )
   2722              {
   2723                // Check NWK address allocation algorithm
   2724                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2725              }
   2726          
   2727              if ( leave == TRUE )
   \                     ??ZDO_LeaveInd_3:
   \   0000A4   7401         MOV     A,#0x1
   \   0000A6   65..         XRL     A,?V0 + 0
   \   0000A8   7011         JNZ     ??ZDO_LeaveInd_5
   2728              {
   2729                // Prepare to leave with reset
   2730                ZDApp_LeaveReset( ind->rejoin );
   \   0000AA                ; Setup parameters for call to function ZDApp_LeaveReset
   \   0000AA   EE           MOV     A,R6
   \   0000AB   240C         ADD     A,#0xc
   \   0000AD   F582         MOV     DPL,A
   \   0000AF   EF           MOV     A,R7
   \   0000B0   3400         ADDC    A,#0x0
   \   0000B2   F583         MOV     DPH,A
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F9           MOV     R1,A
   \   0000B6   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   0000B9   8020         SJMP    ??ZDO_LeaveInd_1
   2731              }
   2732              else
   2733              {
   2734                // Remove device address(optionally descendents) from data
   2735                ZDApp_LeaveUpdate( ind->srcAddr,
   2736                                   ind->extAddr,
   2737                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_5:
   \   0000BB                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   0000BB   EE           MOV     A,R6
   \   0000BC   240B         ADD     A,#0xb
   \   0000BE   F582         MOV     DPL,A
   \   0000C0   EF           MOV     A,R7
   \   0000C1   3400         ADDC    A,#0x0
   \   0000C3   F583         MOV     DPH,A
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   F9           MOV     R1,A
   \   0000C7   EE           MOV     A,R6
   \   0000C8   2402         ADD     A,#0x2
   \   0000CA   FC           MOV     R4,A
   \   0000CB   EF           MOV     A,R7
   \   0000CC   3400         ADDC    A,#0x0
   \   0000CE   FD           MOV     R5,A
   \   0000CF   8E82         MOV     DPL,R6
   \   0000D1   8F83         MOV     DPH,R7
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   FA           MOV     R2,A
   \   0000D5   A3           INC     DPTR
   \   0000D6   E0           MOVX    A,@DPTR
   \   0000D7   FB           MOV     R3,A
   \   0000D8   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2738              }
   2739            }
   2740          
   2741            // Pass the leave indication to higher layer if callback registered.
   2742            if (zdoCBFunc[ZDO_LEAVE_IND_CBID] != NULL)
   \                     ??ZDO_LeaveInd_1:
   \   0000DB   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   F8           MOV     R0,A
   \   0000E0   A3           INC     DPTR
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   F9           MOV     R1,A
   \   0000E3   E8           MOV     A,R0
   \   0000E4   49           ORL     A,R1
   \   0000E5   601C         JZ      ??ZDO_LeaveInd_6
   2743            {
   2744              (void)zdoCBFunc[ZDO_LEAVE_IND_CBID](ind);
   \   0000E7                ; Setup parameters for indirect call
   \   0000E7   EE           MOV     A,R6
   \   0000E8   FA           MOV     R2,A
   \   0000E9   EF           MOV     A,R7
   \   0000EA   FB           MOV     R3,A
   \   0000EB   90....       MOV     DPTR,#zdoCBFunc + 12
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F8           MOV     R0,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   F583         MOV     DPH,A
   \   0000F4   8882         MOV     DPL,R0
   \   0000F6   12....       LCALL   ?CALL_IND
   \   0000F9   8A..         MOV     ?V0 + 2,R2
   \   0000FB   8B..         MOV     ?V0 + 3,R3
   \   0000FD   85..82       MOV     DPL,?V0 + 2
   \   000100   85..83       MOV     DPH,?V0 + 3
   2745            }
   2746          }
   \                     ??ZDO_LeaveInd_6:
   \   000103   7402         MOV     A,#0x2
   \   000105   12....       LCALL   ?DEALLOC_XSTACK8
   \   000108   7F04         MOV     R7,#0x4
   \   00010A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2747          
   2748          /*********************************************************************
   2749           * @fn          ZDO_SyncIndicationCB
   2750           *
   2751           * @brief       This function allows the next higher layer of a
   2752           *              coordinator to be notified of a loss of synchronization
   2753           *                          with the parent/child device.
   2754           *
   2755           * @param       type: 0 - child; 1 - parent
   2756           *
   2757           *
   2758           * @return      none
   2759           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2760          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2761          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   2762            (void)shortAddr;  // Remove this line if this parameter is used.
   2763          
   2764            if ( ZSTACK_END_DEVICE_BUILD
   2765              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityFlags & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   00000B   90....       MOV     DPTR,#_NIB + 14
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   A2E1         MOV     C,0xE0 /* A   */.1
   \   000011   4019         JC      ??ZDO_SyncIndicationCB_0
   2766            {
   2767              if ( type == 1 )
   \   000013   7401         MOV     A,#0x1
   \   000015   65..         XRL     A,?V0 + 0
   \   000017   7013         JNZ     ??ZDO_SyncIndicationCB_0
   2768              {
   2769                // We lost contact with our parent.  Clear the neighbor Table.
   2770                nwkNeighborInitTable();
   \   000019                ; Setup parameters for call to function nwkNeighborInitTable
   \   000019   12....       LCALL   ??nwkNeighborInitTable?relay
   2771          
   2772                // Start the rejoin process.
   2773                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   00001C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001C   7C00         MOV     R4,#0x0
   \   00001E   7D00         MOV     R5,#0x0
   \   000020   7B02         MOV     R3,#0x2
   \   000022   7A03         MOV     R2,#0x3
   \   000024   90....       MOV     DPTR,#ZDAppTaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??ZDApp_SendMsg?relay
   2774              }
   2775            }
   2776          }
   \                     ??ZDO_SyncIndicationCB_0:
   \   00002C   7F01         MOV     R7,#0x1
   \   00002E   02....       LJMP    ?BANKED_LEAVE_XDATA
   2777          
   2778          /*********************************************************************
   2779           * @fn          ZDO_ManytoOneFailureIndicationCB
   2780           *
   2781           * @brief       This function allows the next higher layer of a
   2782           *              concentrator to be notified of a many-to-one route
   2783           *              failure.
   2784           *
   2785           * @param       none
   2786           *
   2787           *
   2788           * @return      none
   2789           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2790          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2791          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2792            // By default, the concentrator automatically redo many-to-one route
   2793            // discovery to update all many-to-one routes in the network
   2794            // If you want anything processing other than the default,
   2795            // please replace the following code.
   2796          
   2797            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2798          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
   2799          
   2800          /*********************************************************************
   2801           * @fn          ZDO_PollConfirmCB
   2802           *
   2803           * @brief       This function allows the next higher layer to be
   2804           *              notified of a Poll Confirm.
   2805           *
   2806           * @param       none
   2807           *
   2808           * @return      none
   2809           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2810          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2811          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2812            (void)status;  // Remove this line if this parameter is used.
   2813            return;
   \   000000   02....       LJMP    ?BRET
   2814          }
   2815          
   2816          /******************************************************************************
   2817           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2818           *
   2819           * @brief       Stub routine implemented by NHLE. NHLE should call
   2820           *              <AddrMgrWriteNV> when appropriate.
   2821           *
   2822           * @param       none
   2823           *
   2824           * @return      none
   2825           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2826          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2827          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2828          #if defined ( NV_RESTORE )
   2829            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   E5..         MOV     A,?V0 + 0
   \   000017   45..         ORL     A,?V0 + 1
   \   000019   7003         JNZ     ??AddrMgrWriteNVRequest_0
   2830            {
   2831              // Trigger to save info into NV
   2832              ZDApp_NVUpdate();
   \   00001B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00001B   12....       LCALL   ??ZDApp_NVUpdate?relay
   2833            }
   2834          #endif
   2835          }
   \                     ??AddrMgrWriteNVRequest_0:
   \   00001E   7F02         MOV     R7,#0x2
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA
   2836          
   2837          /*********************************************************************
   2838           * Call Back Functions from Security  - API
   2839           */
   2840          
   2841           /*********************************************************************
   2842           * @fn          ZDO_UpdateDeviceIndication
   2843           *
   2844           * @brief       This function notifies the "Trust Center" of a
   2845           *              network when a device joins or leaves the network.
   2846           *
   2847           * @param       extAddr - pointer to 64 bit address of new device
   2848           * @param       status  - 0 if a new device joined securely
   2849           *                      - 1 if a new device joined un-securely
   2850           *                      - 2 if a device left the network
   2851           *
   2852           * @return      true if newly joined device should be allowed to
   2853           *                                              remain on network
   2854           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2855          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2856          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
   2857            // can implement a network access policy based on the
   2858            // IEEE address of newly joining devices...
   2859            (void)extAddr;
   2860            (void)status;
   2861          
   2862            return ZSuccess;
   \   000002   7900         MOV     R1,#0x0
   \   000004   02....       LJMP    ?BRET
   2863          }
   2864          
   2865          /*********************************************************************
   2866           * @fn          ZDApp_InMsgCB
   2867           *
   2868           * @brief       This function is called to pass up any message that is
   2869           *              not yet supported.  This allows for the developer to
   2870           *              support features themselves..
   2871           *
   2872           * @return      none
   2873           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2874          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2875          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2876            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   5400         ANL     A,#0x0
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   5480         ANL     A,#0x80
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   49           ORL     A,R1
   \   00001E   7071         JNZ     ??ZDApp_InMsgCB_0
   2877            {
   2878              // Handle the response message
   2879            }
   2880            else
   2881            {
   2882              // Handle the request message by sending a generic "not supported".
   2883              // Device Announce doesn't have a response.
   2884              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7064         JNZ     ??ZDApp_InMsgCB_0
   \   00002D   EE           MOV     A,R6
   \   00002E   240C         ADD     A,#0xc
   \   000030   F582         MOV     DPL,A
   \   000032   EF           MOV     A,R7
   \   000033   3400         ADDC    A,#0x0
   \   000035   F583         MOV     DPH,A
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6413         XRL     A,#0x13
   \   00003A   7004         JNZ     ??ZDApp_InMsgCB_1
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6400         XRL     A,#0x0
   \                     ??ZDApp_InMsgCB_1:
   \   000040   604F         JZ      ??ZDApp_InMsgCB_0
   2885              {
   2886                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2887                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000042                ; Setup parameters for call to function ZDP_GenericRsp
   \   000042   EE           MOV     A,R6
   \   000043   240C         ADD     A,#0xc
   \   000045   F582         MOV     DPL,A
   \   000047   EF           MOV     A,R7
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F583         MOV     DPH,A
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   4400         ORL     A,#0x0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   4480         ORL     A,#0x80
   \   000055   F5..         MOV     ?V0 + 1,A
   \   000057   78..         MOV     R0,#?V0 + 0
   \   000059   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005C   E4           CLR     A
   \   00005D   F5..         MOV     ?V0 + 0,A
   \   00005F   F5..         MOV     ?V0 + 1,A
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   EE           MOV     A,R6
   \   000067   240E         ADD     A,#0xe
   \   000069   F582         MOV     DPL,A
   \   00006B   EF           MOV     A,R7
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F583         MOV     DPH,A
   \   000070   E0           MOVX    A,@DPTR
   \   000071   FD           MOV     R5,A
   \   000072   7C84         MOV     R4,#-0x7c
   \   000074   EE           MOV     A,R6
   \   000075   2402         ADD     A,#0x2
   \   000077   FA           MOV     R2,A
   \   000078   EF           MOV     A,R7
   \   000079   3400         ADDC    A,#0x0
   \   00007B   FB           MOV     R3,A
   \   00007C   EE           MOV     A,R6
   \   00007D   240F         ADD     A,#0xf
   \   00007F   F582         MOV     DPL,A
   \   000081   EF           MOV     A,R7
   \   000082   3400         ADDC    A,#0x0
   \   000084   F583         MOV     DPH,A
   \   000086   E0           MOVX    A,@DPTR
   \   000087   F9           MOV     R1,A
   \   000088   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00008B   7404         MOV     A,#0x4
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000090   E9           MOV     A,R1
   2888              }
   2889            }
   2890          }
   \                     ??ZDApp_InMsgCB_0:
   \   000091   7F02         MOV     R7,#0x2
   \   000093   02....       LJMP    ?BANKED_LEAVE_XDATA
   2891          
   2892          
   2893          /*********************************************************************
   2894           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2895           *
   2896           * @brief   Changes the Match Descriptor Response permission.
   2897           *
   2898           * @param   endpoint - endpoint to allow responses
   2899           * @param   action - true to allow responses, false to not
   2900           *
   2901           * @return  none
   2902           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2903          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2904          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   2905            // Store the action
   2906            afSetMatch( endpoint, action );
   \   000009                ; Setup parameters for call to function afSetMatch
   \   000009   FA           MOV     R2,A
   \   00000A   EF           MOV     A,R7
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??afSetMatch?relay
   \   00000F   E9           MOV     A,R1
   2907          }
   \   000010   7F01         MOV     R7,#0x1
   \   000012   02....       LJMP    ?BANKED_LEAVE_XDATA
   2908          
   2909          /*********************************************************************
   2910           * @fn      ZDApp_NetworkInit()
   2911           *
   2912           * @brief   Used to start the network joining process
   2913           *
   2914           * @param   delay - mSec delay to wait before starting
   2915           *
   2916           * @return  none
   2917           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2918          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2919          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2920            if ( delay )
   \   000009   EE           MOV     A,R6
   \   00000A   4F           ORL     A,R7
   \   00000B   6013         JZ      ??ZDApp_NetworkInit_0
   2921            {
   2922              // Wait awhile before starting the device
   2923              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000D                ; Setup parameters for call to function osal_start_timerEx
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7B00         MOV     R3,#0x0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??osal_start_timerEx?relay
   \   00001D   E9           MOV     A,R1
   \   00001E   800D         SJMP    ??ZDApp_NetworkInit_1
   2924            }
   2925            else
   2926            {
   2927              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000020                ; Setup parameters for call to function osal_set_event
   \   000020   7A01         MOV     R2,#0x1
   \   000022   7B00         MOV     R3,#0x0
   \   000024   90....       MOV     DPTR,#ZDAppTaskID
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F9           MOV     R1,A
   \   000029   12....       LCALL   ??osal_set_event?relay
   \   00002C   E9           MOV     A,R1
   2928            }
   2929          }
   \                     ??ZDApp_NetworkInit_1:
   \   00002D   7F01         MOV     R7,#0x1
   \   00002F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2930          
   2931          /*********************************************************************
   2932           * @fn      ZDApp_NwkStateUpdateCB()
   2933           *
   2934           * @brief   This function notifies that this device's network
   2935           *          state info has been changed.
   2936           *
   2937           * @param   none
   2938           *
   2939           * @return  none
   2940           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2941          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2942          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2943            // Notify to save info into NV
   2944            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   E5..         MOV     A,?V0 + 0
   \   000017   45..         ORL     A,?V0 + 1
   \   000019   7003         JNZ     ??ZDApp_NwkStateUpdateCB_0
   2945            {
   2946              // Trigger to save info into NV
   2947              ZDApp_NVUpdate();
   \   00001B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00001B   12....       LCALL   ??ZDApp_NVUpdate?relay
   2948            }
   2949          }
   \                     ??ZDApp_NwkStateUpdateCB_0:
   \   00001E   7F02         MOV     R7,#0x2
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA
   2950          
   2951          /*********************************************************************
   2952           * @fn      ZDApp_NodeProfileSync()
   2953           *
   2954           * @brief   Sync node with stack profile.
   2955           *
   2956           * @param   stackProfile - stack profile of the network to join
   2957           *
   2958           * @return  none
   2959           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2960          void ZDApp_NodeProfileSync( uint8 stackProfile )
   \                     ZDApp_NodeProfileSync:
   2961          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2962            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000007   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5021         JNC     ??ZDApp_NodeProfileSync_0
   2963            {
   2964              if ( stackProfile != zgStackProfile )
   \   00000F   90....       MOV     DPTR,#zgStackProfile
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6E           XRL     A,R6
   \   000014   601A         JZ      ??ZDApp_NodeProfileSync_0
   2965              {
   2966                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000016   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   54F8         ANL     A,#0xf8
   \   00001C   4402         ORL     A,#0x2
   \   00001E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000021   F0           MOVX    @DPTR,A
   2967                ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   000022   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000025   740C         MOV     A,#0xc
   \   000027   F0           MOVX    @DPTR,A
   2968                NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000028                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2969              }
   2970            }
   2971          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000030   7F01         MOV     R7,#0x1
   \   000032   02....       LJMP    ?BANKED_LEAVE_XDATA
   2972          
   2973          /*********************************************************************
   2974           * @fn      ZDApp_StartJoiningCycle()
   2975           *
   2976           * @brief   Starts the joining cycle of a device.  This will only
   2977           *          continue an already started (or stopped) joining cycle.
   2978           *
   2979           * @param   none
   2980           *
   2981           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2982           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2983          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2984          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2985            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2986            {
   2987              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7401         MOV     A,#0x1
   \   000019   F0           MOVX    @DPTR,A
   2988              ZDApp_NetworkInit( 0 );
   \   00001A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00001A   7A00         MOV     R2,#0x0
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??ZDApp_NetworkInit?relay
   2989          
   2990              return ( TRUE );
   \   000021   7901         MOV     R1,#0x1
   \   000023   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2991            }
   2992            else
   2993              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000025   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000027   D083         POP     DPH
   \   000029   D082         POP     DPL
   \   00002B   02....       LJMP    ?BRET
   2994          }
   2995          
   2996          /*********************************************************************
   2997           * @fn      ZDApp_StopJoiningCycle()
   2998           *
   2999           * @brief   Stops the joining or rejoining process of a device.
   3000           *
   3001           * @param   none
   3002           *
   3003           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   3004           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3005          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   3006          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3007            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   700A         JNZ     ??ZDApp_StopJoiningCycle_1
   3008            {
   3009              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000014   90....       MOV     DPTR,#continueJoining
   \   000017   7400         MOV     A,#0x0
   \   000019   F0           MOVX    @DPTR,A
   3010              return ( TRUE );
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   3011            }
   3012            else
   3013              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001E   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   3014          }
   3015          
   3016          /*********************************************************************
   3017           * @fn      ZDApp_AnnounceNewAddress()
   3018           *
   3019           * @brief   Send Device Announce and hold all transmissions for
   3020           *          new address timeout.
   3021           *
   3022           * @param   none
   3023           *
   3024           * @return  none
   3025           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3026          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   3027          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   3028          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   3029            // Turn off data request hold
   3030            APSME_HoldDataRequests( 0 );
   \   000005                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B00         MOV     R3,#0x0
   \   000009   12....       LCALL   ??APSME_HoldDataRequests?relay
   3031          #endif
   3032          
   3033            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   3034                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   00000C                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000C   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   AE..         MOV     R6,?V0 + 0
   \   000015   AF..         MOV     R7,?V0 + 1
   \   000017                ; Setup parameters for call to function NLME_GetShortAddr
   \   000017   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00001A   8A..         MOV     ?V0 + 0,R2
   \   00001C   8B..         MOV     ?V0 + 1,R3
   \   00001E   AA..         MOV     R2,?V0 + 0
   \   000020   AB..         MOV     R3,?V0 + 1
   \   000022                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000022   75..00       MOV     ?V0 + 0,#0x0
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F9           MOV     R1,A
   \   00002F   EE           MOV     A,R6
   \   000030   FC           MOV     R4,A
   \   000031   EF           MOV     A,R7
   \   000032   FD           MOV     R5,A
   \   000033   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000036   7401         MOV     A,#0x1
   \   000038   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003B   E9           MOV     A,R1
   3035          
   3036          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   3037            // Setup the timeout
   3038            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   \   00003C                ; Setup parameters for call to function APSME_HoldDataRequests
   \   00003C   7A00         MOV     R2,#0x0
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??APSME_HoldDataRequests?relay
   3039          #endif
   3040          }
   \   000043   7F02         MOV     R7,#0x2
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
   3041          
   3042          /*********************************************************************
   3043           * @fn          ZDApp_NVUpdate
   3044           *
   3045           * @brief       Set the NV Update Timer.
   3046           *
   3047           * @param       none
   3048           *
   3049           * @return      none
   3050           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3051          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   3052          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3053          #if defined ( NV_RESTORE )
   3054            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   7CBC         MOV     R4,#-0x44
   \   000006   7D02         MOV     R5,#0x2
   \   000008   7A00         MOV     R2,#0x0
   \   00000A   7B02         MOV     R3,#0x2
   \   00000C   90....       MOV     DPTR,#ZDAppTaskID
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??osal_start_timerEx?relay
   \   000014   E9           MOV     A,R1
   3055          #endif
   3056          }
   \   000015   D083         POP     DPH
   \   000017   D082         POP     DPL
   \   000019   02....       LJMP    ?BRET
   3057          
   3058          /*********************************************************************
   3059           * @fn      ZDApp_CoordStartPANIDConflictCB()
   3060           *
   3061           * @brief   Returns a PAN ID for the network layer to use during
   3062           *          a coordinator start and there is another network with
   3063           *          the intended PANID.
   3064           *
   3065           * @param   panid - the intended PAN ID
   3066           *
   3067           * @return  PANID to try
   3068           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3069          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   3070          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   3071            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   FA           MOV     R2,A
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   3072          }
   3073          
   3074          /*********************************************************************
   3075           * @fn          ZDO_SrcRtgIndCB
   3076           *
   3077           * @brief       This function notifies the ZDO available src route record received.
   3078           *
   3079           * @param       srcAddr - source address of the source route
   3080           * @param       relayCnt - number of devices in the relay list
   3081           * @param       relayList - relay list of the source route
   3082           *
   3083           * @return      none
   3084           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3085          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   3086          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   89..         MOV     ?V0 + 2,R1
   \   000010   EC           MOV     A,R4
   \   000011   FE           MOV     R6,A
   \   000012   ED           MOV     A,R5
   \   000013   FF           MOV     R7,A
   3087            zdoSrcRtg_t srcRtg;
   3088          
   3089            srcRtg.srcAddr = srcAddr;
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E5..         MOV     A,?V0 + 1
   \   000020   F0           MOVX    @DPTR,A
   3090            srcRtg.relayCnt = relayCnt;
   \   000021   E5..         MOV     A,?V0 + 2
   \   000023   7402         MOV     A,#0x2
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E5..         MOV     A,?V0 + 2
   \   00002A   F0           MOVX    @DPTR,A
   3091            srcRtg.pRelayList = pRelayList;
   \   00002B   7403         MOV     A,#0x3
   \   00002D   12....       LCALL   ?XSTACK_DISP0_8
   \   000030   EE           MOV     A,R6
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   EF           MOV     A,R7
   \   000034   F0           MOVX    @DPTR,A
   3092          
   3093            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   000035   90....       MOV     DPTR,#zdoCBFunc
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   E8           MOV     A,R0
   \   00003E   49           ORL     A,R1
   \   00003F   6018         JZ      ??ZDO_SrcRtgIndCB_0
   3094            {
   3095              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000041                ; Setup parameters for indirect call
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   90....       MOV     DPTR,#zdoCBFunc
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F583         MOV     DPH,A
   \   000054   8882         MOV     DPL,R0
   \   000056   12....       LCALL   ?CALL_IND
   3096            }
   3097          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005E   7F03         MOV     R7,#0x3
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   3098          
   3099          /*********************************************************************
   3100           * @fn          ZDApp_InitZdoCBFunc
   3101           *
   3102           * @brief       Call this function to initialize zdoCBFunc[]
   3103           *
   3104           * @param       none
   3105           *
   3106           * @return      none
   3107           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3108          void ZDApp_InitZdoCBFunc( void )
   \                     ZDApp_InitZdoCBFunc:
   3109          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3110            uint8 i;
   3111          
   3112            for ( i=0; i< MAX_ZDO_CB_FUNC; i++ )
   \   000004   7B00         MOV     R3,#0x0
   \                     ??ZDApp_InitZdoCBFunc_0:
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502D         JNC     ??ZDApp_InitZdoCBFunc_1
   3113            {
   3114              zdoCBFunc[i] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   3115            }
   \   000036   0B           INC     R3
   \   000037   80CD         SJMP    ??ZDApp_InitZdoCBFunc_0
   3116          }
   \                     ??ZDApp_InitZdoCBFunc_1:
   \   000039   D083         POP     DPH
   \   00003B   D082         POP     DPL
   \   00003D   02....       LJMP    ?BRET
   3117          
   3118          /*********************************************************************
   3119           * @fn          ZDO_RegisterForZdoCB
   3120           *
   3121           * @brief       Call this function to register the higher layer (for
   3122           *              example, the Application layer or MT layer) with ZDO
   3123           *              callbacks to get notified of some ZDO indication like
   3124           *              existence of a concentrator or receipt of a source
   3125           *              route record.
   3126           *
   3127           * @param       indID - ZDO Indication ID
   3128           * @param       pFn   - Callback function pointer
   3129           *
   3130           * @return      ZSuccess - successful, ZInvalidParameter if not
   3131           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3132          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   3133          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FD           MOV     R5,A
   3134            // Check the range of the indication ID
   3135            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   ED           MOV     A,R5
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502C         JNC     ??ZDO_RegisterForZdoCB_0
   3136            {
   3137              zdoCBFunc[indID] = pFn;
   \   00000C   ED           MOV     A,R5
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   ACF0         MOV     R4,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2C           ADD     A,R4
   \   00001D   FC           MOV     R4,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2C           ADD     A,R4
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   EA           MOV     A,R2
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   EB           MOV     A,R3
   \   000033   F0           MOVX    @DPTR,A
   3138              return ZSuccess;
   \   000034   7900         MOV     R1,#0x0
   \   000036   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   3139            }
   3140          
   3141            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000038   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   00003A   D083         POP     DPH
   \   00003C   D082         POP     DPL
   \   00003E   02....       LJMP    ?BRET
   3142          }
   3143          
   3144          /*********************************************************************
   3145           * @fn          ZDO_DeregisterForZdoCB
   3146           *
   3147           * @brief       Call this function to de-register the higher layer (for
   3148           *              example, the Application layer or MT layer) with ZDO
   3149           *              callbacks to get notified of some ZDO indication like
   3150           *              existence of a concentrator or receipt of a source
   3151           *              route record.
   3152           *
   3153           * @param       indID - ZDO Indication ID
   3154           *
   3155           * @return      ZSuccess - successful, ZInvalidParameter if not
   3156           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3157          ZStatus_t ZDO_DeregisterForZdoCB( uint8 indID )
   \                     ZDO_DeregisterForZdoCB:
   3158          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FB           MOV     R3,A
   3159            // Check the range of the indication ID
   3160            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   EB           MOV     A,R3
   \   000007   C3           CLR     C
   \   000008   9407         SUBB    A,#0x7
   \   00000A   502E         JNC     ??ZDO_DeregisterForZdoCB_0
   3161            {
   3162              zdoCBFunc[indID] = NULL;
   \   00000C   EB           MOV     A,R3
   \   00000D   F8           MOV     R0,A
   \   00000E   7900         MOV     R1,#0x0
   \   000010   E8           MOV     A,R0
   \   000011   75F002       MOV     B,#0x2
   \   000014   A4           MUL     AB
   \   000015   C8           XCH     A,R0
   \   000016   AAF0         MOV     R2,B
   \   000018   75F000       MOV     B,#0x0
   \   00001B   A4           MUL     AB
   \   00001C   2A           ADD     A,R2
   \   00001D   FA           MOV     R2,A
   \   00001E   75F002       MOV     B,#0x2
   \   000021   E9           MOV     A,R1
   \   000022   A4           MUL     AB
   \   000023   2A           ADD     A,R2
   \   000024   F9           MOV     R1,A
   \   000025   74..         MOV     A,#zdoCBFunc & 0xff
   \   000027   28           ADD     A,R0
   \   000028   F582         MOV     DPL,A
   \   00002A   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00002C   39           ADDC    A,R1
   \   00002D   F583         MOV     DPH,A
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
   3163              return ZSuccess;
   \   000036   7900         MOV     R1,#0x0
   \   000038   8002         SJMP    ??ZDO_DeregisterForZdoCB_1
   3164            }
   3165          
   3166            return ZInvalidParameter;
   \                     ??ZDO_DeregisterForZdoCB_0:
   \   00003A   7902         MOV     R1,#0x2
   \                     ??ZDO_DeregisterForZdoCB_1:
   \   00003C   D083         POP     DPH
   \   00003E   D082         POP     DPL
   \   000040   02....       LJMP    ?BRET
   3167          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   401F         DW 8000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkDiscoveryReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkDiscoveryReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_JoinReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_JoinReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceConfigured?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceConfigured

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_beaconNotifyIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_beaconNotifyIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitZdoCBFunc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitZdoCBFunc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_DeregisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_DeregisterForZdoCB
   3168          
   3169          /*********************************************************************
   3170          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     34
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDAppCheckForHoldKey               2      0     12
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     14
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     25
       -> APSME_HoldDataRequests        0      0     20
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> APSME_HoldDataRequests        0      0     20
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
       -> ZDApp_NVUpdate                4      0      0
     ZDApp_DeviceConfigured             0      0     16
       -> osal_nv_read                  0      0     32
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0     12
       -> NLME_GetExtAddr               0      0     24
       -> ZDAppCheckForHoldKey          0      0     24
       -> ZDO_Init                      0      0     24
       -> afRegister                    0      0     24
       -> ZDApp_InitUserDesc            0      0     24
       -> ZDOInitDevice                 0      0     24
       -> ZDOInitDevice                 0      0     24
       -> ZDApp_InitZdoCBFunc           0      0     24
       -> ZDApp_RegisterCBs             0      0     24
     ZDApp_InitUserDesc                 0      0     43
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_InitZdoCBFunc                2      0     12
     ZDApp_JoinReq                      0      0     24
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     40
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     28
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlReset               0      0     24
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             0      0     10
       -> ZDApp_LeaveCtrlReset          0      0     20
     ZDApp_LeaveReset                   0      0     23
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0     41
       -> ZDSecMgrDeviceRemoveByExtAddr
                                        0      0     48
       -> ZDSecMgrAddrClear             0      0     48
       -> osal_memcpy                   0      0     54
       -> NLME_RemoveChild              0      0     48
       -> RTG_RemoveRtgEntry            0      0     48
       -> nwkNeighborRemove             0      0     48
       -> AddrMgrWriteNVRequest         0      0     48
     ZDApp_NVUpdate                     2      0     14
       -> osal_start_timerEx            4      0      0
     ZDApp_NetworkDiscoveryReq          0      0     12
       -> NLME_NetworkDiscoveryRequest
                                        0      0     24
     ZDApp_NetworkInit                  0      0     26
       -> osal_start_timerEx            0      0     18
       -> osal_set_event                0      0     18
     ZDApp_NetworkStartEvt              2      0     14
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> NLME_SetBroadcastFilter       0      0     18
     ZDApp_NwkStateUpdateCB             0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDApp_ProcessMsgCBs                0      0     50
       -> ZDO_ParseAddrRsp              0      0     66
       -> ZDO_UpdateAddrManager         0      0     66
       -> osal_mem_free                 0      0     66
       -> ZDO_ParseBindUnbindReq        0      0     66
       -> ZDO_ProcessBindUnbindReq      0      0     66
     ZDApp_ProcessNetworkJoin           0      0     29
       -> osal_set_event                0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> ZDApp_ResetTimerStart         0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_set_event                0      0     24
     ZDApp_ProcessOSALMsg               0      0     35
       -> ZDP_IncomingData              0      0     34
       -> ZDApp_ProcessMsgCBs           0      0     34
       -> ZDApp_NwkDescListProcessing
                                        0      0     34
       -> ZDApp_NodeProfileSync         0      0     34
       -> NLME_JoinRequest              0      0     42
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> osal_start_timerEx            0      0     34
       -> osal_rand                     0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZDApp_RestoreNwkKey           0      0     34
       -> ZMacSetReq                    0      0     34
       -> ZMacSetReq                    0      0     34
       -> NLME_ReJoinRequest            0      0     34
       -> osal_rand                     0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> NLME_SetPollRate              0      0     34
       -> NLME_SetQueuedPollRate        0      0     34
       -> NLME_SetResponseRate          0      0     34
       -> NLME_SetPollRate              0      0     34
       -> osal_set_event                0      0     34
       -> ZDApp_ProcessNetworkJoin      0      0     34
       -> sAddrExtCpy                   0      0     34
       -> ZDApp_NetworkInit             0      0     34
       -> ZDApp_ProcessSecMsg           0      0     34
     ZDApp_ProcessSecEvent              0      0     23
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
       -> ZDSecMgrSaveApsLinkKey        0      0     18
       -> ZDSecMgrSaveTCLinkKey         0      0     18
     ZDApp_ProcessSecMsg                0      0     26
       -> ZDSecMgrTransportKeyInd       0      0     18
       -> ZDSecMgrRemoveDeviceInd       0      0     18
       -> ZDSecMgrSwitchKeyInd          0      0     18
     ZDApp_ReadNetworkRestoreState      0      0     23
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0     12
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              0      0     21
       -> osal_start_timerEx            0      0     18
     ZDApp_RestoreNetworkState          0      0     23
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     54
       -> osal_nv_read                  0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SaveNetworkStateEvt          2      0     14
       -> NLME_UpdateNV                 4      0      0
       -> zgWriteStartupOptions         4      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SecInit                      0      0     39
       -> ZDSecMgrInit                  0      0     50
       -> ZDSecMgrReadKeyFromNv         0      0     50
       -> SSP_UpdateNwkKey              0      0     50
       -> SSP_SwitchNwkKey              0      0     50
       -> osal_memset                   0      0     50
     ZDApp_SendEventMsg                 0      0     10
       -> ZDApp_SendMsg                 0      0     20
     ZDApp_SendMsg                      1      0     33
       -> osal_msg_allocate             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_msg_send                 0      0     32
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     14
       -> osal_msg_receive              0      0     28
       -> ZDApp_ProcessOSALMsg          0      0     28
       -> osal_msg_deallocate           0      0     28
       -> USER_ZDO_JOINING_MSG          0      0     28
       -> osal_set_event                0      0     28
       -> ZDO_StartDevice               0      0     28
       -> ZDO_DEVICE_DISC               0      0     28
       -> ZDO_ACK_DEAL_WITH             0      0     28
       -> ZDApp_NetworkStartEvt         0      0     28
       -> osal_pwrmgr_device            0      0     28
       -> osal_set_event                0      0     28
       -> ZDO_UpdateNwkStatus           0      0     28
       -> osal_start_timerEx            0      0     28
       -> ZDApp_SaveNetworkStateEvt     0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> Onboard_soft_reset            0      0     28
       -> ZDApp_ProcessSecEvent         0      0     28
     ZDOInitDevice                      0      0     26
       -> zgInitItems                   0      0     28
       -> ZDConfig_InitDescriptors      0      0     28
       -> HalKeyRead                    0      0     28
       -> ZDApp_ReadNetworkRestoreState
                                        0      0     28
       -> ZDApp_RestoreNetworkState     0      0     28
       -> NLME_InitNV                   0      0     28
       -> NLME_SetDefaultNV             0      0     28
       -> ZDSecMgrClearNVKeyValues      0      0     28
       -> ZDAppDetermineDeviceType      0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_SecInit                 0      0     28
       -> ZDApp_LeaveCtrlInit           0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> osal_set_event                0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_SetBroadcastFilter       0      0     28
     ZDO_AddrChangeIndicationCB         0      0     14
       -> ZDApp_NVUpdate                0      0     28
       -> osal_set_event                0      0     28
       -> osal_msg_allocate             0      0     28
       -> osal_msg_send                 0      0     28
       -> ZDApp_AnnounceNewAddress      0      0     28
     ZDO_ConcentratorIndicationCB       1      0     16
     ZDO_DeregisterForZdoCB             2      0      0
     ZDO_JoinConfirmCB                  1      0     14
       -> ZDApp_SendMsg                 0      0     28
     ZDO_JoinIndicationCB               0      0     13
       -> ZDApp_NVUpdate                0      0     24
       -> osal_start_timerEx            0      0     24
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> ZDApp_LeaveUpdate             0      0     20
     ZDO_LeaveInd                       2      0     14
       -> NLME_LeaveRsp                 0      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> NLME_GetCoordShortAddr        4      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> ZDApp_LeaveUpdate             0      0     28
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      3      0      3
       -> ZDO_FinishProcessingMgmtNwkDiscReq
                                        4      0      6
       -> ZDApp_SendMsg                 4      0      6
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     16
     ZDO_StartRouterConfirmCB           0      0      9
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0
     ZDO_beaconNotifyIndCB              1      0     16
       -> osal_mem_alloc                0      0     32
       -> osal_memset                   0      0     32
       -> sAddrExtCpy                   0      0     32
       -> osal_memset                   0      0     32


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_P1                                          1
     _A_P2                                          1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                     14
     ZDO_FIRST_join_flag                            1
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    96
     ZDApp_SecInit                                119
     ZDApp_event_loop                             419
     ZDApp_ProcessSecEvent                        187
     ZDOInitDevice                                204
     ZDApp_ReadNetworkRestoreState                 25
     ZDAppDetermineDeviceType                      98
     ZDApp_NetworkStartEvt                        123
     ZDApp_DeviceAuthEvt                           94
     ZDApp_SaveNetworkStateEvt                     24
     ZDApp_RestoreNetworkState                     96
     ZDApp_InitUserDesc                           138
     ZDAppCheckForHoldKey                          25
     ZDApp_ProcessOSALMsg                         712
     ZDApp_ProcessMsgCBs                          164
     ZDApp_RegisterCBs                             63
     ZDApp_ProcessSecMsg                          114
     ZDApp_ProcessNetworkJoin                     608
     ZDApp_SaveNwkKey                             125
     ZDApp_ResetNwkKey                             84
     ZDApp_RestoreNwkKey                          154
     ZDApp_ResetTimerStart                         31
     ZDApp_ResetTimerCancel                        24
     ZDApp_LeaveCtrlInit                           86
     ZDApp_LeaveCtrlSet                            69
     ZDApp_LeaveCtrlReset                          55
     ZDApp_LeaveCtrlBypass                         25
     ZDApp_LeaveCtrlStartup                        72
     ZDApp_LeaveReset                              23
     ZDApp_LeaveUpdate                            160
     ZDApp_NetworkDiscoveryReq                     32
     ZDApp_JoinReq                                 96
     ZDApp_DeviceConfigured                       101
     ZDApp_SendEventMsg                            34
     ZDApp_SendMsg                                113
     ZDO_NetworkDiscoveryConfirmCB                115
     ZDO_NetworkFormationConfirmCB                 71
     ZDO_beaconNotifyIndCB                        836
     ZDO_StartRouterConfirmCB                      45
     ZDO_JoinConfirmCB                            147
     ZDO_AddrChangeIndicationCB                   157
     ZDO_JoinIndicationCB                          60
     ZDO_ConcentratorIndicationCB                  99
     ZDO_LeaveCnf                                 130
     ZDO_LeaveInd                                 269
     ZDO_SyncIndicationCB                          49
     ZDO_ManytoOneFailureIndicationCB
                                                   14
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                         35
     ZDO_UpdateDeviceIndication                     7
     ZDApp_InMsgCB                                150
     ZDApp_ChangeMatchDescRespPermission
                                                   21
     ZDApp_NetworkInit                             50
     ZDApp_NwkStateUpdateCB                        35
     ZDApp_NodeProfileSync                         53
     ZDApp_StartJoiningCycle                       46
     ZDApp_StopJoiningCycle                        39
     ZDApp_AnnounceNewAddress                      72
     ZDApp_NVUpdate                                28
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               99
     ZDApp_InitZdoCBFunc                           64
     ZDO_RegisterForZdoCB                          65
     ZDO_DeregisterForZdoCB                        67
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_0                                   4
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlReset?relay                   6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_NetworkDiscoveryReq?relay              6
     ??ZDApp_JoinReq?relay                          6
     ??ZDApp_DeviceConfigured?relay                 6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_beaconNotifyIndCB?relay                  6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDApp_InitZdoCBFunc?relay                    6
     ??ZDO_RegisterForZdoCB?relay                   6
     ??ZDO_DeregisterForZdoCB?relay                 6

 
 7 430 bytes in segment BANKED_CODE
   384 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    10 bytes in segment XDATA_I
    10 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    56 bytes in segment XDATA_Z
 
 7 824 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    66 bytes of XDATA memory

Errors: none
Warnings: none
