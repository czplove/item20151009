###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         08/Jan/2015  18:21:55 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\sta #
#                          ck\nwk\nwk_globals.c                               #
#    Command line       =  -f "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\z #
#                          stack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wRouter.cfg" (-DCPU32MHZ                  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC253 #
#                          0DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=1         #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=60            #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=30           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=4 -DASSERT_RESET         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=8000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=1000)  #
#                          -DREJOIN_POLL_RATE=440 "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Components\stack\nwk\nwk_globals.c" -D   #
#                          NV_INIT -D NV_RESTORE -D HOLD_AUTO_START -D        #
#                          MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC -D           #
#                          MT_ZDO_FUNC -D MT_ZDO_MGMT -D ISR_KEYINTERRUPT -D  #
#                          WDT_IN_PM1 -D xOSC32K_CRYSTAL_INSTALLED=0 -D       #
#                          xLARGER_NETWORK -D POWER_PA -D M0042 -lC           #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\M0042_ROUTER\List\"  #
#                          -lA "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\M0042_ROUTER\Lis #
#                          t\" --diag_suppress Pe001,Pa010 -o                 #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\M0042_ROUTER\Obj\"   #
#                          -e --no_cse --no_unroll --no_inline                #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\RE_1_2_0_FORMAL_APP(25 #
#                          1)-14-12-8\Projects\zstack\Samples\SampleApp\CC253 #
#                          0DB\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\Source\" #
#                           -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ #
#                          zstack\Samples\SampleApp\CC2530DB\..\Source\M0042_ #
#                          ROUTER\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \ZMain\TI2530DB\" -I "D:\RE_1_2_0_FORMAL_APP(251)- #
#                          14-12-8\Projects\zstack\Samples\SampleApp\CC2530DB #
#                          \..\..\..\..\..\Components\hal\include\" -I        #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\target\CC2530EB\" -I                     #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\include\" -I "D:\RE_1_2_0_FORMAL_APP(251 #
#                          )-14-12-8\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\Components\mac\high_level\" -I   #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\" -I                     #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\single_chip\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mt\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8 #
#                          \Projects\zstack\Samples\SampleApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\osal\include\" -I              #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\saddr\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\sdata\" -I                          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\af\" -I "D:\RE_1_2_0_FORMAL_APP(251)-1 #
#                          4-12-8\Projects\zstack\Samples\SampleApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\nwk\" -I           #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sapi\" -I "D:\RE_1_2_0_FORMAL_APP(251) #
#                          -14-12-8\Projects\zstack\Samples\SampleApp\CC2530D #
#                          B\..\..\..\..\..\Components\stack\sec\" -I         #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sys\" -I "D:\RE_1_2_0_FORMAL_APP(251)- #
#                          14-12-8\Projects\zstack\Samples\SampleApp\CC2530DB #
#                          \..\..\..\..\..\Components\stack\zdo\" -I          #
#                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta #
#                          ck\Samples\SampleApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\zmac\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12 #
#                          -8\Projects\zstack\Samples\SampleApp\CC2530DB\..\. #
#                          .\..\..\..\Components\zmac\f8w\" -On               #
#                          --require_prototypes                               #
#    List file          =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\M0042_ROUTER\List\nwk #
#                          _globals.lst                                       #
#    Object file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\M0042_ROUTER\Obj\nwk_ #
#                          globals.r51                                        #
#                                                                             #
#                                                                             #
###############################################################################

D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Components\stack\nwk\nwk_globals.c
      1          /**************************************************************************************************
      2            Filename:       nwk_globals.c
      3            Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4            Revision:       $Revision: 29656 $
      5          
      6            Description:    User definable Network Parameters.
      7          
      8          
      9            Copyright 2004-2011 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          #include "ZComdef.h"
     44          #include "OSAL.h"
     45          #include "OSAL_Nv.h"
     46          #include "AddrMgr.h"
     47          #include "AssocList.h"
     48          #include "BindingTable.h"
     49          #include "nwk_util.h"
     50          #include "nwk_globals.h"
     51          #include "APS.h"
     52          #include "ssp.h"
     53          #include "rtg.h"
     54          #include "ZDConfig.h"
     55          #include "ZGlobals.h"
     56          
     57          #if defined ( LCD_SUPPORTED )
     58            #include "OnBoard.h"
     59          #endif
     60          
     61          /* HAL */
     62          #include "hal_lcd.h"
     63          
     64          /*********************************************************************
     65           * MACROS
     66           */
     67          
     68          /*********************************************************************
     69           * CONSTANTS
     70           */
     71          
     72          // Maximums for the data buffer queue
     73          #define NWK_MAX_DATABUFS_WAITING    8     // Waiting to be sent to MAC
     74          #define NWK_MAX_DATABUFS_SCHEDULED  5     // Timed messages to be sent
     75          #define NWK_MAX_DATABUFS_CONFIRMED  5     // Held after MAC confirms
     76          #define NWK_MAX_DATABUFS_TOTAL      12    // Total number of buffers
     77          
     78          // 1-255 (0 -> 256) X RTG_TIMER_INTERVAL
     79          // A known shortcoming is that when a message is enqueued as "hold" for a
     80          // sleeping device, the timer tick may have counted down to 1, so that msg
     81          // will not be held as long as expected. If NWK_INDIRECT_MSG_TIMEOUT is set to 1
     82          // the hold time will vary randomly from 0 - CNT_RTG_TIMER ticks.
     83          // So the hold time will vary within this interval:
     84          // { (NWK_INDIRECT_MSG_TIMEOUT-1)*CNT_RTG_TIMER,
     85          //                                    NWK_INDIRECT_MSG_TIMEOUT*CNT_RTG_TIMER }
     86          #define NWK_INDIRECT_CNT_RTG_TMR    1
     87          // To hold msg for sleeping end devices for 30 secs:
     88          // #define CNT_RTG_TIMER            1
     89          // #define NWK_INDIRECT_MSG_TIMEOUT 30
     90          // To hold msg for sleeping end devices for 30 mins:
     91          // #define CNT_RTG_TIMER            60
     92          // #define NWK_INDIRECT_MSG_TIMEOUT 30
     93          // To hold msg for sleeping end devices for 30 days:
     94          // #define CNT_RTG_TIMER            60
     95          // #define NWK_INDIRECT_MSG_TIMEOUT (30 * 24 * 60)
     96          // Maximum msgs to hold per associated device.
     97          #define NWK_INDIRECT_MSG_MAX_PER    3
     98          // Maximum total msgs to hold for all associated devices.
     99          #define NWK_INDIRECT_MSG_MAX_ALL    \
    100                                      (NWK_MAX_DATABUFS_TOTAL - NWK_INDIRECT_MSG_MAX_PER)
    101          
    102          /*********************************************************************
    103           * TYPEDEFS
    104           */
    105          
    106          /*********************************************************************
    107           * NWK GLOBAL VARIABLES
    108           */
    109          
    110          // Variables for MAX list size

   \                                 In  segment CODE_C, align 1
    111          CONST uint16 gNWK_MAX_DEVICE_LIST = NWK_MAX_DEVICES;
   \                     gNWK_MAX_DEVICE_LIST:
   \   000000   1500         DW 21
    112          
    113          // Variables for MAX Sleeping End Devices

   \                                 In  segment CODE_C, align 1
    114          CONST uint8 gNWK_MAX_SLEEPING_END_DEVICES = NWK_MAX_DEVICES - NWK_MAX_ROUTERS;
   \                     gNWK_MAX_SLEEPING_END_DEVICES:
   \   000000   0F           DB 15
    115          
    116          // Variables for MAX data buffer levels

   \                                 In  segment CODE_C, align 1
    117          CONST uint8 gNWK_MAX_DATABUFS_WAITING = NWK_MAX_DATABUFS_WAITING;
   \                     gNWK_MAX_DATABUFS_WAITING:
   \   000000   08           DB 8

   \                                 In  segment CODE_C, align 1
    118          CONST uint8 gNWK_MAX_DATABUFS_SCHEDULED = NWK_MAX_DATABUFS_SCHEDULED;
   \                     gNWK_MAX_DATABUFS_SCHEDULED:
   \   000000   05           DB 5

   \                                 In  segment CODE_C, align 1
    119          CONST uint8 gNWK_MAX_DATABUFS_CONFIRMED = NWK_MAX_DATABUFS_CONFIRMED;
   \                     gNWK_MAX_DATABUFS_CONFIRMED:
   \   000000   05           DB 5

   \                                 In  segment CODE_C, align 1
    120          CONST uint8 gNWK_MAX_DATABUFS_TOTAL = NWK_MAX_DATABUFS_TOTAL;
   \                     gNWK_MAX_DATABUFS_TOTAL:
   \   000000   0C           DB 12
    121          

   \                                 In  segment CODE_C, align 1
    122          CONST uint8 gNWK_INDIRECT_CNT_RTG_TMR = NWK_INDIRECT_CNT_RTG_TMR;
   \                     gNWK_INDIRECT_CNT_RTG_TMR:
   \   000000   01           DB 1

   \                                 In  segment CODE_C, align 1
    123          CONST uint8 gNWK_INDIRECT_MSG_MAX_PER = NWK_INDIRECT_MSG_MAX_PER;
   \                     gNWK_INDIRECT_MSG_MAX_PER:
   \   000000   03           DB 3

   \                                 In  segment CODE_C, align 1
    124          CONST uint8 gNWK_INDIRECT_MSG_MAX_ALL = NWK_INDIRECT_MSG_MAX_ALL;
   \                     gNWK_INDIRECT_MSG_MAX_ALL:
   \   000000   09           DB 9
    125          
    126          // change this if using a different stack profile...
    127          // Cskip array

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    128          uint16 *Cskip;
   \                     Cskip:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    129          
    130          #if ( STACK_PROFILE_ID == ZIGBEEPRO_PROFILE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    131            uint8 CskipRtrs[1] = {0};
   \                     CskipRtrs:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    132            uint8 CskipChldrn[1] = {0};
   \                     CskipChldrn:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    133          #elif ( STACK_PROFILE_ID == HOME_CONTROLS )
    134            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {6,6,6,6,6,0};
    135            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {20,20,20,20,20,0};
    136          #elif ( STACK_PROFILE_ID == GENERIC_STAR )
    137            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    138            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    139          #elif ( STACK_PROFILE_ID == NETWORK_SPECIFIC )
    140            uint8 CskipRtrs[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    141            uint8 CskipChldrn[MAX_NODE_DEPTH+1] = {5,5,5,5,5,0};
    142          #endif // STACK_PROFILE_ID
    143          
    144          // Minimum lqi value that is required for association

   \                                 In  segment XDATA_I, align 1, keep-with-next
    145          uint8 gMIN_TREE_LINK_COST = MIN_LQI_COST_3;
   \                     gMIN_TREE_LINK_COST:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for gMIN_TREE_LINK_COST>`
   \   000001                REQUIRE __INIT_XDATA_I
    146          
    147          // Statically defined Associated Device List

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          associated_devices_t AssociatedDevList[NWK_MAX_DEVICES];
   \                     AssociatedDevList:
   \   000000                DS 378
   \   00017A                REQUIRE __INIT_XDATA_Z
    149          
    150          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )

   \                                 In  segment CODE_C, align 1
    151            CONST uint16 gNWK_MIN_ROUTER_CHILDREN = NWK_MIN_ROUTER_CHILDREN;
   \                     gNWK_MIN_ROUTER_CHILDREN:
   \   000000   0000         DW 0

   \                                 In  segment CODE_C, align 1
    152            CONST uint16 gNWK_MIN_ENDDEVICE_CHILDREN = NWK_MIN_ENDDEVICE_CHILDREN;
   \                     gNWK_MIN_ENDDEVICE_CHILDREN:
   \   000000   0000         DW 0
    153          #else
    154            CONST uint16 gNWK_MIN_ROUTER_CHILDREN = 0;
    155            CONST uint16 gNWK_MIN_ENDDEVICE_CHILDREN = 0;
    156          #endif
    157          

   \                                 In  segment CODE_C, align 1
    158          CONST uint16 gMAX_RTG_ENTRIES = MAX_RTG_ENTRIES;
   \                     gMAX_RTG_ENTRIES:
   \   000000   1E00         DW 30

   \                                 In  segment CODE_C, align 1
    159          CONST uint16 gMAX_RTG_SRC_ENTRIES = MAX_RTG_SRC_ENTRIES;
   \                     gMAX_RTG_SRC_ENTRIES:
   \   000000   0C00         DW 12

   \                                 In  segment CODE_C, align 1
    160          CONST uint8 gMAX_RREQ_ENTRIES = MAX_RREQ_ENTRIES;
   \                     gMAX_RREQ_ENTRIES:
   \   000000   08           DB 8
    161          

   \                                 In  segment CODE_C, align 1
    162          CONST uint8 gMAX_NEIGHBOR_ENTRIES = MAX_NEIGHBOR_ENTRIES;
   \                     gMAX_NEIGHBOR_ENTRIES:
   \   000000   30           DB 48
    163          
    164           // Table of neighboring nodes (not including child nodes)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    165          neighborEntry_t neighborTable[MAX_NEIGHBOR_ENTRIES];
   \                     neighborTable:
   \   000000                DS 1104
   \   000450                REQUIRE __INIT_XDATA_Z
    166          

   \                                 In  segment CODE_C, align 1
    167          CONST uint8 gMAX_SOURCE_ROUTE = MAX_SOURCE_ROUTE;
   \                     gMAX_SOURCE_ROUTE:
   \   000000   0C           DB 12
    168          

   \                                 In  segment CODE_C, align 1
    169          CONST uint8 gMAX_BROADCAST_QUEUED = MAX_BROADCAST_QUEUED;
   \                     gMAX_BROADCAST_QUEUED:
   \   000000   0A           DB 10
    170          

   \                                 In  segment CODE_C, align 1
    171          CONST uint8 gLINK_DOWN_TRIGGER = LINK_DOWN_TRIGGER;
   \                     gLINK_DOWN_TRIGGER:
   \   000000   18           DB 24
    172          

   \                                 In  segment CODE_C, align 1
    173          CONST uint8 gMAX_PASSIVE_ACK_CNT = MAX_PASSIVE_ACK_CNT;
   \                     gMAX_PASSIVE_ACK_CNT:
   \   000000   08           DB 8
    174          
    175          // Routing table
    176          
    177          
    178              #if defined(IRR_ROUTER)
    179                
    180                rtgEntry_t rtgTable[10];
    181              #else  

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182                rtgEntry_t rtgTable[MAX_RTG_ENTRIES];
   \                     rtgTable:
   \   000000                DS 210
   \   0000D2                REQUIRE __INIT_XDATA_Z
    183               
    184              #endif
    185          
    186          
    187          
    188          #if defined ( ZIGBEE_SOURCE_ROUTING )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    189            rtgSrcEntry_t rtgSrcTable[MAX_RTG_SRC_ENTRIES];
   \                     rtgSrcTable:
   \   000000                DS 72
   \   000048                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    190            uint16 rtgSrcRelayList[MAX_SOURCE_ROUTE];
   \                     rtgSrcRelayList:
   \   000000                DS 24
   \   000018                REQUIRE __INIT_XDATA_Z
    191          #endif
    192          
    193          // Table of current RREQ packets in the network

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    194          rtDiscEntry_t rtDiscTable[MAX_RREQ_ENTRIES];
   \                     rtDiscTable:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z
    195          
    196          // Table of data broadcast packets currently in circulation.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    197          bcastEntry_t bcastTable[MAX_BCAST];
   \                     bcastTable:
   \   000000                DS 72
   \   000048                REQUIRE __INIT_XDATA_Z
    198          
    199          // These 2 arrays are to be used as an array of struct { uint8, uint32 }.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    200          uint8 bcastHoldHandle[MAX_BCAST];
   \                     bcastHoldHandle:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    201          uint32 bcastHoldAckMask[MAX_BCAST];
   \                     bcastHoldAckMask:
   \   000000                DS 36
   \   000024                REQUIRE __INIT_XDATA_Z
    202          

   \                                 In  segment CODE_C, align 1
    203          CONST uint8 gMAX_BCAST = MAX_BCAST;
   \                     gMAX_BCAST:
   \   000000   09           DB 9
    204          
    205          // For tree addressing, this switch allows the allocation of a
    206          // router address to an end device when end device address are
    207          // all used up.  If this option is enabled, address space
    208          // could be limited.

   \                                 In  segment CODE_C, align 1
    209          CONST uint8 gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE = FALSE;
   \                     gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE:
   \   000000   00           DB 0
    210          
    211          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    212          // number of link status periods after the last received address conflict report
    213          // (network status command)

   \                                 In  segment CODE_C, align 1
    214          CONST uint8 gNWK_CONFLICTED_ADDR_EXPIRY_TIME = NWK_CONFLICTED_ADDR_EXPIRY_TIME;
   \                     gNWK_CONFLICTED_ADDR_EXPIRY_TIME:
   \   000000   04           DB 4
    215          #endif
    216          
    217          #if defined ( ZIGBEE_FREQ_AGILITY )

   \                                 In  segment CODE_C, align 1
    218          CONST uint8 gNWK_FREQ_AGILITY_ALL_MAC_ERRS = NWK_FREQ_AGILITY_ALL_MAC_ERRS;
   \                     gNWK_FREQ_AGILITY_ALL_MAC_ERRS:
   \   000000   00           DB 0
    219          #endif
    220          
    221          // The time limited to one MTO RReq (Concentrator Announce) in milliseconds.

   \                                 In  segment CODE_C, align 1
    222          CONST uint16 gMTO_RREQ_LIMIT_TIME = MTO_RREQ_LIMIT_TIME;
   \                     gMTO_RREQ_LIMIT_TIME:
   \   000000   E803         DW 1000
    223          
    224          // The number of seconds a MTO routing entry will last.

   \                                 In  segment CODE_C, align 1
    225          CONST uint8 gMTO_ROUTE_EXPIRY_TIME = MTO_ROUTE_EXPIRY_TIME;
   \                     gMTO_ROUTE_EXPIRY_TIME:
   \   000000   FF           DB 255
    226          
    227          // Route Discovery Request Default Radius

   \                                 In  segment CODE_C, align 1
    228          CONST uint8 gDEFAULT_ROUTE_REQUEST_RADIUS = DEFAULT_ROUTE_REQUEST_RADIUS;
   \                     gDEFAULT_ROUTE_REQUEST_RADIUS:
   \   000000   08           DB 8
    229          
    230          // Network message radius

   \                                 In  segment CODE_C, align 1
    231          CONST uint8 gDEF_NWK_RADIUS = DEF_NWK_RADIUS;
   \                     gDEF_NWK_RADIUS:
   \   000000   0F           DB 15
    232          
    233          #if ( ZSTACK_ROUTER_BUILD )

   \                                 In  segment CODE_C, align 1
    234          CONST uint16 gLINK_STATUS_JITTER_MASK = LINK_STATUS_JITTER_MASK;
   \                     gLINK_STATUS_JITTER_MASK:
   \   000000   7F00         DW 127
    235          #endif
    236          
    237          /*********************************************************************
    238           * APS GLOBAL VARIABLES
    239           */
    240          
    241          // The Maximum number of binding records
    242          // This number is defined in f8wConfig.cfg - change it there.

   \                                 In  segment CODE_C, align 1
    243          CONST uint16 gNWK_MAX_BINDING_ENTRIES = NWK_MAX_BINDING_ENTRIES;
   \                     gNWK_MAX_BINDING_ENTRIES:
   \   000000   0A00         DW 10
    244          
    245          #if defined ( REFLECTOR )
    246            // The Maximum number of cluster IDs in a binding record
    247            // This number is defined in f8wConfig.cfg - change it there.

   \                                 In  segment CODE_C, align 1
    248            CONST uint8 gMAX_BINDING_CLUSTER_IDS = MAX_BINDING_CLUSTER_IDS;
   \                     gMAX_BINDING_CLUSTER_IDS:
   \   000000   04           DB 4
    249          

   \                                 In  segment CODE_C, align 1
    250            CONST uint16 gBIND_REC_SIZE = sizeof( BindingEntry_t );
   \                     gBIND_REC_SIZE:
   \   000000   0E00         DW 14
    251          
    252            
    253          //#if defined(IRR_ROUTER)
    254           //   BindingEntry_t BindingTable[1];
    255          //#else

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    256            BindingEntry_t BindingTable[NWK_MAX_BINDING_ENTRIES];
   \                     BindingTable:
   \   000000                DS 140
   \   00008C                REQUIRE __INIT_XDATA_Z
    257            //#endif
    258            
    259          #endif
    260          
    261          // Maximum number allowed in the groups table.

   \                                 In  segment CODE_C, align 1
    262          CONST uint8 gAPS_MAX_GROUPS = APS_MAX_GROUPS;
   \                     gAPS_MAX_GROUPS:
   \   000000   10           DB 16
    263          
    264          // APS End Device Broadcast Table
    265          #if ( ZG_BUILD_ENDDEVICE_TYPE )
    266            apsEndDeviceBroadcast_t apsEndDeviceBroadcastTable[APS_MAX_ENDDEVICE_BROADCAST_ENTRIES];
    267            uint8 gAPS_MAX_ENDDEVICE_BROADCAST_ENTRIES = APS_MAX_ENDDEVICE_BROADCAST_ENTRIES;
    268          #endif
    269          
    270          /*********************************************************************
    271           * SECURITY GLOBAL VARIABLES
    272           */
    273          
    274          // This is the default pre-configured key,
    275          // change this to make a unique key
    276          // SEC_KEY_LEN is defined in ssp.h.
    277          
    278            /*
    279          #if defined ( DEFAULT_KEY )
    280          CONST uint8 defaultKey[SEC_KEY_LEN] = DEFAULT_KEY;
    281          #else
    282          CONST uint8 defaultKey[SEC_KEY_LEN] =
    283          {
    284            0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    285            0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
    286          };
    287          #endif
    288          */
    289          // This is the default pre-configured Trust Center Link key,
    290          // change this to make a unique key, SEC_KEY_LEN is defined in ssp.h.

   \                                 In  segment CODE_C, align 1
    291          CONST uint8 defaultTCLinkKey[SEC_KEY_LEN] = DEFAULT_TC_LINK_KEY;
   \                     defaultTCLinkKey:
   \   000000   5A           DB 90
   \   000001   69           DB 105
   \   000002   67           DB 103
   \   000003   42           DB 66
   \   000004   65           DB 101
   \   000005   65           DB 101
   \   000006   41           DB 65
   \   000007   6C           DB 108
   \   000008   6C           DB 108
   \   000009   69           DB 105
   \   00000A   61           DB 97
   \   00000B   6E           DB 110
   \   00000C   63           DB 99
   \   00000D   65           DB 101
   \   00000E   30           DB 48
   \   00000F   39           DB 57
    292          
    293          /*********************************************************************
    294           * GLOBAL VARIABLES - Statistics
    295           */
    296          
    297          #if defined ( PACKET_FILTER_STATS )
    298            uint32 apsInvalidPackets = 0;
    299            uint32 apsSecurityFailures = 0;
    300            uint32 nwkInvalidPackets = 0;
    301            uint32 nwkSecurityFailures = 0;
    302          #endif
    303          
    304          /*********************************************************************
    305           * STATUS STRINGS
    306           */
    307          #if defined ( LCD_SUPPORTED )
    308            const char PingStr[]         = "Ping Rcvd from";
    309            const char AssocCnfStr[]     = "Assoc Cnf";
    310            const char SuccessStr[]      = "Success";
    311            const char EndDeviceStr[]    = "EndDevice:";
    312            const char ParentStr[]       = "Parent:";
    313            const char ZigbeeCoordStr[]  = "ZigBee Coord";
    314            const char NetworkIDStr[]    = "Network ID:";
    315            const char RouterStr[]       = "Router:";
    316            const char OrphanRspStr[]    = "Orphan Response";
    317            const char SentStr[]         = "Sent";
    318            const char FailedStr[]       = "Failed";
    319            const char AssocRspFailStr[] = "Assoc Rsp fail";
    320            const char AssocIndStr[]     = "Assoc Ind";
    321            const char AssocCnfFailStr[] = "Assoc Cnf fail";
    322            const char EnergyLevelStr[]  = "Energy Level";
    323            const char ScanFailedStr[]   = "Scan Failed";
    324          #endif
    325          
    326          /*********************************************************************
    327           * @fn       nwk_globals_init()
    328           *
    329           * @brief
    330           *
    331           *   Initialize nwk layer globals.  These are the system defaults and
    332           *   should be changed by the user here.  The default definitions are
    333           *   defined in nwk.h or NLMEDE.h.
    334           *
    335           * @param   none
    336           *
    337           * @return  none
    338           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    339          void nwk_globals_init( void )
   \                     nwk_globals_init:
    340          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    341            AddrMgrInit( NWK_MAX_ADDRESSES );
   \   000004                ; Setup parameters for call to function AddrMgrInit
   \   000004   7A20         MOV     R2,#0x20
   \   000006   7B00         MOV     R3,#0x0
   \   000008   12....       LCALL   ??AddrMgrInit?relay
    342          
    343          #if !defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    344            if ( ZSTACK_ROUTER_BUILD )
    345            {
    346              // Initialize the Cskip Table
    347              Cskip = osal_mem_alloc(sizeof(uint16) *(MAX_NODE_DEPTH+1));
    348              RTG_FillCSkipTable(CskipChldrn, CskipRtrs, MAX_NODE_DEPTH, Cskip);
    349            }
    350          #endif
    351          
    352            // To compile out the Link Status Feature, set NWK_LINK_STATUS_PERIOD
    353            // to 0 (compiler flag).
    354            if ( ZSTACK_ROUTER_BUILD && NWK_LINK_STATUS_PERIOD )
    355            {
    356              NLME_InitLinkStatus();
   \   00000B                ; Setup parameters for call to function NLME_InitLinkStatus
   \   00000B   12....       LCALL   ??NLME_InitLinkStatus?relay
    357            }
    358          
    359          #if defined ( ZIGBEE_FREQ_AGILITY )
    360            NwkFreqAgilityInit();
   \   00000E                ; Setup parameters for call to function NwkFreqAgilityInit
   \   00000E   12....       LCALL   ??NwkFreqAgilityInit?relay
    361          #endif
    362          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
    363          
    364          /*********************************************************************
    365           * @fn       NIB_init()
    366           *
    367           * @brief
    368           *
    369           *   Initialize attribute values in NIB
    370           *
    371           * @param   none
    372           *
    373           * @return  none
    374           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    375          void NIB_init()
   \                     NIB_init:
    376          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    377            _NIB.SequenceNum = LO_UINT16(osal_rand());
   \   000005                ; Setup parameters for call to function osal_rand
   \   000005   12....       LCALL   ??osal_rand?relay
   \   000008   EA           MOV     A,R2
   \   000009   90....       MOV     DPTR,#_NIB
   \   00000C   F0           MOVX    @DPTR,A
    378          
    379            _NIB.nwkProtocolVersion = ZB_PROT_VERS;
   \   00000D   90....       MOV     DPTR,#_NIB + 17
   \   000010   7402         MOV     A,#0x2
   \   000012   F0           MOVX    @DPTR,A
    380            _NIB.MaxDepth = MAX_NODE_DEPTH;
   \   000013   90....       MOV     DPTR,#_NIB + 4
   \   000016   7414         MOV     A,#0x14
   \   000018   F0           MOVX    @DPTR,A
    381          
    382          #if ( NWK_MODE == NWK_MODE_MESH )
    383            _NIB.beaconOrder = BEACON_ORDER_NO_BEACONS;
   \   000019   90....       MOV     DPTR,#_NIB + 40
   \   00001C   740F         MOV     A,#0xf
   \   00001E   F0           MOVX    @DPTR,A
    384            _NIB.superFrameOrder = BEACON_ORDER_NO_BEACONS;
   \   00001F   90....       MOV     DPTR,#_NIB + 41
   \   000022   740F         MOV     A,#0xf
   \   000024   F0           MOVX    @DPTR,A
    385          #endif
    386          
    387            // BROADCAST SETTINGS:
    388            // *******************
    389            //   Broadcast Delivery Time
    390            //     - set to multiples of 100ms
    391            //     - should be 500ms more than the retry time
    392            //       -  "retry time" = PassiveAckTimeout * (MaxBroadcastRetries + 1)
    393            //   Passive Ack Timeout
    394            //     - set to multiples of 100ms
    395            _NIB.BroadcastDeliveryTime = zgBcastDeliveryTime;
   \   000025   90....       MOV     DPTR,#zgBcastDeliveryTime
   \   000028   E0           MOVX    A,@DPTR
   \   000029   90....       MOV     DPTR,#_NIB + 7
   \   00002C   F0           MOVX    @DPTR,A
    396            _NIB.PassiveAckTimeout     = zgPassiveAckTimeout;
   \   00002D   90....       MOV     DPTR,#zgPassiveAckTimeout
   \   000030   E0           MOVX    A,@DPTR
   \   000031   90....       MOV     DPTR,#_NIB + 1
   \   000034   F0           MOVX    @DPTR,A
    397            _NIB.MaxBroadcastRetries   = zgMaxBcastRetires;
   \   000035   90....       MOV     DPTR,#zgMaxBcastRetires
   \   000038   E0           MOVX    A,@DPTR
   \   000039   90....       MOV     DPTR,#_NIB + 2
   \   00003C   F0           MOVX    @DPTR,A
    398          
    399            _NIB.ReportConstantCost = 0;
   \   00003D   90....       MOV     DPTR,#_NIB + 8
   \   000040   7400         MOV     A,#0x0
   \   000042   F0           MOVX    @DPTR,A
    400            _NIB.RouteDiscRetries = 0;
   \   000043   90....       MOV     DPTR,#_NIB + 9
   \   000046   7400         MOV     A,#0x0
   \   000048   F0           MOVX    @DPTR,A
    401            _NIB.SecureAllFrames = USE_NWK_SECURITY;
   \   000049   90....       MOV     DPTR,#_NIB + 11
   \   00004C   7401         MOV     A,#0x1
   \   00004E   F0           MOVX    @DPTR,A
    402            _NIB.nwkAllFresh = NWK_ALL_FRESH;
   \   00004F   90....       MOV     DPTR,#_NIB + 104
   \   000052   7401         MOV     A,#0x1
   \   000054   F0           MOVX    @DPTR,A
    403          
    404            if ( ZG_SECURE_ENABLED )
    405            {
    406              _NIB.SecurityLevel = SECURITY_LEVEL;
   \   000055   90....       MOV     DPTR,#_NIB + 12
   \   000058   7405         MOV     A,#0x5
   \   00005A   F0           MOVX    @DPTR,A
    407            }
    408            else
    409            {
    410              _NIB.SecurityLevel = 0;
    411            }
    412          
    413          #if defined ( ZIGBEEPRO )
    414            _NIB.SymLink = FALSE;
   \   00005B   90....       MOV     DPTR,#_NIB + 13
   \   00005E   7400         MOV     A,#0x0
   \   000060   F0           MOVX    @DPTR,A
    415          #else
    416            _NIB.SymLink = TRUE;
    417          #endif
    418          
    419            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000061   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000064   E0           MOVX    A,@DPTR
   \   000065   90....       MOV     DPTR,#_NIB + 14
   \   000068   F0           MOVX    @DPTR,A
    420          
    421            _NIB.TransactionPersistenceTime = zgIndirectMsgTimeout;
   \   000069   90....       MOV     DPTR,#zgIndirectMsgTimeout
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F8           MOV     R0,A
   \   00006E   7900         MOV     R1,#0x0
   \   000070   90....       MOV     DPTR,#_NIB + 15
   \   000073   F0           MOVX    @DPTR,A
   \   000074   A3           INC     DPTR
   \   000075   E9           MOV     A,R1
   \   000076   F0           MOVX    @DPTR,A
    422          
    423            _NIB.RouteDiscoveryTime = zgRouteDiscoveryTime;
   \   000077   90....       MOV     DPTR,#zgRouteDiscoveryTime
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   90....       MOV     DPTR,#_NIB + 18
   \   00007E   F0           MOVX    @DPTR,A
    424            _NIB.RouteExpiryTime = zgRouteExpiryTime;
   \   00007F   90....       MOV     DPTR,#zgRouteExpiryTime
   \   000082   E0           MOVX    A,@DPTR
   \   000083   90....       MOV     DPTR,#_NIB + 19
   \   000086   F0           MOVX    @DPTR,A
    425          
    426            _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   000087   90....       MOV     DPTR,#_NIB + 20
   \   00008A   74FE         MOV     A,#-0x2
   \   00008C   F0           MOVX    @DPTR,A
   \   00008D   A3           INC     DPTR
   \   00008E   74FF         MOV     A,#-0x1
   \   000090   F0           MOVX    @DPTR,A
    427            _NIB.nwkLogicalChannel = 0;
   \   000091   90....       MOV     DPTR,#_NIB + 22
   \   000094   7400         MOV     A,#0x0
   \   000096   F0           MOVX    @DPTR,A
    428            _NIB.nwkCoordAddress = INVALID_NODE_ADDR;
   \   000097   90....       MOV     DPTR,#_NIB + 23
   \   00009A   74FE         MOV     A,#-0x2
   \   00009C   F0           MOVX    @DPTR,A
   \   00009D   A3           INC     DPTR
   \   00009E   74FF         MOV     A,#-0x1
   \   0000A0   F0           MOVX    @DPTR,A
    429            osal_memset( _NIB.nwkCoordExtAddress, 0, Z_EXTADDR_LEN );
   \   0000A1                ; Setup parameters for call to function osal_memset
   \   0000A1   7C08         MOV     R4,#0x8
   \   0000A3   7D00         MOV     R5,#0x0
   \   0000A5   7900         MOV     R1,#0x0
   \   0000A7   7A..         MOV     R2,#(_NIB + 25) & 0xff
   \   0000A9   7B..         MOV     R3,#((_NIB + 25) >> 8) & 0xff
   \   0000AB   12....       LCALL   ??osal_memset?relay
    430            _NIB.nwkPanId = INVALID_NODE_ADDR;
   \   0000AE   90....       MOV     DPTR,#_NIB + 33
   \   0000B1   74FE         MOV     A,#-0x2
   \   0000B3   F0           MOVX    @DPTR,A
   \   0000B4   A3           INC     DPTR
   \   0000B5   74FF         MOV     A,#-0x1
   \   0000B7   F0           MOVX    @DPTR,A
    431          
    432            osal_cpyExtAddr( _NIB.extendedPANID, zgExtendedPANID );
   \   0000B8                ; Setup parameters for call to function sAddrExtCpy
   \   0000B8   7C..         MOV     R4,#zgExtendedPANID & 0xff
   \   0000BA   7D..         MOV     R5,#(zgExtendedPANID >> 8) & 0xff
   \   0000BC   7A..         MOV     R2,#(_NIB + 53) & 0xff
   \   0000BE   7B..         MOV     R3,#((_NIB + 53) >> 8) & 0xff
   \   0000C0   12....       LCALL   ??sAddrExtCpy?relay
    433          
    434            _NIB.nwkKeyLoaded = FALSE;
   \   0000C3   90....       MOV     DPTR,#_NIB + 61
   \   0000C6   7400         MOV     A,#0x0
   \   0000C8   F0           MOVX    @DPTR,A
    435          
    436          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    437            _NIB.nwkAddrAlloc  = NWK_ADDRESSING_STOCHASTIC;
   \   0000C9   90....       MOV     DPTR,#_NIB + 96
   \   0000CC   7402         MOV     A,#0x2
   \   0000CE   F0           MOVX    @DPTR,A
    438            _NIB.nwkUniqueAddr = FALSE;
   \   0000CF   90....       MOV     DPTR,#_NIB + 97
   \   0000D2   7400         MOV     A,#0x0
   \   0000D4   F0           MOVX    @DPTR,A
    439          #else
    440            _NIB.nwkAddrAlloc  = NWK_ADDRESSING_DISTRIBUTED;
    441            _NIB.nwkUniqueAddr = TRUE;
    442          #endif
    443          
    444            _NIB.nwkLinkStatusPeriod = NWK_LINK_STATUS_PERIOD;
   \   0000D5   90....       MOV     DPTR,#_NIB + 98
   \   0000D8   7414         MOV     A,#0x14
   \   0000DA   F0           MOVX    @DPTR,A
    445            _NIB.nwkRouterAgeLimit = NWK_ROUTE_AGE_LIMIT;
   \   0000DB   90....       MOV     DPTR,#_NIB + 99
   \   0000DE   741E         MOV     A,#0x1e
   \   0000E0   F0           MOVX    @DPTR,A
    446          
    447            //MTO and source routing
    448            _NIB.nwkConcentratorDiscoveryTime = zgConcentratorDiscoveryTime;
   \   0000E1   90....       MOV     DPTR,#zgConcentratorDiscoveryTime
   \   0000E4   E0           MOVX    A,@DPTR
   \   0000E5   90....       MOV     DPTR,#_NIB + 102
   \   0000E8   F0           MOVX    @DPTR,A
    449            _NIB.nwkIsConcentrator = zgConcentratorEnable;
   \   0000E9   90....       MOV     DPTR,#zgConcentratorEnable
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   90....       MOV     DPTR,#_NIB + 101
   \   0000F0   F0           MOVX    @DPTR,A
    450            _NIB.nwkConcentratorRadius = zgConcentratorRadius;
   \   0000F1   90....       MOV     DPTR,#zgConcentratorRadius
   \   0000F4   E0           MOVX    A,@DPTR
   \   0000F5   90....       MOV     DPTR,#_NIB + 103
   \   0000F8   F0           MOVX    @DPTR,A
    451          
    452          #if defined ( ZIGBEE_MULTICAST )
    453            _NIB.nwkUseMultiCast = TRUE;
   \   0000F9   90....       MOV     DPTR,#_NIB + 100
   \   0000FC   7401         MOV     A,#0x1
   \   0000FE   F0           MOVX    @DPTR,A
    454          #else
    455            _NIB.nwkUseMultiCast = FALSE;
    456          #endif
    457          
    458          #if defined ( NV_RESTORE )
    459            if ( osal_nv_read( ZCD_NV_NWKMGR_ADDR, 0, sizeof( _NIB.nwkManagerAddr ),
    460                               &_NIB.nwkManagerAddr ) != SUCCESS )
   \   0000FF                ; Setup parameters for call to function osal_nv_read
   \   0000FF   75....       MOV     ?V0 + 0,#(_NIB + 105) & 0xff
   \   000102   75....       MOV     ?V0 + 1,#((_NIB + 105) >> 8) & 0xff
   \   000105   78..         MOV     R0,#?V0 + 0
   \   000107   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00010A   75..02       MOV     ?V0 + 0,#0x2
   \   00010D   75..00       MOV     ?V0 + 1,#0x0
   \   000110   78..         MOV     R0,#?V0 + 0
   \   000112   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000115   7C00         MOV     R4,#0x0
   \   000117   7D00         MOV     R5,#0x0
   \   000119   7A89         MOV     R2,#-0x77
   \   00011B   7B00         MOV     R3,#0x0
   \   00011D   12....       LCALL   ??osal_nv_read?relay
   \   000120   7404         MOV     A,#0x4
   \   000122   12....       LCALL   ?DEALLOC_XSTACK8
   \   000125   E9           MOV     A,R1
   \   000126   600A         JZ      ??NIB_init_0
    461          #endif
    462            {
    463              _NIB.nwkManagerAddr = 0x0000;
   \   000128   90....       MOV     DPTR,#_NIB + 105
   \   00012B   7400         MOV     A,#0x0
   \   00012D   F0           MOVX    @DPTR,A
   \   00012E   A3           INC     DPTR
   \   00012F   7400         MOV     A,#0x0
   \   000131   F0           MOVX    @DPTR,A
    464            }
    465          
    466            _NIB.nwkUpdateId = 0;
   \                     ??NIB_init_0:
   \   000132   90....       MOV     DPTR,#_NIB + 109
   \   000135   7400         MOV     A,#0x0
   \   000137   F0           MOVX    @DPTR,A
    467            _NIB.nwkTotalTransmissions = 0;
   \   000138   90....       MOV     DPTR,#_NIB + 107
   \   00013B   7400         MOV     A,#0x0
   \   00013D   F0           MOVX    @DPTR,A
   \   00013E   A3           INC     DPTR
   \   00013F   7400         MOV     A,#0x0
   \   000141   F0           MOVX    @DPTR,A
    468          
    469            if ( ZSTACK_ROUTER_BUILD )
    470            {
    471          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
    472              NLME_InitStochasticAddressing();
   \   000142                ; Setup parameters for call to function NLME_InitStochasticAddressing
   \   000142   12....       LCALL   ??NLME_InitStochasticAddressing?relay
    473          #else
    474              NLME_InitTreeAddressing();
    475          #endif
    476            }
    477          }
   \   000145   7F02         MOV     R7,#0x2
   \   000147   02....       LJMP    ?BANKED_LEAVE_XDATA
    478          
    479          /*********************************************************************
    480           * @fn       nwk_Status()
    481           *
    482           * @brief
    483           *
    484           *   Status report.
    485           *
    486           * @param   statusCode
    487           * @param   statusValue
    488           *
    489           * @return  none
    490           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    491          void nwk_Status( uint16 statusCode, uint16 statusValue )
   \                     nwk_Status:
    492          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    493          #if defined ( LCD_SUPPORTED )
    494            switch ( statusCode )
    495            {
    496              case NWK_STATUS_COORD_ADDR:
    497                if ( ZSTACK_ROUTER_BUILD )
    498                {
    499                  HalLcdWriteString( (char*)ZigbeeCoordStr, HAL_LCD_LINE_1 );
    500                  HalLcdWriteStringValue( (char*)NetworkIDStr, statusValue, 16, HAL_LCD_LINE_2 );
    501                  BuzzerControl( BUZZER_BLIP );
    502                }
    503                break;
    504          
    505              case NWK_STATUS_ROUTER_ADDR:
    506                if ( ZSTACK_ROUTER_BUILD )
    507                {
    508                  HalLcdWriteStringValue( (char*)RouterStr, statusValue, 16, HAL_LCD_LINE_1 );
    509                }
    510                break;
    511          
    512              case NWK_STATUS_ORPHAN_RSP:
    513                if ( ZSTACK_ROUTER_BUILD )
    514                {
    515                  if ( statusValue == ZSuccess )
    516                    HalLcdWriteScreen( (char*)OrphanRspStr, (char*)SentStr );
    517                  else
    518                    HalLcdWriteScreen( (char*)OrphanRspStr, (char*)FailedStr );
    519                }
    520                break;
    521          
    522              case NWK_ERROR_ASSOC_RSP:
    523                if ( ZSTACK_ROUTER_BUILD )
    524                {
    525                  HalLcdWriteString( (char*)AssocRspFailStr, HAL_LCD_LINE_1 );
    526                  HalLcdWriteValue( (uint32)(statusValue), 16, HAL_LCD_LINE_2 );
    527                }
    528                break;
    529          
    530              case NWK_STATUS_ED_ADDR:
    531                if ( ZSTACK_END_DEVICE_BUILD )
    532                {
    533                  HalLcdWriteStringValue( (char*)EndDeviceStr, statusValue, 16, HAL_LCD_LINE_1 );
    534                }
    535                break;
    536          
    537              case NWK_STATUS_PARENT_ADDR:
    538                      HalLcdWriteStringValue( (char*)ParentStr, statusValue, 16, HAL_LCD_LINE_2 );
    539                break;
    540          
    541              case NWK_STATUS_ASSOC_CNF:
    542                HalLcdWriteScreen( (char*)AssocCnfStr, (char*)SuccessStr );
    543                break;
    544          
    545              case NWK_ERROR_ASSOC_CNF_DENIED:
    546                HalLcdWriteString((char*)AssocCnfFailStr, HAL_LCD_LINE_1 );
    547                HalLcdWriteValue( (uint32)(statusValue), 16, HAL_LCD_LINE_2 );
    548                break;
    549          
    550              case NWK_ERROR_ENERGY_SCAN_FAILED:
    551                HalLcdWriteScreen( (char*)EnergyLevelStr, (char*)ScanFailedStr );
    552                break;
    553            }
    554          #endif
    555          }
   \   000000   02....       LJMP    ?BRET
    556          
    557          /*********************************************************************
    558           * @fn       nwk_UpdateStatistics()
    559           *
    560           * @brief   Update network layer statistic counters
    561           *
    562           * @param   statisticCode
    563           *
    564           * @return  none
    565           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    566          void nwk_UpdateStatistics( uint8 statisticCode )
   \                     nwk_UpdateStatistics:
    567          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    568          #if defined ( PACKET_FILTER_STATS )
    569            switch ( statisticCode )
    570            {
    571              case STAT_NWK_INVALID_PACKET:
    572                nwkInvalidPackets++;
    573                break;
    574          
    575              case STAT_NWK_SECURITY_FAILURE:
    576                nwkInvalidPackets++;
    577                nwkSecurityFailures++;
    578                break;
    579          
    580              case STAT_APS_INVALID_PACKET:
    581                apsInvalidPackets++;
    582                break;
    583          
    584              case STAT_APS_SECURITY_FAILURE:
    585                apsSecurityFailures++;
    586                break;
    587            }
    588          #endif
    589          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for gMIN_TREE_LINK_COST>`:
   \   000000   06           DB 6

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_globals_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_globals_init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??NIB_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    NIB_init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_Status?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_Status

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??nwk_UpdateStatistics?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    nwk_UpdateStatistics
    590          
    591          /*********************************************************************
    592          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     NIB_init                           0      0     14
       -> osal_rand                     0      0     20
       -> osal_memset                   0      0     20
       -> sAddrExtCpy                   0      0     20
       -> osal_nv_read                  0      0     28
       -> NLME_InitStochasticAddressing
                                        0      0     20
     nwk_Status                         0      0      0
     nwk_UpdateStatistics               0      0      0
     nwk_globals_init                   2      0      0
       -> AddrMgrInit                   4      0      0
       -> NLME_InitLinkStatus           4      0      0
       -> NwkFreqAgilityInit            4      0      0


   Segment part sizes:

     Function/Label                         Bytes
     --------------                         -----
     gNWK_MAX_DEVICE_LIST                      2
     gNWK_MAX_SLEEPING_END_DEVICES             1
     gNWK_MAX_DATABUFS_WAITING                 1
     gNWK_MAX_DATABUFS_SCHEDULED               1
     gNWK_MAX_DATABUFS_CONFIRMED               1
     gNWK_MAX_DATABUFS_TOTAL                   1
     gNWK_INDIRECT_CNT_RTG_TMR                 1
     gNWK_INDIRECT_MSG_MAX_PER                 1
     gNWK_INDIRECT_MSG_MAX_ALL                 1
     Cskip                                     2
     CskipRtrs                                 1
     CskipChldrn                               1
     gMIN_TREE_LINK_COST                       1
     AssociatedDevList                       378
     gNWK_MIN_ROUTER_CHILDREN                  2
     gNWK_MIN_ENDDEVICE_CHILDREN               2
     gMAX_RTG_ENTRIES                          2
     gMAX_RTG_SRC_ENTRIES                      2
     gMAX_RREQ_ENTRIES                         1
     gMAX_NEIGHBOR_ENTRIES                     1
     neighborTable                          1104
     gMAX_SOURCE_ROUTE                         1
     gMAX_BROADCAST_QUEUED                     1
     gLINK_DOWN_TRIGGER                        1
     gMAX_PASSIVE_ACK_CNT                      1
     rtgTable                                210
     rtgSrcTable                              72
     rtgSrcRelayList                          24
     rtDiscTable                              64
     bcastTable                               72
     bcastHoldHandle                           9
     bcastHoldAckMask                         36
     gMAX_BCAST                                1
     gNWK_TREE_ALLOCATE_ROUTERADDR_FOR_ENDDEVICE
                                               1
     gNWK_CONFLICTED_ADDR_EXPIRY_TIME
                                               1
     gNWK_FREQ_AGILITY_ALL_MAC_ERRS            1
     gMTO_RREQ_LIMIT_TIME                      2
     gMTO_ROUTE_EXPIRY_TIME                    1
     gDEFAULT_ROUTE_REQUEST_RADIUS             1
     gDEF_NWK_RADIUS                           1
     gLINK_STATUS_JITTER_MASK                  2
     gNWK_MAX_BINDING_ENTRIES                  2
     gMAX_BINDING_CLUSTER_IDS                  1
     gBIND_REC_SIZE                            2
     BindingTable                            140
     gAPS_MAX_GROUPS                           1
     defaultTCLinkKey                         16
     nwk_globals_init                         24
     NIB_init                                330
     nwk_Status                                3
     nwk_UpdateStatistics                      3
     ?<Initializer for gMIN_TREE_LINK_COST>    1
     ??nwk_globals_init?relay                  6
     ??NIB_init?relay                          6
     ??nwk_Status?relay                        6
     ??nwk_UpdateStatistics?relay              6

 
   360 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
    57 bytes in segment CODE_C
     1 byte  in segment XDATA_I
     1 byte  in segment XDATA_ID
 2 113 bytes in segment XDATA_Z
 
   442 bytes of CODE  memory
 2 114 bytes of XDATA memory

Errors: none
Warnings: none
