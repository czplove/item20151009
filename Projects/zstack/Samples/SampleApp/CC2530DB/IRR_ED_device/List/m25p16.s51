///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.10.1.10194/W32 for 8051        12/Dec/2014  00:51:44 /
// Copyright 2004-2011 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//    Source file        =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta /
//                          ck\Samples\SampleApp\Source\IRR_enddevice\m25p16. /
//                          c                                                 /
//    Command line       =  -f "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ /
//                          zstack\Samples\SampleApp\CC2530DB\..\..\..\Tools\ /
//                          CC2530DB\f8wEndev.cfg" (-DCPU32MHZ                /
//                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3        /
//                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f         /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2 /
//                          530DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=1      /
//                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                 /
//                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                      /
//                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_M /
//                          ASK=0x007F -DBEACON_REQUEST_DELAY=100             /
//                          -DBEACON_REQ_DELAY_MASK=0x00FF                    /
//                          -DLINK_STATUS_JITTER_MASK=0x007F                  /
//                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_P /
//                          OLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=60          /
//                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3   /
//                          -DNWK_MAX_DATA_RETRIES=2                          /
//                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9        /
//                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=30          /
//                          -DNWK_MAX_BINDING_ENTRIES=1                       /
//                          -DMAX_BINDING_CLUSTER_IDS=4 -DASSERT_RESET        /
//                          -DMAC_MAX_FRAME_SIZE=116                          /
//                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const    /
//                          __code" -DGENERIC=__generic                       /
//                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=8000       /
//                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=1000) /
//                           -DREJOIN_POLL_RATE=440                           /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\Source\IRR_enddevice\m25p16 /
//                          .c" -D NV_INIT -D NV_RESTORE -D HOLD_AUTO_START   /
//                          -D MT_TASK -D xMT_APP_FUNC -D MT_SYS_FUNC -D      /
//                          MT_ZDO_FUNC -D xMT_ZDO_MGMT -D ISR_KEYINTERRUPT   /
//                          -D POWER_SAVING -D LONG_POLL_TIMES -D             /
//                          HAVE_TEST_FUN -D RESUME_TIME_TEST -D IRR_ED -D    /
//                          M_V332 -lC "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\P /
//                          rojects\zstack\Samples\SampleApp\CC2530DB\IRR_ED_ /
//                          device\List\" -lA "D:\RE_1_2_0_FORMAL_APP(251)-14 /
//                          -12-8\Projects\zstack\Samples\SampleApp\CC2530DB\ /
//                          IRR_ED_device\List\" --diag_suppress Pe001,Pa010  /
//                          -o "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\ /
//                          zstack\Samples\SampleApp\CC2530DB\IRR_ED_device\O /
//                          bj\" -e --no_cse --no_unroll --no_inline          /
//                          --no_code_motion --no_tbaa --debug --core=plain   /
//                          --dptr=16,1 --data_model=large                    /
//                          --code_model=banked --calling_convention=xdata_re /
//                          entrant --place_constants=data_rom                /
//                          --nr_virtual_regs 16 -I                           /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\" -I               /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\Source\" -I     /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\Source\rssi_tes /
//                          t\h\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Pro /
//                          jects\zstack\Samples\SampleApp\CC2530DB\..\Source /
//                          \IRR_enddevice\" -I "D:\RE_1_2_0_FORMAL_APP(251)- /
//                          14-12-8\Projects\zstack\Samples\SampleApp\CC2530D /
//                          B\..\..\..\ZMain\TI2530DB\" -I                    /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\hal\include\" -I                          /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\hal\target\CC2530EB\" -I                  /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\mac\include\" -I                          /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\mac\high_level\" -I                       /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\mac\low_level\srf04\" -I                  /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\mac\low_level\srf04\single_chip\" -I      /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\mt\" -I "D:\RE_1_2_0_FORMAL_APP(251)-14-1 /
//                          2-8\Projects\zstack\Samples\SampleApp\CC2530DB\.. /
//                          \..\..\..\..\Components\osal\include\" -I         /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\services\saddr\" -I                       /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\services\sdata\" -I                       /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\stack\af\" -I "D:\RE_1_2_0_FORMAL_APP(251 /
//                          )-14-12-8\Projects\zstack\Samples\SampleApp\CC253 /
//                          0DB\..\..\..\..\..\Components\stack\nwk\" -I      /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\stack\sapi\" -I                           /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\stack\sec\" -I "D:\RE_1_2_0_FORMAL_APP(25 /
//                          1)-14-12-8\Projects\zstack\Samples\SampleApp\CC25 /
//                          30DB\..\..\..\..\..\Components\stack\sys\" -I     /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\stack\zdo\" -I "D:\RE_1_2_0_FORMAL_APP(25 /
//                          1)-14-12-8\Projects\zstack\Samples\SampleApp\CC25 /
//                          30DB\..\..\..\..\..\Components\zmac\" -I          /
//                          "D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zst /
//                          ack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Com /
//                          ponents\zmac\f8w\" -On --require_prototypes       /
//    List file          =  D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zsta /
//                          ck\Samples\SampleApp\CC2530DB\IRR_ED_device\List\ /
//                          m25p16.s51                                        /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME m25p16

        RTMODEL "__SystemLibrary", "CLib"
        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "banked"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?ALLOC_XSTACK8
        EXTERN ?BANKED_ENTER_XDATA
        EXTERN ?BANKED_LEAVE_XDATA
        EXTERN ?BDISPATCH
        EXTERN ?BRET
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?PUSH_XSTACK_I_TWO
        EXTERN ?US_DIV_MOD
        EXTERN ?US_SHR
        EXTERN ?V0
        EXTERN ?XSP
        EXTERN ?XSTACK_DISP0_8
        EXTERN __INIT_XDATA_Z

        PUBLIC ??m25p16_BulkErase?relay
        FUNCTION ??m25p16_BulkErase?relay,0203H
        PUBLIC ??m25p16_CAPFModify?relay
        FUNCTION ??m25p16_CAPFModify?relay,0203H
        PUBLIC ??m25p16_EraseAllChip?relay
        FUNCTION ??m25p16_EraseAllChip?relay,0203H
        PUBLIC ??m25p16_beWIP?relay
        FUNCTION ??m25p16_beWIP?relay,0203H
        PUBLIC ??m25p16_deepPowerDown?relay
        FUNCTION ??m25p16_deepPowerDown?relay,0203H
        PUBLIC ??m25p16_pageModify?relay
        FUNCTION ??m25p16_pageModify?relay,0203H
        PUBLIC ??m25p16_pageProgram?relay
        FUNCTION ??m25p16_pageProgram?relay,0203H
        PUBLIC ??m25p16_readData?relay
        FUNCTION ??m25p16_readData?relay,0203H
        PUBLIC ??m25p16_readID?relay
        FUNCTION ??m25p16_readID?relay,0203H
        PUBLIC ??m25p16_readST?relay
        FUNCTION ??m25p16_readST?relay,0203H
        PUBLIC ??m25p16_sectorErase?relay
        FUNCTION ??m25p16_sectorErase?relay,0203H
        PUBLIC ??m25p16_wakeUP?relay
        FUNCTION ??m25p16_wakeUP?relay,0203H
        PUBLIC ??m25p16_writeEnable?relay
        FUNCTION ??m25p16_writeEnable?relay,0203H
        PUBWEAK U0CSR
        PUBWEAK U0DBUF
        PUBWEAK _A_P0
        PUBLIC m25p16_BulkErase
        FUNCTION m25p16_BulkErase,0203H
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_CAPFModify
        FUNCTION m25p16_CAPFModify,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 19, STACK
        PUBLIC m25p16_EraseAllChip
        FUNCTION m25p16_EraseAllChip,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_ID
        PUBLIC m25p16_beWIP
        FUNCTION m25p16_beWIP,021203H
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_deepPowerDown
        FUNCTION m25p16_deepPowerDown,0203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_pageModify
        FUNCTION m25p16_pageModify,021203H
        ARGFRAME XSTACK, 4, STACK
        LOCFRAME XSTACK, 22, STACK
        PUBLIC m25p16_pageProgram
        FUNCTION m25p16_pageProgram,0203H
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 10, STACK
        PUBLIC m25p16_readData
        FUNCTION m25p16_readData,0203H
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 10, STACK
        PUBLIC m25p16_readID
        FUNCTION m25p16_readID,0203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_readST
        FUNCTION m25p16_readST,0203H
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_sectorErase
        FUNCTION m25p16_sectorErase,0203H
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_wakeUP
        FUNCTION m25p16_wakeUP,0203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        PUBLIC m25p16_writeEnable
        FUNCTION m25p16_writeEnable,0203H
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        
        CFI Names cfiNames0
        CFI StackFrame CFA_SP SP IDATA
        CFI StackFrame CFA_PSP16 PSP16 XDATA
        CFI StackFrame CFA_XSP16 XSP16 XDATA
        CFI StaticOverlayFrame CFA_IOVERLAY IOVERLAY
        CFI StaticOverlayFrame CFA_DOVERLAY DOVERLAY
        CFI Resource `PSW.CY`:1, `B.BR0`:1, `B.BR1`:1, `B.BR2`:1, `B.BR3`:1
        CFI Resource `B.BR4`:1, `B.BR5`:1, `B.BR6`:1, `B.BR7`:1, `VB.BR8`:1
        CFI Resource `VB.BR9`:1, `VB.BR10`:1, `VB.BR11`:1, `VB.BR12`:1
        CFI Resource `VB.BR13`:1, `VB.BR14`:1, `VB.BR15`:1, VB:8, B:8, A:8
        CFI Resource PSW:8, DPL0:8, DPH0:8, R0:8, R1:8, R2:8, R3:8, R4:8, R5:8
        CFI Resource R6:8, R7:8, V0:8, V1:8, V2:8, V3:8, V4:8, V5:8, V6:8, V7:8
        CFI Resource V8:8, V9:8, V10:8, V11:8, V12:8, V13:8, V14:8, V15:8, SP:8
        CFI Resource PSPH:8, PSPL:8, PSP16:16, XSPH:8, XSPL:8, XSP16:16
        CFI VirtualResource ?RET:24
        CFI Resource ?BRET_EXT:8
        CFI VirtualResource ?RET_HIGH:8, ?RET_LOW:8
        CFI ResourceParts PSP16 PSPH, PSPL
        CFI ResourceParts XSP16 XSPH, XSPL
        CFI ResourceParts ?RET ?BRET_EXT, ?RET_HIGH, ?RET_LOW
        CFI EndNames cfiNames0
        
        CFI Common cfiCommon0 Using cfiNames0
        CFI CodeAlign 1
        CFI DataAlign -1
        CFI ReturnAddress ?RET CODE
        CFI CFA_DOVERLAY Used
        CFI CFA_IOVERLAY Used
        CFI CFA_SP SP+-3
        CFI CFA_PSP16 PSP16+0
        CFI CFA_XSP16 XSP16+0
        CFI `PSW.CY` SameValue
        CFI `B.BR0` SameValue
        CFI `B.BR1` SameValue
        CFI `B.BR2` SameValue
        CFI `B.BR3` SameValue
        CFI `B.BR4` SameValue
        CFI `B.BR5` SameValue
        CFI `B.BR6` SameValue
        CFI `B.BR7` SameValue
        CFI `VB.BR8` SameValue
        CFI `VB.BR9` SameValue
        CFI `VB.BR10` SameValue
        CFI `VB.BR11` SameValue
        CFI `VB.BR12` SameValue
        CFI `VB.BR13` SameValue
        CFI `VB.BR14` SameValue
        CFI `VB.BR15` SameValue
        CFI VB SameValue
        CFI B Undefined
        CFI A Undefined
        CFI PSW SameValue
        CFI DPL0 SameValue
        CFI DPH0 SameValue
        CFI R0 Undefined
        CFI R1 Undefined
        CFI R2 Undefined
        CFI R3 Undefined
        CFI R4 Undefined
        CFI R5 Undefined
        CFI R6 SameValue
        CFI R7 SameValue
        CFI V0 SameValue
        CFI V1 SameValue
        CFI V2 SameValue
        CFI V3 SameValue
        CFI V4 SameValue
        CFI V5 SameValue
        CFI V6 SameValue
        CFI V7 SameValue
        CFI V8 SameValue
        CFI V9 SameValue
        CFI V10 SameValue
        CFI V11 SameValue
        CFI V12 SameValue
        CFI V13 SameValue
        CFI V14 SameValue
        CFI V15 SameValue
        CFI PSPH Undefined
        CFI PSPL Undefined
        CFI XSPH Undefined
        CFI XSPL Undefined
        CFI ?RET Concat
        CFI ?BRET_EXT Frame(CFA_SP, 3)
        CFI ?RET_HIGH Frame(CFA_SP, 2)
        CFI ?RET_LOW Frame(CFA_SP, 1)
        CFI EndCommon cfiCommon0
        
m25p16_BulkErase    SYMBOL "m25p16_BulkErase"
??m25p16_BulkErase?relay SYMBOL "?relay", m25p16_BulkErase
m25p16_CAPFModify   SYMBOL "m25p16_CAPFModify"
??m25p16_CAPFModify?relay SYMBOL "?relay", m25p16_CAPFModify
m25p16_EraseAllChip SYMBOL "m25p16_EraseAllChip"
??m25p16_EraseAllChip?relay SYMBOL "?relay", m25p16_EraseAllChip
m25p16_beWIP        SYMBOL "m25p16_beWIP"
??m25p16_beWIP?relay SYMBOL "?relay", m25p16_beWIP
m25p16_deepPowerDown SYMBOL "m25p16_deepPowerDown"
??m25p16_deepPowerDown?relay SYMBOL "?relay", m25p16_deepPowerDown
m25p16_pageModify   SYMBOL "m25p16_pageModify"
??m25p16_pageModify?relay SYMBOL "?relay", m25p16_pageModify
m25p16_pageProgram  SYMBOL "m25p16_pageProgram"
??m25p16_pageProgram?relay SYMBOL "?relay", m25p16_pageProgram
m25p16_readData     SYMBOL "m25p16_readData"
??m25p16_readData?relay SYMBOL "?relay", m25p16_readData
m25p16_readID       SYMBOL "m25p16_readID"
??m25p16_readID?relay SYMBOL "?relay", m25p16_readID
m25p16_readST       SYMBOL "m25p16_readST"
??m25p16_readST?relay SYMBOL "?relay", m25p16_readST
m25p16_sectorErase  SYMBOL "m25p16_sectorErase"
??m25p16_sectorErase?relay SYMBOL "?relay", m25p16_sectorErase
m25p16_wakeUP       SYMBOL "m25p16_wakeUP"
??m25p16_wakeUP?relay SYMBOL "?relay", m25p16_wakeUP
m25p16_writeEnable  SYMBOL "m25p16_writeEnable"
??m25p16_writeEnable?relay SYMBOL "?relay", m25p16_writeEnable

// D:\RE_1_2_0_FORMAL_APP(251)-14-12-8\Projects\zstack\Samples\SampleApp\Source\IRR_enddevice\m25p16.c
//    1 //m25p16.c
//    2 //32扇区*256页*256字节 = 2M字节
//    3 //存储器分配，每条红外编码最大为3072个 字节，共12页。21条编码/扇区
//    4 // 21*30= 630个编码， 故m25p16可以存放630条 3072个字节红外编码
//    5 //m25p16存储区域分配：
//    6 //		第0个扇区为编码区域：存放编码0~20
//    7 //				该扇区第0~11页存放编码0，第11页的第254、255字节存放该条编码的长度
//    8 //				该扇区第12~23页存放编码1，第23页的第254、255字节存放该条编码的长度
//    9 //				该扇区第24~35页存放编码2，第35页的第254、255字节存放该条编码的长度
//   10 //				......
//   11 //				该扇区第240~251页存放编码20，第251页的第254、255字节存放该条编码的长度
//   12 //				其它编码区域扇区(1~29) 编码的存放格式同本扇区，编码区域内编码号取模或取余
//   13 //
//   14 //		第1个扇区为编码区域：存放编码21~41
//   15 //		第2个扇区为编码区域：存放编码42~62
//   16 //		第2个扇区为编码区域：存放编码63~83
//   17 //		......
//   18 //		第29个扇区为编码区域：存放编码609~629
//   19 //
//   20 //		第30个扇区存放各个编码区域的编程标志，		
//   21 //				第0页中第0字节表示编码0~7的编程标志，每位对应一个编码，1为未编程，0为已编程
//   22 //				第0页中第1字节表示编码8~15的编程标志，每位对应一个编码，1为未编程，0为已编程
//   23 //				第0页中第2字节表示编码16~23的编程标志，每位对应一个编码，1为未编程，0为已编程
//   24 //				第0页中第3字节表示编码24~31的编程标志，每位对应一个编码，1为未编程，0为已编程
//   25 //				......
//   26 //				第0页中第77字节表示编码616~623的编程标志，每位对应一个编码，1为未编程，0为已编程
//   27 //				第0页中第78字节表示编码624~629的编程标志，每位对应一个编码，1为未编程，0为已编程
//   28 //		第31个扇区作为数据中转扇区，用于修改某个扇区中的部分数据
//   29 
//   30 
//   31 #include "m25p16.h"

        ASEGN SFR_AN:DATA:NOROOT,080H
// union <unnamed> volatile __sfr _A_P0
_A_P0:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,086H
// unsigned char volatile __sfr U0CSR
U0CSR:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0c1H
// unsigned char volatile __sfr U0DBUF
U0DBUF:
        DATA8
        DS 1
//   32 
//   33 #define	m25p16_select	(P0_4 = 0)	//select m25p16
//   34 #define	m25p16_release	(P0_4 = 1)	//release m25p16
//   35 
//   36 
//   37 
//   38 
//   39 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//   40 //m25p16的数据存取格式：A23 A22 A21 A20 A19 A18 A17 A16 A15 A14 A13 A12 A11 A10 A9 A8 A7 A6 A5 A4 A3 A2 A1 A0
//   41 //扇区号 A23 A22 A21 A20  A19 A18 A17 A16 其中A23 A22 A21固定为0，共32个扇区
//   42 //页面号 A15 A14 A13 A12  A11 A10 A9  A8  每个扇区256个page
//   43 //字节号 A7  A6  A5  A4   A3  A2  A1  A0  每个page 256个字节

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   44 static unsigned char m25p16_ST;				//m25p16状态寄存器
m25p16_ST:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   45 static unsigned char m_dummy_data;			//用于m25p16的虚读操作
m_dummy_data:
        DS 1
        REQUIRE __INIT_XDATA_Z
//   46 //static unsigned char m25p16_wrBuff[256];	//m25p16页面写缓冲区
//   47 //static unsigned char m25p16_rdBuff[256];	//m25p16页面读缓冲区

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA32
//   48 unsigned char m25p16_ID[4];			//m25p16 ID  ： 00  20  20  15 
m25p16_ID:
        DS 4
        REQUIRE __INIT_XDATA_Z
//   49 
//   50 
//   51 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//   52 //                                                    M25P16的基本读写访问                                               //
//   53 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//   54 
//   55 //**********************************************************************************
//   56 //enable m25p16 write operation

        RSEG BANKED_CODE:CODE:NOROOT(0)
//   57 void m25p16_writeEnable(void)
m25p16_writeEnable:
        CFI Block cfiBlock0 Using cfiCommon0
        CFI Function m25p16_writeEnable
        CODE
//   58 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//   59 	//while(0 == (U0CSR &(1<<1)));	//直到发送完成
//   60 	//U0CSR &= ~(1<<1);				//清楚标志位
//   61 	m25p16_select;					//select m25p16
        CLR     0x80.4
//   62 
//   63 	U0DBUF = 0x06;					//0000 0110b (command)
        MOV     0xc1,#0x6
//   64 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_writeEnable_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_writeEnable_0
//   65 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//   66 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//   67 	m25p16_release;					//release m25p16
        SETB    0x80.4
//   68 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock0
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//   69 
//   70 
//   71 //***********************************************************************************
//   72 //read m25p16 identification

        RSEG BANKED_CODE:CODE:NOROOT(0)
//   73 void m25p16_readID(void)
m25p16_readID:
        CFI Block cfiBlock1 Using cfiCommon0
        CFI Function m25p16_readID
        CODE
//   74 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//   75 	//while(0 == (U0CSR &(1<<1)));	//直到发送完成
//   76 	//U0CSR &= ~(1<<1);				//清楚标志位
//   77 	m25p16_select;					//select m25p16
        CLR     0x80.4
//   78 
//   79 	U0DBUF = 0x9F;					//read m25p16 device ID (command)
        MOV     0xc1,#-0x61
//   80 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readID_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readID_0
//   81 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//   82 	m25p16_ID[0] = U0DBUF;		//dummy read, High Impedance
        MOV     A,0xc1
        MOV     DPTR,#m25p16_ID
        MOVX    @DPTR,A
//   83 
//   84 	U0DBUF = 0x00;					//dummy write
        MOV     0xc1,#0x0
//   85 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readID_1:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readID_1
//   86 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//   87 	m25p16_ID[1] = U0DBUF;		//20h
        MOV     A,0xc1
        MOV     DPTR,#m25p16_ID + 1
        MOVX    @DPTR,A
//   88 
//   89 	U0DBUF = 0x00;					//dummy write
        MOV     0xc1,#0x0
//   90 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readID_2:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readID_2
//   91 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//   92 	m25p16_ID[2] = U0DBUF;		//20h
        MOV     A,0xc1
        MOV     DPTR,#m25p16_ID + 2
        MOVX    @DPTR,A
//   93 
//   94 	U0DBUF = 0x00;					//dummy write
        MOV     0xc1,#0x0
//   95 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readID_3:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readID_3
//   96 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//   97 	m25p16_ID[3] = U0DBUF;		//15h
        MOV     A,0xc1
        MOV     DPTR,#m25p16_ID + 3
        MOVX    @DPTR,A
//   98 	
//   99 	m25p16_release;					//release m25p16
        SETB    0x80.4
//  100 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock1
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  101 
//  102 
//  103 
//  104 //************************************************************************************
//  105 //read m25p16 status register

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  106 void m25p16_readST(void)
m25p16_readST:
        CFI Block cfiBlock2 Using cfiCommon0
        CFI Function m25p16_readST
        CODE
//  107 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  108 	m25p16_select;					//select m25p16
        CLR     0x80.4
//  109 
//  110 	U0DBUF = 0x05;					//0000 0101b (command)
        MOV     0xc1,#0x5
//  111 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readST_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readST_0
//  112 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  113 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  114 	
//  115 	U0DBUF = 0x00;					//dummy write
        MOV     0xc1,#0x0
//  116 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readST_1:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readST_1
//  117 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  118 	m25p16_ST = U0DBUF;				//m25p16状态寄存器
        MOV     A,0xc1
        MOV     DPTR,#m25p16_ST
        MOVX    @DPTR,A
//  119 	
//  120 	m25p16_release;					//release m25p16
        SETB    0x80.4
//  121 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock2
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  122 
//  123 //*************************************************************************************
//  124 //judge m25p16 status register's WIP (write in progress) bit

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  125 void m25p16_beWIP(void)
m25p16_beWIP:
        CFI Block cfiBlock3 Using cfiCommon0
        CFI Function m25p16_beWIP
        CODE
//  126 {
        FUNCALL m25p16_beWIP, m25p16_readST
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  127 	do
//  128 	{
//  129 		m25p16_readST();
??m25p16_beWIP_0:
        ; Setup parameters for call to function m25p16_readST
        LCALL   ??m25p16_readST?relay
//  130 	}while((m25p16_ST & 0x01) == 0x01);			//等待WIP位变为0
        MOV     DPTR,#m25p16_ST
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.0
        JC      ??m25p16_beWIP_0
//  131 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock3
//  132 
//  133 //**************************************************************************************
//  134 //read m25p16 data byte
//  135 //source_sector_addr: sector no
//  136 //source_page_addr: page no
//  137 //source_byte_addr: byte no
//  138 //length: 准备读取的数据长度，1 --> 256 (注意：char表示不了256，此处一定要用int)

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  139 void m25p16_readData(unsigned char source_sector_addr,
m25p16_readData:
        CFI Block cfiBlock4 Using cfiCommon0
        CFI Function m25p16_readData
        CODE
//  140 					 unsigned char source_page_addr,
//  141 					 unsigned char source_byte_addr,
//  142 					 uint8* rdBuff,
//  143 					 unsigned int length)
//  144 {
        MOV     A,#-0xa
        LCALL   ?BANKED_ENTER_XDATA
        CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
        CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
        CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
        CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
        CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
        CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
        CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-7)))
        CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-8)))
        CFI VB load(1, XDATA, add(CFA_XSP16, literal(-9)))
        CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
        CFI CFA_SP SP+0
        CFI CFA_XSP16 add(XSP16, 10)
        ; Saved register size: 10
        ; Auto size: 0
        MOV     A,#0xa
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
//  145 	unsigned int m_rdCnt;						//读操作计数器
//  146 
//  147 	m25p16_select;					//select m25p16
        CLR     0x80.4
//  148 
//  149 	U0DBUF = 0x03;					//0000 0011b (read data bytes command)
        MOV     0xc1,#0x3
//  150 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readData_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readData_0
//  151 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  152 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  153 
//  154 	U0DBUF = source_sector_addr;				//A23 -- A16 (A23 to A21 can be ignored)
        MOV     0xc1,R1
//  155 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readData_1:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readData_1
//  156 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  157 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  158 
//  159 	U0DBUF = source_page_addr;					//A15 -- A8
        MOV     0xc1,R2
//  160 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readData_2:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readData_2
//  161 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  162 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  163 
//  164 	U0DBUF = source_byte_addr;					//A7 -- A0
        MOV     0xc1,R3
//  165 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_readData_3:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readData_3
//  166 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  167 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  168 
//  169 	for(m_rdCnt = 0; m_rdCnt < length; m_rdCnt++)
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_readData_4:
        CLR     C
        MOV     A,R6
        SUBB    A,?V0 + 0
        MOV     A,R7
        SUBB    A,?V0 + 1
        JNC     ??m25p16_readData_5
//  170 	{
//  171 		U0DBUF = 0x00;						//dummy write
        MOV     0xc1,#0x0
//  172 		while(0 == (U0CSR &(1<<1)));		//直到发送完成
??m25p16_readData_6:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_readData_6
//  173 		U0CSR &= ~(1<<1);					//清楚标志位
        ANL     0x86,#0xfd
//  174 		//rdBuff[m_rdCnt] = U0DBUF;	//store read data bytes
//  175 		*rdBuff = U0DBUF;	//store read data bytes
        MOV     A,0xc1
        MOV     DPL,R4
        MOV     DPH,R5
        MOVX    @DPTR,A
//  176 		rdBuff++;
        MOV     DPL,R4
        MOV     DPH,R5
        INC     DPTR
        MOV     R4,DPL
        MOV     R5,DPH
//  177 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_readData_4
//  178 
//  179 	m25p16_release;							//release m25p16
??m25p16_readData_5:
        SETB    0x80.4
//  180 }
        MOV     R7,#0x2
        LJMP    ?BANKED_LEAVE_XDATA
        CFI EndBlock cfiBlock4
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  181 
//  182 //*********************************************************************************************
//  183 //write m25p16 data page (PAGE PROGRAM COMMAND)
//  184 //dest_sector_addr: sector no
//  185 //dest_page_addr: page no
//  186 //dest_byte_addr: byte no
//  187 //length: 准备写入的数据长度，1 --> 256

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  188 void m25p16_pageProgram(unsigned char dest_sector_addr,
m25p16_pageProgram:
        CFI Block cfiBlock5 Using cfiCommon0
        CFI Function m25p16_pageProgram
        CODE
//  189 						unsigned char dest_page_addr,
//  190 						unsigned char dest_byte_addr,
//  191 						uint8* wrBuff,
//  192 						unsigned int length)
//  193 {
        MOV     A,#-0xa
        LCALL   ?BANKED_ENTER_XDATA
        CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
        CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
        CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
        CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
        CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
        CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
        CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-7)))
        CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-8)))
        CFI VB load(1, XDATA, add(CFA_XSP16, literal(-9)))
        CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
        CFI CFA_SP SP+0
        CFI CFA_XSP16 add(XSP16, 10)
        ; Saved register size: 10
        ; Auto size: 0
        MOV     A,#0xa
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
//  194 	unsigned int m_wrCnt;						//写操作计数器
//  195 
//  196 	m25p16_select;								//select m25p16
        CLR     0x80.4
//  197 
//  198 	U0DBUF = 0x02;					//0000 0010b (read data bytes command)
        MOV     0xc1,#0x2
//  199 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_pageProgram_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_pageProgram_0
//  200 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  201 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  202 
//  203 	U0DBUF = dest_sector_addr;				//A23 -- A16 (A23 to A21 can be ignored)
        MOV     0xc1,R1
//  204 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_pageProgram_1:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_pageProgram_1
//  205 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  206 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  207 
//  208 	U0DBUF = dest_page_addr;					//A15 -- A8
        MOV     0xc1,R2
//  209 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_pageProgram_2:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_pageProgram_2
//  210 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  211 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  212 
//  213 	U0DBUF = dest_byte_addr;					//A7 -- A0
        MOV     0xc1,R3
//  214 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_pageProgram_3:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_pageProgram_3
//  215 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  216 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  217 
//  218 	for(m_wrCnt = 0; m_wrCnt < length; m_wrCnt++)
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_pageProgram_4:
        CLR     C
        MOV     A,R6
        SUBB    A,?V0 + 0
        MOV     A,R7
        SUBB    A,?V0 + 1
        JNC     ??m25p16_pageProgram_5
//  219 	{
//  220 		//U0DBUF = wrBuff[m_wrCnt];		//
//  221 		U0DBUF = *wrBuff;		//
        MOV     DPL,R4
        MOV     DPH,R5
        MOVX    A,@DPTR
        MOV     0xc1,A
//  222 		wrBuff++;
        MOV     DPL,R4
        MOV     DPH,R5
        INC     DPTR
        MOV     R4,DPL
        MOV     R5,DPH
//  223 		while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_pageProgram_6:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_pageProgram_6
//  224 		U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  225 		m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  226 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_pageProgram_4
//  227 
//  228 	m25p16_release;							//release m25p16
??m25p16_pageProgram_5:
        SETB    0x80.4
//  229 }
        MOV     R7,#0x2
        LJMP    ?BANKED_LEAVE_XDATA
        CFI EndBlock cfiBlock5
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  230 
//  231 //***********************************************************************************************
//  232 //erase a sector in m25p16 (SECTOR ERASE COMMAND)
//  233 //在对任意一扇区的某页面或某字节进行写之前，该扇区一定应该是擦除过的，否则是写不正确的
//  234 //页面号和字节号最好都是0，仅指定扇区号即可

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  235 void m25p16_sectorErase(unsigned char erase_sector_addr,
m25p16_sectorErase:
        CFI Block cfiBlock6 Using cfiCommon0
        CFI Function m25p16_sectorErase
        CODE
//  236 						unsigned char erase_page_addr,
//  237 						unsigned char erase_byte_addr)
//  238 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  239 	m25p16_select;								//select m25p16
        CLR     0x80.4
//  240 
//  241 	U0DBUF = 0xd8;					//1101 1000b (read data bytes command)
        MOV     0xc1,#-0x28
//  242 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_sectorErase_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_sectorErase_0
//  243 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  244 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  245 
//  246 	U0DBUF = erase_sector_addr;				//A23 -- A16 (A23 to A21 can be ignored)
        MOV     0xc1,R1
//  247 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_sectorErase_1:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_sectorErase_1
//  248 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  249 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  250 
//  251 	U0DBUF = erase_page_addr;					//A15 -- A8
        MOV     0xc1,R2
//  252 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_sectorErase_2:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_sectorErase_2
//  253 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  254 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  255 
//  256 	U0DBUF = erase_byte_addr;					//A7 -- A0
        MOV     0xc1,R3
//  257 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_sectorErase_3:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_sectorErase_3
//  258 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  259 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  260 
//  261 	m25p16_release;							//release m25p16
        SETB    0x80.4
//  262 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock6
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  263 
//  264 
//  265 
//  266 //***********************************************************************************************
//  267 //modify  pages in m25p16 
//  268 //对0~29扇区的部分扇区中的数据作修改，利用第31个扇区作为中转。0~29扇区为编码扇区
//  269 //modify_sector_addr,要修改的页所在的扇区
//  270 //modify_page_start_addr,要修改的起始页
//  271 //modify_page_end_addr，要修改的结束页
//  272 //wrBuff，新的数据
//  273 //length，数据块长度，3个字节一块

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  274 void m25p16_pageModify(unsigned char modify_sector_addr,
m25p16_pageModify:
        CFI Block cfiBlock7 Using cfiCommon0
        CFI Function m25p16_pageModify
        CODE
//  275 					   unsigned char modify_page_start_addr,
//  276 					   unsigned char modify_page_end_addr,
//  277 					   uint16* wrBuffWord,
//  278 					   uint8*  wrBuffByte,
//  279 					   unsigned int length)
//  280 {
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_sectorErase
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_sectorErase
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_pageModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
        CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
        CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
        CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
        CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
        CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
        CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
        CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-7)))
        CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-8)))
        CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-9)))
        CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-10)))
        CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-11)))
        CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-12)))
        CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-13)))
        CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-14)))
        CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-15)))
        CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-16)))
        CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-17)))
        CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-18)))
        CFI VB load(1, XDATA, add(CFA_XSP16, literal(-19)))
        CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-20)))
        CFI CFA_SP SP+0
        CFI CFA_XSP16 add(XSP16, 20)
        ; Saved register size: 20
        ; Auto size: 0
        MOV     ?V0 + 2,R1
        MOV     ?V0 + 3,R2
        MOV     ?V0 + 5,R3
        MOV     ?V0 + 10,R4
        MOV     ?V0 + 11,R5
        MOV     A,#0x14
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 6,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 7,A
//  281 	uint16 Cnt;
//  282 	uint8 SAddr,PAddr,BAddr;//扇区，页，字节地址
//  283 	//uint16 IRCodeIndex = 0;//红外编码的索引0~1023 共1024个红外编码。
//  284 	
//  285 	//擦除中转扇区
//  286 	m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  287 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  288 	m25p16_sectorErase(31,0,0);				//擦除第31扇区
        ; Setup parameters for call to function m25p16_sectorErase
        MOV     R3,#0x0
        MOV     R2,#0x0
        MOV     R1,#0x1f
        LCALL   ??m25p16_sectorErase?relay
//  289 	
//  290 	//写编码总数至31扇区，
//  291 	PAddr = modify_page_start_addr + 11;//modify_page_start_addr=(IRCodeIndex % 21) * 12
        MOV     A,#0xb
        ADD     A,?V0 + 3
        MOV     ?V0 + 1,A
//  292 	BAddr = 254;
        MOV     ?V0 + 0,#-0x2
//  293 	m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  294 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  295 	m25p16_pageProgram(31,PAddr,BAddr,(uint8 *)&(length),2);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x2
        MOV     ?V0 + 9,#0x0
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,#0x18
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R3,?V0 + 0
        MOV     R2,?V0 + 1
        MOV     R1,#0x1f
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  296 	
//  297 	
//  298 	//写更新的数据到中转扇区
//  299 	for(Cnt = 0; Cnt < length; Cnt++)//Cnt = edgeCnt
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_pageModify_0:
        MOV     A,#0x16
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        CLR     C
        MOV     A,R6
        SUBB    A,R0
        MOV     A,R7
        SUBB    A,R1
        JC      $+5
        LJMP    ??m25p16_pageModify_1 & 0xFFFF
//  300 	{
//  301 		SAddr = 31;//中转扇区
        MOV     ?V0 + 4,#0x1f
//  302 		PAddr = modify_page_start_addr + (Cnt*3) / 255;//modify_page_start_addr=(IRCodeIndex % 21) * 12
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        MOV     A,R0
        MOV     B,#0x3
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x3
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     R2,#-0x1
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     A,R0
        ADD     A,?V0 + 3
        MOV     ?V0 + 1,A
//  303 		BAddr = (Cnt*3) % 255;
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        MOV     A,R0
        MOV     B,#0x3
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x3
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     R2,#-0x1
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     A,R2
        MOV     ?V0 + 0,A
//  304 		
//  305 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  306 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  307 		m25p16_pageProgram(SAddr,PAddr,BAddr,(uint8 *)&(wrBuffWord[Cnt]),2);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x2
        MOV     ?V0 + 9,#0x0
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        MOV     A,R0
        MOV     B,#0x2
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x2
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,?V0 + 10
        ADD     A,R0
        MOV     R4,A
        MOV     A,?V0 + 11
        ADDC    A,R1
        MOV     R5,A
        MOV     R3,?V0 + 0
        MOV     R2,?V0 + 1
        MOV     R1,?V0 + 4
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  308 		
//  309 		PAddr = modify_page_start_addr + (Cnt*3+2) / 255;
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        MOV     A,R0
        MOV     B,#0x3
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x3
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,R0
        ADD     A,#0x2
        MOV     R0,A
        MOV     A,R1
        ADDC    A,#0x0
        MOV     R1,A
        MOV     R2,#-0x1
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     A,R0
        ADD     A,?V0 + 3
        MOV     ?V0 + 1,A
//  310 		BAddr = (Cnt*3+2) % 255;
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        MOV     A,R0
        MOV     B,#0x3
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x3
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,R0
        ADD     A,#0x2
        MOV     R0,A
        MOV     A,R1
        ADDC    A,#0x0
        MOV     R1,A
        MOV     R2,#-0x1
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     A,R2
        MOV     ?V0 + 0,A
//  311 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  312 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  313 		m25p16_pageProgram(SAddr,PAddr,BAddr,(uint8 *)&(wrBuffByte[Cnt]),1);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x1
        MOV     ?V0 + 9,#0x0
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,?V0 + 6
        ADD     A,R6
        MOV     R4,A
        MOV     A,?V0 + 7
        ADDC    A,R7
        MOV     R5,A
        MOV     R3,?V0 + 0
        MOV     R2,?V0 + 1
        MOV     R1,?V0 + 4
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  314 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        LJMP    ??m25p16_pageModify_0 & 0xFFFF
//  315 	//转移所更新数据的前半部分至中转扇区
//  316 	for(Cnt = 0;Cnt < modify_page_start_addr; Cnt++)//Cnt = PageAddr
??m25p16_pageModify_1:
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_pageModify_2:
        MOV     ?V0 + 8,?V0 + 3
        MOV     ?V0 + 9,#0x0
        CLR     C
        MOV     A,R6
        SUBB    A,?V0 + 8
        MOV     A,R7
        SUBB    A,?V0 + 9
        JNC     ??m25p16_pageModify_3
//  317 	{
//  318 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  319 		m25p16_readData(modify_sector_addr,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,?V0 + 2
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  320 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  321 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  322 		m25p16_pageProgram(31,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,#0x1f
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  323 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_pageModify_2
//  324 	//转移所更新数据的后半部分至中转扇区
//  325 	for(Cnt = modify_page_end_addr;Cnt < 256; Cnt++)//Cnt = PageAddr
??m25p16_pageModify_3:
        MOV     DPL,?V0 + 5
        MOV     DPH,#0x0
        MOV     R6,DPL
        MOV     R7,DPH
??m25p16_pageModify_4:
        CLR     C
        MOV     A,R6
        SUBB    A,#0x0
        MOV     A,R7
        SUBB    A,#0x1
        JNC     ??m25p16_pageModify_5
//  326 	{
//  327 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  328 		m25p16_readData(modify_sector_addr,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,?V0 + 2
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  329 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  330 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  331 		m25p16_pageProgram(31,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,#0x1f
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  332 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_pageModify_4
//  333 	//将要修改的页所在扇区擦除
//  334 	m25p16_beWIP();
??m25p16_pageModify_5:
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  335 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  336 	m25p16_sectorErase(modify_sector_addr,0,0);				//
        ; Setup parameters for call to function m25p16_sectorErase
        MOV     R3,#0x0
        MOV     R2,#0x0
        MOV     R1,?V0 + 2
        LCALL   ??m25p16_sectorErase?relay
//  337 
//  338 	//从中转扇区拷贝数据至修改页所在的扇区
//  339 	for(Cnt = 0;Cnt < 256; Cnt++)//Cnt = PageAddr
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_pageModify_6:
        CLR     C
        MOV     A,R6
        SUBB    A,#0x0
        MOV     A,R7
        SUBB    A,#0x1
        JNC     ??m25p16_pageModify_7
//  340 	{
//  341 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  342 		m25p16_readData(31,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,#0x1f
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  343 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  344 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  345 		m25p16_pageProgram(modify_sector_addr,Cnt,0,wrBuffByte,256);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 8,#0x0
        MOV     ?V0 + 9,#0x1
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R3,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     R1,?V0 + 2
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 20)
//  346 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_pageModify_6
//  347 }
??m25p16_pageModify_7:
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
        CFI EndBlock cfiBlock7
//  348 
//  349 
//  350 
//  351 //***********************************************************************************************
//  352 //编码区域编程标志修改
//  353 //对0~29扇区中的编码区域是否被编码的标志作修改，利用第31个扇区作为中转。
//  354 //
//  355 //		第30个扇区存放各个编码区域的编程标志，		
//  356 //				第0页中第0字节表示编码0~7的编程标志，每位对应一个编码，1为未编程，0为已编程
//  357 //				第0页中第1字节表示编码8~15的编程标志，每位对应一个编码，1为未编程，0为已编程
//  358 //				第0页中第2字节表示编码16~23的编程标志，每位对应一个编码，1为未编程，0为已编程
//  359 //				第0页中第3字节表示编码24~31的编程标志，每位对应一个编码，1为未编程，0为已编程
//  360 //				......
//  361 //				第0页中第77字节表示编码616~623的编程标志，每位对应一个编码，1为未编程，0为已编程
//  362 //				第0页中第78字节表示编码624~629的编程标志，每位对应一个编码，1为未编程，0为已编程
//  363 //		第31个扇区作为数据中转扇区，用于修改某个扇区中的部分数据
//  364 //IRCodeIndex,要修改的编码号
//  365 //CAPF，编码的新编程标志

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  366 void m25p16_CAPFModify(uint16 IRCodeIndex,uint8 CAPF)
m25p16_CAPFModify:
        CFI Block cfiBlock8 Using cfiCommon0
        CFI Function m25p16_CAPFModify
        CODE
//  367 {
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_sectorErase
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_sectorErase
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_readData
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_beWIP
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_writeEnable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 17, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 17, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_CAPFModify, m25p16_pageProgram
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
        CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
        CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
        CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
        CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
        CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
        CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
        CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
        CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
        CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
        CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
        CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
        CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
        CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
        CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
        CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
        CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
        CFI CFA_SP SP+0
        CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 1
        MOV     A,#-0x1
        LCALL   ?ALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
        MOV     A,R1
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    @DPTR,A
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
//  368 	uint16 Cnt;
//  369 	uint8 SAddr,PAddr,BAddr,CAPF_BAddr;//扇区，页，字节地址
//  370 	//uint16 IRCodeIndex = 0;//红外编码的索引0~1023 共1024个红外编码。
//  371 	
//  372 	//擦除中转扇区
//  373 	m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  374 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  375 	m25p16_sectorErase(31,0,0);				//擦除第31扇区
        ; Setup parameters for call to function m25p16_sectorErase
        MOV     R3,#0x0
        MOV     R2,#0x0
        MOV     R1,#0x1f
        LCALL   ??m25p16_sectorErase?relay
//  376 	
//  377 	
//  378 	CAPF_BAddr = IRCodeIndex / 8;
        MOV     ?V0 + 6,?V0 + 2
        MOV     ?V0 + 7,?V0 + 3
        MOV     A,#0x3
        MOV     R0,#?V0 + 6
        LCALL   ?US_SHR
        MOV     A,?V0 + 6
        MOV     ?V0 + 4,A
//  379 	//写IRCodeIndex的标志位（在CAPF中）到中转扇区
//  380 	
//  381 	SAddr = 31;	//中转扇区
        MOV     ?V0 + 1,#0x1f
//  382 	PAddr = IRCodeIndex / 8 / 256; 	// 一个IRCodeIndex对应一个bit，故一个页可存放8*256个IRCodeIndex 
        MOV     ?V0 + 6,?V0 + 2
        MOV     ?V0 + 7,?V0 + 3
        MOV     A,#0xb
        MOV     R0,#?V0 + 6
        LCALL   ?US_SHR
        MOV     A,?V0 + 6
        MOV     ?V0 + 0,A
//  383 	//BAddr = Cnt ;
//  384 	m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  385 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  386 	m25p16_pageProgram(SAddr,PAddr,CAPF_BAddr,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R3,?V0 + 4
        MOV     R2,?V0 + 0
        MOV     R1,?V0 + 1
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  387 	
//  388 	
//  389 	
//  390 	//转移所更新数据的前半部分至中转扇区
//  391 	for(Cnt = 0; Cnt < CAPF_BAddr; Cnt++)//Cnt = byte
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_CAPFModify_0:
        MOV     ?V0 + 6,?V0 + 4
        MOV     ?V0 + 7,#0x0
        CLR     C
        MOV     A,R6
        SUBB    A,?V0 + 6
        MOV     A,R7
        SUBB    A,?V0 + 7
        JNC     ??m25p16_CAPFModify_1
//  392 	{
//  393 		SAddr = 31;	//中转扇区
        MOV     ?V0 + 1,#0x1f
//  394 		PAddr = IRCodeIndex / 8 / 256; 	// 一个IRCodeIndex对应一个bit，故一个页可存放8*256个IRCodeIndex 
        MOV     ?V0 + 6,?V0 + 2
        MOV     ?V0 + 7,?V0 + 3
        MOV     A,#0xb
        MOV     R0,#?V0 + 6
        LCALL   ?US_SHR
        MOV     A,?V0 + 6
        MOV     ?V0 + 0,A
//  395 		//BAddr = Cnt ;
//  396 		
//  397 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  398 		m25p16_readData(30,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,#0x1e
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  399 		
//  400 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  401 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  402 		m25p16_pageProgram(SAddr,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,?V0 + 1
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  403 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_CAPFModify_0
//  404 
//  405 	//转移所更新数据的后半部分至中转扇区
//  406 	for(Cnt = CAPF_BAddr + 1;Cnt < 256; Cnt++)//Cnt = byte
??m25p16_CAPFModify_1:
        MOV     ?V0 + 6,?V0 + 4
        MOV     ?V0 + 7,#0x0
        MOV     A,?V0 + 6
        ADD     A,#0x1
        MOV     R0,A
        MOV     A,?V0 + 7
        ADDC    A,#0x0
        MOV     R1,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R1
        MOV     R7,A
??m25p16_CAPFModify_2:
        CLR     C
        MOV     A,R6
        SUBB    A,#0x0
        MOV     A,R7
        SUBB    A,#0x1
        JNC     ??m25p16_CAPFModify_3
//  407 	{
//  408 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  409 		m25p16_readData(30,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,#0x1e
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  410 		
//  411 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  412 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  413 		m25p16_pageProgram(SAddr,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,?V0 + 1
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  414 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_CAPFModify_2
//  415 	
//  416 	//将要修改的页所在扇区擦除
//  417 	m25p16_beWIP();
??m25p16_CAPFModify_3:
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  418 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  419 	m25p16_sectorErase(30,0,0);				//
        ; Setup parameters for call to function m25p16_sectorErase
        MOV     R3,#0x0
        MOV     R2,#0x0
        MOV     R1,#0x1e
        LCALL   ??m25p16_sectorErase?relay
//  420 	
//  421 	//从中转扇区拷贝数据至修改页所在的扇区
//  422 	for(Cnt = 0;Cnt < 256; Cnt++)//Cnt = byte
        MOV     R6,#0x0
        MOV     R7,#0x0
??m25p16_CAPFModify_4:
        CLR     C
        MOV     A,R6
        SUBB    A,#0x0
        MOV     A,R7
        SUBB    A,#0x1
        JNC     ??m25p16_CAPFModify_5
//  423 	{	
//  424 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  425 		m25p16_readData(SAddr,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_readData
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,?V0 + 1
        LCALL   ??m25p16_readData?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  426 		m25p16_beWIP();
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  427 		m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  428 		m25p16_pageProgram(30,PAddr,Cnt,(uint8 *)&CAPF,1);
        ; Setup parameters for call to function m25p16_pageProgram
        MOV     ?V0 + 6,#0x1
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
        CFI CFA_XSP16 add(XSP16, 19)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R3,A
        MOV     R2,?V0 + 0
        MOV     R1,#0x1e
        LCALL   ??m25p16_pageProgram?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 17)
//  429 	}
        MOV     A,R6
        ADD     A,#0x1
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??m25p16_CAPFModify_4
//  430 }
??m25p16_CAPFModify_5:
        MOV     A,#0x1
        LCALL   ?DEALLOC_XSTACK8
        CFI CFA_XSP16 add(XSP16, 16)
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
        CFI EndBlock cfiBlock8
//  431 
//  432 
//  433 

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  434 void m25p16_BulkErase(void)
m25p16_BulkErase:
        CFI Block cfiBlock9 Using cfiCommon0
        CFI Function m25p16_BulkErase
        CODE
//  435 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  436 	m25p16_select;								//select m25p16
        CLR     0x80.4
//  437 
//  438 	U0DBUF = 0xC7;					//11000111b (Bulk Erase command)
        MOV     0xc1,#-0x39
//  439 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_BulkErase_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_BulkErase_0
//  440 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  441 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  442 
//  443 	m25p16_release;							//release m25p16
        SETB    0x80.4
//  444 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock9
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  445 
//  446 
//  447 

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  448 void m25p16_EraseAllChip(void)
m25p16_EraseAllChip:
        CFI Block cfiBlock10 Using cfiCommon0
        CFI Function m25p16_EraseAllChip
        CODE
//  449 {
        FUNCALL m25p16_EraseAllChip, m25p16_beWIP
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_EraseAllChip, m25p16_writeEnable
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_EraseAllChip, m25p16_BulkErase
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL m25p16_EraseAllChip, m25p16_beWIP
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 0, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 2, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 0, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  450 	m25p16_beWIP();//等待m25P16空闲，写入块擦除指令
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  451 	m25p16_writeEnable();
        ; Setup parameters for call to function m25p16_writeEnable
        LCALL   ??m25p16_writeEnable?relay
//  452 	m25p16_BulkErase();
        ; Setup parameters for call to function m25p16_BulkErase
        LCALL   ??m25p16_BulkErase?relay
//  453 	m25p16_beWIP();//等待空闲，即表示块擦除完成
        ; Setup parameters for call to function m25p16_beWIP
        LCALL   ??m25p16_beWIP?relay
//  454 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock10
//  455 

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  456 void m25p16_deepPowerDown(void)
m25p16_deepPowerDown:
        CFI Block cfiBlock11 Using cfiCommon0
        CFI Function m25p16_deepPowerDown
        CODE
//  457 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  458 	//while(0 == (U0CSR &(1<<1)));	//直到发送完成
//  459 	//U0CSR &= ~(1<<1);				//清楚标志位
//  460 	m25p16_select;					//select m25p16
        CLR     0x80.4
//  461 
//  462 	U0DBUF = 0xB9;					//1011 1001b (command)
        MOV     0xc1,#-0x47
//  463 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_deepPowerDown_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_deepPowerDown_0
//  464 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  465 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  466 	m25p16_release;					//release m25p16
        SETB    0x80.4
//  467 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock11
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR
//  468 
//  469 

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  470 void m25p16_wakeUP(void)
m25p16_wakeUP:
        CFI Block cfiBlock12 Using cfiCommon0
        CFI Function m25p16_wakeUP
        CODE
//  471 {
        PUSH    DPL
        CFI DPL0 Frame(CFA_SP, 4)
        CFI CFA_SP SP+-4
        PUSH    DPH
        CFI DPH0 Frame(CFA_SP, 5)
        CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  472 	//while(0 == (U0CSR &(1<<1)));	//直到发送完成
//  473 	//U0CSR &= ~(1<<1);				//清楚标志位
//  474 	m25p16_select;					//select m25p16
        CLR     0x80.4
//  475 
//  476 	U0DBUF = 0xAB;					//1010 1011b (command)
        MOV     0xc1,#-0x55
//  477 	while(0 == (U0CSR &(1<<1)));	//直到发送完成
??m25p16_wakeUP_0:
        MOV     A,0x86
        MOV     C,0xE0 /* A   */.1
        JNC     ??m25p16_wakeUP_0
//  478 	U0CSR &= ~(1<<1);				//清楚标志位
        ANL     0x86,#0xfd
//  479 	m_dummy_data = U0DBUF;
        MOV     A,0xc1
        MOV     DPTR,#m_dummy_data
        MOVX    @DPTR,A
//  480 	m25p16_release;					//release m25p16
        SETB    0x80.4
//  481 }
        POP     DPH
        CFI DPH0 SameValue
        CFI CFA_SP SP+-4
        POP     DPL
        CFI DPL0 SameValue
        CFI CFA_SP SP+-3
        LJMP    ?BRET
        CFI EndBlock cfiBlock12
        REQUIRE _A_P0
        REQUIRE U0DBUF
        REQUIRE U0CSR

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_writeEnable?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_writeEnable

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_readID?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_readID

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_readST?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_readST

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_beWIP?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_beWIP

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_readData?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_readData

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_pageProgram?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_pageProgram

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_sectorErase?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_sectorErase

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_pageModify?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_pageModify

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_CAPFModify?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_CAPFModify

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_BulkErase?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_BulkErase

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_EraseAllChip?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_EraseAllChip

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_deepPowerDown?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_deepPowerDown

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??m25p16_wakeUP?relay:
        LCALL   ?BDISPATCH
        DATA
        DC24    m25p16_wakeUP

        END
//  482 
// 
// 1 869 bytes in segment BANKED_CODE
//    78 bytes in segment BANK_RELAYS
//     3 bytes in segment SFR_AN
//     6 bytes in segment XDATA_Z
// 
// 1 947 bytes of CODE  memory
//     0 bytes of DATA  memory (+ 3 bytes shared)
//     6 bytes of XDATA memory
//
//Errors: none
//Warnings: 2
